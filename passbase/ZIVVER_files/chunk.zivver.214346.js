(window.webpackJsonp=window.webpackJsonp||[]).push([[4],[,,,,,function(t,e,i){var n,o;n=[i,e,i(7),i(214),i(215),i(216),i(217),i(218),i(219),i(220)],void 0===(o=function(t,e,i,n,o,s,r,a,c,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i.__exportStar(n,e),i.__exportStar(o,e),i.__exportStar(s,e),i.__exportStar(r,e),i.__exportStar(a,e),i.__exportStar(c,e),i.__exportStar(l,e)}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(7),i(213)],void 0===(o=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i.__exportStar(n,e)}.apply(e,n))||(t.exports=o)},,function(t,e,i){var n,o;n=[i,e,i(7),i(322),i(84),i(323),i(324),i(85),i(325),i(326),i(327),i(328),i(329),i(54),i(86),i(330),i(331)],void 0===(o=function(t,e,i,n,o,s,r,a,c,l,u,p,d,h,f,v,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i.__exportStar(n,e),i.__exportStar(o,e),i.__exportStar(s,e),i.__exportStar(r,e),i.__exportStar(a,e),i.__exportStar(c,e),i.__exportStar(l,e),i.__exportStar(u,e),i.__exportStar(p,e),i.__exportStar(d,e),i.__exportStar(h,e),i.__exportStar(f,e),i.__exportStar(v,e),i.__exportStar(m,e)}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(7),i(89),i(334),i(335),i(93),i(92),i(336),i(55),i(90),i(91),i(337)],void 0===(o=function(t,e,i,n,o,s,r,a,c,l,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i.__exportStar(n,e),i.__exportStar(o,e),i.__exportStar(s,e),i.__exportStar(r,e),i.__exportStar(a,e),i.__exportStar(c,e),i.__exportStar(l,e),i.__exportStar(u,e),i.__exportStar(p,e),i.__exportStar(d,e)}.apply(e,n))||(t.exports=o)},,,,function(t,e,r){var i,n;i=[r,e,r(1),r(287)],void 0===(n=function(t,e,i){"use strict";var n;Object.defineProperty(e,"__esModule",{value:!0}),(n=e.WarningDialogTypes||(e.WarningDialogTypes={})).info="info",n.warning="warning",n.error="error";var o=(s.$inject=["$mdDialog","$translate","config"],s.prototype.cancel=function(){this.$mdDialog.cancel()},s.prototype.submit=function(){this.$mdDialog.hide()},s.factory=function(t){return{controller:s,locals:{config:t},templateUrl:r(288)}},s);function s(t,e,i){this.$mdDialog=t,this.config=i,this.hideSubmitButton=!1,this.config.cancelText=void 0===i.cancelText?"MAIN.CANCEL":i.cancelText,void 0!==i.hideSubmit&&(this.hideSubmitButton=i.hideSubmit),this.explanation=!1===this.config.translate?i.explanation:e.instant(i.explanation,i.explanationParams),this.title=!1===this.config.translate?i.title:e.instant(i.title,i.titleParams)}e.WarningDialog=o,e.WarningDialogModule=i.module("common.warningDialog",[])}.apply(e,i))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BLANK_GIF=i(339),e.LETTER_AVATRS={a:i(340),b:i(341),c:i(342),d:i(343),e:i(344),f:i(345),g:i(346),h:i(347),i:i(348),j:i(349),k:i(350),l:i(351),m:i(352),n:i(353),o:i(354),p:i(355),q:i(356),r:i(357),s:i(358),t:i(359),u:i(360),v:i(361),w:i(362),x:i(363),y:i(364),z:i(365)},e.PRESENCE={online:i(98),online_dnd:i(98),offline:i(366),offline_dnd:i(367)},e.UNKNOWN_PERSON=i(75)}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(7),i(370),i(150),i(149),i(148),i(146),i(147),i(57),i(371),i(372),i(373),i(374),i(375)],void 0===(o=function(t,e,i,n,o,s,r,a,c,l,u,p,d,h,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i.__exportStar(n,e),i.__exportStar(o,e),i.__exportStar(s,e),i.__exportStar(r,e),i.__exportStar(a,e),i.__exportStar(c,e),i.__exportStar(l,e),i.__exportStar(u,e),i.__exportStar(p,e),i.__exportStar(d,e),i.__exportStar(h,e),i.__exportStar(f,e)}.apply(e,n))||(t.exports=o)},,,function(t,e,u){var i,n;i=[u,e,u(1),u(39),u(5),u(25),u(308)],void 0===(n=function(t,e,i,n,o,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=(a.$inject=["$rootScope","$log","AppSwitcherService"],a.prototype.$onInit=function(){var e=this;this.current=this.AppSwitcherService.getContext(),this.AppSwitcherService.getContexts().then(function(t){e.checkCurrentContext(t,e.current),e.contexts=t}),this.$rootScope.$on(o.AuthEvents.scopesChanged,function(){e.AppSwitcherService.getContexts().then(function(t){e.checkCurrentContext(t,e.current),e.contexts=t})})},a.prototype.activateContext=function(t){t.specialId!==this.current.specialId&&this.AppSwitcherService.switchContext(t,"conversations.label",{label:"inbox"})},a.prototype.toggleDropdown=function(){this.open=!this.open},a.prototype.checkCurrentContext=function(t,e){var i=t.map(function(t){return t.theme}),n=t.map(function(t){return t.specialId}),o=this.AppSwitcherService.getDefaultContext();if(void 0!==e.specialId&&-1===n.indexOf(e.specialId))this.$log.warn("Appswitcher resumed with special not active (anymore)",{contexts:t,current:e}),this.AppSwitcherService.switchContext(o,"conversations.label",{});else if(void 0!==e.theme&&void 0===e.specialId){var s=i.indexOf(e.theme);if(-1===s)this.$log.warn("Appswitcher theme is not defined (anymore)",{contexts:t,current:e}),this.AppSwitcherService.switchContext(o,"conversations.label",{});else{var r=t[s];this.$log.debug("Switching to context for theme",{context:r}),this.AppSwitcherService.switchContext(r,"conversations.label",{})}}},a);function a(t,e,i){this.$rootScope=t,this.$log=e,this.AppSwitcherService=i,this.contexts=[],this.open=!1}e.AppSwitcher=r;var c=(l.$inject=["$window","$timeout","$q","$state","SpecialsService","StorageService","AuthSessionService"],l.prototype.getContext=function(){return this.context},l.prototype.getDefaultContext=function(){return i.extend({},this.defaultContext)},l.prototype.getContexts=function(){var e=this;return void 0!==this.contextsPromise||(!1===this.AuthSessionService.hasScope(o.Scopes.SPECIALSUSER)?this.contextsPromise=this.$q.resolve([this.defaultContext]):this.contextsPromise=this.SpecialsService.listSpecials().then(function(t){var i=[];return t.filter(function(t){return"active"===t.status}).forEach(function(t){var e=s.importSpecialTheme(t.theme);i.push({specialId:t.id,name:t.name,icon:e.iconSvg,theme:t.theme})}),e.contexts=[e.defaultContext].concat(i),e.contexts})),this.contextsPromise},l.prototype.switchContext=function(t,e,i){void 0===t.specialId?(this.StorageService.removeItem("LOCAL","application.context"),this.StorageService.removeItem("SESSION","application.theme")):(this.StorageService.setItem("LOCAL","application.context",t),this.StorageService.setItem("SESSION","application.theme",t.theme)),n.locationReload(e,i,this.$window,this.$state)},l.prototype.switchToSpecialId=function(i,n,o){var s=this;return this.getContexts().then(function(t){var e=t.filter(function(t){return t.specialId===i});return 0!==e.length&&(s.switchContext(e[0],n,o),!0)})},l.prototype.restoreContext=function(){var t=this.StorageService.getItem("LOCAL","application.context")||this.getDefaultContext();if(void 0!==t.theme){var e=s.importSpecialTheme(t.theme);t.icon=e.iconSvg}return t},l.prototype.setContextStylesheet=function(t){void 0!==t.theme&&s.loadTheme(t.theme)},l);function l(t,e,i,n,o,s,r){this.$window=t,this.$timeout=e,this.$q=i,this.$state=n,this.SpecialsService=o,this.StorageService=s,this.AuthSessionService=r,this.contexts=[],this.defaultContext={name:"ZIVVER",icon:u(309)},this.context=this.restoreContext(),this.setContextStylesheet(this.context)}e.AppSwitcherService=c,e.AppSwitcherModule=i.module("components.AppSwitcher",[]).service("AppSwitcherService",c).component("appSwitcher",{controller:r,template:u(310)}).run(["$rootScope","$state","$transitions","$mdDialog","$translate","AppSwitcherService",function(t,e,i,r,a,c){i.onBefore({},function(t){var e=t.to(),i=t.params(),n=c.getContext(),o=e.name,s=!1;void 0!==n.specialId&&(-1<o.indexOf("settings.")&&(s=!0),-1<o.indexOf("organization.")&&(s=!0),-1<o.indexOf("contacts.")&&(s=!0),s&&(t.abort(),r.show(r.confirm().textContent(a.instant("app-switcher.CONFIRM.SWITCH",{theme:n.name})).ok(a.instant("MAIN.OK")).cancel(a.instant("MAIN.CANCEL"))).then(function(){c.switchContext(c.getDefaultContext(),e.name,i)})))})}])}.apply(e,i))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(7),i(1),i(95),i(96),i(99),i(100),i(102),i(103),i(52),i(104),i(105),i(106),i(107),i(108),i(109),i(111),i(112),i(113),i(114),i(31),i(115),i(116),i(117),i(118),i(119),i(120),i(121),i(122),i(123),i(124),i(125),i(126),i(127),i(128),i(129),i(130),i(131),i(132),i(133),i(134),i(135),i(136),i(137),i(138),i(139),i(140),i(141),i(142),i(143),i(144),i(145),i(151),i(152),i(153),i(154),i(50),i(155),i(95),i(96),i(99),i(100),i(102),i(103),i(52),i(104),i(105),i(106),i(107),i(108),i(109),i(111),i(112),i(113),i(114),i(31),i(115),i(116),i(118),i(117),i(119),i(120),i(121),i(122),i(123),i(124),i(125),i(126),i(127),i(128),i(129),i(130),i(131),i(132),i(133),i(134),i(135),i(136),i(137),i(138),i(139),i(140),i(141),i(142),i(143),i(144),i(145),i(151),i(152),i(153),i(154),i(50),i(155)],void 0===(o=function(t,e,i,n,o,s,r,a,c,l,u,p,d,h,f,v,m,g,S,$,y,b,w,E,C,T,A,I,R,x,D,O,M,_,P,L,k,N,F,U,V,j,B,z,q,G,H,W,K,Y,Q,Z,X,J,tt,et,it,nt,ot,st,rt,at,ct,lt,ut,pt,dt,ht,ft,vt,mt,gt,St,$t,yt,bt,wt,Et,Ct,Tt,At,It,Rt,xt,Dt,Ot,Mt,_t,Pt,Lt,kt,Nt,Ft,Ut,Vt,jt,Bt,zt,qt,Gt,Ht,Wt,Kt,Yt,Qt,Zt,Xt,Jt,te,ee,ie,ne,oe,se){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i.__exportStar(st,e),i.__exportStar(rt,e),i.__exportStar(at,e),i.__exportStar(ct,e),i.__exportStar(lt,e),i.__exportStar(ut,e),i.__exportStar(pt,e),i.__exportStar(dt,e),i.__exportStar(ht,e),i.__exportStar(ft,e),i.__exportStar(vt,e),i.__exportStar(mt,e),i.__exportStar(gt,e),i.__exportStar(St,e),i.__exportStar($t,e),i.__exportStar(yt,e),i.__exportStar(bt,e),i.__exportStar(wt,e),i.__exportStar(Et,e),i.__exportStar(Ct,e),i.__exportStar(Tt,e),i.__exportStar(At,e),i.__exportStar(It,e),i.__exportStar(Rt,e),i.__exportStar(xt,e),i.__exportStar(Dt,e),i.__exportStar(Ot,e),i.__exportStar(Mt,e),i.__exportStar(_t,e),i.__exportStar(Pt,e),i.__exportStar(Lt,e),i.__exportStar(kt,e),i.__exportStar(Nt,e),i.__exportStar(Ft,e),i.__exportStar(Ut,e),i.__exportStar(Vt,e),i.__exportStar(jt,e),i.__exportStar(Bt,e),i.__exportStar(zt,e),i.__exportStar(qt,e),i.__exportStar(Gt,e),i.__exportStar(Ht,e),i.__exportStar(Wt,e),i.__exportStar(Kt,e),i.__exportStar(Yt,e),i.__exportStar(Qt,e),i.__exportStar(Zt,e),i.__exportStar(Xt,e),i.__exportStar(Jt,e),i.__exportStar(te,e),i.__exportStar(ee,e),i.__exportStar(ie,e),i.__exportStar(ne,e),i.__exportStar(oe,e),i.__exportStar(se,e),e.ZivverServicesModule=n.module("zivver.services",[]).service("AccessRightGrantService",o.AccessRightGrantService).service("AccountsService",s.AccountsService).service("ActiveSessionsService",r.ActiveSessionsService).service("AddressBookService",a.AddressBookService).service("AliasService",c.AliasService).service("AuditLogService",l.AuditLogService).service("AuthSessionService",u.AuthSessionService).service("AvailabilityService",p.AvailabilityService).service("BusinessRulesService",d.BusinessRulesService).service("CommunicationLogService",h.CommunicationLogService).service("ConnectedServicesService",f.ConnectedServicesService).service("ContactsService",v.ContactsService).service("ConversationStartersService",m.ConversationStartersService).service("ConversationsService",g.ConversationsService).service("DelegateAccountService",S.DelegateAccountService).service("DeviceService",$.DeviceService).service("DraftsRecipientsService",y.DraftsRecipientsService).service("DraftsService",b.DraftsService).service("DraftsValidationService",w.DraftsValidationService).service("FilesOutService",E.FilesOutService).service("FTPService",C.FTPService).service("GeoService",A.GeoService).service("FunctionsService",T.FunctionsService).service("InvitesService",I.InvitesService).service("KeysService",R.KeysService).service("LabelService",x.LabelService).service("LoggerService",D.LoggerService).service("LoginService",O.LoginService).service("MediaService",M.MediaService).service("MessengerService",_.MessengerService).service("MultifactorService",P.MultifactorService).service("NotificationService",L.NotificationService).service("OrganizationService",k.OrganizationService).service("PasswordService",N.PasswordService).service("PrintService",F.PrintService).service("ProfileService",U.ProfileService).service("QuickStatsService",V.QuickStatsService).service("RecoveryKeyService",j.RecoveryKeyService).service("ReplyService",B.ReplyService).service("SanitizeService",z.SanitizeService).service("ScrollService",q.ScrollService).service("SettingsService",G.SettingsService).service("ShareTokenService",H.ShareTokenService).service("SignatureService",W.SignatureService).service("SignupService",K.SignupService).service("BusinessSignupService",Y.BusinessSignupService).service("LegalDocumentsService",Q.LegalDocumentsService).service("SsoService",Z.SsoService).service("SpecialsService",X.SpecialsService).service("StatisticsService",J.StatisticsService).service("StorageService",tt.StorageService).service("SurveyService",et.SurveyService).service("ThemeService",it.ThemeService).service("WebSocketService",nt.WebSocketService).service("WizardService",ot.WizardService).run(["DeviceService",function(t){t.isDesktop()}])}.apply(e,n))||(t.exports=o)},,function(t,e,i){t.exports=i.p+"assets/img/ZIVVER-logo.2adc78.svg"},,,,function(t,e,s){var i;void 0===(i=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={telede:s(297),teleecg:s(298)};function n(t){var e=(new Date).toISOString().split("T").shift().replace(/-/g,""),i=document.createElement("link");i.rel="stylesheet",i.media="screen",i.href=t+"?"+e,document.body.appendChild(i)}function o(t){return void 0!==i[t]}e.loadTheme=function(t){if(!1!==o(t)){document.body.classList.add("theme-"+t),n(i[t]),n("/assets/themes/"+t+"/material.css");try{window.sessionStorage.setItem("application.theme",JSON.stringify(t))}catch(t){}}},e.unloadTheme=function(){for(var t=document.body.classList,e=0,i=t.value.split(" ");e<i.length;e++){var n=i[e];0===n.indexOf("theme-")&&t.remove(n)}window.sessionStorage.removeItem("application.theme")},e.validTheme=o,e.importSpecialTheme=function(t){switch(t){case"telede":return s(299);case"teleecg":return s(302);default:throw new Error("Unexpected theme: "+t)}}}.apply(e,[s,e]))||(t.exports=i)},,,,function(t,e,s){var i,n;i=[s,e,s(1),s(451)],void 0===(n=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$rootScope","$scope","$timeout","$element","$mdSidenav"],o.prototype.$onInit=function(){var e=this;this.locationChangeStartListener=this.$rootScope.$on("$locationChangeStart",function(t){t.preventDefault(),e.$mdSidenav("sidepane").close()}),this.$scope.$applyAsync(function(){e.$mdSidenav("sidepane").open(),e.$mdSidenav("sidepane").onClose(function(){void 0!==e.onClose&&e.$timeout(function(){return e.onClose()},250)})})},o.prototype.$onDestroy=function(){this.locationChangeStartListener()},o.prototype.closePane=function(){this.$mdSidenav("sidepane").close()},o);function o(t,e,i,n,o){this.$rootScope=t,this.$scope=e,this.$timeout=i,this.$element=n,this.$mdSidenav=o,document.body.appendChild(this.$element[0])}e.SidepaneModule=i.module("components.sidePane",[]).component("sidepane",{controller:n,bindings:{onClose:"&"},transclude:{title:"paneTitle",content:"paneContent"},template:s(452)})}.apply(e,i))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(7)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.removeEmptyProps=function(t){var e=i.__assign({},t);return Object.keys(t).forEach(function(t){""!==e[t]&&null!==e[t]&&void 0!==e[t]||delete e[t]}),e}}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(7),i(9),i(6)],void 0===(o=function(t,e,o,s,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.$inject=["$rootScope","$http","$q","$window","DraftsValidationService"],n.prototype.list=function(t,e){var i={offset:t,limit:e,creator:"webapp"};return this.$http.get("/api/drafts",{params:i}).then(function(t){return t.data}).then(function(t){return{items:t.items.map(function(t){return new s.Draft(t)}),pagination:t.pagination}})},n.prototype.get=function(t){return this.$http.get("/api/drafts/"+t).then(function(t){return t.data}).then(function(t){return new s.Draft(t)})},n.prototype.save=function(t,e){t.isModified=!1;var i=this.getDraftRequestEntity(t,e);return void 0===t.id?this.$http.post("/api/drafts",i).then(function(t){return t.data}).then(function(t){return new s.Draft(t)}):this.$http.put("/api/drafts/"+t.id,i).then(function(t){return t.data}).then(function(t){return new s.Draft(t)})},n.prototype.remove=function(t){var e=this,i=[this.$http.delete("/api/drafts/"+t.id)];return t.files.forEach(function(t){i.push(e.$http.delete("/api/files_out/"+t.id))}),this.$q.all(i).then(function(){return!0})},n.prototype.send=function(t){var e={draft:this.getDraftRequestEntity(t)},i=[];return i.push(this.$http.post("/api/drafts/finalize",e).then(function(t){return t.data}).then(function(t){return new s.FinalizeResult(t)})),null!==t.id&&void 0!==t.id&&i.push(this.$http.delete("/api/drafts/"+t.id)),this.$q.all(i).then(function(t){return t[0]})},n.prototype.validate=function(i){var n=this,t={draft:this.getDraftRequestEntity(i)};return this.$http.put("/api/drafts/validation",t).then(function(t){var e=new s.ValidationStatus(t.data,n.DraftsValidationService.getDismissedViolationsIds(i.id));return e.validationCompleted=t.status===r.HTTP_OK,e=e.addClientViolations(i.validation.clientViolations),n.$rootScope.$broadcast(a.ValidationsUpdated,{validation:e}),e})},n.prototype.setAccessRightGrant=function(t){void 0===t?delete this.grantToken:this.grantToken=t},n.prototype.getDraftRequestEntity=function(t,e){var i,n=t.toRequestEntity();if(t.isReply()||t.isFoward()){if(void 0===this.grantToken)throw Error("accessRightGrant is undefined");void 0!==t.quote&&(i={conversationId:t.quote.conversationInfo.id,messageIds:t.quote.messages.filter(function(t){return!1===t.revoked}).map(function(t){return t.id})}),void 0!==e&&(i=e),0!==i.messageIds.length&&(n.quote=o.__assign({},i,{downloadGrant:this.grantToken.token}))}return n},n);function n(t,e,i,n,o){this.$rootScope=t,this.$http=e,this.$q=i,this.$window=n,this.DraftsValidationService=o}e.DraftsService=i;var a=(c.ValidationsUpdated="DraftEvents.ValidationsUpdated",c);function c(){}e.DraftEvents=a}.apply(e,n))||(t.exports=o)},,,,,,function(t,e,i){var n,o;n=[i,e,i(7),i(206),i(207),i(208)],void 0===(o=function(t,e,i,n,o,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i.__exportStar(n,e),i.__exportStar(o,e),i.__exportStar(s,e)}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(1),i(242)],void 0===(o=function(t,e,c){"use strict";i.$inject=["$q","PasswordService"],Object.defineProperty(e,"__esModule",{value:!0});var l=72;function i(r,a){return{require:"ngModel",priority:9999,link:function(t,e,i,n){var o=c.element("<div></div>")[0];function s(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null),n.$strength={pwarning:null!==i&&""!==i&&i,suggestions:null!==e&&0<e.length&&e,"score-0":0===t,"score-1":1===t,"score-2":2===t,"score-3":3===t,"score-4":4===t},n.$strength.score=t,o.setAttribute("data-score",t)}o.className="password-strength",o.setAttribute("data-score","0"),e.after(o),e.attr("maxlength",l),e.parent().addClass("password-strength").attr("md-is-error","ctrl.form.password.$dirty"),s(-1),n.$viewChangeListeners.push(function(){void 0===n.$viewValue&&(s(0),n.$setValidity("passwordStrength",!0))}),n.$asyncValidators.passwordStrength=function(t){if(n.$isEmpty(t))return s(0),r.resolve(!0);var e=a.test(t);return e.catch(function(t){return s(t.data.score,t.data.suggestions,t.data.warning),r.reject(!1)}),e.then(function(t){return s(t.score,t.suggestions,t.warning),0!=t.score>=t.minimumScore||r.reject(!1)})}}}}e.PasswordStrengthDirectiveModule=c.module("zivver.PasswordStrengthDirective",[]).directive("passwordStrength",i)}.apply(e,n))||(t.exports=o)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.locationReload=function(t,e,i,n){void 0===e&&(e={}),i.location.href=n.href(t,e,{absolute:!0})}}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(9),i(14),i(50)],void 0===(o=function(t,e,i,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=(Object.defineProperty(r.prototype,"fullName",{get:function(){var t;return void 0!==this.personal&&void 0!==this.personal.fullName?t=this.personal.fullName:void 0!==this.organization&&void 0!==this.organization.fullName?t=this.organization.fullName:void 0!==this.profile&&void 0!==this.profile.fullName&&(t=this.profile.fullName),void 0!==t&&0<t.length?t:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"picture",{get:function(){return void 0!==this.profile&&void 0!==this.profile.picture?this.profile.picture:n.UNKNOWN_PERSON},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"phonenumber",{get:function(){return void 0!==this.personal&&void 0!==this.personal.phonenumber?this.personal.phonenumber:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"language",{get:function(){return void 0!==this.personal&&void 0!==this.personal.language?this.personal.language:void 0},enumerable:!0,configurable:!0}),r.prototype.toRecipient=function(){var t=new i.Recipient({email:this.email,fullName:this.fullName,phonenumber:this.phonenumber,language:this.language});return t.picture=void 0!==this.profile?this.profile.picture:void 0,t.verifications=this.verifications,t.accessRightSetup=this.getDefaultAccessRight(),t},r.prototype.getDefaultAccessRight=function(){if(0!==this.verifications.length)return i.AccessRightSetup.fromVerification(this.verifications[0])},r);function r(t){this.isSelected=!1,this.presence=o.WebsocketPresenceEnum.offline,void 0!==t&&(this.email=t.email,this.organization=t.organization,this.personal=t.personal||{id:void 0},this.profile=t.profile,this.verifications=t.verifications||[],this.uuid=t.uuid)}e.Contact=s}.apply(e,n))||(t.exports=o)},,,,,,,,,,function(t,e,i){var n,o;n=[i,e,i(7)],void 0===(o=function(t,e,n){"use strict";var c,i,l,o,u,s,r,a,p,d;Object.defineProperty(e,"__esModule",{value:!0}),(i=c=c||{}).Ping="Ping",i.PresenceSet="PresenceSet",i.PresenceSubscribe="PresenceSubscribe",(o=l=l||{}).Pong="Pong",o.PresenceChanged="PresenceChanged",o.TriggerPoll="TriggerPoll",o.CircuitBreakerTripped="CircuitBreakerTripped",(s=u=e.WebSocketEvents||(e.WebSocketEvents={})).CONVERSATION_UPDATED="CONVERSATION_UPDATED",s.PRESENCE_CHANGED="PRESENCE_CHANGED",(a=r=e.WebsocketPresenceEnum||(e.WebsocketPresenceEnum={})).offline="offline",a.offline_dnd="offline_dnd",a.online="online",a.online_dnd="online_dnd",(d=p=p||{})[d.CONNECTING=0]="CONNECTING",d[d.OPEN=1]="OPEN",d[d.CLOSING=2]="CLOSING",d[d.CLOSED=3]="CLOSED";var h=(f.$inject=["$rootScope","$interval","$timeout","$http","$q","$log","$location"],f.prototype.open=function(){var e=this;return this.hasSocketState([p.OPEN,p.CONNECTING])?this.$q.resolve():this.getWebsocketToken().then(function(t){return e.initSocket(t)}).catch(function(t){return e.$log.warn("Could not open websocket",{error:t})})},f.prototype.send=function(t,e){var i=JSON.stringify(n.__assign({type:t},e));this.$log.debug("Sending message over websocket "+i),!1===this.isOpen()?(this.$log.debug("Cannot send data with websocket, because it is not open. Queueing it",{message:i}),this.messageQueue.push(i)):this.circuitBreakerTripped?this.$log.info("Cannot send data with websocket, because circuitbreaker was tripped, discarding message",{message:i}):this.webSocket.send(i)},f.prototype.close=function(){void 0===this.webSocket||this.hasSocketState([p.CLOSED,p.CLOSING])||this.webSocket.close()},f.prototype.isOpen=function(){return this.hasSocketState([p.OPEN])},f.prototype.setPresence=function(t){var e="stealth"===t?r.offline:r.online;this.send(c.PresenceSet,{presence:e})},f.prototype.getPresence=function(t){var e=this.presenceRegistry[t];return void 0===e&&(this.presenceRegistry[t]=r.offline,this.send(c.PresenceSubscribe,{accountUuid:t})),e||r.offline},f.prototype.onOpen=function(){var t=this;this.sendQueuedMessages(),this.$timeout(function(){t.send(c.Ping)},5e4)},f.prototype.onMessage=function(t){var e=this;if(void 0!==t.data){var i=JSON.parse(t.data);switch(i.type){case l.TriggerPoll:var n=i.conversationUuid;void 0!==this.triggerPollDebounces[n]&&this.$timeout.cancel(this.triggerPollDebounces[n]),this.triggerPollDebounces[n]=this.$timeout(function(){e.$rootScope.$broadcast(u.CONVERSATION_UPDATED,n),e.triggerPollDebounces[n]=void 0},500);break;case l.PresenceChanged:var o=i,s=o.presence,r=o.accountUuid;o.dnd&&(s+="_dnd"),this.$rootScope.$broadcast(u.PRESENCE_CHANGED,{accountUuid:r,presence:s}),this.presenceRegistry[r]=s;break;case l.CircuitBreakerTripped:var a=i.timeout;this.$log.warn("Websocket CircuitBreakerTripped",{waiting:a}),this.circuitBreakerTripped=!0,this.$timeout(function(){e.circuitBreakerTripped=!1},a||1e4);break;case l.Pong:this.$timeout(function(){e.isOpen()&&e.send(c.Ping)},5e4);break;default:this.$log.warn("Unexpected type for message from websocket",t)}}else this.$log.warn("Got message from websocket, without data",{event:t})},f.prototype.onClose=function(){this.webSocket=void 0,this.presenceRegistry={}},f.prototype.initSocket=function(t){var e=this;try{return this.webSocket=new WebSocket(this.getUrl(t)),this.webSocket.onopen=function(){return e.onOpen()},this.webSocket.onclose=function(){return e.onClose()},this.webSocket.onmessage=function(t){return e.onMessage(t)},this.$timeout(function(){},250,!1)}catch(t){return this.$q.reject(t)}},f.prototype.getWebsocketToken=function(){return this.$http.post("/api/ws",{}).then(function(t){return t.data.token})},f.prototype.getUrl=function(t){var e=this.$location.host(),i=this.$location.port(),n=this.$location.protocol().replace("http","ws");return(-1===[80,443].indexOf(i)?n+"://"+e+":"+i+"/api/":n+"://"+e+"/api/")+"ws/"+t},f.prototype.hasSocketState=function(t){return void 0!==this.webSocket&&-1<t.indexOf(this.webSocket.readyState)},f.prototype.sendQueuedMessages=function(){var e=this;this.messageQueue.forEach(function(t){return e.webSocket.send(t)}),this.messageQueue=[]},f);function f(t,e,i,n,o,s,r){this.$rootScope=t,this.$interval=e,this.$timeout=i,this.$http=n,this.$q=o,this.$log=s,this.$location=r,this.circuitBreakerTripped=!1,this.messageQueue=[],this.presenceRegistry={},this.triggerPollDebounces={}}e.WebSocketService=h}.apply(e,n))||(t.exports=o)},,function(t,e,i){var n,o;n=[i,e,i(1),i(10),i(5)],void 0===(o=function(t,o,e,s,i){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var r="auth.session";o.SESSION_EXPIRATION_DAYS=30;var n=(a.$inject=["$window","$rootScope","$timeout","$log","$cookies","StorageService"],a.prototype.setAccessToken=function(t,e){this.accessToken=t,this.accessTokenExpires=s().add(e,"seconds").toDate()},a.prototype.setRefreshToken=function(t,e){this.removeStorageEventListener();var i=void 0;e&&(i=s().add(o.SESSION_EXPIRATION_DAYS,"days").toDate()),this.session={accountId:t.accountId,delegate:!1,expires:i,guest:!1,refreshToken:t.refreshToken,sessionId:t.sessionId,username:t.username},this.StorageService.setItem("LOCAL",r,this.session);var n={};e&&(n.expires=i),this.$cookies.put(r,"1",n),this.registerStorageEventListener()},a.prototype.forgetMe=function(){delete this.accessToken,delete this.accessTokenExpires,delete this.session,this.removeStorageEventListener(),this.$cookies.remove(r),this.StorageService.removeItem("LOCAL",r),this.StorageService.removeItem("SESSION",r)},a.prototype.forgetDelegate=function(){var t=this;delete this.accessToken,delete this.accessTokenExpires,delete this.session,this.ignoreStorageEvent=!0,this.StorageService.removeItem("SESSION",r),this.restoreSession(),this.$timeout(function(){t.ignoreStorageEvent=!1})},a.prototype.isAuthenticated=function(){return void 0!==this.getAccessToken()&&0<this.getScopes().length},a.prototype.getAccessToken=function(){if(void 0!==this.accessToken){if(new Date<this.accessTokenExpires)return this.accessToken;delete this.accessToken,delete this.accessTokenExpires}},a.prototype.getRefreshToken=function(){return this.hasRefreshToken()?this.session.refreshToken:void 0},a.prototype.hasRefreshToken=function(){return void 0!==this.session&&void 0!==this.session.refreshToken},a.prototype.getUsername=function(){return void 0!==this.session&&void 0!==this.session.username?this.session.username:void 0},a.prototype.getUsernameFromLocalStorage=function(){var t=this.StorageService.getItem("LOCAL",r);return null!==t?t.username:""},a.prototype.setScopes=function(t){!1===e.equals(t,this.scopes)&&this.$rootScope.$broadcast(i.AuthEvents.scopesChanged,{scopes:t}),this.scopes=t},a.prototype.getScopes=function(){return this.scopes},a.prototype.hasScope=function(e){return 1===this.getScopes().filter(function(t){return t===e}).length},a.prototype.hasScopes=function(t,e){if(void 0===e&&(e="OR"),0===t.length)throw Error("no scopes to check");for(var i="OR"!==e,n=0,o=t;n<o.length;n++){var s=o[n],r=this.hasScope(s);i="OR"===e?i||r:i&&r}return i},a.prototype.getAccountId=function(){return void 0!==this.session?this.session.accountId:void 0},a.prototype.getSessionId=function(){return void 0!==this.session?this.session.sessionId:void 0},a.prototype.isDelegate=function(){return void 0!==this.session&&this.session.delegate||!1},a.prototype.isGuest=function(){return void 0!==this.session&&this.session.guest||!1},a.prototype.restoreSession=function(){var t=this.StorageService.getItem("SESSION",r);if(null!==t)return this.session=t,!0;if(void 0===this.$cookies.get(r))return this.StorageService.removeItem("LOCAL",r),this.StorageService.removeItem("SESSION",r),!1;var e=this.StorageService.getItem("LOCAL",r);return null!==e&&(this.session=e,!0)},a.prototype.removeStorageEventListener=function(){void 0!==this.storageEventListener&&(this.$window.removeEventListener("storage",this.storageEventListener),this.storageEventListener=void 0)},a.prototype.registerStorageEventListener=function(){var e=this;this.storageEventListener=function(t){if(null===t.key||t.key===r){if(e.ignoreStorageEvent)return e.$log.debug("auth.session ignoring storage event"),void(e.ignoreStorageEvent=!1);e.$log.debug("auth.session changed in other tab"),e.removeStorageEventListener(),e.$rootScope.$broadcast(i.AuthEvents.logoutOtherTab,{username:e.getUsername()}),delete e.accessToken,delete e.accessTokenExpires,delete e.session}},this.$timeout(function(){e.$window.addEventListener("storage",e.storageEventListener)})},a.prototype.setSessionToken=function(t,e,i){var n=this;this.session={accountId:t.accountId,delegate:e,expires:void 0,guest:i,refreshToken:t.refreshToken,sessionId:t.sessionId,username:t.username},this.ignoreStorageEvent=!0,this.StorageService.setItem("SESSION",r,this.session),this.$timeout(function(){n.ignoreStorageEvent=!1})},a);function a(t,e,i,n,o,s){this.$window=t,this.$rootScope=e,this.$timeout=i,this.$log=n,this.$cookies=o,this.StorageService=s,this.scopes=[],this.ignoreStorageEvent=!1,this.restoreSession()&&this.registerStorageEventListener()}o.AuthSessionService=n}.apply(e,n))||(t.exports=o)},function(t,e,s){var i,n;i=[s,e,s(1),s(291)],void 0===(n=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$log","$http","$timeout"],o.prototype.$onInit=function(){this.withApi=void 0===this.withApi||this.withApi,this.withApi&&this.getBackendVersion()},o.prototype.getBackendVersion=function(){var e=this;10<=this.refreshErrors||this.$http.get("/api/version").then(function(t){return t.data}).then(function(t){null!==e.backend&&e.backend!==t.backendVersion&&e.$log.debug("backend updated to "+t.backendVersion),null!==e.backendApi&&e.backendApi!==t.apiVersion&&e.$log.debug("backend api version updated to "+t.apiVersion),e.backend=t.backendVersion,e.backendApi=t.apiVersion,e.refreshErrors=0}).catch(function(t){e.refreshErrors++,400<=t.status&&e.$log.warn("Uncaught error getting version from api",{error:t})}).finally(function(){e.refreshTimeout=e.$timeout(function(){e.getBackendVersion()},9e5+6e3*e.refreshErrors,!1)})},o);function o(t,e,i){this.$log=t,this.$http=e,this.$timeout=i,this.app="2.16.31",this.api=void 0,this.backend=null,this.backendApi=null,this.refreshTimeout=null,this.refreshErrors=0}e.Version=n,e.VersionModule=i.module("components.version",[]).component("version",{controller:n,template:s(292),bindings:{withApi:"<"}})}.apply(e,i))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.prototype.fullNameOrEmail=function(){return null!==this.fullName?this.fullName:this.email},n.prototype.fullNameAndEmail=function(){return null!==this.fullName?this.fullName+" &lt;"+this.email+"&gt;":this.email},n);function n(t){this.active=!0,this.collapsed=!0,this.fullName=null,this.picture=null,this.removable=!1,this.removed=!1,void 0!==t&&(this.accessRight=t.accessRight,this.active=void 0===t.active||t.active,this.email=t.email,this.fullName=t.fullName||null,this.picture=t.picture||null,this.removable=void 0!==t.removable&&t.removable,this.uuid=t.uuid)}e.Participant=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(89)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.prototype.toRequestEntity=function(){var t={email:this.email};if(void 0!==this.accessRightSetup){var e=this.accessRightSetup,i=e.id,n=e.accessType,o=e.phonenumber,s=e.password;t.accessRightSetup=[{id:i,accessType:n,phonenumber:o,password:s}]}return void 0!==this.fullName&&(t.fullName=this.fullName),void 0!==this.language&&(t.language=this.language),t},o.prototype.fullNameOrEmail=function(){return void 0!==this.fullName?this.fullName:this.email},o);function o(t){this.emailIsValid=!0,this.verifications=[],void 0!==t&&(this.email=t.email,this.language=t.language,this.fullName=t.fullName,this.phonenumber=t.phonenumber,t instanceof o?(this.verifications=t.verifications,this.accessRightSetup=t.accessRightSetup,this.picture=t.picture,this.emailIsValid=t.emailIsValid):void 0!==t.accessRightSetup&&0<t.accessRightSetup.length&&(this.accessRightSetup=new i.AccessRightSetup(t.accessRightSetup[0])))}e.Recipient=n}.apply(e,n))||(t.exports=o)},function(t,e,u){var i,n;i=[u,e,u(1),u(94),u(13),u(58),u(415)],void 0===(n=function(t,e,i,n,o,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=(a.$inject=["$rootScope","$log","$mdDialog","$q","$state","ContactsService","ConversationsService","MessengerService"],a.prototype.$onInit=function(){this.expandable=!1===this.profile.isGuest(),this.collapsedList="READ"===this.listTitle||"BCC"===this.listTitle||"UNREAD"===this.listTitle||"BOUNCES"===this.listTitle,this.isQuotedInfo=!!this.isQuotedInfo&&this.isQuotedInfo,this.collapsable=!!this.collapsable&&this.collapsable,this.isConversationInfo="CONVERSATION"===this.infoType},a.prototype.$onChanges=function(t){void 0!==t.participants&&this.setParticipantsRemoved(),void 0!==this.participants&&this.orderByVerificationProblem()},a.prototype.openContact=function(t){this.profile.isGuest()||this.profile.email===t.email||this.$state.go("contacts.view",{contactEmail:[t.email]})},a.prototype.isVerified=function(t){return!!this.hasAccessRights(t)&&"generatedCode"!==t.accessRight.accessRightType},a.prototype.setParticipantsRemoved=function(){var i=this;if(void 0!==this.conversationParticipants){var n=this.conversationParticipants.map(function(t){return t.email});this.participants.forEach(function(t,e){i.isQuotedInfo?n.indexOf(t.participant.email)<0&&(i.participants[e].removed=!0):n.indexOf(t.email)<0&&(i.participants[e].removed=!0)})}},a.prototype.orderByVerificationProblem=function(){var i=this;this.participants.sort(function(t,e){if(i.hasAccessRights(t)&&i.hasAccessRights(e))return Number(e.accessRight.verificationProblem)-Number(t.accessRight.verificationProblem)})},a.prototype.hasAccessRights=function(t){return void 0!==t.accessRight},a.prototype.isDisabled=function(t){return t.email===this.profile.email||!1===t.active||!0===t.removed},a.prototype.toggleCard=function(t){!0===this.expandable&&(t.collapsed=!t.collapsed)},a.prototype.editVerificationMethod=function(i){var n=this,t=new s.RecipientDialog,e=i;t.resolve.recipient=function(){return n.ContactsService.get(e.email).then(function(t){return t.toRecipient()})},t.locals.verificationProblem=e.accessRight.verificationProblem,this.$mdDialog.show(t).then(function(t){var e=t.toRequestEntity();n.ConversationsService.updateVerification(n.conversationId,i.uuid,{accessRightSetup:e.accessRightSetup[0]}).then(function(t){n.$mdDialog.hide().then(function(){return i.accessRight=t})})})},a.prototype.removeParticipant=function(e){var i=this,t=o.WarningDialog.factory({title:"participants-list.REMOVE.DIALOG.TITLE",explanation:"participants-list.REMOVE.DIALOG.EXPLANATION",explanationParams:{email:e},submitText:"participants-list.REMOVE.DIALOG.CONFIRM",type:o.WarningDialogTypes.error});this.$mdDialog.show(t).then(function(){i.ConversationsService.removeParticipant(i.conversationId,e).then(function(){i.participants=i.participants.filter(function(t){return t.email!==e}),i.$rootScope.$broadcast(c.Updated,i.participants),i.MessengerService.toast("participants-list.REMOVE.SUCCESS")}).catch(function(t){i.$log.warn("Participant "+e+" could not be removed from conversation "+i.conversationId,{error:t}),i.MessengerService.toast("participants-list.REMOVE.FAILED")})})},a.prototype.toggleCollapsedList=function(){this.collapsedList=!this.collapsedList},a);function a(t,e,i,n,o,s,r,a){this.$rootScope=t,this.$log=e,this.$mdDialog=i,this.$q=n,this.$state=o,this.ContactsService=s,this.ConversationsService=r,this.MessengerService=a,this.bccIcon=u(416)}e.ParticipantsList=r;var c=(l.Updated="participants:updated",l);function l(){}e.Events=c,e.ParticipantsListModule=i.module("components.ParticipantsList",[n.ParticipantAvatarsModule.name,o.WarningDialogModule.name]).component("participantsList",{bindings:{collapsable:"<",conversationId:"<",conversationParticipants:"<",expandable:"<",infoType:"<",icon:"@",isQuotedInfo:"<",listTitle:"@",profile:"<",participants:"<",svg:"@"},controller:r,templateUrl:u(417)})}.apply(e,i))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(146)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MessageDefinition=function(t){this.formDefinition=new i.FormDefinition(t.formDefinition),this.id=t.id,this.name=t.name}}.apply(e,n))||(t.exports=o)},function(t,e,c){var i,n;i=[c,e,c(1),c(9),c(159),c(197),c(413)],void 0===(n=function(t,e,i,n,o,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RecipientDialog=function(){this.templateUrl=c(414),this.locals={violations:null,verificationProblem:null},this.resolve={recipient:null},this.controller=r};var r=(a.$inject=["$scope","$log","$mdDialog","$timeout","$translate","$window","ContactsService","recipient","violations","verificationProblem"],a.prototype.initSetupForRecipient=function(){void 0===this.recipient.language&&this.isGuest()&&(this.recipient.language=this.$translate.use()),this.accessRightSetup=this.recipient.accessRightSetup||new n.AccessRightSetup,void 0!==this.accessRightSetup&&this.accessRightSetup.id?this.verificationID=this.accessRightSetup.id:this.hasVerifications()&&(this.verificationID=this.verifications[0].id),this.verificationChanged()},a.prototype.verificationChanged=function(){var t=this;if(void 0!==this.verificationID){var e=this.showUserInputs(),i=e.phonenumber,n=e.accesscode;this.showPhonenumberField=i,this.showAccessCodeField=n;var o=this.verificationProblem&&this.verificationID===this.recipient.accessRightSetup.id;this.$scope.$applyAsync(function(){t.form.verificationID.$setValidity("verificationProblem",!o),void 0!==t.form.phonenumber&&""!==t.accessRightSetup.phonenumber&&(t.form.phonenumber.$setDirty(),t.form.phonenumber.$validate())})}},a.prototype.save=function(){if(this.form.$invalid)this.$log.debug("form is invalid");else{var t=n.AccessRightSetup.fromVerification(this.getSelectedVerificationMethod());t.requiresUserInput&&(t.isSms()?t.phonenumber=this.accessRightSetup.phonenumber:t.isPassword()&&(t.password=this.accessRightSetup.password)),this.recipient.accessRightSetup=t,""===this.recipient.fullName&&(this.recipient.fullName=void 0),this.$mdDialog.hide(this.recipient)}},a.prototype.isGuest=function(){return 0===this.verifications.filter(function(t){return"zivver"===t.verificationType}).length},a.prototype.cancel=function(){this.$mdDialog.cancel()},a.prototype.hasVerifications=function(){return 0<this.verifications.length},a.prototype.showUserInputs=function(){var t=!1,e=!1;if(this.hasVerifications()){var i=this.getSelectedVerificationMethod(),n=i.verificationType,o=i.requiresUserInput;"sms"===n&&(t=o),"password"===n&&(e=o),!1===o&&(this.recipient.phonenumber="",this.accessRightSetup.phonenumber="",this.accessRightSetup.password="")}return{phonenumber:t,accesscode:e}},a.prototype.getContactInfo=function(t){var e=this;this.ContactsService.get(t).then(function(t){void 0===e.recipient.fullName&&void 0!==t.fullName&&(e.recipient.fullName=t.fullName),void 0===e.recipient.phonenumber&&void 0!==t.phonenumber&&(e.recipient.phonenumber=t.phonenumber),e.verifications=t.verifications,e.initSetupForRecipient()}).finally(function(){return e.loading=!1})},a.prototype.getSelectedVerificationMethod=function(){var e=this;return this.verifications.filter(function(t){return t.id===e.verificationID}).shift()},a.prototype.validEmailChanged=function(){var t=this;void 0!==this.recipient.email&&null!==this.recipient.email&&""!==this.recipient.email&&this.$timeout(function(){t.recipient.accessRightSetup=void 0,t.getContactInfo(t.recipient.email)},100)},a);function a(t,e,i,n,o,s,r,a,c,l){this.$scope=t,this.$log=e,this.$mdDialog=i,this.$timeout=n,this.$translate=o,this.$window=s,this.ContactsService=r,this.recipient=a,this.violations=c,this.verificationProblem=l,this.loading=!0,this.emailPattern="^([!#-'*+\\/-9=?A-Z^-~-]+(\\.[!#-'*+\\/-9=?A-Z^-~-]+)*)@[a-zA-Z0-9-]+\\.[a-zA-Z0-9-.]+$",this.verifications=[],this.languages=["en","de","nl"],this.title=a.fullNameOrEmail(),this.verifications=a.verifications.slice(),this.getContactInfo(a.email)}e.RecipientDialogModule=i.module("drafts.RecipientDialog",[o.DraftViolationItemModule.name,s.InputPhonenumberModule.name])}.apply(e,i))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(1)],void 0===(o=function(t,e,i){"use strict";function n(t,e){return null==t||""===t?e:t}Object.defineProperty(e,"__esModule",{value:!0}),e.IfEmptyFilterModule=i.module("zivver.common.filters.ifEmpty",[]).filter("ifEmpty",function(){return n})}.apply(e,n))||(t.exports=o)},function(t,e,r){var i,n;i=[r,e,r(7),r(10),r(477)],void 0===(n=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(s.$inject=["$element","$mdDialog","$scope","$timeout","OrganizationService","isDraft","isEnabled","scheduledExpiration"],s.prototype.$onInit=function(){var e=this;if(void 0===this.scheduledExpiration)this.OrganizationService.getMessageExpirationPolicy().then(function(t){!0===t.automaticScheduledExpiration?e.scheduledExpiration={action:t.defaults.action,expiresIn:t.defaults.duration}:e.scheduledExpiration={action:"revoke",expiresIn:"P0D"}});else if(this.scheduledExpiration={action:!1!==this.isEnabled?this.scheduledExpiration.action:"revoke",expiresIn:!1!==this.isEnabled?this.scheduledExpiration.expiresIn:void 0},this.targetToggle(this.scheduledExpiration.action),void 0!==this.scheduledExpiration.expiresIn){var t=new RegExp("([WDH])+");this.unit=this.scheduledExpiration.expiresIn.substr(this.scheduledExpiration.expiresIn.search(t),1).toLowerCase(),this.amount=Math.round(n.duration(this.scheduledExpiration.expiresIn).as(this.unit))}this.originalSettings={action:i.__assign({},this.action),amount:this.amount,isEnabled:this.isEnabled,unit:this.unit,expiresIn:void 0!==this.scheduledExpiration&&void 0!==this.scheduledExpiration.expiresIn?this.scheduledExpiration.expiresIn:"PnullD"},Object.freeze(this.originalSettings),this.$scope.$watchCollection(function(){return[e.amount,e.unit]},function(t){void 0!==t&&void 0!==e.scheduledExpiration&&(e.amount=t[0],e.unit=t[1],e.scheduledDate=n().add(e.amount,e.unit).format("dddd D MMMM YYYY, HH:mm"),e.scheduledExpiration.expiresIn=e.getDuration(),e.scheduledExpiration.expiresAt=n().add(n.duration(e.getDuration())).toISOString())})},s.prototype.getDuration=function(){switch(this.unit){case"w":return"P"+this.amount+"W";case"d":return"P"+this.amount+"D";case"h":return"PT"+this.amount+"H"}},s.prototype.targetToggle=function(t){!1===this.action[t]&&(this.action.revoke=!this.action.revoke,this.action.delete=!this.action.delete,this.scheduledExpiration.action=t)},s.prototype.momentToggle=function(t){!1===t?(this.scheduledExpiration.expiresIn=void 0,this.scheduledExpiration.expiresAt=void 0):(this.scheduledExpiration.expiresIn=this.getDuration(),this.scheduledExpiration.expiresAt=n().add(n.duration(this.getDuration())).toISOString())},s.prototype.trimLength=function(t){var e=document.getElementById("amount");8!==t.keyCode&&(t.keyCode<37||40<t.keyCode)&&((t.keyCode<41||57<t.keyCode)&&(t.keyCode<96||105<t.keyCode)||3<e.value.length)&&t.preventDefault()},s.prototype.disableSave=function(){return!0===this.isOriginalSetting()||this.isEnabled&&void 0!==this.scheduledExpiration&&this.scheduledExpiration.expiresIn&&!this.amount},s.prototype.onEnabledChange=function(){!0===this.isEnabled&&this.$timeout(function(){var t=document.getElementById("amount");null===t||t.focus()},120,!0)},s.prototype.close=function(){return this.$mdDialog.cancel()},s.prototype.save=function(){return this.$mdDialog.hide({isEnabled:this.isEnabled,scheduledExpiration:this.isEnabled?this.scheduledExpiration:void 0})},s.prototype.isOriginalSetting=function(){return void 0!==this.scheduledExpiration&&this.unit===this.originalSettings.unit&&this.amount===this.originalSettings.amount&&this.isEnabled===this.originalSettings.isEnabled&&this.action.revoke===this.originalSettings.action.revoke&&this.action.delete===this.originalSettings.action.delete&&this.scheduledExpiration.expiresIn===this.originalSettings.expiresIn},s.factory=function(t){return{controller:s,templateUrl:r(478),locals:t}},s);function s(t,e,i,n,o,s,r,a){this.$element=t,this.$mdDialog=e,this.$scope=i,this.$timeout=n,this.OrganizationService=o,this.isDraft=s,this.isEnabled=r,this.scheduledExpiration=a,this.amount=null,this.action={revoke:!0,delete:!1},this.unit="d"}e.ExpirationDialog=o}.apply(e,i))||(t.exports=n)},function(t,e,p){var i,n;i=[p,e,p(7),p(1),p(9),p(484),p(6),p(489)],void 0===(n=function(t,e,o,i,a,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=[s.ERR_CONNECTION_REFUSED,s.HTTP_INTERNAL_SERVER_ERROR,s.HTTP_BAD_GATEWAY,s.HTTP_SERVICE_UNAVAILABLE,s.HTTP_GATEWAY_TIMEOUT],c="draft-attachments",l=(u.$inject=["$scope","$log","$transitions","$translate","FilesOutService"],u.prototype.$onInit=function(){var i=this;this.files=this.draft.files.slice(),this.$scope.$on("files-dropped",function(t,e){i.uploadFiles(e)}),this.$scope.$on("conversations.replied",function(){i.files=[]}),this.$scope.$on("attachments-removed",function(t,e){e.forEach(function(t){return i.removeFile(t)})}),this.$scope.$watch(function(){return i.uploadsInProgress.length},function(){i.doUpload()})},u.prototype.uploadFiles=function(t){var r=this;t.forEach(function(t){var e=window.URL.createObjectURL(t),i=t.name,n=t.size,o=t.type||"application/octet-stream",s=new a.DraftAttachment;return s.fileId=e,s.name=i,s.size=n,s.fileType=o,r.files.push(s),t.size>r.FilesOutService.getMaxFileSize()?r.createInvalidFile(s,a.ClientViolationTypes.FileSize):50<r.files.filter(function(t){return void 0===t.upload||void 0===t.upload.error}).length?(r.filesToUpload[e]=t,r.createInvalidFile(s,a.ClientViolationTypes.MaxFiles)):(r.filesToUpload[e]=t,void r.createFileSlotAndUploadTasks(s))})},u.prototype.removeFile=function(e){this.files=this.files.filter(function(t){return t.id!==e.id}),void 0!==e.upload&&this.abortUploadForFile(e),this.draft.removeAttachment(e),this.FilesOutService.remove(e.fileslotId),this.checkInvalidFilesForUpload();var t=this.draft.validation.violationsUnresolved.filter(function(t){return t.id===a.ClientViolationTypes.MaxFiles}).shift();void 0!==t&&0===t.files.length&&(this.draft.validation=this.draft.validation.removeViolationByBusinessRuleId(a.ClientViolationTypes.MaxFiles)),this.removeFileAndBlob(e)},u.prototype.checkInvalidFilesForUpload=function(){var t=this.files.filter(function(t){return void 0!==t.upload&&t.upload.error===a.ClientViolationTypes.MaxFiles}).shift();void 0!==t&&(delete t.upload.error,this.createFileSlotAndUploadTasks(t))},u.prototype.createFileSlotAndUploadTasks=function(e){var i=this;this.FilesOutService.createFileSlot(e.name,e.size,e.fileType,!1).then(function(t){return e.fileslotId=t.fileslotId,i.FilesOutService.initMultipart(e)}).then(function(){e.parts.forEach(function(t){i.uploadQueue.push({attempts:0,fileId:e.fileId,fileslotId:e.fileslotId,part:t.part,start:t.start,end:t.end})}),i.doUpload()}).catch(function(t){i.$log.warn("Creating fileslot or initialising multipart failed",{error:t}),void 0===e.upload&&(e.upload={aborted:!0,progress:0,loaded:0,partsLeft:e.parts.length}),i.removeFileAndBlob(e),e.upload.error=a.ClientViolationTypes.UploadFailed})},u.prototype.doUpload=function(){var e=this;if(this.draft.isUploading=0<this.uploadsInProgress.length,!(3<this.uploadsInProgress.length+1||0===this.uploadQueue.length)){var i=this.uploadQueue.shift(),t=this.filesToUpload[i.fileId],n=this.files.filter(function(t){return t.fileslotId===i.fileslotId}).shift();if(void 0===t)return this.$log.warn("upload task is missing file to upload",{task:i,attachment:n}),void this.removeFile(n);i.attempts++,this.uploadsInProgress.push(o.__assign({},i)),this.FilesOutService.readMultipart(t,i.start,i.end).then(function(t){return e.FilesOutService.uploadPart(n,i.part,t)}).then(function(){e.onUploadEnd(i.fileslotId,i.part),0===n.upload.partsLeft&&e.FilesOutService.finishMultipart(i.fileslotId).then(function(){e.draft.addAttachment(n),delete n.upload,e.removeFileAndBlob(n),delete n.fileId})}).catch(function(t){n.upload.aborted||(e.onUploadEnd(i.fileslotId,i.part),-1<r.indexOf(t.status)&&i.attempts<3?(e.$log.info("Failed multipart upload, will retry",{task:i}),e.uploadQueue.unshift(o.__assign({},i))):(e.$log.warn("Uploading multipart failed with unretryable status or too many attempts",{task:i,responseStatus:t.status}),n.upload.error=a.ClientViolationTypes.UploadFailed,e.abortUploadForFile(n)))})}},u.prototype.abortUploadForFile=function(e){this.uploadQueue=this.uploadQueue.filter(function(t){return t.fileId!==e.fileId}),this.uploadsInProgress=this.uploadsInProgress.filter(function(t){return t.fileId!==e.fileId}),void 0!==e.upload&&(e.upload.aborted=!0,e.parts.filter(function(t){return void 0!==t.abort}).forEach(function(t){return t.abort()}),this.removeFileAndBlob(e))},u.prototype.onUploadEnd=function(e,i){this.uploadsInProgress=this.uploadsInProgress.filter(function(t){return!(t.fileslotId===e&&t.part===i)})},u.prototype.createInvalidFile=function(t,e){t.upload={error:e,aborted:!0,partsLeft:0,loaded:-1,progress:-1};var i=new a.Violation;switch(i.violationLevel="warning",i.showStopper=!0,i.id=e.toString()+"-"+t.id,i.businessRuleId=e.toString(),e){case a.ClientViolationTypes.MaxFiles:i.description=this.$translate.instant(c+".VIOLATION-MAXFILES",{max:50});break;case a.ClientViolationTypes.FileSize:i.description=this.$translate.instant(c+".VIOLATION-MAXSIZE"),this.removeFileAndBlob(t)}i.files=[t.id],this.draft.validation=this.draft.validation.addClientViolation(i)},u.prototype.removeFileAndBlob=function(t){void 0!==t.fileId&&(window.URL.revokeObjectURL(t.fileId),delete this.filesToUpload[t.fileId])},u);function u(t,e,i,n,o){this.$scope=t,this.$log=e,this.$transitions=i,this.$translate=n,this.FilesOutService=o,this.files=[],this.filesToUpload={},this.uploadQueue=[],this.uploadsInProgress=[]}e.DraftAttachmentsModule=i.module("components.DraftAttachments",[n.DraftAttachmentChipModule.name]).component("draftAttachments",{bindings:{draft:"="},controller:l,template:p(490)})}.apply(e,i))||(t.exports=n)},,,,,,,,,,,,,function(t,e,c){var i,n;i=[c,e,c(1),c(10),c(228),c(229)],void 0===(n=function(t,s,e,r){"use strict";function i(i,n){var o=[];return function(t){var e=n.use();void 0!==s.AvailableLanguages[e]&&void 0===o[t]&&(i.warn("Missing "+e+" translation for id "+t),o[t]=!0)}}function n(e){return function(t){return e.get(s.TRANSLATIONS[t.key]).then(function(t){return t.data})}}function o(t,e,i){var n;e.useCookieStorage(),e.useSanitizeValueStrategy("escaped"),e.useLoader("i18nTranslationsLoader"),e.useMissingTranslationHandler("i18nMissingTranslationsLogger"),n=(navigator.language||navigator.userLanguage).substr(0,2).toLowerCase(),Object.keys(s.AvailableLanguages).indexOf(n),e.registerAvailableLanguageKeys(Object.keys(s.AvailableLanguages),{en_US:"en",en_UK:"en",nl_NL:"nl",nl_BE:"nl"}),e.fallbackLanguage("en"),e.determinePreferredLanguage(),i.firstDayOfWeek=1,i.formatDate=function(t){return void 0===t&&(t=null),null===t?null:r(t).format("L")},i.parseDate=function(t){var e=r(t,"L",!0);return e.isValid()?e.toDate():new Date(NaN)}}function a(t,i,n,o){t.$on("$translateChangeSuccess",function(t,e){i.find("html").attr("lang",e.language),n.defaults.headers.common["Accept-Language"]=e.language,r.locale(e.language),o.months=r.months(),o.shortMonths=r.monthsShort(),o.days=r.weekdays(),o.shortDays=r.weekdaysShort()})}i.$inject=["$log","$translate"],n.$inject=["$http"],o.$inject=["$httpProvider","$translateProvider","$mdDateLocaleProvider"],a.$inject=["$rootScope","$document","$http","$mdDateLocale"],Object.defineProperty(s,"__esModule",{value:!0}),s.AvailableLanguages={en:"English",de:"Deutsch",nl:"Nederlands"},s.TRANSLATIONS={en:c(230),de:c(231),nl:c(232)},s.I18nModule=e.module("common.i18n",["pascalprecht.translate"]).config(o).run(a).factory("i18nMissingTranslationsLogger",i).factory("i18nTranslationsLoader",n)}.apply(e,i))||(t.exports=n)},function(t,e,i){t.exports=i.p+"assets/img/unknown-person.430f07.png"},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Setting=function(t,e){this.type=t,void 0!==e&&(this.keyName=e.keyName,this.valueData=e.valueData,this.enabled="true"===this.valueData,void 0!==e.forced&&(this.forced=e.forced))}}.apply(e,[i,e]))||(t.exports=n)},function(t,e,r){var i,n;i=[r,e,r(1),r(171),r(548)],void 0===(n=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(s.$inject=["$scope","$log","$window","$timeout","FilesOutService","ScrollService"],s.prototype.$onInit=function(){var e=this;this.sections=this.formDefinition.sections,this.numberSteps=this.sections.length,this.openFirstSection(),this.$scope.$watch(function(){return e.currentState},function(t){void 0!==t&&e.changeCurrentState(t)})},s.prototype.goToStep=function(t){var e=this;this.activeStep=t;var i=this.getSectionByIndex(t-1);i.setOpened(!0).setFocusedComponent(i.getFirstComponent()),this.$timeout(function(){var t=e.$window.document.getElementById("special-step-"+e.activeStep);e.ScrollService.scrollIntoView(t,e.mainContentElement,!0)},100,!1)},s.prototype.getCurrentStep=function(){return this.activeStep},s.prototype.scrollToComponent=function(t){var e=this.$window.document.getElementById(t);void 0!==e?this.ScrollService.scrollIntoView(e,this.mainContentElement,!0):this.$log.warn("can not find component to scroll to!")},s.prototype.awaitUpload=function(){this.awaitedUploads++,this.getLastSection().setDisabled(!0)},s.prototype.awaitedUploadDone=function(){0<this.awaitedUploads&&this.awaitedUploads--,0===this.awaitedUploads&&this.getLastSection().setDisabled(!1)},s.prototype.onSubmitSpecial=function(){return"initiation"===this.type?this.onSubmit({subject:this.createSubject()}):"response"===this.type?this.onSubmit():void 0},s.prototype.validateComponents=function(t){var n=this,o=[];return void 0!==this.formCtrl&&0<t.length&&t.forEach(function(t){var e=n.formCtrl[t];if(void 0!==e){e.$setTouched(),e.$validate();var i=Object.keys(e.$error);void 0!==i&&0<i.length&&o.push({compKey:t,error:e.$error})}}),o},s.prototype.closeAllStepsBelow=function(t){this.activeStep=t;for(var e=this.activeStep;e<this.numberSteps;++e)this.getSectionByIndex(e).setOpened(!1).setCompleted(!1)},s.prototype.validateForm=function(){var t=this.sections.reduce(function(t,e){return t.concat(e.components.filter(function(t){return!1===t.isStatic()}).map(function(t){return t.key}))},[]);return this.validateComponents(t)},s.prototype.jumpToFirstError=function(t){var i,e=this,n=t[0].compKey;this.sections.some(function(t){var e=t.hasComponentByKey(n);if(!0===e)return i=t.getComponentByKey(n),e}),void 0!==i&&0<t.length?(this.scrollToComponent(n),this.$timeout(function(){i.showError=!0,e.$timeout(function(){i.showError=!1},750,!1)},this.ScrollService.scrollDuration)):this.$log.warn("failed to jump to first erroneous component!")},s.prototype.onSectionCompleted=function(){return this.completedSteps++,"initiation"===this.type?this.saveDraft(this.createSubject()):this.saveDraft()},s.prototype.onCancelForm=function(){this.onCancel()},s.prototype.addFile=function(t){this.files.push(t)},s.prototype.removeFile=function(e){void 0!==e.id&&this.FilesOutService.remove(e.id),this.files=this.files.filter(function(t){return t.id!==e.id})},s.prototype.removeAllFiles=function(){var e=this;0!==this.files.length&&this.files.forEach(function(t){e.FilesOutService.remove(t.id)}),this.files=[]},s.prototype.toSaveEntity=function(){var n={messageDefinition:this.messageDefinitionId,data:{}};return this.sections.forEach(function(t){var e=t.toSaveEntity();for(var i in e)!0===e.hasOwnProperty(i)&&(n.data[i]=e[i])}),n},s.prototype.changeCurrentState=function(t){switch(t){case"pending":this.sections.forEach(function(t){return t.setDisabled(!1)});break;case"submitting":this.sections.forEach(function(t){return t.setDisabled(!0).setOpened(!1)}),this.getLastSection().setOpened(!0);break;case"sent":this.getLastSection().setDisabled(!1)}},s.prototype.openFirstSection=function(){return this.getFirstSection().setOpened(!0)},s.prototype.getSectionByIndex=function(t){if(-1<t&&t<this.sections.length)return this.sections[t];throw new Error("index out of bounds")},s.prototype.getFirstSection=function(){return this.getSectionByIndex(0)},s.prototype.getLastSection=function(){return this.getSectionByIndex(this.sections.length-1)},s.prototype.createSubject=function(){var i=this,n=this.formDefinition.subjectTemplate,o=(" "+n).slice(1);return(n=(n=n.replace(/\$(\w-*)+/g,function(t){var e=i.formDefinition.getComponentByKey(t.replace("$",""));return void 0!==e.answer&&void 0!==e.answer.subject?e.answer.subject:""})).replace(/&(\w-*)+/g,function(t){var e=i.formDefinition.getComponentByKey(t.replace("&",""));return void 0!==e.answer&&void 0!==e.answer.value?e.answer.value:(i.$log.warn("SpecialsForm could not create subject for '&-template-var'",{subject:n,subjectCopy:o,match:t,comp:e}),"")})).trim()},s.prototype.saveDraft=function(t){var e={draftBody:this.generateBody(),subject:t};return this.onSave(e)},s.prototype.generateBody=function(){return this.body=JSON.stringify(this.toSaveEntity(),null,0),this.body},s);function s(t,e,i,n,o,s){this.$scope=t,this.$log=e,this.$window=i,this.$timeout=n,this.FilesOutService=o,this.ScrollService=s,this.activeStep=1,this.completedSteps=1,this.awaitedUploads=0,this.mainContentElement=this.$window.document.getElementsByClassName("main-content")[0]}e.SpecialsForm=o,e.SpecialsFormModule=i.module("ziv.components.specialsForm",[n.SpecialsSectionModule.name]).component("specialsForm",{controller:o,bindings:{body:"<",currentState:"=",files:"=",formDefinition:"=",messageDefinitionId:"<",onCancel:"&",onSave:"&",onSubmit:"&",submitTranslated:"<",type:"<"},templateUrl:r(549)})}.apply(e,i))||(t.exports=n)},,function(t,e,r){var i,n;i=[r,e,r(1),r(38),r(243)],void 0===(n=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(s.$inject=["$scope"],s.prototype.$onInit=function(){var t=this;this.$scope.$watchGroup([function(){return t.password},function(){return t.passwordAgain},function(){return t.form.password.$strength.score}],function(){t.comparePasswordFields()})},s.prototype.comparePasswordFields=function(){this.form.passwordAgain.$setValidity("validator",void 0===this.password||this.password===this.passwordAgain),this.passwordStrongAndMatch=void 0!==this.password&&this.password===this.passwordAgain&&this.form.password.$valid},s);function s(t){this.$scope=t,this.passwordStrongAndMatch=!1}e.PasswordComponent=o,e.PasswordComponentModule=i.module("components.passwordComponent",[n.PasswordStrengthDirectiveModule.name]).component("passwordComponent",{bindings:{form:"=",icons:"<",reset:"<",password:"<",passwordAgain:"<"},controller:o,templateUrl:r(244)})}.apply(e,i))||(t.exports=n)},function(t,e,r){var i,n;i=[r,e,r(1),r(74),r(255)],void 0===(n=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(s.$inject=["$rootScope","$scope","$translate"],s.prototype.$onInit=function(){var i=this;this.availableLanguages=n.AvailableLanguages,this.language=this.$translate.use(),this.$rootScope.$on("$translateChangeSuccess",function(t,e){i.language=e.language}),this.$scope.$watch(function(){return i.language},function(t,e){t!==e&&null!==e&&i.$translate.use(t)}),void 0===this.availableLanguages[this.language]&&(this.language=Object.keys(this.availableLanguages)[0])},s);function s(t,e,i){this.$rootScope=t,this.$scope=e,this.$translate=i,this.availableLanguages={},this.language=null}e.LanguageSelectModule=i.module("components.languageSelect",[n.I18nModule.name]).component("languageSelect",{controller:o,template:r(256)})}.apply(e,i))||(t.exports=n)},function(t,e,i){t.exports=i.p+"assets/themes/img/logo.5a6b87.svg"},function(t,e,i){t.exports=i.p+"assets/themes/img/logo.6992cd.svg"},function(t,e,u){var i,n;i=[u,e,u(1),u(8),u(87),u(88),u(426),u(13),u(429)],void 0===(n=function(t,e,i,n,o,s,r,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=(l.$inject=["$element","$log","$mdDialog","$mdMedia","$q","$rootScope","$scope","$state","$timeout","AuthSessionService","ConversationsService","LabelService","MessengerService","NotificationService","PrintService"],l.prototype.$onInit=function(){this.actions=[],void 0!==this.conversation&&void 0!==this.share&&(this.participantsInfo=this.getParticipantsInfo(this.conversation.participants),this.allParticipants=this.conversation.participants.map(function(t){return t.fullNameAndEmail().replace(/&lt;/gi,"<").replace(/&gt;/gi,">")}).join(", "),this.profile.isGuest()?this.addGuestActions():this.addNonGuestActions())},l.prototype.$onChanges=function(t){void 0===t.conversation&&void 0===t.share||this.$onInit()},l.prototype.openInfoPane=function(){this.showInfoPane=!0},l.prototype.sidePaneClosed=function(){this.showInfoPane=!1},l.prototype.trash=function(){this.moveConversation(n.SystemLabel.TRASH)},l.prototype.archive=function(){this.moveConversation(n.SystemLabel.ARCHIVE)},l.prototype.moveToInbox=function(){this.moveConversation(n.SystemLabel.INBOX)},l.prototype.deleteForever=function(){var e=this,t=a.WarningDialog.factory({title:"conversation-header.DELETE.TITLE",explanation:"conversation-header.DELETE.EXPLANATION",submitText:"conversation-header.DELETE.CONFIRM",type:a.WarningDialogTypes.error});this.$mdDialog.show(t).then(function(){e.ConversationsService.removeConversation(e.conversation.share).then(function(){e.MessengerService.toast("conversation-header.MOVE.SUCCESS-DELETE"),e.$rootScope.$broadcast("conversation-moved",e.conversation.id)}).catch(function(t){e.$log.warn("Error deleting conversation forever",{error:t,share:e.conversation.share})})})},l.prototype.openActionsMenu=function(t,e){this.$scope.$broadcast("conversation-menu:open"),t.open(e)},l.prototype.editLabels=function(t){var e=this,i=o.LabelsDialog.factory("SELECT",this.conversation.labelIdList);i.targetEvent=t,this.$mdDialog.show(i).then(function(t){e.ConversationsService.setConversationLabels(e.conversation,t).then(function(){e.LabelService.getLabelsAndBroadcast()})})},l.prototype.changeNotifications=function(t){var e=this,i={useDefault:this.conversation.sendNotificationsDefault,enable:this.conversation.sendNotifications},n=r.NotificationsDialog.factory(i,this.profile);n.targetEvent=t,n.resolve.accountPreference=function(){return e.profile.isGuest()?e.$q.resolve({sendNotificationsDefault:!0}):e.NotificationService.isEmailActive()},this.$mdDialog.show(n).then(function(t){e.ConversationsService.setConversationNotifications(e.conversation,t.enable,t.useDefault).then(function(){e.actions.forEach(function(t){"changeNotifications"===t.onClick&&(t.icon=e.getNotificationIcon())})}).catch(function(t){e.$log.warn("Setting notification failed...",{error:t})})},function(t){void 0!==t&&!1===e.AuthSessionService.isDelegate()?e.$state.go(t):void 0!==t&&e.AuthSessionService.isDelegate()&&e.MessengerService.alert("conversation-header.NOTIFICATION-SETTINGS-DELEGATE")})},l.prototype.printConversation=function(){this.PrintService.printConversation(this.conversation,this.$element[0].parentElement)},l.prototype.replyToAll=function(){this.$rootScope.$broadcast("reply-all")},l.prototype.addNonGuestActions=function(){var t="inbox"===this.conversation.systemLabel.name,e="archive"===this.conversation.systemLabel.name,i="trash"===this.conversation.systemLabel.name,n=this.share.isAccessGranted();t?this.actions.push({icon:"archive",onClick:"archive",label:".MOVE.ARCHIVE"}):e&&this.actions.push({icon:"move_to_inbox",onClick:"moveToInbox",label:".MOVE.INBOX"}),(t||e)&&(n&&this.actions.push({icon:"local_offer",onClick:"editLabels",label:".EDIT-LABELS"}),this.actions.push({icon:"delete",onClick:"trash",label:".MOVE.TRASH"})),(t||e)&&this.actions.push({icon:"forward",onClick:"forwardConversation",label:".FORWARD"}),i&&(this.actions.push({icon:"move_to_inbox",onClick:"moveToInbox",label:".MOVE.INBOX"}),this.actions.push({icon:"delete_forever",onClick:"deleteForever",label:".MOVE.DELETE"})),n&&this.actions.push({icon:"print",onClick:"printConversation",label:".PRINT"}),this.actions.push({icon:"info",onClick:"openInfoPane",label:".CONVERSATION-INFO"}),(t||e)&&this.actions.push({icon:this.getNotificationIcon(),onClick:"changeNotifications",label:".CHANGE-NOTIFICATIONS"})},l.prototype.addGuestActions=function(){this.actions.push({icon:"reply_all",onClick:"replyToAll",label:".REPLY-TO-ALL"}),this.actions.push({icon:"print",onClick:"printConversation",label:".PRINT"}),this.actions.push({icon:"info",onClick:"openInfoPane",label:".CONVERSATION-INFO"})},l.prototype.getNotificationIcon=function(){return"notifications_"+(this.conversation.sendNotifications?"active":"off")},l.prototype.getParticipantsInfo=function(t){return 1===t.length?t[0].fullNameAndEmail().replace(/&lt;/gi,"<").replace(/&gt;/gi,">"):t.map(function(t){return t.fullNameOrEmail()}).join(", ").replace(/&lt;/gi,"<").replace(/&gt;/gi,">")},l.prototype.moveConversation=function(e){var i=this;this.ConversationsService.moveConversation(this.conversation,e).then(function(){i.MessengerService.toast("conversation-header.MOVE.SUCCESS-"+e),i.$rootScope.$broadcast("conversation-moved",i.conversation.id)}).catch(function(t){i.MessengerService.toast("conversation-header.MOVE.ERROR"),i.$log.warn("Error moving conversation",{error:t,target:e})})},l.prototype.forwardConversation=function(){var t=this.messages.filter(function(t){return!1===t.revoked&&!1===t.deleted}).map(function(t){return t.id}),e={draftType:"forward",quote:{conversationId:this.conversation.id,messageIds:t},share:this.share,subject:"FW: "+this.conversation.subject};0!==t.length?this.$state.go("drafts.create",e):this.MessengerService.alert("DRAFTS.EDIT.FORWARD.ALL-REVOKED.ERROR")},l);function l(t,e,i,n,o,s,r,a,c,l,u,p,d,h,f){this.$element=t,this.$log=e,this.$mdDialog=i,this.$mdMedia=n,this.$q=o,this.$rootScope=s,this.$scope=r,this.$state=a,this.$timeout=c,this.AuthSessionService=l,this.ConversationsService=u,this.LabelService=p,this.MessengerService=d,this.NotificationService=h,this.PrintService=f,this.participantsInfo="",this.showInfoPane=!1}e.ConversationHeaderModule=i.module("components.conversationHeader",[o.LabelsDialogModule.name,r.NotificationsDialogModule.name,s.ConversationInfoModule.name,a.WarningDialogModule.name]).component("conversationHeader",{bindings:{conversation:"<",messages:"<",profile:"<",share:"<"},controller:c,template:u(430)})}.apply(e,i))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.prototype.isImage=function(){return"image"===this.fileType.split("/")[0]},n.prototype.isSvg=function(){return"svg+xml"===this.fileType.split("/")[1]},n.prototype.isPdf=function(){return"pdf"===this.fileType.split("/")[1]},n.prototype.setBackgroundImage=function(t,e){this.style.backgroundImage="url("+t+")",this.style.backgroundSize=e?"90px 90px":void 0},n);function n(t){this.busy=!1,this.style={},this.id=t.id,this.downloadable=t.downloadable,this.empty=t.empty,this.fileType=t.fileType,this.inline=t.inline,this.name=t.name,this.size=t.size,this.openedBy=t instanceof n?t.openedBy:t.opened_by}e.Attachment=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(7),i(54),i(84),i(86)],void 0===(o=function(t,e,i,n,o,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=(a.fromQuotedConversationMessage=function(t){return new a(i.__assign({},t,{deleted:!1,hardBouncedBy:0,softBouncedBy:0,opened_by:0,quote:void 0}))},a);function a(t){var e;this.body=null,this.contentType="text/plain",this.counters={hardBounces:0,opens:0,softBounces:0},this.deleted=!1,this.files=[],this.revoked=!1,this.sender=null,this.inlineImages=[],this.isSelected=!1,this.isBcc=t.bcc,this.body=void 0===t.body?null:t.body,this.contentType=t.contentType,this.counters.hardBounces=t.hardBouncedBy,this.counters.opens=t.opened_by,this.counters.softBounces=t.softBouncedBy,this.createdDate=new Date(t.created),this.deleted=t.deleted,this.id=t.id,this.messageDefinition=t.messageDefinition,this.participant=new n.Participant(i.__assign({},t.participant)),this.quoted=t.quoted,this.revoked=t.revoked,this.scheduledExpiration=t.scheduledExpiration,this.sender=t.sender,e=t.files.map(function(t){return new o.Attachment(t)}).sort(function(t,e){return t.name.localeCompare(e.name)}).reduce(function(t,e){return t[e.isImage()&&e.inline?0:1].push(e),t},[[],[]]),this.inlineImages=e[0],this.files=e[1],void 0!==t.quote&&(this.quote=new s.Quote(t.quote)),this.sentByDelegate=t.sentByDelegate}e.ConversationMessage=r}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(85)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Quote=function(t){this.messages=[],this.conversationInfo=t.conversation,void 0!==t.messages&&(this.messages=t.messages.map(function(t){return i.ConversationMessage.fromQuotedConversationMessage(t)}))}}.apply(e,n))||(t.exports=o)},function(t,e,a){var i,n;i=[a,e,a(1),a(8),a(6),a(332)],void 0===(n=function(t,e,i,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=(r.$inject=["$scope","$log","$timeout","$mdDialog","LabelService","openIn","conversationLabels","label"],r.prototype.getLabels=function(){var e=this.searchFor.toLowerCase();return this.labels.filter(function(t){return-1<t.name.toLowerCase().indexOf(e)})},r.prototype.editLabel=function(t){this.label=new n.Label(t),this.mode="EDIT",this.watchLabel()},r.prototype.removeLabel=function(){var e=this;this.labels=this.labels.filter(function(t){return t.id!==e.label.id}),this.selection[this.label.id]=void 0,this.LabelService.removeLabel(this.label.id),this.mode="SELECT"},r.prototype.newLabel=function(){var t=this;this.label=new n.Label,this.label.name=this.searchFor,this.label.labelColor=this.labelColors[Math.floor(Math.random()*this.labelColors.length)],this.mode="EDIT",0<this.searchFor.length&&this.$timeout(function(){t.labelForm.$setDirty()}),this.watchLabel()},r.prototype.setLabelColor=function(t){this.label.labelColor=t,this.labelForm.$setDirty()},r.prototype.submit=function(){var e=this;if("SELECT"===this.mode)this.$mdDialog.hide(this.labels.filter(function(t){return e.selection[t.id]}));else{if(void 0===this.label.id&&this.isLabelDuplicate(this.label.name))return void this.labelForm.labelName.$setValidity("duplicate",!1);if(!1===this.isValidName(this.label.name))return void this.labelForm.labelName.$setValidity("validName",!1);this.labelForm.$valid&&this.labelForm.$dirty&&(void 0===this.label.id?this.LabelService.createLabel(this.label.name,this.label.labelColor).then(function(t){e.selection[t.id]=!0}):this.LabelService.updateLabel(this.label.id,this.label.name,this.label.labelColor)).then(function(){if(e.unwatchLabel(),"CLOSE"!==e.afterEdit)return e.loadLabels().then(function(){e.mode="SELECT"});e.$mdDialog.hide()},function(t){t.status===o.HTTP_CONFLICT?e.labelForm.labelName.$setValidity("duplicate",!1):t.status===o.HTTP_BAD_REQUEST?e.labelForm.labelName.$setValidity("validName",!1):e.$log.warn("Error saving label",{error:t})})}},r.prototype.cancel=function(){"EDIT"===this.mode?"EDIT"===this.openIn?this.$mdDialog.cancel():(this.unwatchLabel(),this.label=void 0,this.searchFor="",this.mode="SELECT"):this.$mdDialog.cancel()},r.prototype.close=function(){this.$mdDialog.cancel()},r.prototype.loadLabels=function(){var e=this;return this.LabelService.getLabels().then(function(t){e.labels=t.userLabels})},r.prototype.watchLabel=function(){var i=this;this.unwatchLabel=this.$scope.$watch(function(){return i.label.name},function(t,e){void 0!==i.labelForm&&t!==e&&(i.labelForm.labelName.$setValidity("duplicate",!0),i.labelForm.labelName.$setValidity("validName",!0))})},r.prototype.isLabelDuplicate=function(t){return-1<this.labels.map(function(t){return t.name}).indexOf(t)},r.factory=function(t,e,i){return{controller:r,locals:{conversationLabels:e,label:i,openIn:t},templateUrl:a(333)}},r.prototype.isValidName=function(t){return!(-1<t.indexOf(",")||"-"===t.charAt(0)||30<t.length)},r);function r(t,e,i,n,o,s,r,a){var c=this;this.$scope=t,this.$log=e,this.$timeout=i,this.$mdDialog=n,this.LabelService=o,this.openIn=s,this.labels=[],this.mode="LOADING",this.searchFor="",this.selection={},this.afterEdit="SELECT",this.labelColors=this.LabelService.getColors(),"SELECT"===this.openIn?this.loadLabels().then(function(){c.labels.forEach(function(t){c.selection[t.id]=-1<r.indexOf(t.id)}),0===c.labels.length?c.newLabel():c.mode="SELECT"}):(this.afterEdit="CLOSE",void 0===a?this.newLabel():this.editLabel(a))}e.LabelsDialog=s,e.LabelsDialogModule=i.module("common.labelsDialog",[])}.apply(e,i))||(t.exports=n)},function(t,e,c){var i,n;i=[c,e,c(1),c(9),c(56),c(160),c(424)],void 0===(n=function(t,e,i,n,o,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=(a.$inject=["$scope","$element","$q","$timeout","$log","ConversationsService","$mdToast","$translate"],a.prototype.$onInit=function(){var n=this;this.canAdd=!1===this.profile.isGuest(),void 0!==this.conversation.flow&&(this.canAdd=this.conversation.flow.allowAddAnyRecipient||0<this.conversation.flow.allowedAddRecipients.length),!1!==this.canAdd&&(this.accessRightGrant=this.$q(function(e,i){n.ConversationsService.getShare(n.conversation.share).then(function(t){e(t.accessRightGrant)}).catch(function(t){n.$log.error("[conversation-info] Error getting accessRightGrant",{error:t}),i(t)})}))},a.prototype.add=function(){var i=this;this.draft=new n.Draft,this.participantsAsRecipient=this.conversation.participants.map(function(t){return new n.Recipient({email:t.email})}),this.adding=!0,this.validDraft=!1,this.unWatchDraftRecipients=this.$scope.$watch(function(){return i.draft.recipients},function(t,e){t!==e&&i.validateRecipients()},!0),this.unWatchDraftValidating=this.$scope.$watch(function(){return i.draft.isValidating},function(){i.setIconStatus()}),this.unWatchDraftValidation=this.$scope.$watch(function(){return i.draft.validation},function(){i.violationsUnresolved=i.draft.validation.violationsUnresolved,i.setIconStatus(),i.setViolationDescription()},!0)},a.prototype.cancel=function(){this.unWatchDraftRecipients(),this.unWatchDraftValidating(),this.unWatchDraftValidation(),this.adding=!1,this.draft=void 0},a.prototype.saveRecipients=function(){var i=this;if(!1!==this.validDraft&&0!==this.getRecipientsWithValidEmail().length){this.submitting=!0;var t=this.accessRightGrant.then(function(t){return i.ConversationsService.addNewParticipants(i.conversation.id,i.getRecipientsWithValidEmail(),t.token)});t.then(function(){return i.ConversationsService.get(i.conversation.id)}).then(function(t){i.conversation.participants=t.participants,i.$scope.$emit(o.Events.Updated,i.conversation.participants);var e=i.$mdToast.simple().parent(i.$element).position("top left").textContent(i.$translate.instant("conversation-info.TOAST.ADD-OK"));i.$mdToast.show(e),void 0!==t.flow&&(i.canAdd=t.flow.allowAddAnyRecipient||0<t.flow.allowedAddRecipients.length)}),t.catch(function(t){i.$log.error("Could not add participants to conversation",{error:t})}),t.finally(function(){i.adding=!1,i.submitting=!1})}},a.prototype.validateRecipients=function(){var i=this;if(void 0!==this.validationTimeout&&(this.$timeout.cancel(this.validationTimeout),this.validationTimeout=void 0),this.validating&&this.draft.isModified)this.validationTimeout=this.$timeout(function(){i.validateRecipients()},1e3);else if(0===this.draft.recipients.length&&(this.draft.validation.violationsUnresolved=[]),0!==this.getRecipientsWithValidEmail().length){this.validating=!0;var t=this.accessRightGrant.then(function(t){return i.ConversationsService.validateNewParticipants(i.conversation.id,i.getRecipientsWithValidEmail(),t.token)});t.then(function(t){var e=new n.ValidationStatus(t);e.validationCompleted=!0,e=e.addClientViolations(i.draft.validation.clientViolations),i.draft.validation=e,i.validDraft=i.draft.validation.validDraft&&0===i.draft.recipients.filter(function(t){return!1===t.emailIsValid}).length&&0<i.getRecipientsWithValidEmail().length,i.$timeout(function(){i.draft.isModified=!1,i.validating=!1},500)}),t.catch(function(t){i.$log.warn("Error validating adding recipients to conversation",{error:t})})}else this.validDraft=!1},a.prototype.getRecipientsWithValidEmail=function(){return this.draft.recipients.filter(function(t){return t.emailIsValid})},a.prototype.setIconStatus=function(){void 0!==this.violationsUnresolved&&(this.draft.isValidating?(this.iconStatus="unknown",this.info=".NOTIFICATIONS.UNKNOWN"):0<this.draft.validation.getErrors().length?(this.iconStatus="error",this.info=".NOTIFICATIONS.ERROR"):0<this.draft.validation.getWarnings().length?(this.iconStatus="warning",this.info=".NOTIFICATIONS.WARNING"):0<this.draft.validation.getSuggestions().length?(this.iconStatus="info",this.info=".NOTIFICATIONS.INFO"):(this.iconStatus="verified",this.info=".NOTIFICATIONS.OK"))},a.prototype.setViolationDescription=function(){this.violationDescription=this.pickViolationDescription()},a.prototype.pickViolationDescription=function(){if(void 0!==this.violationsUnresolved)return 0<this.draft.validation.getErrors().length?this.draft.validation.getErrors()[0].description:0<this.draft.validation.getWarnings().length?this.draft.validation.getWarnings()[0].description:0<this.draft.validation.getSuggestions().length?this.draft.validation.getSuggestions()[0].description:void 0},a);function a(t,e,i,n,o,s,r,a){this.$scope=t,this.$element=e,this.$q=i,this.$timeout=n,this.$log=o,this.ConversationsService=s,this.$mdToast=r,this.$translate=a,this.participantsAsRecipient=[],this.adding=!1,this.canAdd=!0,this.iconStatus="unknown",this.infoType="CONVERSATION",this.submitting=!1,this.validDraft=!1,this.validating=!1}e.ConversationInfo=r,e.ConversationInfoModule=i.module("components.ConversationInfo",[s.DraftRecipientsModule.name,o.ParticipantsListModule.name]).component("conversationInfo",{bindings:{conversation:"<",profile:"<"},controller:r,templateUrl:c(425)})}.apply(e,i))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.prototype.isPassword=function(){return"password"===this.accessType},n.prototype.isSms=function(){return"sms"===this.accessType},n.fromVerification=function(t){var e=new n;return e.id=t.id,e.requiresUserInput=t.requiresUserInput,"none"===t.verificationType?e.accessType="Email"===t.id?"email":"generatedCode":e.accessType=t.verificationType,e},n);function n(t){this.isValid=!0,this.requiresUserInput=!1,void 0!==t?(this.accessType=t.accessType,this.id=t.id,this.password=t.password,this.phonenumber=t.phonenumber,this.isPassword()&&void 0===this.password?this.requiresUserInput=!0:this.isSms()&&void 0===this.phonenumber&&(this.requiresUserInput=!0)):this.accessType="generatedCode"}e.AccessRightSetup=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(91)],void 0===(o=function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(o.clone=function(t){var e=new o;return e.validDraft=t.validDraft,e.validationCompleted=t.validationCompleted,e.violationsIgnored=t.violationsIgnored,e.violationsUnresolved=t.violationsUnresolved,e},o.prototype.hasViolations=function(){return 0<this.violationsUnresolved.length},o.prototype.getErrors=function(){return this.violationsUnresolved.filter(function(t){return"error"===t.violationLevel})},o.prototype.getWarnings=function(){return this.violationsUnresolved.filter(function(t){return"warning"===t.violationLevel})},o.prototype.getSuggestions=function(){return this.violationsUnresolved.filter(function(t){return"suggestion"===t.violationLevel})},o.prototype.getViolationsForRecipient=function(e){return this.violationsUnresolved.filter(function(t){return-1<t.recipients.indexOf(e.email)})},o.prototype.getViolationsForAttachment=function(e){return this.violationsUnresolved.filter(function(t){return-1<t.files.indexOf(e)})},o.prototype.addClientViolation=function(e){var t=o.clone(this);t=t.removeViolationByBusinessRuleId(e.businessRuleId);var i=this.violationsUnresolved.filter(function(t){return t.businessRuleId===e.businessRuleId}).shift(),n=this.violationsIgnored.filter(function(t){return t.businessRuleId===e.businessRuleId}).shift();return void 0!==i?(e.files=i.files.concat(e.files),e.recipients=i.recipients.concat(e.recipients),t.violationsUnresolved.push(e)):void 0!==n?(e.files=n.files.concat(e.files),e.recipients=n.recipients.concat(e.recipients),t.violationsIgnored.push(e)):t.violationsUnresolved.push(e),t},o.prototype.addClientViolations=function(t){var e=this,i=o.clone(this);return t.forEach(function(t){i=e.addClientViolation(t)}),i},o.prototype.removeViolationByBusinessRuleId=function(e){var t=o.clone(this);return t.violationsUnresolved=t.violationsUnresolved.filter(function(t){return t.businessRuleId!==e}),t.violationsIgnored=t.violationsIgnored.filter(function(t){return t.businessRuleId!==e}),t},o.prototype.removeViolationsForEmail=function(e){function t(t){return!(1===t.recipients.length&&-1<t.recipients.indexOf(e))}var i=o.clone(this);return i.violationsUnresolved=i.violationsUnresolved.filter(t),this.violationsIgnored=i.violationsIgnored.filter(t),i},o.prototype.removeViolationsForFile=function(e){function t(t){return!(1===t.files.length&&-1<t.files.indexOf(e))}var i=o.clone(this);return i.violationsUnresolved=i.violationsUnresolved.filter(t),this.violationsIgnored=i.violationsIgnored.filter(t),i},o.prototype.ignoreViolation=function(e){var t=o.clone(this);return t.violationsUnresolved=t.violationsUnresolved.filter(function(t){return t.id!==e.id}),t.violationsIgnored.push(e),t},Object.defineProperty(o.prototype,"clientViolations",{get:function(){return this.violationsUnresolved.filter(function(t){return t.isClientViolation()})},enumerable:!0,configurable:!0}),o);function o(t,e){if(void 0===e&&(e=[]),this.validationCompleted=!1,this.validDraft=!0,this.violationsUnresolved=[],this.violationsIgnored=[],void 0!==t&&(this.validDraft=t.validDraft,void 0!==t.violations&&0<t.violations.length)){var i=t.violations.filter(function(t){return"trustedRecipients"!==t.violationType}).map(function(t){return new n.Violation(t)});this.violationsUnresolved=i.filter(function(t){return-1===e.indexOf(t.id)}),this.violationsIgnored=i.filter(function(t){return-1<e.indexOf(t.id)})}}e.ValidationStatus=i}.apply(e,n))||(t.exports=o)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.prototype.isClientViolation=function(){return 0===this.businessRuleId.indexOf("client::")},n);function n(t){this.files=[],this.recipients=[],void 0!==t&&(this.businessRuleId=t.businessRuleId,this.description=t.description,this.files=t.files?t.files:[],this.id=t.id.toString(),this.recipients=t.recipients?t.recipients:[],this.showStopper=t.showStopper,this.violationLevel=t.violationLevel,this.violationType=t.violationType)}e.Violation=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(7),i(8)],void 0===(o=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o,s=(o=n.Quote,i.__extends(r,o),r);function r(t){var e=o.call(this,t)||this;return void 0!==t&&(e.shareId=t.shareId),e}e.DraftQuote=s}.apply(e,n))||(t.exports=o)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(Object.defineProperty(n.prototype,"id",{get:function(){return this.fileId||this.fileslotId},enumerable:!0,configurable:!0}),n);function n(t){this.parts=[],void 0!==t&&(this.fileslotId=t.id,this.fileType=t.fileType,this.inline=t.inline||!1,this.name=t.name,this.size=t.size)}e.DraftAttachment=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,a){var i,n;i=[a,e,a(1),a(338),a(14),a(407)],void 0===(n=function(t,e,i,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=(r.prototype.$onInit=function(){var e=this;1<this.participants.length&&(this.participants=this.participants.filter(function(t){return t.email!==e.profile.email}))},r.prototype.$onChanges=function(t){void 0!==t.participants&&void 0!==t.participants.currentValue&&(this.participants=t.participants.currentValue)},r.prototype.getPicture=function(t){if(void 0!==t.picture&&null!==t.picture)return t.picture;var e=this.getFirstLetter(t);return null!==e&&null!==e.match(/[a-z]/i)?o.LETTER_AVATRS[e.toLowerCase()]:o.UNKNOWN_PERSON},r.prototype.getAltText=function(t){var e=t.email;return null!==t.fullName&&(e=t.fullName+" <"+t.email+">"),e},r.prototype.getFirstLetter=function(t){return null!==t.fullName&&void 0!==t.fullName?t.fullName.substring(0,1):null!==t.email&&void 0!==t.email?t.email.substring(0,1):null},r);function r(){}e.ParticipantAvatarsModule=i.module("components.ParticipantAvatars",[n.ParticipantAvatarModule.name]).component("participantAvatars",{bindings:{participants:"<",profile:"<"},controller:s,template:a(408)})}.apply(e,i))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(8),i(5)],void 0===(o=function(t,e,o,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n="arg.",i=(s.$inject=["$rootScope","$window","$q","$http","$log","StorageService","AuthSessionService"],s.prototype.getGrant=function(i){var n=this;return this.$q(function(e){var t=n.StorageService.getItem(n.getStorageType(),n.prefix(i));return null!==t?(n.$log.debug("Grant "+i+" available from storage."),e(new o.AccessRightGrant(t))):(n.$log.debug("Fetching grant "+i+" from api."),n.$http.get("/api/shares_in/"+i+"/grant").then(function(t){n.$log.debug("Fetched grant "+i+" from api."),e(new o.AccessRightGrant(t.data))}))})},s.prototype.setGrant=function(t,e){this.StorageService.setItem(this.getStorageType(),this.prefix(t),e)},s.prototype.clear=function(){var e=this,i=this.getStorageType();this.StorageService.keys(i).filter(function(t){return t.substring(0,n.length)===n}).forEach(function(t){return e.StorageService.removeItem(i,t)})},s.prototype.prefix=function(t){return n+this.AuthSessionService.getSessionId()+"."+t},s.prototype.getStorageType=function(){return this.AuthSessionService.isGuest()?"SESSION":"LOCAL"},s);function s(t,e,i,n,o,s,r){var a=this;this.$window=e,this.$q=i,this.$http=n,this.$log=o,this.StorageService=s,this.AuthSessionService=r,t.$on(c.AuthEvents.logoutSuccess,function(){a.clear()})}e.AccessRightGrantService=i}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(97)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$q","$log","$http"],o.prototype.list=function(){return this.$http.get("/api/accounts").then(function(t){return t.data}).then(function(t){return t.items})},o.prototype.listFunctional=function(){return this.$http.get("/api/accounts/functional").then(function(t){return t.data}).then(function(t){return t.items})},o.prototype.listRekeyables=function(){var n=this;return this.$http.get("/api/accounts/rekey").then(function(t){return t.data}).then(function(t){return t.rekeyableAccounts}).then(function(t){var i=[];return t.forEach(function(t){var e=n.$http.get("/api/accounts/"+t).then(function(t){return t.data});i.push(e)}),n.$q.all(i).then(function(t){return t})})},o.prototype.getProfile=function(t){return this.$http.get("/api/profile/"+t).then(function(t){return new i.Profile(t.data)})},o.prototype.getAccount=function(t){return this.$http.get("/api/accounts/"+t).then(function(t){return t.data})},o.prototype.createFunctionalAccount=function(t){return this.$http.post("/api/accounts/functional",t).then(function(){return!0})},o.prototype.createAccount=function(t){return this.$http.post("/api/accounts",t)},o.prototype.updatePassword=function(t,e,i){var n={newPassword:e,mustChange:i};return this.$http.post("/api/accounts/"+t+"/password",n).then(function(){return!0})},o.prototype.convertToRegular=function(t){return this.$http.post("/api/accounts/"+t+"/to_regular",{}).then(function(){return!0})},o.prototype.convertToFunctional=function(t){return this.$http.post("/api/accounts/"+t+"/to_functional",{}).then(function(){return!0})},o.prototype.removeSessions=function(t){return this.$http.delete("/api/accounts/"+t+"/sessions").then(function(){return!0})},o.prototype.rekey=function(){return this.$http.post("/api/accounts/rekey",{}).then(function(){return!0})},o.prototype.updateAccountActive=function(t,e){var i={active:e};return this.$http.put("/api/accounts/"+t,i).then(function(){return!0})},o.prototype.removeAccount=function(t){return this.$http.delete("/api/accounts/"+t).then(function(){return!0})},o.prototype.mergeGuest=function(t,e){var i={emailAddress:e};return this.$http.post("/api/accounts/"+t+"/merge/guest",i).then(function(){return!0})},o.prototype.mergeAccount=function(t,e){var i={accountId:e};return this.$http.post("/api/accounts/"+t+"/merge/account",i).then(function(){return!0})},o);function o(t,e,i){this.$q=t,this.$log=e,this.$http=i}e.AccountsService=n}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(14)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.prototype.isGuest=function(){return"guest"===this.accountType},o.prototype.isPersonal=function(){return"personal"===this.accountType},o.prototype.isBusiness=function(){return"business"===this.accountType},o.prototype.getProfilePicture=function(){return null!==this.picture?this.picture:i.UNKNOWN_PERSON},o);function o(t){this.nickName=null,this.picture=null,void 0!==t&&(this.absenceDisablesPush=t.absenceDisablesPush,this.absenceMessage=t.absenceMessage,this.accountType=t.accountType,this.email=t.email,this.fullName=t.fullName||null,this.language=t.language,this.nickName=t.nickName||null,this.organizationLogo=t.organizationLogo,this.organizationName=t.organizationName,this.picture=t.picture||null,this.presence=t.presence,this.showRealSender=t.showRealSender||!1,this.showRealSenderDefault=t.showRealSenderDefault||!1,this.timezone=t.timezone||null,this.uuid=t.uuid," "===this.nickName&&(this.nickName=null))}e.Profile=n}.apply(e,n))||(t.exports=o)},function(t,e,i){t.exports=i.p+"assets/img/presence-online.8b840f.svg"},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.$inject=["$http"],n.prototype.list=function(){return this.$http.get("/api/sessions").then(function(t){return t.data}).then(function(t){return t.items})},n.prototype.kill=function(t){return this.$http.delete("/api/sessions/"+t).then(function(){return!0})},n);function n(t){this.$http=t}e.ActiveSessionsService=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(40),i(101)],void 0===(o=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(s.$inject=["$rootScope","$http"],s.prototype.list=function(){return this.$http.get("/api/addressbooks").then(function(t){return t.data})},s.prototype.create=function(t){var e=this;return this.$http.post("/api/addressbooks",t).then(function(t){return t.data}).then(function(t){return e.$rootScope.$broadcast(n.Events.Created,t),t})},s.prototype.get=function(t){return this.$http.get("/api/addressbooks/"+t).then(function(t){return t.data})},s.prototype.getAsAdmin=function(t){return this.$http.get("/api/addressbooks/"+t+"/admin").then(function(t){return t.data})},s.prototype.leave=function(t){return this.$http.delete("/api/addressbooks/"+t).then(function(){return!0})},s.prototype.getMembers=function(t){return this.$http.get("/api/addressbooks/"+t+"/members").then(function(t){return t.data}).then(function(t){return t.items.map(function(t){return new i.Contact(t)})})},s.prototype.update=function(t,e){var i=this;return this.$http.patch("/api/addressbooks/"+t+"/admin",e).then(function(t){return t.data}).then(function(t){return i.$rootScope.$broadcast(n.Events.Updated,t),t})},s.prototype.remove=function(t){var e=this;return this.$http.delete("/api/addressbooks/"+t+"/admin").then(function(){return e.$rootScope.$broadcast(n.Events.Deleted,t),!0})},s.prototype.getMembersExtended=function(t){return this.$http.get("/api/addressbooks/"+t+"/admin/members").then(function(t){return t.data}).then(function(t){return t.items})},s.prototype.setStatus=function(t,e,i){var n={status:i};return this.$http.patch("/api/addressbooks/"+t+"/admin/members/"+e,n).then(function(t){return t.data})},s.prototype.deleteMember=function(t,e){return this.$http.delete("/api/addressbooks/"+t+"/admin/members/"+e).then(function(){return!0})},s.prototype.getSignup=function(t){return this.$http.get("/api/signup/addressbooks/"+t,this.signupRequestsConfig).then(function(t){return t.data})},s.prototype.join=function(t){return this.$http.post("/api/addressbooks/"+t,{}).then(function(){return!0})},s.prototype.requestSignup=function(t,e){return this.$http.post("/api/signup/addressbooks/"+t,e,this.signupRequestsConfig).then(function(){return!0})},s.prototype.authenticateChallenge=function(t){var e={token:t};return this.$http.post("/api/signup/addressbooks/authenticate",e,this.signupRequestsConfig).then(function(){return!0})},s.prototype.unsubscribe=function(t){return this.$http.delete("/api/signup/addressbooks/"+t,this.signupRequestsConfig).then(function(){return!0})},s);function s(t,e){this.$rootScope=t,this.$http=e,this.signupRequestsConfig={authenticationRequired:!1}}e.AddressBookService=o}.apply(e,n))||(t.exports=o)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.Created="addressbook:created",n.Updated="addressbook:updated",n.Deleted="addressbook:deleted",n);function n(){}e.Events=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.$inject=["$http"],n.prototype.getAccountAliases=function(t){return this.$http.get("/api/accounts/"+t+"/aliases").then(function(t){return t.data})},n.prototype.create=function(t,e){var i={emailAddress:e};return this.$http.post("/api/accounts/"+t+"/aliases",i).then(function(t){return t.data})},n.prototype.patch=function(t,e){return this.$http.patch("/api/accounts/"+t+"/aliases/"+encodeURIComponent(e),{}).then(function(){return!0})},n.prototype.remove=function(t,e){return this.$http.delete("/api/accounts/"+t+"/aliases/"+encodeURIComponent(e)).then(function(){return!0})},n);function n(t){this.$http=t}e.AliasService=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(30)],void 0===(o=function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.$inject=["$log","$http"],n.prototype.getAuditLogs=function(t,e,i){var n=o.removeEmptyProps({category:t,actor:e,toDate:i});return this.$http.get("/api/audit_logs",{params:n}).then(function(t){return t.data}).then(function(t){return t.items})},n.prototype.getPersonalAuditLogs=function(t){var e=o.removeEmptyProps({toDate:t});return this.$http.get("/api/audit_logs/personal",{params:e}).then(function(t){return t.data}).then(function(t){return t.items})},n.prototype.getArchives=function(){return this.$http.get("/api/audit_logs/archives").then(function(t){return t.data}).then(function(t){return t.archives})},n.prototype.getCategories=function(){var e=this;return this.$http.get("/api/audit_logs/categories").then(function(t){return t.data}).then(function(t){return t.categories.sort(e.sortCategories)})},n.prototype.getArchiveDownloadUrl=function(e){return this.getDownloadToken().then(function(t){return"/api/audit_logs/archives/download/"+e+"?download_token="+t})},n.prototype.getDownloadToken=function(){return this.$http.get("/api/audit_logs/archives/download").then(function(t){return t.data}).then(function(t){return t.token})},n.prototype.sortCategories=function(t,e){return t.categoryLabel=void 0===t.categoryLabel?t.category:t.categoryLabel,e.categoryLabel=void 0===e.categoryLabel?e.category:e.categoryLabel,t.categoryLabel.localeCompare(e.categoryLabel)},n);function n(t,e){this.$log=t,this.$http=e}e.AuditLogService=i}.apply(e,n))||(t.exports=o)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.$inject=["$http"],n.prototype.list=function(){return this.$http.get("/api/scheduled_absences").then(function(t){return t.data})},n.prototype.create=function(t){return this.$http.post("/api/scheduled_absences",t).then(function(t){return t.data})},n.prototype.update=function(t,e){return this.$http.put("/api/scheduled_absences/"+t,e).then(function(t){return t.data})},n.prototype.remove=function(t){return this.$http.delete("/api/scheduled_absences/"+t).then(function(){return!0})},n);function n(t){this.$http=t}e.AvailabilityService=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(368)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$log","$q","$http"],o.prototype.list=function(){return this.$http.get("/api/business_rules/organization").then(function(t){return t.data}).then(function(t){return t.items.map(function(t){return new i.BusinessRule(t)})})},o.prototype.listPersonal=function(){return this.$http.get("/api/business_rules").then(function(t){return t.data}).then(function(t){return t.items.map(function(t){return new i.BusinessRule(t)})})},o.prototype.update=function(t,e){return this.$http.put("/api/business_rules/organization/"+t,e).then(function(t){return t.data}).then(function(t){return new i.BusinessRule(t)})},o);function o(t,e,i){this.$log=t,this.$q=e,this.$http=i}e.BusinessRulesService=n}.apply(e,n))||(t.exports=o)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.$inject=["$http"],n.prototype.getCategories=function(){var e=this;return this.$http.get("/api/audit_logs/communication/categories").then(function(t){return t.data}).then(function(t){return t.categories.sort(e.sortCategories)})},n.prototype.getCommunicationLogs=function(t,e,i){var n={toDate:e,category:i};return this.$http.get("/api/audit_logs/communication/"+t,{params:n}).then(function(t){return t.data}).then(function(t){return t.items})},n.prototype.sortCategories=function(t,e){return t.categoryLabel=void 0===t.categoryLabel?t.category:t.categoryLabel,e.categoryLabel=void 0===e.categoryLabel?e.category:e.categoryLabel,t.categoryLabel.localeCompare(e.categoryLabel)},n);function n(t){this.$http=t}e.CommunicationLogService=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(7)],void 0===(o=function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(o.$inject=["$q","$http"],o.prototype.listAsAdmin=function(){return this.$http.get("/api/connected_services/organization").then(function(t){return t.data})},o.prototype.listAsUser=function(){return this.$http.get("/api/connected_services/user").then(function(t){return t.data})},o.prototype.get=function(t){switch(t.type){case"medvrij_enabled_service":return this.getMedvrij(t.id)}},o.prototype.create=function(t,e){switch(t){case"medvrij_enabled_service":return this.createMedvrij(e)}},o.prototype.patch=function(t,e){e.id;var i=n.__rest(e,["id"]);switch(t.type){case"medvrij_enabled_service":return this.patchMedvrij(t.id,i)}},o.prototype.toggle=function(t,e){switch(t.type){case"medvrij_enabled_service":return this.toggleMedvrij(t.id,e)}},o.prototype.remove=function(t){switch(t.type){case"medvrij_enabled_service":return this.removeMedvrij(t.id)}},o.prototype.testService=function(t){switch(t.type){case"medvrij_enabled_service":return this.testMedvrij(t.id)}},o.prototype.getMedvrij=function(t){return this.$http.get("/api/connected_services/organization/medvrij_enabled_services/"+t).then(function(t){return t.data})},o.prototype.createMedvrij=function(t){return this.$http.post("/api/connected_services/organization/medvrij_enabled_services",t).then(function(t){return t.data})},o.prototype.toggleMedvrij=function(t,e){return this.$http.post("/api/connected_services/organization/medvrij_enabled_services/"+t,e).then(function(){return!0})},o.prototype.patchMedvrij=function(t,e){return this.$http.patch("/api/connected_services/organization/medvrij_enabled_services/"+t,e).then(function(){return!0})},o.prototype.removeMedvrij=function(t){return this.$http.delete("/api/connected_services/organization/medvrij_enabled_services/"+t).then(function(){return!0})},o.prototype.testMedvrij=function(t){return this.$http.post("/api/connected_services/organization/medvrij_enabled_services/"+t,{}).then(function(){return!0})},o);function o(t,e){this.$q=t,this.$http=e}e.ConnectedServicesService=i}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(40),i(30)],void 0===(o=function(t,e,l,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.$inject=["$rootScope","$log","$q","$http"],n.prototype.listContacts=function(a){var c=this;return this.$q(function(o){var s=[],r=function(e,i){var t={offset:e,limit:i},n="/api/contacts"+("all"!==a?"/"+a:"");return c.$http.get(n,{params:t}).then(function(t){return t.data}).then(function(t){(s=s.concat(t.items.map(function(t){return new l.Contact(t)}))).length<t.pagination.total?r(e+i,i):o(s)})};r(0,1e3)})},n.prototype.get=function(t){return this.$http.get("/api/contacts/"+t).then(function(t){return t.data}).then(function(t){return new l.Contact(t)})},n.prototype.addContact=function(t){var e=this,i={email:t};return this.$http.post("/api/contacts/personal",i).then(function(){return e.get(t)})},n.prototype.removePersonalContact=function(t,e){return this.$http.delete("/api/contacts/personal/"+e).then(function(){return!0})},n.prototype.savePersonalInfo=function(t){var e=this,i=t.personal,n=i.fullName,o=i.language,s=i.phonenumber,r=i.identifier,a=i.accessRightPassword;if(void 0!==t.personal.id)return c={fullName:n,language:o,phonenumber:s,identifier:r,accessRightPassword:a},this.$http.put("/api/contacts/personal/"+t.personal.id,u.removeEmptyProps(c)).then(function(){return e.get(t.email)});var c={email:t.email,fullName:n,language:o,phonenumber:s,identifier:r,accessRightPassword:a};return this.$http.post("/api/contacts/personal",u.removeEmptyProps(c)).then(function(){return e.get(t.email)})},n);function n(t,e,i,n){this.$log=e,this.$q=i,this.$http=n}e.ContactsService=i}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(110),i(30)],void 0===(o=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(s.$inject=["$http"],s.prototype.getInfo=function(t){return this.$http.get("/api/conversation_starters/"+t,this.requestConfig).then(function(t){return t.data})},s.prototype.initiateConversationGuest=function(t,e){return this.$http.post("/api/conversation_starters/"+t,n.removeEmptyProps(e),this.requestConfig).then(function(t){return t.data})},s.prototype.initiateConversationRegistered=function(t){return this.$http.post("/api/conversation_starters/"+t+"/logged_in",{}).then(function(t){return t.data})},s.prototype.validateConversationStarterToken=function(t){var e={token:t};return this.$http.put("/api/conversation_starters",e,this.requestConfig).then(function(t){return t.data})},s.prototype.getBranding=function(t){return this.$http.get("/api/branding/conversation_starters/"+t,this.requestConfig).then(function(t){return new i.GuestBranding(t.data)}).catch(function(){return new i.GuestBranding})},s);function s(t){this.$http=t,this.requestConfig={authenticationRequired:!1}}e.ConversationStartersService=o}.apply(e,n))||(t.exports=o)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GuestBranding=function(t){this.name="zivver",void 0!==t&&(this.accentColor=t.accentColor,this.logoUrl=t.logoUrl,this.name=t.name,this.primaryColor=t.primaryColor,this.wallpaperUrl=t.wallpaperUrl,this.languageColor=t.languageColor)}}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(8),i(5),i(110)],void 0===(o=function(t,e,a,l,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$rootScope","$http","$httpParamSerializerJQLike","$q","$log","$timeout","AccessRightGrantService","SpecialsService"],o.prototype.list=function(e,t,i,n,o){var s=this;void 0===n&&(n=50);var r={order:e,label:i,limit:n,start:void 0===t?void 0:t.toISOString(),special:o};return this.$http.get("/api/conversations",{params:r}).then(function(t){return t.data}).then(function(t){return"asc"===e&&(t.items=t.items.reverse()),{items:t.items.map(function(t){return new a.Conversation(t,s.labels)}),pagination:{total:t.pagination.total}}})},o.prototype.get=function(t){var n=this;return this.$http.get("/api/conversations/"+t).then(function(t){return t.data}).then(function(i){return void 0===i.specialId?new a.Conversation(i,n.labels):n.SpecialsService.getConversationFlow(t).then(function(t){var e=new a.Conversation(i,n.labels);return e.flow=t,e})})},o.prototype.removeConversation=function(t){return this.$http.delete("/api/shares_in/"+t).then(function(){return!0})},o.prototype.getBatch=function(t){var e=this,i={ids:t};return this.$http.post("/api/conversations/batch",i).then(function(t){return t.data}).then(function(t){return t.items.map(function(t){return new a.Conversation(t,e.labels)})})},o.prototype.listMessages=function(t,e,s){var i={order:"asc",token:e,limit:1e3};return this.$http.get("/api/conversations/"+t+"/messages",{params:i}).then(function(t){return t.data}).then(function(t){var e=t.items.reduce(function(t,e){var i=e.sender===s;if(e.deleted||e.revoked&&0==i){var n=new a.ConversationEvent;n.originator=e.sender,n.createdDate=new Date(e.created),e.deleted&&i?n.eventType="deleted-own":e.deleted?n.eventType="deleted":e.revoked&&(n.eventType="revoked"),t[1].push(n)}else{var o=new a.ConversationMessage(e);o.isOwn=i,t[0].push(o)}return t},[[],[]]),i=e[0],n=e[1];return{items:i,events:t.events.map(function(t){return new a.ConversationEvent(t)}).concat(n),pagination:t.pagination}})},o.prototype.revokeMessage=function(t,e,i){return this.$http.delete("/api/conversations/"+t+"/messages/"+e+"?action="+i).then(function(){return!0})},o.prototype.unrevokeMessage=function(t,e){return this.$http.post("/api/conversations/"+t+"/messages/"+e+"/un_revoke",{}).then(function(){return!0})},o.prototype.scheduleAccessRemoval=function(t,e,i){return this.$http.put("/api/conversations/"+t+"/messages/"+e+"/scheduled_expiration",i).then(function(){return!0})},o.prototype.unscheduleAccessRemoval=function(t,e){return this.$http.delete("/api/conversations/"+t+"/messages/"+e+"/scheduled_expiration").then(function(){return!0})},o.prototype.deliverMessage=function(t,e,i){var n={token:i};return this.$http.post("/api/conversations/"+t+"/messages/"+e+"/deliver/self",{params:n}).then(function(){return!0})},o.prototype.deliverWithService=function(t,e,i,n){var o={uuid:n};return this.$http.post("/api/conversations/"+t+"/messages/"+e+"/deliver/service",o).then(function(){return!0})},o.prototype.updateReadMarker=function(t,e){return this.updateConversation(t,{readMarker:e}).then(function(t){return t})},o.prototype.setConversationNotifications=function(t,e,i){var n=this;return this.updateConversation(t.id,{sendNotifications:e,sendNotificationsDefault:i}).then(function(){return t.sendNotificationsDefault=i,t.sendNotifications=e,n.$rootScope.$broadcast("conversation:updated",t),t})},o.prototype.moveConversation=function(t,e){return this.updateConversation(t.id,{archive:"ARCHIVE"===e,trash:"TRASH"===e})},o.prototype.setMessageParticipants=function(e,t){e.participant=t.filter(function(t){return t.email===e.sender})[0]},o.prototype.setConversationLabels=function(t,e){var i=this,n=(e=e.concat([t.systemLabel])).map(function(t){return t.id});return this.updateConversation(t.id,{labels:n}).then(function(){return t.labelIdList=n,t.updateLabelCollection(new a.LabelCollection(e)),i.$rootScope.$broadcast("conversation:updated",t),t})},o.prototype.search=function(t,e){var i={search:t,specialId:e};return this.$http.get("/api/conversations/search",{params:i}).then(function(t){return t.data}).then(function(t){return t.items})},o.prototype.getMessageOpenedBy=function(t,e){return this.$http.get("/api/conversations/"+t+"/messages/"+e+"/opened_by").then(function(t){return t.data})},o.prototype.getShare=function(i){var n=this;return void 0!==this.shares[i]?this.$q.resolve(this.shares[i]):this.$http.get("/api/shares_in/"+i).then(function(t){return t.data}).then(function(t){return new a.Share(t)}).then(function(e){return n.AccessRightGrantService.getGrant(e.id).then(function(t){return e.setAccessRightGrant(t),e.isAccessGranted()&&n.AccessRightGrantService.setGrant(e.id,t),n.shares[i]=e})})},o.prototype.triggerAccessRight=function(t){return this.$http.put("/api/shares_in/"+t.id+"/access_rights/"+t.accessRight.id,{}).then(function(){return!0})},o.prototype.notifySender=function(t){return this.$http.post("/api/shares_in/"+t.id+"/access_rights/"+t.accessRight.id+"/inaccessible",{}).then(function(t){return t.data})},o.prototype.validateAccessRight=function(i,t){var n=this,e={response:t,downloadGrant:i.accessRightGrant.token};return this.$http.post("/api/shares_in/"+i.id+"/access_rights/"+i.accessRight.id,e).then(function(t){return t.data}).then(function(t){var e=new a.AccessRightGrant(t);return void 0!==n.shares[i.id]&&n.shares[i.id].setAccessRightGrant(e),e})},o.prototype.getAttachmentInfo=function(t,e){return this.$http.get("/api/shares_in/"+t+"/files/"+e+"/opened_by").then(function(t){return t.data})},o.prototype.getFileDownloadUrl=function(e,i){return this.getShareDownloadToken(e).then(function(t){return"/api/shares_in/"+e.id+"/files/"+i+"/download/content?download_token="+t})},o.prototype.getMessageDownloadUrl=function(t,e,i,n){return this.getShareDownloadToken(t).then(function(t){return"/api/conversations/"+e+"/messages/"+i+"/download/content?download_token="+t+"&file_type="+n})},o.prototype.getShareDownloadToken=function(e){var i=this;if(void 0===e.downloadToken){var t={token:e.accessRightGrant.token};e.downloadToken=this.$http.post("/api/shares_in/"+e.id+"/download",t).then(function(t){return t.data}).then(function(t){return i.$timeout(function(){e.downloadToken=void 0},750*t.tokenExpirySeconds),t.token})}return e.downloadToken},o.prototype.addNewParticipants=function(t,e,i){var n={items:e.map(function(t){return t.toRequestEntity()}),downloadGrantToken:i};return this.$http.post("/api/conversations/"+t+"/participants/finalize",n).then(function(){return!0})},o.prototype.removeParticipant=function(t,e){var i={email:e};return this.$http.post("/api/conversations/"+t+"/participants/remove",i).then(function(){return!0})},o.prototype.validateNewParticipants=function(t,e,i){var n={items:e.map(function(t){return t.toRequestEntity()}),downloadGrantToken:i};return this.$http.put("/api/conversations/"+t+"/participants/validation",n).then(function(t){return t.data})},o.prototype.setLabels=function(t){this.labels=t},o.prototype.getBrandingForShare=function(t){return this.$http.get("/api/branding/accounts/"+t.conversationCreatorAccountUuid).then(function(t){return new i.GuestBranding(t.data)}).catch(function(){return new i.GuestBranding})},o.prototype.updateConversation=function(t,e){return this.$http.patch("/api/conversations/"+t,e).then(function(){return!0}).catch(function(){return!1})},o.prototype.updateVerification=function(t,e,i){return this.$http.patch("/api/conversations/"+t+"/participants/"+e+"/verification",i).then(function(t){return t.data})},o.prototype.getSecurityLevel=function(t){var e={email:t};return this.$http.get("/api/domains",{params:e}).then(function(t){return t.data.securityLevel})},o.prototype.sendCopyToInbox=function(t,e,i){return this.$http.post("/api/conversations/"+t+"/messages/"+e+"/deliver/self",{securityLevel:i}).then(function(){return!0})},o);function o(t,e,i,n,o,s,r,a){var c=this;this.$rootScope=t,this.$http=e,this.$httpParamSerializerJQLike=i,this.$q=n,this.$log=o,this.$timeout=s,this.AccessRightGrantService=r,this.SpecialsService=a,this.shares={},t.$on(l.AuthEvents.logoutSuccess,function(){return c.shares={}})}e.ConversationsService=n}.apply(e,n))||(t.exports=o)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.$inject=["$http"],n.prototype.getPrincipalAccounts=function(t){return this.$http.get("/api/accounts/"+t+"/delegates").then(function(t){return t.data}).then(function(t){return t.items})},n.prototype.addPrincipalAccount=function(t,e){var i={delegateAccountId:e};return this.$http.post("/api/accounts/"+t+"/delegates",i).then(function(){return!0})},n.prototype.removePrincipalAccount=function(t,e){return this.$http.delete("/api/accounts/"+t+"/delegates/"+e).then(function(){return!0})},n.prototype.getDelegations=function(){return this.$http.get("/api/delegations").then(function(t){return t.data}).then(function(t){return t.items.sort(function(t,e){var i=t.fullName||t.email,n=e.fullName||e.email;return i.localeCompare(n)})})},n.prototype.listDelegateAccounts=function(){return this.$http.get("/api/delegations/delegates").then(function(t){return t.data}).then(function(t){return t.items})},n.prototype.addDelegateAccount=function(t){var e={email:t};return this.$http.post("/api/delegations/delegates",e).then(function(){return!0})},n.prototype.removeDelegateAccount=function(t){return this.$http.delete("/api/delegations/delegates/"+t).then(function(){return!0})},n);function n(t){this.$http=t}e.DelegateAccountService=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(49)],void 0===(o=function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(r.$inject=["$rootScope","$window","$timeout","$log"],r.prototype.isDesktop=function(){return void 0===this.uaParser.getDevice().type},r.prototype.isMobile=function(){return"mobile"===this.uaParser.getDevice().type},r.prototype.getBrowser=function(){return this.uaParser.getBrowser()},r.prototype.getDevice=function(){return this.uaParser.getDevice()},r.prototype.getOS=function(){return this.uaParser.getOS()},r.prototype.simulateMouseClick=function(t){this.$timeout(function(){var e;try{e=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0})}catch(t){(e=document.createEvent("MouseEvent")).initEvent("click",!1,!1,{view:window})}t.dispatchEvent(e)},180,!1)},r.Events={OrientationChanged:"OrientationChanged",WindowResized:"WindowResized"},r);function r(t,e,i,n){var o=this;this.$rootScope=t,this.$timeout=i,this.$log=n,this.uaParser=new s.UAParser,e.addEventListener("orientationchange",function(){var t=90===Math.abs(Number(e.orientation))?"landscape":"portrait";o.$timeout(function(){o.$rootScope.$broadcast(r.Events.OrientationChanged,t),o.$log.debug("Device orientation changed to ",t)},10,!1)}),e.addEventListener("resize",function(){o.$timeout(function(){o.$rootScope.$broadcast(r.Events.WindowResized),o.$log.debug("Window resized ")},10,!1)})}e.DeviceService=i}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(55),i(37)],void 0===(o=function(t,e,l,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n="(([\\w_.+-])+\\s)+",o=(u.prototype.extractRecipientsUsingRegex=function(t){var e=[];if(null!==t.match(u.PATTERN_SEPARATORS.pattern))for(var i=0,n=t.split(u.PATTERN_SEPARATORS.pattern);i<n.length;i++){var o=n[i];if(0!==o.length&&""!==o&&" "!==o){var s=this.getMatchFor(o);e.push(s)}}else 0!==t.length&&""!==t&&" "!==t&&e.push(this.getMatchFor(t));return e},u.prototype.getMatchFor=function(t){for(var e={},i=0,n=this.validPatternsList;i<n.length;i++){var o=n[i],s=t.match(o.pattern);if(null!==s&&s.length){var r=s[0],a=r.match(u.PATTERN_NAME.pattern);null!==a&&a.length&&(e.fullName=a.shift().trim());var c=r.match(u.PATTERN_EMAIL.pattern);if(null!==c&&c.length&&(e.email=c.shift().trim().toLowerCase()),o===u.PATTERN_ANYTHING_ELSE&&(e.email=r),void 0!==e.email&&void 0!==e.fullName)break;if(void 0!==e.email)break}}return new l.Recipient(e)},u.PATTERN_SEPARATORS={name:"separators",pattern:new RegExp("[,;]+","g")},u.PATTERN_NAME={name:"onlyName",pattern:new RegExp(n,"ig")},u.PATTERN_EMAIL={name:"zivverEmail",pattern:new RegExp(i.EMAIL_REGEX,"i")},u.PATTERN_GMAIL={name:"gmail",pattern:new RegExp("("+n+")(<("+i.EMAIL_REGEX+")>)","ig")},u.PATTERN_OUTLOOK={name:"outlook",pattern:new RegExp("("+n+")("+i.EMAIL_REGEX+")","ig")},u.PATTERN_ANYTHING_ELSE={name:"anythingElse",pattern:new RegExp("(([^\\s,;])+\\s?)+","ig")},u);function u(){this.validPatternsList=[u.PATTERN_GMAIL,u.PATTERN_OUTLOOK,u.PATTERN_EMAIL,u.PATTERN_ANYTHING_ELSE]}e.DraftsRecipientsService=o}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(9),i(31)],void 0===(o=function(t,e,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s="ignoredViolations.",i=(r.$inject=["$rootScope","StorageService"],r.prototype.dismissViolation=function(t,e){var i=n.ValidationStatus.clone(e.validation);return t.isClientViolation()&&(i=i.removeViolationByBusinessRuleId(t.businessRuleId)),i=i.ignoreViolation(t),this.$rootScope.$broadcast(o.DraftEvents.ValidationsUpdated,{validation:i}),this.StorageService.setItem("SESSION",s+e.id,i.violationsIgnored.map(function(t){return t.id})),i},r.prototype.dismissAllViolations=function(t){var e=n.ValidationStatus.clone(t.validation);return e.violationsUnresolved.filter(function(t){return!1===t.showStopper}).forEach(function(t){t.isClientViolation()&&(e=e.removeViolationByBusinessRuleId(t.businessRuleId)),e=e.ignoreViolation(t)}),this.$rootScope.$broadcast(o.DraftEvents.ValidationsUpdated,{validation:e}),this.StorageService.setItem("SESSION",s+t.id,e.violationsIgnored.map(function(t){return t.id})),e},r.prototype.getDismissedViolationsIds=function(t){return this.StorageService.getItem("SESSION",s+t)||[]},r.prototype.clearDismissedViolations=function(t){return this.StorageService.removeItem("SESSION",s+t)},r);function r(t,e){this.$rootScope=t,this.StorageService=e}e.DraftsValidationService=i}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(7),i(9)],void 0===(o=function(t,e,i,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$log","$q","$http","Upload"],o.prototype.createFileSlot=function(t,e,i,n){var o={fileType:i,size:e,name:t,inline:n};return this.$http.post("/api/files_out",o).then(function(t){return new s.DraftAttachment(t.data)})},o.prototype.initMultipart=function(r){return this.$http.put("/api/files_out/"+r.fileslotId+"/multipart",{}).then(function(t){return t.data}).then(function(t){for(var e=[],i=0,n=t.partSize,o=0;o<t.parts;o++){var s=o+1;e.push({part:s,start:i,end:n}),(n=(i=n)+t.partSize)>r.size&&(n=r.size)}return e}).then(function(t){return r.parts=t.map(function(t){return i.__assign({},t,{loaded:0,total:t.end-t.start})}),r.upload={aborted:!1,progress:0,loaded:0,partsLeft:r.parts.length},r})},o.prototype.readMultipart=function(n,o,s){return this.$q(function(t,e){var i=new FileReader;i.readAsArrayBuffer(n.slice(o,s)),i.onloadend=function(){i.readyState===FileReader.DONE?t(i.result):e("Error reading file part from "+o+" to "+s)}})},o.prototype.uploadPart=function(t,i,e){var n={method:"put",url:"/api/files_out/"+t.fileslotId+"/multipart/"+i,data:e,headers:{"Content-Type":"application/octet-stream"},timeout:this.$q(function(e){return t.parts=t.parts.map(function(t){return t.part===i&&(t.abort=e),t})}),transformRequest:function(t){return t},uploadEventHandlers:{progress:function(e){t.parts=t.parts.map(function(t){return t.part===i&&(t.loaded=e.loaded),t}),t.upload.loaded=t.parts.reduce(function(t,e){return t+e.loaded},0),t.upload.progress=Math.floor(t.upload.loaded/t.size*100)}}};return this.$http(n).then(function(){t.upload.partsLeft--,t.parts=t.parts.map(function(t){return t.part===i&&(t.abort=function(){}),t})})},o.prototype.finishMultipart=function(t){return this.$http.post("/api/files_out/"+t+"/multipart",{}).then(function(){return!0})},o.prototype.uploadToFileSlot=function(e,t){return e.upload={aborted:!1,partsLeft:0,progress:0,loaded:0},this.Upload.http({url:"/api/files_out/"+e.id+"/content",method:"POST",data:t,headers:{"Content-Type":"application/octet-stream"},timeout:0}).progress(function(t){void 0!==e.upload&&(e.upload.loaded=t.loaded,e.upload.progress=t.loaded/t.total*100)}).then(function(){return e.upload=void 0,e})},o.prototype.remove=function(t){return this.$http.delete("/api/files_out/"+t).then(function(){return!0})},o.prototype.getMaxFileSize=function(){return this.maxFileSize},o);function o(t,e,i,n){this.$log=t,this.$q=e,this.$http=i,this.Upload=n,this.maxFileSize=5497558138880}e.FilesOutService=n}.apply(e,n))||(t.exports=o)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.$inject=["$http"],n.prototype.getFTPStatus=function(){return this.$http.get("/api/authentication/ftp",{}).then(function(t){return t.data})},n.prototype.setFTPStatus=function(t){var e={enabled:t};return this.$http.put("/api/authentication/ftp",e).then(function(t){return t.data})},n);function n(t){this.$http=t}e.FTPService=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.$inject=["$http"],n.prototype.list=function(){return this.$http.get("/api/functions").then(function(t){return t.data}).then(function(t){return t.items})},n.prototype.update=function(t,e){var i={member:e};return this.$http.post("/api/functions/"+t+"/members",i).then(function(){})},n.prototype.remove=function(t,e){return this.$http.delete("/api/functions/"+t+"/members/"+e).then(function(){return!0})},n);function n(t){this.$http=t}e.FunctionsService=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.$inject=["$http","$q","$log"],n.prototype.getCountryCodes=function(){return this.$http.get("/api/geo/phonenumbers",{cache:!0}).then(function(t){return t.data})},n.prototype.getCountries=function(){return this.$http.get("/api/geo/countries").then(function(t){return t.data})},n.prototype.getCountriesInfo=function(){var e=this;return void 0!==this.countriesInfo||(this.countriesInfo=this.$q.all([this.getCountryCodes(),this.getCountries()]).then(function(t){var e=t[0],i=t[1],n=[];return Object.keys(e).forEach(function(t){void 0!==i[t]&&n.push({iso:t,name:i[t],code:e[t].toString()})}),n}).catch(function(t){return e.$log.warn("Error getting codes and names",{error:t}),e.countriesInfo=void 0,[]})),this.countriesInfo},n.prototype.validatePhonenumber=function(t,e){void 0===t&&(t="");var i={defaultRegion:e,phoneNumber:t};return this.$http.put("/api/geo/phonenumbers/validate",i).then(function(t){return t.data})},n.prototype.getCurrentCountryIso=function(){return this.$http.get("/api/geo/countries/current_by_ip").then(function(t){return t.data.region})},n);function n(t,e,i){this.$http=t,this.$q=e,this.$log=i}e.GeoService=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(196)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$http"],o.prototype.get=function(t){return this.$http.get("/api/accounts/invites/"+t).then(function(t){return t.data}).then(function(t){return new i.Invite(t)})},o.prototype.invite=function(t){return this.$http.post("/api/accounts/invites",t).then(function(t){return t.data}).then(function(t){return new i.Invite(t)})},o.prototype.update=function(t,e){return this.$http.put("/api/accounts/invites/"+t,e).then(function(t){return t.data}).then(function(t){return new i.Invite(t)})},o.prototype.remove=function(t){return this.$http.delete("/api/accounts/invites/"+t).then(function(){return!0})},o);function o(t){this.$http=t}e.InvitesService=n}.apply(e,n))||(t.exports=o)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.$inject=["$http"],n.prototype.verifyAdoptShareToken=function(t){var e={shareToken:t};return this.$http.put("/api/keys/adopt_share_key",e).then(function(t){return t.data})},n.prototype.adoptShareToken=function(t){var e={shareToken:t};return this.$http.post("/api/keys/adopt_share_key",e).then(function(){return!0})},n);function n(t){this.$http=t}e.KeysService=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(5),i(8)],void 0===(o=function(t,e,r,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.$inject=["$rootScope","$log","$q","$http","AppSwitcherService"],n.prototype.getLabels=function(t){var e=this;if(void 0===t&&(t=!0),void 0!==this.labelCollectionCached&&t)return this.$q.resolve(this.labelCollectionCached);if(void 0!==this.getPromise&&t)return this.getPromise;var i=this.AppSwitcherService.getContext().specialId;return this.getPromise=this.$http.get("/api/labels",{params:{special:i}}).then(function(t){return t.data}).then(function(t){return e.getPromise=void 0,e.labelCollectionCached=new o.LabelCollection(t.items.map(function(t){return new o.Label(t)})),e.labelCollectionCached}),this.getPromise},n.prototype.createLabel=function(t,e){var i=this,n={name:t,color:e};return this.$http.post("/api/labels",n).then(function(t){return t.data}).then(function(t){var e=new o.Label(t);return void 0!==i.labelCollectionCached&&(i.labelCollectionCached.add(e),i.broadCastUpdate()),e})},n.prototype.updateLabel=function(t,e,i){var n=this,o={name:e,color:i};return this.$http.put("/api/labels/"+t,o).then(function(){void 0!==n.labelCollectionCached&&(n.labelCollectionCached.update(t,o),n.broadCastUpdate())})},n.prototype.removeLabel=function(t){var e=this;return this.$http.delete("/api/labels/"+t).then(function(){return void 0!==e.labelCollectionCached&&(e.labelCollectionCached.remove(t),e.broadCastUpdate(),e.broadCastDelete(t)),!0})},n.prototype.getLabelsAndBroadcast=function(){var e=this;return this.getLabels(!1).then(function(t){return e.broadCastUpdate(),t})},n.prototype.getColors=function(){return Object.keys(o.LabelColors)},n.prototype.broadCastUpdate=function(){this.$rootScope.$broadcast(o.LabelEvents.Updated,this.labelCollectionCached)},n.prototype.broadCastDelete=function(t){this.$rootScope.$broadcast(o.LabelEvents.Deleted,t)},n);function n(t,e,i,n,o){var s=this;this.$rootScope=t,this.$log=e,this.$q=i,this.$http=n,this.AppSwitcherService=o,t.$on(r.AuthEvents.logoutSuccess,function(){s.labelCollectionCached=void 0})}e.LabelService=i}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(7),i(1)],void 0===(o=function(t,e,i,n){"use strict";var s,o;l.$inject=["$provide","$logProvider"],Object.defineProperty(e,"__esModule",{value:!0}),(o=s=e.LogLevel||(e.LogLevel={})).INFO="INFO",o.WARN="WARN",o.ERROR="ERROR";var r=['ARIA: Attribute "',"mdInput messages show animation called on invalid messages element: "],a=(c.$inject=["$http","$timeout","$state","AuthSessionService"],c.prototype.addToDefaultContext=function(t,e){null===e&&n.isDefined(this.defaultContext[t])?delete this.defaultContext[t]:this.defaultContext[t]=e},c.prototype.resetDefaultContext=function(){this.defaultContext={version:"2.16.31"}},c.prototype.logMessage=function(t,e,i){void 0===i&&(i={}),n.isArray(e)&&(e=e.shift()),"string"!=typeof e&&(e=void 0!==e.message?e.message:JSON.stringify(e)),void 0===this.messageMemory[t+"-"+e]&&(-1<r.indexOf(e)||(this.messageMemory[t+"-"+e]=Date.now(),this.$http.post("/api/log",{channel:this.CHANNEL,level:t,message:e.substr(0,255),context:this.getContext(i)},this.getRequestConfig()).catch(function(){return null})))},c.prototype.trackAnalytics=function(t,e){this.$http.post("/api/log",{channel:this.CHANNEL,level:s.INFO,message:"analytics."+t,context:this.getContext(e)},this.getRequestConfig()).catch(function(){return null})},c.prototype.getContext=function(t){return i.__assign({},t,this.defaultContext,{state:this.$state.current.name})},c.prototype.purgeMemory=function(){var e=this,i=Date.now()-600;Object.keys(this.messageMemory).forEach(function(t){e.messageMemory[t]<i&&delete e.messageMemory[t]}),this.$timeout(function(){e.purgeMemory()},6e5,!1)},c.prototype.getRequestConfig=function(){var t={authenticationRequired:!1,headers:{}},e=this.AuthSessionService.getAccessToken();return void 0!==e&&(t.headers.Authorization="Bearer "+e),t},c);function c(t,e,i,n){var o=this;this.$http=t,this.$timeout=e,this.$state=i,this.AuthSessionService=n,this.messageMemory={},this.CHANNEL="WEBAPP",this.resetDefaultContext(),this.messageMemory={},this.$timeout(function(){o.purgeMemory()},6e5,!1)}function l(t,e){function i(e,o){return[s.ERROR,s.WARN,s.INFO].forEach(function(t){return function(i,t){var e=i.toString().toLowerCase(),n=t[e];t[e]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];n.apply(null,t),function(t,e,i){o.get("LoggerService").logMessage(t,e,i)}.apply(null,[i].concat(t))}}(t,e)}),e}i.$inject=["$delegate","$injector"],e.debugEnabled(!1),t.decorator("$log",i)}e.LoggerService=a,e.LoggerServiceModule=n.module("services.LoggerService",[]).config(l)}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(7),i(5)],void 0===(o=function(t,e,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=["login","login-extra-factor","login-refresh","login-401","logout"],o=(r.$inject=["$q","$timeout","$log","$http","$httpParamSerializerJQLike","$state","AuthSessionService","StorageService"],r.prototype.login=function(t,e){var i=this;return this.loginRequest(s.GrantType.password,{username:t,password:e}).then(function(t){return i.createLoginResult(t)}).then(function(t){return i.processRefreshToken(t)}).then(function(t){return i.processAccessToken(t)})},r.prototype.logout=function(t){return this.logoutRequest(t)},r.prototype.refresh=function(t){var e=this;if(void 0===t&&(t=!0),t&&void 0!==this.refreshPromise)return this.refreshPromise;var i=this.AuthSessionService.getRefreshToken();if(void 0===i)return this.$q.reject("No refresh token available");var n=this.AuthSessionService.isDelegate()?s.GrantType.delegate:s.GrantType.refresh_token,o=this.loginRequest(n,{refresh_token:i,username:this.AuthSessionService.getUsername()}).then(function(t){return e.createLoginResult(t)}).then(function(t){return e.processAccessToken(t)}).finally(function(){e.refreshPromise=void 0});return this.refreshPromise=o},r.prototype.authCodeLogin=function(t,e){var i=this;return this.rememberMe=e,this.loginRequest(s.GrantType.authorization_code,{code:t}).then(function(t){return i.createLoginResult(t)}).then(function(t){return i.processRefreshToken(t,!1,!e)}).then(function(t){return i.processAccessToken(t)})},r.prototype.ssoLogin=function(t){var e=this;return this.rememberMe=!0,this.loginRequest(s.GrantType.authorization_code,{code:t}).then(function(t){return e.createLoginResult(t)}).then(function(t){return e.processRefreshToken(t)}).then(function(t){return e.processAccessToken(t)})},r.prototype.switchAccount=function(t){var e=this,i=this.AuthSessionService.getAccessToken(),n=this.AuthSessionService.getRefreshToken(),o=s.GrantType.delegate;return void 0===n?this.$q.reject("No refresh token available"):(void 0!==i&&!0===this.AuthSessionService.isDelegate()&&this.logoutRequest(i),this.mainUsername===t&&(this.AuthSessionService.forgetDelegate(),o=s.GrantType.refresh_token),this.loginRequest(o,{username:t,refresh_token:n}).then(function(t){return e.createLoginResult(t)}).then(function(t){return o===s.GrantType.delegate?e.processRefreshToken(t,!0):e.processRefreshToken(t)}).then(function(t){return e.processAccessToken(t)}))},r.prototype.setRememberMe=function(){this.rememberMe=!0},r.prototype.setLoginDestination=function(t,e){void 0===e&&(e={}),-1<i.indexOf(t)||this.StorageService.setItem("SESSION","login.destination",{stateName:t,stateParams:e})},r.prototype.getLoginDestination=function(){return this.StorageService.getItem("SESSION","login.destination")||{stateName:"conversations.label",stateParams:{}}},r.prototype.clearLoginDestination=function(){this.StorageService.removeItem("SESSION","login.destination")},r.prototype.check401Response=function(t){var e={reason:t.reason};switch(t.reason){case"ACCOUNT_SUSPENDED":case"NOT_DELEGATED":break;case"CLIENT_IP_NOT_IN_RANGE":e.details={clientIp:t.clientIp,allowedRanges:t.allowedRanges};break;default:return!1}return this.$state.go("login-401",e),!0},r.prototype.handleLoginResult=function(t,e,i){if(t.mfaRequired)return this.$state.go("login-extra-factor",{},{location:"replace"});if(void 0===e){var n=this.getLoginDestination();this.clearLoginDestination(),e=n.stateName,i=n.stateParams}return this.$state.go(e,i,{location:"replace"})},r.prototype.isTrustedDevice=function(){var e=this,t=this.StorageService.getItem("LOCAL",this.getTrustedDeviceStorageKey());return null===t?(this.$log.info("No trusted device token found"),this.$q.resolve(!1)):(this.$log.info("Validating trusted device"),this.$http.put("/api/authentication/trusted-clients",{token:t}).then(function(t){return t.data}).then(function(t){return e.AuthSessionService.setScopes(t.scope.split(" ").map(function(t){return a(t)})),e.storeTrustedDeviceToken(t.token),e.$log.info("Trusted device validated"),!0},function(t){return e.$log.warn("Trusted device was not valid",{error:t}),e.removeTrustedDeviceToken(),!1}).catch(function(t){return e.$log.warn("Error validating trusted device",{error:t}),!1}))},r.prototype.trustDevice=function(){var e=this;return this.$http.post("/api/authentication/trusted-clients",{}).then(function(t){return t.data}).then(function(t){return e.storeTrustedDeviceToken(t.token)})},r.prototype.createLoginResult=function(t){return{accessToken:t.access_token,accountId:t.accountId,expiresIn:t.expires_in,mfaRequired:t.mfa_required,refreshToken:t.refresh_token,sessionId:t.sessionId,scopes:t.scope.split(" "),username:t.username}},r.prototype.processAccessToken=function(t){return this.AuthSessionService.setAccessToken(t.accessToken,.85*t.expiresIn),this.AuthSessionService.setScopes(t.scopes.map(function(t){return a(t)})),t},r.prototype.processRefreshToken=function(t,e,i){return void 0===e&&(e=!1),void 0===i&&(i=!1),e||i?this.AuthSessionService.setSessionToken(t,e,i):this.AuthSessionService.setRefreshToken(t,this.rememberMe),this.$timeout(function(){return t},250)},r.prototype.storeTrustedDeviceToken=function(t){this.StorageService.setItem("LOCAL",this.getTrustedDeviceStorageKey(),t)},r.prototype.removeTrustedDeviceToken=function(){this.StorageService.removeItem("LOCAL",this.getTrustedDeviceStorageKey())},r.prototype.getTrustedDeviceStorageKey=function(){return"trusted-client."+this.AuthSessionService.getAccountId()},r.prototype.loginRequest=function(t,e){var i={authenticationRequired:!1,headers:this.headers};return this.$http.post("/api/authentication/login",this.$httpParamSerializerJQLike(n.__assign({},e,{grant_type:t})),i).then(function(t){return t.data})},r.prototype.logoutRequest=function(t){var e={token:t,token_type_hint:"access_token"},i={authenticationRequired:!1,headers:this.headers};return this.$http.post("/api/authentication/revoke",this.$httpParamSerializerJQLike(e),i).then(function(){return!0})},r);function r(t,e,i,n,o,s,r,a){this.$q=t,this.$timeout=e,this.$log=i,this.$http=n,this.$httpParamSerializerJQLike=o,this.$state=s,this.AuthSessionService=r,this.StorageService=a,this.rememberMe=!1,this.headers={"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},this.mainUsername=this.AuthSessionService.getUsernameFromLocalStorage()}function a(t){return s.Scopes[t]}e.LoginService=o}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(14)],void 0===(o=function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.$inject=["$log","$http","$location"],n.prototype.resize=function(t,e,i,n){var o=this,s={source:this.getAbsoluteUrl(t),resize:{width:e,height:i},fitIn:n};return this.$http.post("/api/media/image_resize",s).then(function(t){return t.data}).then(function(t){return t.url}).catch(function(t){return o.$log.warn("could not get resize image url",{error:t}),r.BLANK_GIF})},n.prototype.proxy=function(t){var e=this;return this.$http.post("/api/media/image_resize",{source:t}).then(function(t){return t.data}).then(function(t){return t.url}).catch(function(t){return e.$log.warn("could not get proxy image url",{error:t}),r.BLANK_GIF})},n.prototype.getAbsoluteUrl=function(t){if("http"!==t.substr(0,4)){var e=this.$location.protocol()+"://"+this.$location.host();("http"===this.$location.protocol()&&80!==this.$location.port()||"https"===this.$location.protocol()&&443!==this.$location.port())&&(e+=":"+this.$location.port()),t=""+e+t}return t},n);function n(t,e,i){this.$log=t,this.$http=e,this.$location=i}e.MediaService=i}.apply(e,n))||(t.exports=o)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.$inject=["$mdToast","$mdDialog","$translate"],n.prototype.toast=function(t,e,i){void 0===e&&(e={}),void 0===i&&(i=!0);var n=this.$mdToast.simple().position("top center").parent(this.toastParent).hideDelay(4e3).textContent(i?this.translate(t,e):t);return this.$mdToast.show(n)},n.prototype.alert=function(t,e,i,n,o){void 0===e&&(e=null),void 0===i&&(i={}),void 0===o&&(o=!0);var s=this.$mdDialog.alert().htmlContent(o?this.translate(t,i):t).ok(void 0===n?this.translate("MAIN.OK"):n);return 0<e.length&&s.title(this.translate(e,i)),this.$mdDialog.show(s)},n.prototype.confirm=function(t,e,i,n,o,s){var r;return void 0===e&&(e=""),void 0===i&&(i={}),void 0===n&&(n=null),void 0===o&&(o=null),void 0===s&&(s=!0),null===n&&(n=this.translate("MAIN.OK")),null===o&&(o=this.translate("MAIN.CANCEL")),r=this.$mdDialog.confirm().htmlContent(s?this.translate(t,i):t).ok(n).cancel(o),0<e.length&&r.title(this.translate(e,i)),this.$mdDialog.show(r)},n);function n(t,e,i){this.$mdToast=t,this.$mdDialog=e,this.translate=i.instant}e.MessengerService=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(5),i(6)],void 0===(o=function(t,e,n,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(s.$inject=["$log","$q","$http"],s.prototype.getFactors=function(){var e=this;return this.$http.get("/api/authentication/multifactor").then(function(t){return t.data}).then(function(t){return t.factors.map(function(t){return new n.Multifactor(t)}).sort(e.sortFactors)})},s.prototype.validateFactor=function(t,e,i){void 0===i&&(i=null);var n={response:i},o={headers:{Authorization:"Bearer "+t}};return this.$http.post("/api/authentication/multifactor/"+e,n,o).then(function(t){return t.data})},s.prototype.setupOtp=function(t){var i=this;return this.$http.get("/api/authentication/multifactor/setup/onetimepassword?flavor="+t).then(function(t){return t.data}).then(function(t){if("enabled"===t.status)return i.$log.debug("Cannot setup one time password"),null;var e={otpType:t.otpType};return i.$http.post("/api/authentication/multifactor/setup/onetimepassword",e).then(function(t){return t.data}).then(function(t){return new n.OtpSetup(t)})})},s.prototype.setupSmsFactor=function(t){var e={phonenumber:t};return this.$http.post("/api/authentication/multifactor/setup/sms",e).then(function(t){return t.data})},s.prototype.validateOtpSetup=function(t,e){var i={otpType:t,authcode:e};return this.$http.put("/api/authentication/multifactor/setup/onetimepassword",i).then(function(){return!0})},s.prototype.validateSmsSetup=function(t,e){var i={phonenumber:t,authcode:e};return this.$http.put("/api/authentication/multifactor/setup/sms",i).then(function(){return!0})},s.prototype.getBackupcodes=function(){var e=this;return this.$http.get("/api/authentication/multifactor/backupcodes").then(function(t){return t.status===i.HTTP_NO_CONTENT?e.generateBackupcodes():t.data})},s.prototype.generateBackupcodes=function(){return this.$http.post("/api/authentication/multifactor/backupcodes",{}).then(function(t){return t.data})},s.prototype.removeFactor=function(t){return this.$http.delete("/api/authentication/multifactor/"+t).then(function(){return!0})},s.prototype.sortFactors=function(t,e){return t.isTotp()?-1:1},s);function s(t,e,i){this.$log=t,this.$q=e,this.$http=i}e.MultifactorService=o}.apply(e,n))||(t.exports=o)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.$inject=["$log","$http","$q"],n.prototype.isEmailActive=function(){return this.$http.get("/api/notifications/email").then(function(t){return t.data}).then(function(t){return t.sendNotificationsDefault})},n.prototype.getPushNotificationSubscriptions=function(){var e=this;return this.$http.get("/api/notifications/push").then(function(t){return t.data}).catch(function(t){return e.$log.warn("Error getting push notification subscriptions",{error:t}),{sendNotificationsDefault:!1,userTokens:[]}})},n.prototype.subscribePushNotifications=function(t,e){var i={pushSubscriptionType:t,token:e};return this.$http.post("/api/notifications/push",i).then(function(t){return t.data})},n.prototype.toggleEmailNotifications=function(t){var e={sendNotificationsDefault:t};return this.$http.put("/api/notifications/email",e).then(function(){return!0})},n.prototype.togglePushNotifications=function(t){var e={sendNotificationsDefault:t};return this.$http.put("/api/notifications/push",e).then(function(){return!0})},n.prototype.deletePushNotificationSubscription=function(t){return this.$http.delete("/api/notifications/push/"+t).then(function(){return!0})},n);function n(t,e,i){this.$log=t,this.$http=e,this.$q=i}e.NotificationService=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(30)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$q","$http","Upload"],o.prototype.get=function(){return this.$http.get("/api/organization").then(function(t){return t.data})},o.prototype.uploadLogo=function(t){return this.Upload.http({method:"POST",url:"/api/organization/logo",data:t,headers:{"Content-Type":"application/octet-stream"},timeout:0})},o.prototype.deleteOrganization=function(t){var e={password:t};return this.$http.post("/api/organization/remove",e).then(function(){return!0})},o.prototype.updateOrganization=function(t){return this.$http.patch("/api/organization",t).then(function(t){return t.data})},o.prototype.getNetworkRangeRestriction=function(){return this.$http.get("/api/organization/network_range_restriction").then(function(t){return t.data})},o.prototype.addNetworkRangeRestriction=function(t,e){var i={ipRange:t,description:e};return this.$http.post("/api/organization/network_range_restriction",i).then(function(){return!0})},o.prototype.changeNetworkRangeRestrictions=function(t){return this.$http.put("/api/organization/network_range_restriction",t).then(function(){return!0})},o.prototype.removeNetworkRangeRestriction=function(t){var e={range:t.ipRange};return this.$http.delete("/api/organization/network_range_restriction",{params:e}).then(function(){return!0})},o.prototype.getFooters=function(){return this.$http.get("/api/organization/email_footers").then(function(t){return t.data})},o.prototype.saveFooter=function(t){return this.$http.post("/api/organization/email_footers",t).then(function(){return!0})},o.prototype.sendFooterExample=function(t){return this.$http.post("/api/organization/email_footers/preview",t).then(function(){return!0})},o.prototype.getPreNotificationEmails=function(){return this.$http.get("/api/organization/pre_notification").then(function(t){return t.data})},o.prototype.savePreNotificationEmail=function(t,e,i){var n={body:t,subject:e,language:i};return this.$http.post("/api/organization/pre_notification",n).then(function(){return!0})},o.prototype.sendPreNotificationEmail=function(t,e,i){var n={body:t,subject:e,language:i};return this.$http.post("/api/organization/pre_notification/preview",n).then(function(){return!0})},o.prototype.savePreNotificationStatus=function(t){var e={enabled:t};return this.$http.patch("/api/organization/pre_notification",e).then(function(){return!0})},o.prototype.getVerificationSuggestions=function(){return this.$http.get("/api/organization/verification_suggestions").then(function(t){return t.data})},o.prototype.getVerificationSuggestionsByEmail=function(t){return this.$http.get("/api/organization/verification_suggestions/"+t).then(function(t){return t.data})},o.prototype.removeVerificationSuggestions=function(t){return this.$http.delete("/api/organization/verification_suggestions/"+t).then(function(){return!0})},o.prototype.uploadVerificationSuggestions=function(t){return this.Upload.http({method:"POST",url:"/api/organization/verification_suggestions/validate",data:t,headers:{"Content-Type":"text/csv"},timeout:0})},o.prototype.importVerificationSuggestions=function(t){return this.$http.post("/api/organization/verification_suggestions",{items:t},{timeout:6e4}).then(function(){return!0})},o.prototype.listClaimedDomains=function(){return this.$http.get("/api/organization/domain_ownership").then(function(t){return t.data})},o.prototype.addClaimedDomain=function(t,e){var i={domain:t,emailAlias:e};return this.$http.post("/api/organization/domain_ownership",i).then(function(){return!0})},o.prototype.verifyClaimedDomain=function(t){var e={token:t};return this.$http.put("/api/organization/domain_ownership",e).then(function(){return!0})},o.prototype.removeClaimedDomain=function(t){return this.$http.delete("/api/organization/domain_ownership/"+t).then(function(){return!0})},o.prototype.forceJoinAccountsDomain=function(t){return this.$http.post("/api/organization/domain_ownership/"+t+"/force_join",{}).then(function(){return!0})},o.prototype.listEmailDomains=function(){return this.$http.get("/api/organization/domain_email").then(function(t){return t.data})},o.prototype.addEmailDomain=function(t){var e={domain:t};return this.$http.post("/api/organization/domain_email",e).then(function(t){return t.data})},o.prototype.removeEmailDomain=function(t){return this.$http.delete("/api/organization/domain_email/"+t).then(function(){return!0})},o.prototype.getSsoSaml=function(){return this.$http.get("/api/organization/sso/saml").then(function(t){return t.data})},o.prototype.removeSsoSaml=function(){return this.$http.delete("/api/organization/sso/saml").then(function(){return!0})},o.prototype.saveSsoException=function(t){return this.$http.post("/api/organization/sso/2fa_exemption",t).then(function(){return!0})},o.prototype.saveSsoSaml=function(t){return this.$http.post("/api/organization/sso/saml",i.removeEmptyProps(t)).then(function(){return!0})},o.prototype.listApiKeys=function(){return this.$http.get("/api/organization/apikeys").then(function(t){return t.data})},o.prototype.createApiKey=function(t,e){var i={name:t,permissions:e};return this.$http.post("/api/organization/apikeys",i).then(function(t){return t.data})},o.prototype.toggleApiKey=function(t,e){var i={enabled:e};return this.$http.put("/api/organization/apikeys/"+t,i).then(function(t){return t.data})},o.prototype.removeApiKey=function(t){return this.$http.delete("/api/organization/apikeys/"+t).then(function(){return!0})},o.prototype.getConversationStarters=function(){return this.$http.get("/api/organization/conversation_starters").then(function(t){return t.data})},o.prototype.createConversationStarter=function(t){return this.$http.post("/api/organization/conversation_starters",t).then(function(t){return t.data})},o.prototype.updateConversationStarter=function(t){return this.$http.put("/api/organization/conversation_starters/"+t.id,t).then(function(t){return t.data})},o.prototype.removeConversationStarter=function(t){return this.$http.delete("/api/organization/conversation_starters/"+t).then(function(){return!0})},o.prototype.getSmtpCredentials=function(){return this.$http.get("/api/organization/smtp_credentials").then(function(t){return t.data})},o.prototype.createSmtpCredentials=function(t){var e={description:t};return this.$http.post("/api/organization/smtp_credentials",e).then(function(t){return t.data})},o.prototype.updateSmtpCredentials=function(t,e){var i={isActive:e};return this.$http.patch("/api/organization/smtp_credentials/"+t,i).then(function(){return!0})},o.prototype.removeSmtpCredentials=function(t){return this.$http.delete("/api/organization/smtp_credentials/"+t,{}).then(function(){return!0})},o.prototype.getDirectDeliveryDomains=function(){return this.$http.get("/api/organization/direct_delivery_domains").then(function(t){return t.data}).then(function(t){return t.items})},o.prototype.updateDirectDeliveryDomain=function(t,e){var i={isActive:e};return this.$http.patch("/api/organization/direct_delivery_domains/"+t,i).then(function(){return!0})},o.prototype.validateDirectDeliveryDomain=function(t){return this.$http.put("/api/organization/direct_delivery_domains/"+t+"/validate",{}).then(function(t){return t.data})},o.prototype.setMessageExpirationPolicy=function(t){return this.$http.put("/api/organization/message_expiration_policy",t).then(function(){return!0})},o.prototype.getMessageExpirationPolicy=function(){return this.$http.get("/api/organization/message_expiration_policy").then(function(t){return t.data})},o);function o(t,e,i){this.$q=t,this.$http=e,this.Upload=i}e.OrganizationService=n}.apply(e,n))||(t.exports=o)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.$inject=["$http","$httpParamSerializerJQLike"],n.prototype.validateResetToken=function(t){var e={authenticationRequired:!1,params:{token:t}};return this.$http.get("/api/authentication/password/forgot",e).then(function(t){return t.data})},n.prototype.initForget=function(t){var e={email_address:t};return this.$http.post("/api/authentication/password/forgot",this.$httpParamSerializerJQLike(e),{authenticationRequired:!1,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(function(){return!0})},n.prototype.resetPassword=function(t,e,i){var n={resetToken:t,password:e,recoveryCode:i};return this.$http.put("/api/authentication/password/forgot",n,{authenticationRequired:!1}).then(function(){return!0})},n.prototype.changePassword=function(t,e){var i={oldPassword:t,newPassword:e};return this.$http.post("/api/authentication/password/change",i).then(function(){return!0})},n.prototype.test=function(t){var e={password:t};return this.$http.post("/api/authentication/password/test",e,{authenticationRequired:!1}).then(function(t){return t.data})},n);function n(t,e){this.$http=t,this.$httpParamSerializerJQLike=e}e.PasswordService=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(10)],void 0===(o=function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.$inject=["$log","$window","$timeout","$translate","AuthSessionService","MessengerService"],n.prototype.printConversation=function(t,i){var n=this;!1!==this.isConversationLoaded(i)?this.createPrintWindow("share="+t.share+"&conversation="+t.id).then(function(e){try{e.document.title=t.subject,e.document.body.innerHTML=[n.generateHeader(),n.generateConversationHtml(i)].join("\n"),n.$timeout(function(){e.window.print()},250,!1)}catch(t){n.$log.error("Error creating print window DOM",{error:t}),e.close()}}).catch(function(t){n.$log.error("Error creating  print window",{error:t})}):this.MessengerService.toast("PRINT.NOTREADY",{},!0)},n.prototype.isConversationLoaded=function(t){var e=!1;return[].slice.call(t.querySelectorAll("conversation-message")).forEach(function(t){""!==t.innerHTML&&(e=!0)}),e},n.prototype.createPrintWindow=function(t){var e=this.$window.location,i=e.href.replace(e.pathname,"")+"/print.html#/?"+t,n=this.$window.window.open(i,"print-"+t);return this.$timeout(function(){try{return n.addEventListener("unload",function(){n.close()}),n}catch(t){throw n.close(),t}},350,!1)},n.prototype.generateHeader=function(){return'\n\t\t<header>\n\t\t\t<div class="profile">'+this.AuthSessionService.getUsername()+"</div>\n\t\t</header>\n\t\t"},n.prototype.generateConversationHtml=function(o){var s=this,r=this.$window.document.createElement("div"),t=this.$window.document.body.querySelector("conversation-header .title .md-title").innerHTML,e=this.$window.document.body.querySelector("conversation-header .all-participants").innerHTML;return[].slice.call(o.querySelectorAll("conversation-message")).forEach(function(t,e){var i,n=t.cloneNode(!0);0===e&&[].slice.call(o.querySelectorAll("conversation-quote div.message-quoted")).forEach(function(t){void 0!==t&&(i=t.cloneNode(!0),s.fixConversationQuoteDisplay(i),s.fixConversationQuoteAttachmentsDisplay(i),s.appendConversationQuote(n,i))}),s.fixExpirationBar(n),s.fixHeaderDisplay(n),s.fixConversationAttachmentsDisplay(n),r.appendChild(n)}),'\n\t\t<div class="conversation">\n\t\t\t<h1>'+t+"</h1>\n\t\t\t<h2>"+e+"</h2>\n\t\t\t"+r.innerHTML+"\n\t\t</div>"},n.prototype.appendConversationQuote=function(t,e){t.querySelector("a.downloadMessage").appendChild(e)},n.prototype.fixExpirationBar=function(t){var e=t.querySelector("expiration-bar");if(null!==e){var i=this.$window.document.createElement("span");i.classList.add("expiration"),i.textContent=e.querySelector("span.description").innerHTML,e.replaceWith(i)}},n.prototype.fixHeaderDisplay=function(t){var e=t.querySelector("time");if(null!==e){var i=this.$window.document.createElement("span");i.classList.add("time"),i.textContent=a(e.getAttribute("datetime")).format("LLLL");var n=t.querySelector("md-card-header-text"),o=n.querySelector("span.md-title span.fullname")?n.querySelector("span.md-title span.fullname").innerHTML:"",s=n.querySelector("span.sender .sent-by").innerHTML,r=""!==o?o+" &lt;"+s+"&gt;":s;n.innerHTML='<span class="sender">'+r+"</span>",n.appendChild(i)}},n.prototype.fixConversationAttachmentsDisplay=function(t){var e=t.querySelector("conversation-attachments");if(null!==e){var i=this.$window.document.createElement("ul"),n=this.$window.document.createElement("h4");n.textContent=this.$translate.instant("PRINT.ATTACHMENTS")+":";for(var o=0,s=[].slice.call(e.querySelectorAll("span.filename"));o<s.length;o++){var r=s[o],a=this.$window.document.createElement("li");a.textContent=r.getAttribute("title"),i.appendChild(a)}e.parentNode.appendChild(n),e.parentNode.appendChild(i),e.parentNode.removeChild(e)}},n.prototype.fixConversationQuoteDisplay=function(t){var e=t.querySelector(".quote-information span.sender"),i=t.querySelector(".quote-information time");i.textContent=this.$translate.instant("PRINT.QUOTED")+a(i.getAttribute("datetime")).format("LLLL");var n=t.querySelector("div.conversation-message-body.info div.message-body"),o=t.querySelector("conversation-message-body div.message-body");if(null!==o){var s=this.$window.document.createElement("span");s.classList.add("time"),s.appendChild(e),s.appendChild(i),null!==n&&s.appendChild(n),s.appendChild(o),t.appendChild(s),t.classList.add("quote")}},n.prototype.fixConversationQuoteAttachmentsDisplay=function(t){var e=t.querySelector("conversation-attachments");if(null!==e){var i=t.querySelector(".quote-information"),n=this.$window.document.createElement("ul"),o=this.$window.document.createElement("h4");o.textContent=this.$translate.instant("PRINT.ATTACHMENTS")+":";for(var s=0,r=[].slice.call(e.querySelectorAll("span.filename"));s<r.length;s++){var a=r[s],c=this.$window.document.createElement("li");c.textContent=a.getAttribute("title"),n.appendChild(c)}t.removeChild(i),t.appendChild(o),t.appendChild(n),e.parentNode.removeChild(e)}},n);function n(t,e,i,n,o,s){this.$log=t,this.$window=e,this.$timeout=i,this.$translate=n,this.AuthSessionService=o,this.MessengerService=s}e.PrintService=i}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(30),i(97),i(5)],void 0===(o=function(t,e,n,o,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(s.$inject=["$rootScope","$q","$http","AuthSessionService","Upload"],s.prototype.get=function(){if(void 0!==this.cachedProfilePromise)return this.cachedProfilePromise;var t=[];return t.push(this.$http.get("/api/profile").then(function(t){return t.data}).then(function(t){return new o.Profile(t)})),t.push(this.progress()),this.cachedProfilePromise=this.$q.all(t).then(function(t){var e=t[0],i=t[1];return e.features=i,e}),this.cachedProfilePromise},s.prototype.save=function(t,e){var i=this;return this.$http.patch("/api/profile/"+t,n.removeEmptyProps(e)).then(function(t){return i.cachedProfilePromise=void 0,new o.Profile(t.data)}).then(function(e){return i.AuthSessionService.getAccountId()===t?i.progress().then(function(t){return e.features=t,i.$rootScope.$broadcast("profile-updated",{profile:e}),e}):e})},s.prototype.patchProfile=function(t,e){return this.$http.patch("/api/profile"+(e?"/"+e:""),t).then(function(){return!0})},s.prototype.uploadPicture=function(t,e){var i=this,n="/api/profile"+(void 0!==e?"/"+e+"/picture":"/picture"),o=this.Upload.http({method:"POST",url:n,data:t,headers:{"Content-Type":"application/octet-stream"},timeout:0});return o.then(function(){i.cachedProfilePromise=void 0}),o},s.prototype.removePicture=function(t){var e="/api/profile"+(void 0!==t?"/"+t+"/picture":"/picture");return this.$http.delete(e).then(function(){return!0})},s.prototype.clearCachedProfile=function(){this.cachedProfilePromise=void 0},s.prototype.progress=function(){return this.$http.get("/api/profile/progress").then(function(t){return t.data})},s.prototype.deleteAccount=function(t){var e={password:t};return this.$http.post("/api/profile/remove",e).then(function(){return!0})},s);function s(t,e,i,n,o){var s=this;this.$rootScope=t,this.$q=e,this.$http=i,this.AuthSessionService=n,this.Upload=o,t.$on(r.AuthEvents.logoutSuccess,function(){return s.clearCachedProfile()})}e.ProfileService=i}.apply(e,n))||(t.exports=o)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.$inject=["$http"],n.prototype.get=function(){return this.$http.get("/api/organization/quickstats").then(function(t){return t.data})},n);function n(t){this.$http=t}e.QuickStatsService=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(10)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n="ddd D MMM YYYY HH:mm",o=(s.$inject=["$http"],s.prototype.getInaccessibles=function(){return this.$http.get("/api/keys/recovery/inaccessibles").then(function(t){return t.data}).then(function(t){return t.inaccessibles.map(function(t){return void 0!==t.recoverySent&&(t.recoverySent=i(t.recoverySent).format(n)),t.activeSince=i(t.activeSince).format(n),t.activeUntil=i(t.activeUntil).format(n),t}),t})},s.prototype.getLastCodeInfo=function(){return this.$http.get("/api/keys/recovery").then(function(t){return t.data}).then(function(t){return void 0!==t.lastSent&&(t.lastSent=i(t.lastSent).format(n)),t})},s.prototype.requestNewCode=function(){return this.$http.post("/api/keys/recovery",{}).then(function(){return!0})},s.prototype.requestRecovery=function(t){return this.$http.post("/api/keys/recovery/inaccessibles",t).then(function(t){return t.data})},s);function s(t){this.$http=t}e.RecoveryKeyService=o}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(31),i(9),i(6),i(8)],void 0===(o=function(t,e,r,a,c,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.$inject=["$rootScope","$q","$log","$http","DraftsValidationService","WizardService"],n.prototype.send=function(t,e,i){var n={draft:e.toRequestEntity(),downloadGrantToken:i};return this.$http.post("/api/conversations/"+t+"/draft/finalize",n).then(function(t){return t.data}).then(function(t){return new o.ConversationMessage(t.message)})},n.prototype.validate=function(t,i,e,n){var o=this,s={draft:i.toRequestEntity(),downloadGrantToken:e};return this.$http.put("/api/conversations/"+t+"/draft/validation",s).then(function(t){var e=new a.ValidationStatus(t.data,o.DraftsValidationService.getDismissedViolationsIds(i.id));return e.validationCompleted=t.status===c.HTTP_OK,e=e.addClientViolations(i.validation.clientViolations),o.$rootScope.$broadcast(r.DraftEvents.ValidationsUpdated,{validation:e}),e.hasViolations()&&!1===n&&o.WizardService.showWizardOnce(o.WizardService.WIZARDS.BUSINESSRULES),e})},n);function n(t,e,i,n,o,s){this.$rootScope=t,this.$q=e,this.$log=i,this.$http=n,this.DraftsValidationService=o,this.WizardService=s}e.ReplyService=i}.apply(e,n))||(t.exports=o)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=["A","ADDRESS","AREA","B","BLOCKQUOTE","BR","CAPTION","CODE","COL","COLGROUP","DD","DEL","DIV","DL","DT","EM","FIGCAPTION","FIGURE","FONT","H1","H2","H3","H4","H5","H6","HR","I","IMG","INS","LI","MARK","MAP","OL","P","PRE","Q","S","SMALL","SPAN","STRIKE","STRONG","SUB","SUP","TABLE","TBODY","TD","THEAD","TFOOT","TH","TIME","TR","U","UL"],i=(o.$inject=["$window","$log","MessengerService"],o.prototype.sanitizeHtml=function(t,e){var i=this.$window.document.createElement("div");i.style.display="none",i.style.visibility="hidden",i.insertAdjacentHTML("beforeend",t);for(var n=0,o=[].slice.call(i.querySelectorAll("img"));n<o.length;n++){var s=o[n];this.sanitizeImg(s,e)}for(var r=0,a=[].slice.call(i.querySelectorAll(this.disAllowedTagsSelector));r<a.length;r++)s=a[r],this.$log.warn("removing non-whitelisted tag "+s.tagName),this.removeElement(s);for(var c=0,l=[].slice.call(i.querySelectorAll("td"));c<l.length;c++)s=l[c],this.sanitizeTable(s);for(var u=0,p=[].slice.call(i.querySelectorAll("a"));u<p.length;u++)s=p[u],this.sanitizeAnchor(s);for(var d=0,h=[].slice.call(i.querySelectorAll(":not(a):not(img):not(td)"));d<h.length;d++)s=h[d],this.sanitizeElement(s);return i},o.prototype.sanitizeAnchor=function(t){var e=t.getAttribute("href"),i=t.getAttribute("style"),n=t.innerText;this.removeAttributes(t),this.sanitizeStyle(t,i),null!==e&&(null!==e.match(/^(call|ftp|http|https|mailto):/i)?(t.target="_blank",t.rel="noopener noreferrer",t.href=e,0<n.length&&(t.innerText=n)):this.$log.info("invalid href for a element",{href:e}))},o.prototype.sanitizeImg=function(t,e){var i=t.getAttribute("src"),n=t.getAttribute("alt"),o=t.getAttribute("title"),s=e.map(function(t){return t.name}),r=!1,a=new RegExp("(https://img.zivver.com|https://img.zivver.org|localhost:)+");if("sanitized"!==t.className){if(this.removeAttributes(t),null!==i){var c=s.indexOf(i);if(-1<c){var l=e[c];!1===l.downloadable?this.$log.warn("inline image is marked as not downloadable",{fileId:l.id}):(t.className="internal",t.setAttribute("attachmentId",l.id),r=!0)}if(!1===r&&a.test(i))return t.className="sanitized",t.src=i,void(t.title=o);if(!1===r&&"http"===i.substring(0,4)&&(t.className="external",t.title=i,r=!0),!1===r&&!1===/^data:image\/[^;]+;base64/i.test(i)&&(t.src=i,r=!0),!1===r)return this.removeElement(t),void this.$log.info("removed img tag without valid src",{src:i})}null!==n&&(t.alt=n)}},o.prototype.sanitizeTable=function(e){var i=this,n=e.getAttribute("style");[].slice.call(e.attributes).forEach(function(t){switch(t.name){case"align":case"valign":case"width":case"height":case"colspan":case"rowspan":break;case"style":i.sanitizeStyle(e,n);break;default:e.removeAttribute(t.name)}})},o.prototype.sanitizeElement=function(t){var e=t.getAttribute("style");this.removeAttributes(t),this.sanitizeStyle(t,e)},o.prototype.sanitizeStyle=function(o,t){var s=this;if(void 0===t&&(t=""),null!==t&&""!==t){var e=t.replace(/\\r\\n/gi,"").split(";").map(function(t){return t.trim()}),r=[];e.forEach(function(t){if(""!==t.trim()){var e=t.split(":").map(function(t){return t.toLowerCase().trim()}),i=e[0],n=e[1];switch(i){case"font-family":"wingdings"===n.toLowerCase()&&"J"===o.innerHTML?o.innerHTML="😀":r.push(i+":"+n.replace(/"/gi,"'"));break;case"background":0<n.indexOf("url")?s.$log.info("invalid style property",{prop:i,val:n}):r.push(i+":"+n);break;case"position":"relative"===n.toLowerCase()&&r.push(i+":"+n);break;case"white-space":"normal"!==n&&(s.$log.info("invalid style property",{prop:i,val:n}),r.push(i+":normal"));break;case"background-color":case"border":case"border-bottom":case"border-left":case"border-right":case"border-top":case"box-sizing":case"box-top":case"color":case"letter-spacing":case"line-height":case"max-height":case"max-width":case"outline":case"page":case"vertical-align":case"word-wrap":case"word-spacing":r.push(i+":"+n);break;default:0===i.indexOf("border")||0===i.indexOf("font")||0===i.indexOf("margin")||0===i.indexOf("padding")||0===i.indexOf("text")?r.push(i+":"+n):s.$log.info("invalid style property",{prop:i,val:n})}}}),0<r.length&&o.setAttribute("style",r.join(";"))}},o.prototype.removeAttributes=function(e){[].slice.call(e.attributes).forEach(function(t){e.removeAttribute(t.name)})},o.prototype.removeElement=function(t){void 0!==t.remove?t.remove():t.parentNode.removeChild(t)},o);function o(t,e,i){this.$window=t,this.$log=e,this.MessengerService=i,this.disAllowedTagsSelector=n.reduce(function(t,e){return t+":not("+e+")"},"")}e.SanitizeService=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.prototype.scrollIntoView=function(t,i,e){var n=this;void 0===e&&(e=!0);var o=t.offsetTop-i.scrollTop,s=Math.abs(o),r=o<0?"up":"down",a=i.scrollTop+o,c=0,l=0,u=this.scrollDuration/16,p=0;if(!0===e)var d=setInterval(function(){var t,e;l=16*c/n.scrollDuration,p=function(t){return t<.5?2*t*t:(4-2*t)*t-1}(l)*s,u<c&&clearInterval(d),"down"==r&&(e=d,i.scrollTop<a?i.scrollTop+p>a?i.scrollTop=a:i.scrollTop+=p:clearInterval(e)),"up"==r&&(t=d,i.scrollTop>a?i.scrollTop-p<a?i.scrollTop=a:i.scrollTop-=p:clearInterval(t)),c++},16)},n);function n(){this.scrollDuration=350}e.ScrollService=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(76)],void 0===(o=function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.$inject=["$log","$q","$http"],n.prototype.getSettings=function(e){var i=this;if("USER"===e&&void 0!==this.cachedUserSettings)return this.cachedUserSettings;var t=this.$http.get("/api/settings/"+e.toLowerCase()).then(function(t){return t.data}).then(function(t){return t.settings.map(function(t){return new r.Setting(e,t)})});return"USER"===e&&(this.cachedUserSettings=t),t.catch(function(t){return i.$log.error("Error getting settings",{error:t,type:e}),"USER"===e&&(i.cachedUserSettings=void 0),[]})},n.prototype.getSetting=function(i,n,o){return this.getSettings(i).then(function(t){var e=t.filter(function(t){return t.keyName===n}).shift();return void 0===e&&(e=new r.Setting(i,{keyName:n,valueData:o,enabled:!1})),e})},n.prototype.updateSetting=function(i,n,o){var s=this;return this.getSettings(i).then(function(t){var e=t.filter(function(t){return t.keyName!==n}).concat([new r.Setting(i,{keyName:n,valueData:o})]);return s.updateSettings(i,e).then(function(t){return t.filter(function(t){return t.keyName===n}).shift()})})},n.prototype.updateSettings=function(e,t){var i=this,n=t.map(function(t){return t.keyName}),o={settings:t.map(function(t){return{forced:t.forced,keyName:t.keyName,valueData:t.valueData}})};return this.$http.put("/api/settings/"+e.toLowerCase(),o).then(function(t){return t.data}).then(function(t){return t.settings.filter(function(t){return-1<n.indexOf(t.keyName)}).map(function(t){return new r.Setting(e,t)})}).then(function(t){return"USER"===e&&(i.cachedUserSettings=i.$q.resolve(t)),t})},n);function n(t,e,i){this.$log=t,this.$q=e,this.$http=i}e.SettingsService=i}.apply(e,n))||(t.exports=o)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.$inject=["StorageService"],n.prototype.storeToken=function(t,e){this.storage.setItem(this.getStorageKey(t),e)},n.prototype.hasToken=function(t){return null!==this.storage.getItem(this.getStorageKey(t))},n.prototype.getToken=function(t){var e=this.storage.getItem(this.getStorageKey(t));return null===e?void 0:e},n.prototype.removeToken=function(t){this.storage.removeItem(this.getStorageKey(t))},n.prototype.getStorageKey=function(t){return"share.token."+t},n);function n(i){this.storage={getItem:function(t){return i.getItem("LOCAL",t,!1)},setItem:function(t,e){return i.setItem("LOCAL",t,e,!1)},removeItem:function(t){return i.removeItem("LOCAL",t)}}}e.ShareTokenService=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(6)],void 0===(o=function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(o.$inject=["$q","$http"],o.prototype.getSignature=function(t,e){var i={context:e};return this.$http.get("/api/profile/"+t+"/signature",{params:i}).then(function(t){if(t.status!==n.HTTP_NO_CONTENT)return t.data})},o.prototype.setSignature=function(t,e){return this.$http.post("/api/profile/"+t+"/signature",e).then(function(){return!0})},o);function o(t,e){this.$q=t,this.$http=e}e.SignatureService=i}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(7),i(369)],void 0===(o=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(s.$inject=["$http"],s.prototype.signup=function(t){var e={email:t};return this.$http.post("/api/signup",e,this.requestConfig).then(function(){return!0})},s.prototype.create=function(t){return this.$http.post("/api/signup/create",t,this.requestConfig).then(function(){return!0})},s.prototype.validate=function(t){var e=i.__assign({},this.requestConfig,{params:{token:t}});return this.$http.get("/api/signup/create",e).then(function(t){return t.data})},s.prototype.getInvite=function(t){var e=i.__assign({},this.requestConfig,{params:{token:t}});return this.$http.get("/api/signup/invite",e).then(function(t){return t.data}).then(function(t){return new n.InviteInfo(t)})},s.prototype.acceptInvite=function(t,e,i,n){var o={acceptLegalDocumentSet:n,token:t,password:e,fullName:i};return this.$http.post("/api/signup/invite",o,this.requestConfig).then(function(){return!0})},s.prototype.joinOrganization=function(t){var e={token:t};return this.$http.post("/api/signup/join",e).then(function(){return!0})},s);function s(t){this.$http=t,this.requestConfig={authenticationRequired:!1}}e.SignupService=o}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(7)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$http"],o.prototype.signup=function(t,e){var i={code:t,email:e};return this.$http.post("/api/signup/business",i,this.requestConfig).then(function(){return!0})},o.prototype.create=function(t){return this.$http.post("/api/signup/business/create",t,this.requestConfig).then(function(){return!0})},o.prototype.validate=function(t){var e=i.__assign({},this.requestConfig,{params:{token:t}});return this.$http.get("/api/signup/business/create",e).then(function(t){return t.data})},o);function o(t){this.$http=t,this.requestConfig={authenticationRequired:!1}}e.BusinessSignupService=n}.apply(e,n))||(t.exports=o)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.prototype.findLegalDocumentSet=function(t,e,i,n){var o;if(0===t.length)throw Error("No documents!!");var s=t.filter(function(t){return t.language===i&&t.accountType===e&&t.invitee===n});if(0<s.length)return s.pop();var r=((o={}).en="nl",o.de="nl",o.nl="en",o);if(void 0!==r[i])return this.findLegalDocumentSet(t,e,r[i],n);throw Error("Could not find legal document set :-(")},n);function n(){}e.LegalDocumentsService=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.$inject=["$q","$http"],n.prototype.link=function(t){var e={token:t};return this.$http.post("/api/sso/topicus/link",e).then(function(){return!0})},n);function n(t,e){this.$q=t,this.$http=e}e.SsoService=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(15),i(5)],void 0===(o=function(t,e,n,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(o.$inject=["$rootScope","$log","$q","$http","$translate"],o.prototype.listSpecials=function(t){var e=this;return void 0===t&&(t=!0),void 0!==this.listSpecialsCache&&t||(this.listSpecialsCache=this.$http.get("/api/specials").then(function(t){return t.data}).then(function(t){return t.specials.map(function(t){return new n.Special(t)})}).catch(function(t){return e.$log.warn("error getting user specials",{error:t}),[]})),this.listSpecialsCache},o.prototype.getSpecial=function(t){var e=this;return this.$http.get("/api/specials/"+t).then(function(t){return t.data}).then(function(t){return e.translateSpecial(new n.Special(t))})},o.prototype.getConversationFlow=function(t){var i=this,e={conversation_uuid:t};return this.$http.get("/api/specials/flow",{params:e}).then(function(t){return t.data}).then(function(t){var e=new n.ConversationFlow(t);return e.responses.forEach(function(t){t.formDefinition=i.translateFormDefinition(t.formDefinition)}),e})},o.prototype.getMessageDefinition=function(t){var i=this;return this.$http.get("/api/specials/message_definitions/"+t).then(function(t){return t.data}).then(function(t){var e=new n.MessageDefinition(t);return e.formDefinition=i.translateFormDefinition(e.formDefinition),e})},o.prototype.listOrganizationSpecials=function(){return this.$http.get("/api/specials/organization").then(function(t){return t.data}).then(function(t){return t.items.map(function(t){return new n.OrganizationSpecial(t)})})},o.prototype.listOrganizationSpecialUsers=function(t){return this.$http.get("/api/specials/organization/"+t+"/users").then(function(t){return t.data}).then(function(t){return t.users.map(function(t){return new n.SpecialUser(t)})})},o.prototype.inviteOrganisationUser=function(t,e){return this.$http.post("/api/specials/organization/"+t+"/users",e).then(function(){return!0})},o.prototype.updateOrganisationUser=function(t,e,i){return this.$http.put("/api/specials/organization/"+t+"/users/"+e,i).then(function(){return!0})},o.prototype.deleteOrgSpecialUser=function(t,e){return this.$http.delete("/api/specials/organization/"+t+"/users/"+e).then(function(){return!0})},o.prototype.getSpecialUserData=function(t,e){return this.$http.get("/api/specials/organization/"+t+"/users/"+e+"/user_information").then(function(t){return t.data})},o.prototype.updateSpecialUserData=function(t,e,i){return this.$http.put("/api/specials/organization/"+t+"/users/"+e+"/user_information",i).then(function(){return!0})},o.prototype.translateSpecial=function(t){var e=this;return t.flowInitiations.forEach(function(t){t.messageDefinition.formDefinition=e.translateFormDefinition(t.messageDefinition.formDefinition)}),t},o.prototype.translateFormDefinition=function(t){var e=this;return t.titleTranslated=this.getTranslated(t.title),t.sections.forEach(function(t){t.titleTranslated=e.getTranslated(t.title),t.components.forEach(function(t){t.labelTranslated=e.getTranslated(t.label),t.textTranslated=e.getTranslated(t.text),t.choices.forEach(function(t){t.labelTranslated=e.getTranslated(t.label)})})}),t},o.prototype.getResumedFormDefinition=function(t,i){return t.sections.forEach(function(t){t.components.forEach(function(t){if(void 0!==t.key&&void 0===i.data[t.key]);else if(void 0!==t.key){var e=i.data[t.key];e instanceof Array?t.answerArray=e.map(function(t){return new n.FormChoice({value:t})}):t.answer=t.setAnswer(e)}})}),t},o.prototype.preOpenSections=function(t,o){var s=0;return t.sections.forEach(function(t,e){var i=t.components.filter(function(t){return!1===t.isStatic()}).filter(function(t){return!0===t.required}).filter(function(t){return!1===t.enablesOtherComponent()}).length,n=0;t.components.forEach(function(t){void 0!==t.key&&void 0!==o.data[t.key]&&!0===t.required&&!1===t.enablesOtherComponent()&&n++}),0!==n&&i===n&&e===s+1&&(t.setOpened(!0),s=e)}),t},o.prototype.getTranslated=function(t){var e=this.$translate.use();if(void 0!==t)return void 0!==t[e]?t[e]:t.nl},o);function o(t,e,i,n,o){var s=this;this.$rootScope=t,this.$log=e,this.$q=i,this.$http=n,this.$translate=o,t.$on(r.AuthEvents.logoutSuccess,function(){s.listSpecialsCache=void 0})}e.SpecialsService=i}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(147)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.prototype.getComponentByKey=function(e){var i=void 0;return this.sections.some(function(t){if(t.hasComponentByKey(e))return i=t.getComponentByKey(e),!0}),i},o);function o(t){this.title=t.title,this.sections=t.sections.map(function(t){return new i.FormSection(t)}),this.subjectTemplate=t.subjectTemplate}e.FormDefinition=n}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(148)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.prototype.hasComponentByKey=function(e){var t=this.components.filter(function(t){return t.key===e});return 0!==t.length&&(1===t.length||void 0)},o.prototype.getComponentByKey=function(e){var t=this.components.filter(function(t){return t.key===e});if(0===t.length)throw Error("Component '"+e+" not found");if(1<t.length)throw Error("Multiple components with key '"+e+" found");return t[0]},o.prototype.toSaveEntity=function(){var i={};return this.components.filter(function(t){return!1===t.isStatic()}).forEach(function(t){var e=t.getAnswer();null!==e&&("integer"===t.dataType?i[t.key]=Number(e):i[t.key]=e)}),i},o.prototype.setOpened=function(t){return this.isOpened=t,this},o.prototype.setCompleted=function(t){return this.isCompleted=t,this},o.prototype.setDisabled=function(t){return this.isDisabled=t,this},o.prototype.setFocusedComponent=function(e){var t=this.components.filter(function(t){return t.key===e});t&&t.length&&(t[0].focused=!0,this.focusedComponent=e)},o.prototype.getFirstComponent=function(){return this.components[0].key},o);function o(t,e){this.components=[],this.isOpened=!1,this.isCompleted=!1,this.isDisabled=!1,this.title=t.title,this.components=t.components.map(function(t){return new i.FormComponent(t)})}e.FormSection=n}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(149)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.prototype.getAnswer=function(){return void 0!==this.answer?this.answer.value:void 0!==this.answerArray?this.answerArray.map(function(t){return t.value}):null},o.prototype.setAnswer=function(e){var t=this.choices.filter(function(t){if(t.value===e)return t});return 1===t.length?t[0]:new i.FormChoice({value:e})},o.prototype.enablesOtherComponent=function(){var t=this.choices.filter(function(t){return void 0!==t.enables&&""!==t.enables});return t&&1===t.length},o.prototype.isStatic=function(){return"static"===this.componentType.toString().substr(0,6)},o);function o(t){this.focused=!1,this.showError=!1,this.visible=!0,this.autocomplete=t.autocomplete,this.choices=(t.choices||[]).map(function(t){return new i.FormChoice(t)}),this.componentType=t.componentType,this.dataType=t.dataType,this.defaultValue=t.defaultValue,this.imgUrl=t.imgUrl,this.key=t.key,this.label=t.label,this.maxItems=t.maxItems,this.minItems=t.minItems,this.text=t.text,this.renderType=t.renderType,this.required=t.required,this.linkedComponents=t.linkedComponents,this.pattern=t.pattern,this.patternReferences=t.patternReferences,this.patternReplacementFileName=t.patternReplacementFileName}e.FormComponent=n}.apply(e,n))||(t.exports=o)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FormChoice=function(t){this.enables=t.enables,this.label=t.label,this.svg=t.svg,this.value=t.value,this.unselectable=t.unselectable,this.default=t.default,this.subject=t.subject}}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(57)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FlowInitiation=function(t){this.allowAnyRecipient=t.allowAnyRecipient,this.allowedRecipients=t.allowedRecipients,this.fixedRecipients=t.fixedRecipients,this.messageDefinition=new i.MessageDefinition(t.messageDefinition)}}.apply(e,n))||(t.exports=o)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.$inject=["$log","$http"],n.prototype.getTimeSeries=function(t,e){return this.$http.get("/api/stats/usage/time_series",{params:{dataSetTS:t,timeScale:e}}).then(function(t){return t.data})},n.prototype.getStackedArea=function(t,e){var i=this;return this.$http.get("/api/stats/usage/time_series",{params:{dataSetTS:t,timeScale:e}}).then(function(t){return t.data}).then(function(t){return i.convertToStackedArea(t)})},n.prototype.getPercentages=function(t,e){return this.$http.get("/api/stats/usage/percentages",{params:{dataSetP:t,timeScale:e}}).then(function(t){return t.data}).then(function(t){var e=[];return t.data.forEach(function(i){var t=Object.keys(i).filter(function(t){return"percentage"!==t}).reduce(function(t,e){return t[e]=i[e],t},{});e.push(t)}),t.data=e,t})},n.prototype.getStatsAccount=function(t){return this.$http.get("/api/stats/usage/accounts",{params:{timeScale:t}}).then(function(t){return t.data})},n.prototype.convertToStackedArea=function(t){var i={data:[]};return t.dataByTopic.forEach(function(t){var e=t.topicName;t.dates.forEach(function(t){t.name=e,i.data.push(t)})}),i},n);function n(t,e){this.$log=t,this.$http=e}e.StatisticsService=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u="pseudoStorage.local",p="pseudoStorage.session",i=(n.$inject=["$window","$cookies","$injector","$timeout"],n.prototype.setItem=function(t,e,i,n){void 0===n&&(n=!0),this.getStorage(t).setItem(e,n?JSON.stringify(i):i)},n.prototype.getItem=function(e,i,t){void 0===t&&(t=!0);var n=this.getStorage(e).getItem(i);if(null===n)return null;if(!1===t)return n;try{return JSON.parse(n)}catch(t){this.warn("Error parsing JSON from storage",{error:t,storage:e,key:i}),this.removeItem(e,i)}},n.prototype.removeItem=function(t,e){this.getStorage(t).removeItem(e)},n.prototype.keys=function(t){return Object.keys(this.getStorage(t))},n.prototype.getStorage=function(t){switch(t){case"LOCAL":return this.localStorage;case"SESSION":return this.sessionStorage}},n.prototype.canWrite=function(){try{var t="test_"+ +new Date;return this.localStorage.setItem(t,t),this.localStorage.removeItem(t),this.sessionStorage.setItem(t,t),this.sessionStorage.removeItem(t),!0}catch(t){return this.warn("Error writing localstorage or sessionstorage",{error:t}),!1}},n.prototype.warn=function(t,e){var i=this;this.$timeout(function(){i.$injector.get("$log").warn(t,e)},1e3)},n);function n(t,e,i,n){var o=this;this.$window=t,this.$cookies=e,this.$injector=i,this.$timeout=n;var s=!0;try{this.sessionStorage=this.$window.sessionStorage,this.localStorage=this.$window.localStorage}catch(t){this.warn("Error accessing localstorage or sessionstorage",{error:t}),s=!1}if(null!==this.localStorage&&null!==this.sessionStorage||(this.warn("LocalStorage and/or sessionStorage is null"),s=!1),!1===s||!1===this.canWrite()){var r=this.$cookies.getObject(u)||{},a=this.$cookies.getObject(p)||{};this.$cookies.remove(u),this.$cookies.remove(p);var c=this.localStorage=new d(r),l=this.sessionStorage=new d(a);this.$window.addEventListener("unload",function(){o.$cookies.putObject(u,c.getItems()),o.$cookies.putObject(p,l.getItems())})}}e.StorageService=i;var d=(o.prototype.clear=function(){this.items={}},o.prototype.getItem=function(t){return void 0===this.items[t]?null:this.items[t]},o.prototype.key=function(t){var e=Object.keys(this.items);return void 0===e[t]?null:e[t]},Object.defineProperty(o.prototype,"length",{get:function(){return Object.keys(this.items).length},enumerable:!0,configurable:!0}),o.prototype.removeItem=function(t){delete this.items[t]},o.prototype.setItem=function(t,e){this.items[t]=e},o.prototype.getItems=function(){return this.items},o);function o(t){this.items={},this.items=t}}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(6)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$http"],o.prototype.getSurvey=function(t,e){return this.$http.get("/api/survey/"+t+"/"+e).then(function(t){return t.status!==i.HTTP_NO_CONTENT}).catch(function(){return!1})},o.prototype.removeSurvey=function(t,e){return this.$http.delete("/api/survey/"+t+"/"+e).then(function(){return!0})},o);function o(t){this.$http=t}e.SurveyService=n}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(7)],void 0===(o=function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.prototype.loadTheme=function(t,e){var i=this.createColorPalette(t.primaryColor),n=this.createColorPalette(t.accentColor);t.wallpaperUrl||(t.backgroundColor=n[500]);var o,s="\n\tbody.theme-custom.landing, body.theme-custom.auth {\n\t\tbackground-color: "+(o=r.__assign({},t,{accentPalette:n,primaryPalette:i})).backgroundColor+" !important;\n\t}\n\n\tbody.theme-custom.landing, body.theme-custom.auth {\n\t\tbackground-size: cover !important;\n\t\tbackground: url("+o.wallpaperUrl+") no-repeat center center;\n\t}\n\n\tbody.theme-custom #zivver-main aside {\n\t\tbackground-color: "+o.accentPalette[500]+" !important;\n\t}\n\n\tbody.theme-custom #zivver-main right-pane .rightpane-inner md-toolbar {\n\t\tbackground-color: "+o.accentPalette[600]+" !important;\n\t}\n\n\tbody.theme-custom #zivver-main md-content.conversations-list div.messageType .icons md-icon.new,\n\tbody.theme-custom #zivver-main md-content.drafts-list div.messageType .icons md-icon.new {\n\t\tcolor: "+o.primaryPalette[500]+" !important;\n\t}\n\n\tbody.theme-custom #zivver-main md-content.conversations-list .div-list .div-list-item.active,\n\tbody.theme-custom #zivver-main md-content.drafts-list .div-list .div-list-item.active {\n\t\tbackground-color: "+o.primaryPalette[500]+" !important;\n\t}\n\n\tbody.theme-custom #zivver-main conversation-message md-card md-card-header md-card-header-text span.sender a {\n\t\tcolor: "+o.primaryPalette[400]+" !important;\n\t}\n\n\tbody.theme-custom #zivver-main conversation-message md-card.selected {\n\t\tborder-color: "+o.primaryPalette[500]+" !important;\n\t}\n\n\tbody.theme-custom #zivver-main .draft-text.ql-editor:focus-within {\n\t\tborder-color: "+o.primaryPalette[500]+" !important;\n\t}\n\n\tbody.theme-custom #zivver-main .draft-text.ql-editor.ng-dirty {\n\t\tborder-color: "+o.primaryPalette[500]+" !important;\n\t}\n\n\tbody.theme-custom #zivver-main .draft-text.rich-editor:focus-within {\n\t\tborder-color: "+o.primaryPalette[500]+" !important;\n\t}\n\n\tbody.theme-custom #zivver-main a:link:not(.ces-button), body-theme-custom #zivver-main a:visited {\n\t\tcolor: "+o.primaryPalette[400]+" !important;\n\t}\n\n\tbody.theme-custom #zivver-main .recipients img, body-theme-custom #zivver-main .md-user-avatar {\n\t\tbackground-color: "+o.primaryPalette[400]+" !important;\n\t}\n\n\tbody.theme-custom md-toolbar:not(.md-menu-toolbar) {\n\t\tbackground-color: "+o.primaryPalette[400]+";\n\t}\n\n\n\tbody.theme-custom .md-user-avatar {\n\t\tbackground-color: "+o.primaryPalette[400]+" !important;\n\t}\n\n\tbody.theme-custom .md-raised.md-primary.md-button {\n\t\tbackground-color: "+o.primaryPalette[500]+" !important;\n\t}\n\tbody.theme-custom .md-button.wrong-number-guest {\n\t\tcolor: "+o.primaryPalette[500]+" !important;\n\t}\n\n\tbody.theme-custom .md-raised.md-primary.md-button[disabled] {\n\t\tbackground-color: rgba(0,0,0,.12) !important;\n\t}\n\n\tbody.theme-custom md-input-container:not(.md-input-invalid).md-input-focused .md-input {\n\t\tborder-color: "+o.primaryPalette[500]+" !important;\n\t}\n\n\tbody.theme-custom md-input-container:not(.md-input-invalid).md-input-focused label {\n\t\tcolor: "+o.primaryPalette[500]+' !important;\n\t}\n\n\tbody.theme-custom header.app h1 a {\n\t\tbackground: transparent url("'+o.logoUrl+"\") center center no-repeat;\n\t\tbackground-size: contain;\n\t\twidth: 144px;\n\t\theight: 60px;\n\t}\n\n\tbody.theme-custom language-select.open-guest md-icon {\n\t\tcolor: 'white';\n\t\tcolor: "+o.languageColor+" !important;\n\t}\n\n\tbody.theme-custom language-select.open-guest md-select .md-select-value {\n\t\tcolor: 'white';\n\t\tcolor: "+o.languageColor+" !important;\n\t}\n";this.addStyleString(s),e&&window.sessionStorage.setItem("application.theme",JSON.stringify(t))},n.prototype.addStyleString=function(t){var e=document.createElement("style");e.innerHTML=t,document.body.appendChild(e),document.body.classList.add("theme-custom")},n.prototype.multiplyColors=function(t,e){var i=Math.floor(t.b*e.b/255),n=Math.floor(t.g*e.g/255);return{r:Math.floor(t.r*e.r/255),g:n,b:i}},n.prototype.hexToRgb=function(t){return{r:this.hexToR(t),g:this.hexToG(t),b:this.hexToB(t)}},n.prototype.hexToR=function(t){return parseInt(this.cutHex(t).substring(0,2),16)},n.prototype.hexToG=function(t){return parseInt(this.cutHex(t).substring(2,4),16)},n.prototype.hexToB=function(t){return parseInt(this.cutHex(t).substring(4,6),16)},n.prototype.cutHex=function(t){var e=""+t;return"#"===e.charAt(0)?e.substring(1,7):"#"===e.charAt(0)?e.substring(1,7):e},n.prototype.rgbToHex=function(t){return"#"+this.toHex(t.r)+this.toHex(t.g)+this.toHex(t.b)},n.prototype.toHex=function(t){var e=parseInt(t,10);return isNaN(e)?"00":(e=Math.max(0,Math.min(e,255)),""+"0123456789abcdef".charAt((e-e%16)/16)+"0123456789abcdef".charAt(e%16))},n.prototype.mix=function(t,e,i){i=0===i?0:i||50;var n=this.hexToRgb(t),o=this.hexToRgb(e),s=i/100;return{r:Math.round((o.r-n.r)*s+n.r),g:Math.round((o.g-n.g)*s+n.g),b:Math.round((o.b-n.b)*s+n.b)}},n.prototype.createColorPalette=function(t){var e=void 0===t?"#00A9E0":t,i="#ffffff",n=this.multiplyColors(this.hexToRgb(e),this.hexToRgb(e)),o=this.rgbToHex(n);return{50:this.rgbToHex(this.mix(i,e,12)),100:this.rgbToHex(this.mix(i,e,30)),200:this.rgbToHex(this.mix(i,e,50)),300:this.rgbToHex(this.mix(i,e,70)),400:this.rgbToHex(this.mix(i,e,85)),500:this.rgbToHex(this.mix(i,e,100)),600:this.rgbToHex(this.mix(o,e,87)),700:this.rgbToHex(this.mix(o,e,70)),800:this.rgbToHex(this.mix(o,e,54)),900:this.rgbToHex(this.mix(o,e,25))}},n);function n(){}e.ThemeService=i}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(76),i(376)],void 0===(o=function(t,e,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(s.$inject=["$mdDialog","$q","$log","$mdMedia","DeviceService","SettingsService"],s.prototype.openWizard=function(t,e){var i=this;if(void 0!==this.shownDialogPromise)return this.shownDialogPromise;if(!1===this.validWizardName(t))throw Error('Undfined wizard "'+t+'"');return this.shownDialogPromise=this.$mdDialog.show(o.WizardDialog.factory(t,e)).finally(function(){i.shownDialogPromise=void 0}),this.shownDialogPromise},s.prototype.showWizardOnce=function(e){var i=this;this.hasNotSeen(e).then(function(t){i.DeviceService.isDesktop()&&i.$mdMedia("gt-xs")&&i.openWizard(e,{}).finally(function(){return i.wizardIsSeen(t,!0)})})},s.prototype.getWizardSettingsKey=function(t){return"webapp."+t.replace("-",".")},s.prototype.close=function(){void 0!==this.shownDialogPromise&&this.$mdDialog.cancel("wizard cancelled by wizard service")},s.prototype.hasNotSeen=function(t){var e=this,i=this.getWizardSettingsKey(t);return this.SettingsService.getSetting("USER",i,!1).then(function(t){return t.enabled?e.$q.reject():e.$q.resolve(i)})},s.prototype.wizardIsSeen=function(t,e){var i=new n.Setting("USER",{keyName:t,valueData:e});return this.SettingsService.updateSettings("USER",[i])},s.prototype.validWizardName=function(t){var e=this;return-1<Object.keys(this.WIZARDS).map(function(t){return e.WIZARDS[t]}).indexOf(t)},s.prototype.createDefaultController=function(){function e(){return t.$q.resolve(void 0)}var t=this,i={steps:1,selectedStep:0,nextEnabled:!0,completeEnabled:!0,swipeEnabled:!0,showCancel:!0,showComplete:!0,showNext:!0,showPrevious:!0,showDots:!0,showClose:!0,translations:{cancel:"MAIN.CANCEL",previous:"MAIN.BACK",next:"MAIN.NEXT",complete:"MAIN.OK"},backDelegate:e,cancelDelegate:e,closeDelegate:e,completeDelegate:e,nextDelegate:e,skipDelegate:e,dotsClickedDelegate:function(t){return!0!==i.disallowDotsClick&&(i.selectedStep=t),i.dotsClicked(),e()},restart:function(){},dotsClicked:function(){},onBack:function(){i.backDelegate()},onCancel:function(){i.cancelDelegate()},onClose:function(){i.closeDelegate()},onComplete:function(){i.completeDelegate()},onNext:function(){i.nextDelegate()},onSkip:function(){i.skipDelegate()}};return i},s);function s(t,e,i,n,o,s){this.$mdDialog=t,this.$q=e,this.$log=i,this.$mdMedia=n,this.DeviceService=o,this.SettingsService=s,this.WIZARDS={VERIFICATION:"wizard-verification",BUSINESSRULES:"wizard-businessrules",MFA:"wizard-mfa"}}e.WizardService=i}.apply(e,n))||(t.exports=o)},function(t,e,r){var i,n;i=[r,e,r(1),r(377)],void 0===(n=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n="wizard-verification",o=(s.$inject=["$log","$translate","$q"],s.prototype.$onInit=function(){this.flow={"static-tab-1":{index:0,next:"static-tab-2"},"static-tab-2":{index:1,previous:"static-tab-1",next:"static-tab-3"},"static-tab-3":{index:2,previous:"static-tab-2",next:"static-tab-4"},"static-tab-4":{index:3,previous:"static-tab-3",next:"static-tab-5"},"static-tab-5":{index:4,previous:"static-tab-4"}};var t=this.wizardController;this.translateControls(t),this.setupFlow(),t.disallowDotsClick=!1,t.nextEnabled=!0},s.prototype.getTabIndex=function(t){var e=-1;for(var i in this.flow)i===t&&(e=this.flow[i].index);return e},s.prototype.setTab=function(t,e){return this.wizardController.selectedStep=this.getTabIndex(t),this.currentTabLabel=t,this.setControl(t,e)},s.prototype.setControl=function(t,i){var n=this;this.currentControl={completeEnabled:function(){},cancel:function(){return n.$q.resolve()},back:function(){return n.$q.resolve()},next:function(){return n.$q.resolve()},complete:function(){return n.$q.resolve()},skip:function(){return n.$q.resolve()},fail:function(t){n.$log.error(" Ͱ wizard-verification fail called. error: ",t)}};var o=this.wizardController;o.cancelDelegate=function(){return n.currentControl.cancel()},o.backDelegate=function(){return n.currentControl.back().then(function(){n.setTab(i[t].previous,i)})},o.nextDelegate=function(){return n.currentControl.next().then(function(){n.setTab(i[t].next,i)})},o.completeDelegate=function(){return n.currentControl.complete()},o.onSkip=function(){return n.currentControl.skip().then(function(){n.setTab(i[t].skip,i)})},o.dotsClickedDelegate=function(t){for(var e in n.flow)if(n.flow[e].index===t){n.setTab(e,i);break}return o.dotsClicked(),n.$q.resolve(void 0)}},s.prototype.defineFlow=function(t){return this.wizardController.steps=Object.keys(t).length,t},s.prototype.setupFlow=function(){var t=this.defineFlow(this.flow);this.setTab("static-tab-1",t)},s.prototype.translateControls=function(t){var e={cancel:n+".CANCEL",complete:n+".COMPLETE",previous:n+".PREVIOUS",next:n+".NEXT"};for(var i in e)t.translations[i]=this.$translate.instant(e[i])},s);function s(t,e,i){this.$log=t,this.$translate=e,this.$q=i,this.currentTabLabel=""}e.WizardVerification=o,e.WizardVerificationModule=i.module("components.wizardVerification",[]).component("wizardVerification",{bindings:{params:"<",wizardController:"="},controller:o,templateUrl:r(378)})}.apply(e,i))||(t.exports=n)},function(t,e,r){var i,n;i=[r,e,r(1),r(379)],void 0===(n=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$log","$translate","$q"],o.prototype.$onInit=function(){this.flow={"static-tab-1":{index:0,next:"static-tab-2"},"static-tab-2":{index:1,previous:"static-tab-1",next:"static-tab-3"},"static-tab-3":{index:2,previous:"static-tab-2",next:"static-tab-4"},"static-tab-4":{index:3,previous:"static-tab-3"}};var t=this.wizardController;this.translateControls(t),this.setupFlow(),t.disallowDotsClick=!1,t.nextEnabled=!0},o.prototype.getTabIndex=function(t){var e=-1;for(var i in this.flow)i===t&&(e=this.flow[i].index);return e},o.prototype.setTab=function(t,e){return this.wizardController.selectedStep=this.getTabIndex(t),this.currentTabLabel=t,this.setControl(t,e)},o.prototype.setControl=function(t,i){var n=this;this.currentControl={completeEnabled:function(){},cancel:function(){return n.$q.resolve()},back:function(){return n.$q.resolve()},next:function(){return n.$q.resolve()},complete:function(){return n.$q.resolve()},skip:function(){return n.$q.resolve()},fail:function(t){n.$log.error(" Ͱ wizard-businessrules fail called. error: ",t)}};var o=this.wizardController;o.cancelDelegate=function(){return n.currentControl.cancel()},o.backDelegate=function(){return n.currentControl.back().then(function(){n.setTab(i[t].previous,i)})},o.nextDelegate=function(){return n.currentControl.next().then(function(){n.setTab(i[t].next,i)})},o.completeDelegate=function(){return n.currentControl.complete()},o.onSkip=function(){return n.currentControl.skip().then(function(){n.setTab(i[t].skip,i)})},o.dotsClickedDelegate=function(t){for(var e in n.flow)if(n.flow[e].index===t){n.setTab(e,i);break}return o.dotsClicked(),n.$q.resolve(void 0)}},o.prototype.defineFlow=function(t){return this.wizardController.steps=Object.keys(t).length,t},o.prototype.setupFlow=function(){var t=this.defineFlow(this.flow);this.setTab("static-tab-1",t)},o.prototype.translateControls=function(t){var e={cancel:s+".CANCEL",complete:s+".COMPLETE",previous:s+".PREVIOUS",next:s+".NEXT"};for(var i in e)t.translations[i]=this.$translate.instant(e[i])},o);function o(t,e,i){this.$log=t,this.$translate=e,this.$q=i,this.currentTabLabel=""}e.WizardBusinessRules=n;var s="wizard-businessrules";e.WizardBusinessRulesModule=i.module("components.wizardBusinessRules",[]).component("wizardBusinessRules",{bindings:{params:"<",wizardController:"="},controller:n,templateUrl:r(380)})}.apply(e,i))||(t.exports=n)},function(t,e,p){var i,n;i=[p,e,p(1),p(381),p(384),p(386),p(389),p(391),p(394)],void 0===(n=function(t,e,i,n,o,s,r,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c="wizard-mfa",l=(u.$inject=["$log","$mdDialog","$q","$timeout","$translate","MultifactorService"],u.prototype.$onInit=function(){var e=this,t=this.wizardController;this.translateControls(t),t.showDots=!1,t.showCancel=!1,t.swipeEnabled=!1,t.disallowDotsClick=!1,t.showClose=!!this.params&&this.params.allowClose,t.nextEnabled=!0,this.setupFlow(),this.MultifactorService.getFactors().then(function(t){e.hasTotpFactor=0<t.filter(function(t){return t.isTotp()}).length,e.hasSmsFactor=0<t.filter(function(t){return t.isSms()}).length})},u.prototype.onChangeMfaChoice=function(){this.flow[this.currentTabLabel].next=this.mfaChoice,this.wizardController.nextEnabled=!0},u.prototype.getTabIndex=function(t){var e=-1;for(var i in this.flow)i===t&&(e=this.flow[i].index);return e},u.prototype.setTab=function(t,e){return this.wizardController.selectedStep=this.getTabIndex(t),this.currentTabLabel=t,this.$timeout(function(){var t=document.querySelectorAll("input")[0];null!=t&&t.focus()},500),this.setControl(t,e)},u.prototype.setControl=function(e,i){var n=this,t=this.wizardController;this.currentControl={completeEnabled:function(){},cancel:function(){return n.$q.resolve()},back:function(){return n.$q.resolve()},next:function(){return n.$q.resolve()},complete:function(){return n.$q.resolve()},skip:function(){return n.$q.resolve()},fail:function(t){n.$log.error(" Ͱ wizard-mfa fail called. error: ",t)}},t.cancelDelegate=function(){return n.currentControl.cancel()},t.backDelegate=function(){return n.currentControl.back().then(function(){n.setTab(i[e].previous,i),n.updateControls()})},t.nextDelegate=function(){return n.currentControl.next().then(function(t){n.configureNextTab(i,e,t),void 0!==i[e].next&&n.setTab(i[e].next,i),n.updateControls()})},t.completeDelegate=function(){return n.currentControl.complete().then(function(){return n.mfToReturn})},t.skipDelegate=function(){return n.currentControl.skip().then(function(){n.setTab(i[e].skip,i),n.updateControls()})}},u.prototype.configureNextTab=function(t,e,i){switch(e){case this.MFA_CHOICE:t[e].next=this.mfaChoice;break;case this.MFA_SMS_SETUP:case this.MFA_AUTHENTICATOR_SMS_BACKUP_SETUP:this.mfaSmsFactorId=i.factorId,this.phoneNumber=i.phoneNumber;break;case this.MFA_AUTHENTICATOR_SETUP:!0===this.hasTotpFactor&&(t[e].next=this.MFA_COMPLETE),this.totpSetup=i;break;case this.MFA_SMS_VALIDATE:case this.MFA_AUTHENTICATOR_SMS_BACKUP_VALIDATE:this.mfToReturn=i;break;case this.MFA_AUTHENTICATOR_VALIDATE:this.mfToReturn=i,!0===this.hasSmsFactor&&(t[e].next=this.MFA_COMPLETE)}},u.prototype.updateControls=function(){var t=this.wizardController;t.showPrevious=void 0!==this.flow[this.currentTabLabel].previous,t.showNext=void 0!==this.flow[this.currentTabLabel].next,this.currentTabLabel!==this.MFA_INTRO&&this.currentTabLabel!==this.MFA_CHOICE&&this.currentTabLabel!==this.MFA_COMPLETE||(t.showNext=!0,t.nextEnabled=!0)},u.prototype.setupFlow=function(){return this.wizardController.steps=Object.keys(this.flow).length,this.setTab(this.MFA_INTRO,this.flow)},u.prototype.translateControls=function(t){var e={cancel:c+".CANCEL",close:c+".CLOSE",complete:c+".COMPLETE",next:c+".NEXT",previous:c+".PREVIOUS",skip:c+".SKIP"};for(var i in e)t.translations[i]=this.$translate.instant(e[i])},u);function u(t,e,i,n,o,s){this.$log=t,this.$mdDialog=e,this.$q=i,this.$timeout=n,this.$translate=o,this.MultifactorService=s,this.MFA_INTRO="mfa-intro",this.MFA_CHOICE="mfa-choice",this.MFA_SMS_SETUP="mfa-sms-setup",this.MFA_SMS_VALIDATE="mfa-sms-validate",this.MFA_AUTHENTICATOR_SETUP="mfa-authenticator-setup",this.MFA_AUTHENTICATOR_VALIDATE="mfa-authenticator-validate",this.MFA_AUTHENTICATOR_SMS_BACKUP_SETUP="mfa-authenticator-sms-setup",this.MFA_AUTHENTICATOR_SMS_BACKUP_VALIDATE="mfa-authenticator-sms-validate",this.MFA_COMPLETE="mfa-complete",this.currentTabLabel="",this.mfaChoice=this.MFA_AUTHENTICATOR_SETUP,this.deskProAuthenticatorLink="https://support.zivver.com/"+this.$translate.use()+"/kb/articles/wat-is-een-authenticator-app",this.flow={},this.flow[this.MFA_INTRO]={index:0,next:this.MFA_CHOICE},this.flow[this.MFA_CHOICE]={index:1,previous:this.MFA_INTRO},this.flow[this.MFA_SMS_SETUP]={index:2,previous:this.MFA_CHOICE,next:this.MFA_SMS_VALIDATE},this.flow[this.MFA_SMS_VALIDATE]={index:3,previous:this.MFA_SMS_SETUP,next:this.MFA_COMPLETE},this.flow[this.MFA_AUTHENTICATOR_SETUP]={index:4,previous:this.MFA_CHOICE,next:this.MFA_AUTHENTICATOR_VALIDATE},this.flow[this.MFA_AUTHENTICATOR_VALIDATE]={index:5,previous:this.MFA_AUTHENTICATOR_SETUP,next:this.MFA_AUTHENTICATOR_SMS_BACKUP_SETUP},this.flow[this.MFA_AUTHENTICATOR_SMS_BACKUP_SETUP]={index:6,next:this.MFA_AUTHENTICATOR_SMS_BACKUP_VALIDATE,skip:this.MFA_COMPLETE},this.flow[this.MFA_AUTHENTICATOR_SMS_BACKUP_VALIDATE]={index:7,previous:this.MFA_AUTHENTICATOR_SMS_BACKUP_SETUP,next:this.MFA_COMPLETE},this.flow[this.MFA_COMPLETE]={index:8}}e.WizardMfa=l,e.WizardMfaModule=i.module("components.wizardMfa",[n.MfaTotpSetupModule.name,o.MfaTotpValidateModule.name,s.MfaSmsSetupModule.name,r.MfaSmsValidateModule.name,a.MfaBackupCodesModule.name]).component("wizardMfa",{bindings:{params:"<",wizardController:"="},controller:l,templateUrl:p(395)})}.apply(e,i))||(t.exports=n)},function(t,e,r){var i,n;i=[r,e,r(1),r(59),r(409)],void 0===(n=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(s.prototype.$onChanges=function(t){void 0!==t.showFiles&&!0===t.showFiles.currentValue&&(this.showFiles=0<this.files.length),void 0!==t.showRecipients&&!0===t.showRecipients.currentValue&&(this.showRecipients=0<this.violation.recipients.length)},s.prototype.getFileNames=function(){var e=[],i={};return this.files.forEach(function(t){return i[t.id]=t}),this.violation.files.forEach(function(t){void 0===i[t]?e.push("Unknown file "+t):e.push(i[t].name)}),e},s.prototype.getIcon=function(){switch(this.violation.violationLevel){case"error":return"error";case"warning":return"warning";case"suggestion":return"feedback";default:return"error"}},s);function s(){this.files=[],this.showFiles=!1,this.showRecipients=!1}e.DraftViolationItemModule=i.module("components.DraftViolationItem",[n.IfEmptyFilterModule.name]).component("draftViolationItem",{controller:o,bindings:{violation:"<",files:"<",showRecipients:"<",showFiles:"<"},templateUrl:r(410),transclude:!0})}.apply(e,i))||(t.exports=n)},function(t,e,h){var i,n;i=[h,e,h(1),h(9),h(37),h(418),h(421),h(14),h(6),h(40),h(422)],void 0===(n=function(t,e,i,s,n,o,r,l,a,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=new RegExp(n.EMAIL_REGEX,"i"),p=(d.$inject=["$element","$scope","$timeout","$q","$http","$log","$translate","ContactsService","DraftsRecipientsService"],d.prototype.$onInit=function(){var n=this;this.recipients.forEach(function(t){void 0!==t.accessRightSetup&&0!==t.verifications.length||n.getContact(t.email).then(function(t){return n.updateRecipient(t)})}),this.useFlowRecipients()&&this.flow.allowedAddRecipients.forEach(function(t){n.getContact(t).then(function(t){return n.allowedFlowRecipients.push(t.toRecipient())})}),this.$scope.$watch(function(){return n.recipients},function(t,e){if(!1!==n.recipientsChanged(t,e)){n.validation=n.validation.removeViolationByBusinessRuleId(s.ClientViolationTypes.RecipientsInvalid),n.recipients=n.checkEmailAddresses(t);var i=n.recipients.filter(function(t){return!1===t.emailIsValid});0<i.length&&n.addInvalidRecipientViolation(i)}},!0)},d.prototype.onBlur=function(){var e=this;this.$timeout(function(){var t=e.searchFor.toLowerCase();!1===u.test(t)||e.hasRecipient(t)||e.getContact(t).then(function(t){return e.addRecipient(t.toRecipient())}).then(function(){return e.searchFor=""})},180,!0)},d.prototype.onPaste=function(t){var o=this,e=(t.clipboardData||window.clipboardData).getData("Text");if(""!==e){t.preventDefault(),t.stopPropagation();var i=this.DraftsRecipientsService.extractRecipientsUsingRegex(e).reduce(function(t,e){var i=o.recipients.concat(o.hiddenRecipients,t[0]).map(function(t){return t.email}),n=e.emailIsValid?0:1;return-1<i.indexOf(e.email)&&(n=2),t[n].push(e),t},[[],[],[]]),n=i[0],s=i[1],r=i[2];0<r.length&&this.$log.info("Ignoring "+r.length+" duplicate email addresses after paste"),n.forEach(function(t){o.addRecipient(t),o.$timeout(function(){o.getContact(t.email).then(function(t){return o.updateRecipient(t)})},60,!0)}),this.addInvalidRecipients(s)}else this.$log.warn("DraftRecipients onPaste had no (plain text) contents? ",{event:t})},d.prototype.onAdd=function(t){var e=this;this.getContact(t.email).then(function(t){return e.updateRecipient(t)})},d.prototype.searchContacts=function(){var n=this,o=this.searchFor.toLowerCase();return this.$q(function(i){return""===o&&i([]),n.useFlowRecipients()?i(n.allowedFlowRecipients.filter(function(t){return!1===n.hasRecipient(t.email)})):n.contactsAutoComplete(o).then(function(t){if(-1===t.map(function(t){return t.email}).indexOf(o)&&!1===n.hasRecipient(o)){var e=new s.Recipient;e.email=o,i(t.concat([e]))}else i(t)})})},d.prototype.recipientsChanged=function(t,n){if(t===n)return!1;if(t.length!==n.length)return!0;var o=!1;return t.forEach(function(t,e){if(!o){var i=JSON.stringify(n[e].toRequestEntity());JSON.stringify(t.toRequestEntity())===i||(o=!0)}}),o},d.prototype.addInvalidRecipients=function(i){var n=this;i.forEach(function(t,e){n.contactsAutoComplete(t.email).then(function(t){1===t.length&&(i[e]=t[0])}),i[e].accessRightSetup=void 0,i[e].verifications=[],n.recipients.push(i[e])})},d.prototype.addInvalidRecipientViolation=function(t){this.validation=this.validation.addClientViolation(new s.Violation({businessRuleId:s.ClientViolationTypes.RecipientsInvalid,violationType:"toRecipients",violationLevel:"error",description:this.$translate.instant("DRAFTS.EDIT.VALIDATION.INVALID-RECIPIENTS"),recipients:t.map(function(t){return t.email}),showStopper:!0,id:0}))},d.prototype.contactsAutoComplete=function(t){var e=this,i={term:t,limit:15},n=this.recipients.concat(this.hiddenRecipients).map(function(t){return t.email}),o={params:i};return this.$http.get("/api/contacts/autocomplete",o).then(function(t){return t.data}).then(function(t){return t.items.filter(function(t){return-1===n.indexOf(t.email)})}).then(function(t){return t.map(function(t){var e=new s.Recipient;return e.email=t.email,e.fullName=void 0!==t.fullName&&""!==t.fullName?t.fullName:void 0,e.picture=t.picture,e})}).catch(function(t){return e.$log.warn("Error searching contacts",{error:t}),e.$q.resolve([])})},d.prototype.checkEmailAddresses=function(t){return t.map(function(t){return t.emailIsValid=!(void 0===t.email||!1===u.test(t.email)),t})},d.prototype.addRecipient=function(t){this.recipients=this.recipients.concat([t])},d.prototype.updateRecipient=function(t){var e=this.recipients.map(function(t){return t.email}).indexOf(t.email);if(-1!==e){var i=new s.Recipient(this.recipients[e]);i.verifications=t.verifications,void 0===i.fullName&&void 0!==t.fullName&&(i.fullName=t.fullName),void 0===i.accessRightSetup&&(i.accessRightSetup=t.toRecipient().accessRightSetup),void 0===i.picture&&(i.picture=t.picture),void 0===i.phonenumber&&(i.phonenumber=t.phonenumber),void 0===i.language&&(i.language=t.personal.language),this.recipients[e]=i}},d.prototype.getContact=function(i){var n=this;return this.ContactsService.get(i).catch(function(t){t.status!==a.HTTP_NOT_FOUND&&n.$log.warn("Unexpected error trying to get a contact",{error:t,email:i});var e=new c.Contact;return e.email=i,e})},d.prototype.hasRecipient=function(e){return 0<this.recipients.concat(this.hiddenRecipients).filter(function(t){return t.email===e}).length},d.prototype.useFlowRecipients=function(){return void 0!==this.flow&&!1===this.flow.allowAddAnyRecipient&&0<this.flow.allowedAddRecipients.length},d);function d(t,e,i,n,o,s,r,a,c){this.$element=t,this.$scope=e,this.$timeout=i,this.$q=n,this.$http=o,this.$log=s,this.$translate=r,this.ContactsService=a,this.DraftsRecipientsService=c,this.hiddenRecipients=[],this.recipients=[],this.searchFor="",this.unknownPerson=l.UNKNOWN_PERSON,this.allowedFlowRecipients=[]}e.DraftRecipientsModule=i.module("components.DraftRecipients",[r.RecipientAvatarDirectiveModule.name,o.RecipientChipModule.name]).component("draftRecipients",{controller:p,template:h(423),bindings:{autofocus:"<",recipients:"=",flow:"<",validation:"="}}).directive("mdBlur",["$timeout","$mdUtil",function(o,s){return{require:"^mdAutocomplete",restrict:"A",link:function(e,t,i,n){o(function(){var t=n.blur;n.blur=function(){e.$eval(i.mdBlur,{$mdAutocomplete:n}),s.nextTick(function(){t.call(n)})}})}}}])}.apply(e,i))||(t.exports=n)},function(t,e,a){var i,n;i=[a,e,a(1),a(6),a(431)],void 0===(n=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o="code.sent",s=(r.$inject=["$log","$timeout","$translate","$scope","$state","$window","AccessRightGrantService","ConversationsService","StorageService","MessengerService"],r.prototype.$onInit=function(){var e,i=this,t=this.StorageService.getItem("SESSION",o+"."+this.conversation.id)||void 0;this.zivverUrl="https://zivver.eu",this.notified=void 0!==this.notified&&this.notified,this.participants=this.conversation.participants.map(function(t){return t.fullNameOrEmail()}).join("; "),this.share.isGeneratedCodeAccessRight()?(e=266,this.challengeSent=!0,this.setFocus()):this.share.isPasswordAccessRight()?(e=267,this.inputType="password",this.challengeSent=!0,this.setFocus()):this.share.isSmsAccessRight()?(e=268,this.inputPattern="[0-9]*"):this.share.isEmailAccessRight()?(e=286,this.inputPattern="[0-9]*",this.preventDoubleClick=!1,void 0!==t&&!1!==t||this.triggerChallenge(!1)):this.share.isZivverAccessRight()&&this.$state.go("conversations.error",{error:"ZIVVER-ACCESSRIGHT",conversation:this.conversation},{location:!1}),this.$scope.$applyAsync(function(){var t=i.$translate.use().toLowerCase();i.supportUrl="https://support.zivver.com/"+t+"/kb/articles/"+e}),this.$scope.$watch(function(){return i.formValues.response},function(t,e){void 0!==e&&i.resetCustomErrors()}),this.share.isEmailAccessRight()&&this.$window.document.querySelectorAll("div.main-view div.auth.landing main")[0].classList.add("new-challenge"),this.$window.addEventListener("beforeunload",function(){i.StorageService.setItem("SESSION",o+"."+i.conversation.id,!0)})},r.prototype.triggerChallenge=function(t){var e=this;void 0===t&&(t=!0),this.inProgress||(this.inProgress=!0,this.preventDoubleClick=!0===t,this.ConversationsService.triggerAccessRight(this.share).then(function(){(e.challengeSent=!0)===t&&e.triggerToast()}).catch(function(t){e.$log.error("Could not trigger accessRightChallenge",{share:e.share.id,error:t}),e.error=!0,e.screen="CHALLENGE"}).finally(function(){e.inProgress=!1,e.setFocus(),e.$timeout(function(){e.preventDoubleClick=!1},3e4)}))},r.prototype.triggerToast=function(){var t=this.share.isEmailAccessRight()?this.profile.email:this.share.getChallengeInformation();return this.MessengerService.toast("conversation-challenge.RESEND-"+this.share.getAccessRightType().toUpperCase()+"-TOAST",{info:t})},r.prototype.notifySender=function(){var e=this;this.ConversationsService.notifySender(this.share).then(function(){return e.notified=!0}).catch(function(t){e.error=!0,e.screen="NOTIFY",e.$log.error("Could not notify",{share:e.share.id,error:t})})},r.prototype.validateChallenge=function(){var e=this;this.inProgress||(this.inProgress=!0,this.resetCustomErrors(),this.ConversationsService.validateAccessRight(this.share,this.formValues.response).then(function(t){e.share.accessRightGrant=t,e.AccessRightGrantService.setGrant(e.share.id,t),e.StorageService.getItem("SESSION",o+"."+e.conversation.id),e.viewConversation()}).catch(function(t){t.status===n.HTTP_BAD_REQUEST?e.form.response.$setValidity(e.share.getAccessRightType(),!1):e.$log.warn("Unexpected error validating accessRights",{error:t})}).finally(function(){return e.inProgress=!1}))},r.prototype.setWrongNumber=function(){(this.isWrongNumber=!0)===this.challengeSent&&(this.challengeSent=!1,this.isChallengeSent=!0)},r.prototype.back=function(){this.error=!1,!(this.isWrongNumber=!1)===this.isChallengeSent&&(this.challengeSent=!0)},r.prototype.reloadPage=function(){this.$window.location.reload()},r.prototype.showNotMyNumberButton=function(){return!1===this.challengeSent&&this.share.isSmsAccessRight()&&!1===this.isWrongNumber&&this.profile.isGuest()},r.prototype.showSendCodeButton=function(){return!1===this.challengeSent&&!1===this.isWrongNumber&&(this.share.isSmsAccessRight()||this.share.isEmailAccessRight())},r.prototype.showNotifyButton=function(){return this.share.isSmsAccessRight()&&!0===this.isWrongNumber},r.prototype.showMainActions=function(){return this.challengeSent&&!this.share.isEmailAccessRight()},r.prototype.showSecondaryActions=function(){return(this.challengeSent||!0===this.isWrongNumber)&&(this.share.isSmsAccessRight()||this.share.isEmailAccessRight())},r.prototype.resetCustomErrors=function(){this.form.response.$setValidity("generatedCode",!0),this.form.response.$setValidity("password",!0),this.form.response.$setValidity("sms",!0),this.form.response.$setValidity("email",!0)},r.prototype.setFocus=function(){var e=this;this.$timeout(function(){var t=e.$window.document.getElementById("response");null!==t&&t.focus()},200)},r.prototype.viewConversation=function(){return this.$state.go("conversations.view",{conversationId:this.share.conversationId,conversation:this.conversation,share:this.share,label:this.label},{location:"replace"})},r.prototype.summarizeRecipients=function(t,e){void 0===e&&(e=3);var i=this.conversation.participants.map(function(t){return t.fullNameOrEmail()}),n=i.slice(0,e).join(", ");return i.length>e&&(n+="... + "+(i.length-e)),n},r);function r(t,e,i,n,o,s,r,a,c,l){this.$log=t,this.$timeout=e,this.$translate=i,this.$scope=n,this.$state=o,this.$window=s,this.AccessRightGrantService=r,this.ConversationsService=a,this.StorageService=c,this.MessengerService=l,this.notified=!1,this.challengeSent=!1,this.error=!1,this.formValues={},this.inputPattern=".*",this.inputType="text",this.inProgress=!1,this.isChallengeSent=!1,this.isWrongNumber=!1,this.preventDoubleClick=!1}e.ConversationChallenge=s,e.ConversationChallengeModule=i.module("components.ConversationChallenge",[]).component("conversationChallenge",{bindings:{conversation:"<",sender:"<",profile:"<",share:"<",expired:"<",label:"@",notified:"="},controller:s,template:a(432)})}.apply(e,i))||(t.exports=n)},function(t,e,s){var i,n;i=[s,e,s(1),s(436)],void 0===(n=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$rootScope","$scope","$log","$window","$element","$timeout","$translate","$injector","$transitions","hotkeys","MediaService"],o.prototype.$onInit=function(){var t=this;this.contentEl=this.$element[0].querySelectorAll(".preview .content")[0],this.imageAttachments=this.attachments.filter(function(t){return t.isImage()}),this.canNavigate=1<this.imageAttachments.length,this.loadAttachment(this.getAttachment("current")),this.previewAttachment.isImage()&&this.$element[0].querySelectorAll("img")[0].addEventListener("load",function(){t.$scope.$applyAsync(function(){t.loading=!1})})},o.prototype.exitCarousel=function(){this.previewAttachment=void 0,this.unregisterStateChange()},o.prototype.showNext=function(t){t.preventDefault(),t.stopPropagation(),!1!==this.canNavigate&&this.loadAttachment(this.getAttachment("next"))},o.prototype.showPrevious=function(t){t.preventDefault(),t.stopPropagation(),!1!==this.canNavigate&&this.loadAttachment(this.getAttachment("prev"))},o.prototype.resetPreview=function(){this.$element[0].querySelectorAll("img")[0].src=void 0,this.loading=!0},o.prototype.getNoPreviewImage=function(){switch(this.$translate.use().toUpperCase()){case"EN":return s(437);case"NL":return s(438)}},o.prototype.loadAttachment=function(t){var e=this;if(this.loading=!0,t.isSvg())return this.previewAttachment=t,void(this.loading=!1);var i=2*this.$window.document.documentElement.clientHeight,n=2*this.$window.document.documentElement.clientWidth;void 0!==t.downloadUrl?this.MediaService.resize(t.downloadUrl,n,i,"fitIn").then(function(){e.previewAttachment=t}):(this.$log.error("Download url for the attachment id="+t.id+" is undefined"),this.previewAttachment.downloadUrl=this.getNoPreviewImage(),this.loading=!1)},o.prototype.registerShortcuts=function(){var e=this;this.hotkeys.bindTo(this.$scope).add({combo:["enter","space","right","down"],callback:function(t){e.showNext(t)}}).add({combo:["left","up"],callback:function(t){e.showPrevious(t)}}).add({combo:["esc","backspace","q"],callback:function(t){t.preventDefault(),e.exitCarousel()}})},o.prototype.registerStateChange=function(){var t=this;this.unregisterStateChange=this.$transitions.onStart({},function(){t.$element[0].parentNode.removeChild(t.$element[0]),t.unregisterStateChange()})},o.prototype.downloadAttachment=function(t){t.stopPropagation()},o.prototype.getAttachment=function(t){var e,i,n=this;switch(t){case"current":e=this.imageAttachments.filter(function(t){return t.id===n.previewAttachment.id}).shift();break;case"next":e=(i=this.imageAttachments.map(function(t){return t.id}).indexOf(this.previewAttachment.id))===this.imageAttachments.length-1?this.imageAttachments[0]:this.imageAttachments[i+1],this.resetPreview();break;case"prev":e=0===(i=this.imageAttachments.map(function(t){return t.id}).indexOf(this.previewAttachment.id))?this.imageAttachments[this.imageAttachments.length-1]:this.imageAttachments[i-1],this.resetPreview()}return e.downloadUrl="/api/shares_in/"+this.share.id+"/files/"+e.id+"/download/content?download_token="+this.downloadToken,e},o.prototype.printAttachment=function(t){if(t.preventDefault(),t.stopPropagation(),this.previewAttachment.isImage()&&void 0!==this.previewAttachment.downloadUrl)return this.$window.document.getElementById("noprinting").style.display="none",window.print(),void(this.$window.document.getElementById("noprinting").style.display="")},o);function o(t,e,i,n,o,s,r,a,c,l,u){this.$rootScope=t,this.$scope=e,this.$log=i,this.$window=n,this.$element=o,this.$timeout=s,this.$translate=r,this.$injector=a,this.$transitions=c,this.hotkeys=l,this.MediaService=u,this.canNavigate=!1,this.loading=!0,this.imageAttachments=[],this.target="_self",this.registerShortcuts(),this.registerStateChange(),this.$window.document.body.appendChild(this.$element[0])}e.AttachmentCarousel=n,e.AttachmentCarouselModule=i.module("components.AttachmentsCarousel",[]).component("attachmentCarousel",{controller:n,bindings:{attachments:"<",downloadToken:"<",previewAttachment:"=",share:"<"},templateUrl:s(439)})}.apply(e,i))||(t.exports=n)},function(t,e,r){var i,n;i=[r,e,r(1),r(440)],void 0===(n=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={added:"success",deleted:"warning","deleted-own":"warning",inaccessible:"warning",left:"notification",removed:"warning",revoked:"notification",suspended:"warning",unknown:"notification","quotes-conversation-revoked":"warning","quotes-revoked":"warning"},o=(s.$inject=["$translate"],s.prototype.$onInit=function(){this.eventLevel=n[this.event.eventType.toString()]||"notification",this.setIcon(),this.setText()},s.prototype.setIcon=function(){switch(this.eventLevel){case"notification":case"success":this.icon="info";break;case"warning":this.icon="warning"}},s.prototype.setText=function(){var t=this.event.originator,e=this.event.subject;this.text=this.$translate.instant("conversation-event."+this.event.eventType.toUpperCase(),{actor:t,participant:e})},s);function s(t){this.$translate=t}e.ConversationEventModule=i.module("components.conversationEvent",[]).component("conversationEvent",{bindings:{event:"<"},controller:o,template:r(441)})}.apply(e,i))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(1)],void 0===(o=function(t,e,i){"use strict";function n(t,e){var i,n;n=e?(i=1024,["Ki","Mi","Gi","Ti","Pi","Ei","Zi","Yi"]):(i=1e3,["k","M","G","T","P","E","Z","Y"]);var o=Math.log(t)/Math.log(i)|0;return(t/Math.pow(i,o)).toFixed(1)+" "+(0<o?n[o-1]+"B":"Bytes")}Object.defineProperty(e,"__esModule",{value:!0}),e.formatBytes=n,e.FormatBytesFilterModule=i.module("filters.formatBytes",[]).filter("formatBytes",function(){return n})}.apply(e,n))||(t.exports=o)},function(t,e,r){var i,n;i=[r,e,r(1),r(8),r(481)],void 0===(n=function(t,e,s,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$log","$state","$window","$timeout","ConversationsService"],o.prototype.$onInit=function(){var t=this;this.sender=this.getSender(),this.allRecipients=this.quote.conversationInfo.quoteRecipients.map(function(t){return new i.Participant(t)}).map(function(t){return t.fullNameOrEmail()}).join(", "),this.$timeout(function(){t.initRecipientsExpandability()}),this.$window.addEventListener("resize",function(){t.$timeout(function(){t.initRecipientsExpandability()})})},o.prototype.getSender=function(){if(void 0!==this.quote.conversationInfo){if(void 0!==this.quote.conversationInfo.quotedParticipant)return new i.Participant(this.quote.conversationInfo.quotedParticipant);throw new Error("quotedParticipant is undefined on quoted conversation")}},o.prototype.initRecipientsExpandability=function(){var i=this;this.areRecipientsExpanded=this.quote.messages.reduce(function(t,e){return t[e.id]=!1,t},{}),this.areRecipientsExpandable=this.quote.messages.reduce(function(t,e){return t[e.id]=i.isElementTruncated("recipients-"+e.id),t},{})},o.prototype.getRecipients=function(e){return this.allRecipients.split(", ").filter(function(t){return t!==(e.fullName||e.email)}).join(", ")},o.prototype.isOwnMessage=function(t){return t.sender===this.profile.email},o.prototype.showOriginal=function(){var e=this;this.ConversationsService.get(this.quote.conversationInfo.id).then(function(t){e.$state.go("conversations.open",{shareId:t.share,label:t.systemLabel.name},{reload:!0})})},o.prototype.toggleSelectMessage=function(t){var e=this.selectedMessages.indexOf(t);-1===e?this.selectedMessages.push(t):void 0!==this.selectedMessages&&this.selectedMessages.splice(e,1),this.selectedMessages.sort(function(t,e){return Number(t)-Number(e)})},o.prototype.isSelectedMessage=function(t){return this.isForwardedConversation&&-1<this.selectedMessages.indexOf(t)},o.prototype.isSenderVisible=function(t){return!1===t.isBcc||!0===this.isSenderUniqueParticipant()},o.prototype.areRecipientsVisible=function(t){return(!1===t.isBcc||!1===this.isSenderUniqueParticipant())&&0<this.getRecipients(t.participant).length},o.prototype.isSenderUniqueParticipant=function(){return void 0===this.quote.conversationInfo.quoteRecipients||1===this.quote.conversationInfo.quoteRecipients.length&&this.quote.conversationInfo.quoteRecipients[0].email===this.sender.email},o.prototype.toggleRecipientsExpansion=function(t){void 0!==this.areRecipientsExpandable[t]&&!1!==this.areRecipientsExpandable[t]&&(this.areRecipientsExpanded[t]=!this.areRecipientsExpanded[t])},o.prototype.getAreRecipientsExpanded=function(t){return void 0!==this.areRecipientsExpanded[t]&&this.areRecipientsExpanded[t]},o.prototype.getAreRecipientsExpandable=function(t){return void 0!==this.areRecipientsExpandable[t]&&this.areRecipientsExpandable[t]},o.prototype.isElementTruncated=function(t){var e=this.$window.document.getElementById(t),i=s.element(e).parent(),n=!1;if(null!=e&&null!=i){i.addClass("overflow-visible");var o=e.offsetWidth;i.removeClass("overflow-visible"),n=e.parentElement.clientWidth<=o}return n},o);function o(t,e,i,n,o){this.$log=t,this.$state=e,this.$window=i,this.$timeout=n,this.ConversationsService=o,this.areRecipientsExpanded={},this.areRecipientsExpandable={}}e.ConversationQuoteModule=s.module("components.ConversationQuote",[]).component("conversationQuote",{bindings:{conversation:"<",downloadToken:"<",isForwardedConversation:"<",profile:"<",quote:"<",selectedMessages:"=",share:"<"},controller:n,template:r(482)})}.apply(e,i))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(1)],void 0===(o=function(t,e,o){"use strict";function i(t,e,i,n){return void 0===i&&(i=""),void 0===n&&(n=!1),e=void 0===e?t.length:e,!o.isString(t)||t.length<=e?t:t.substring(0,n?-1===t.indexOf(" ",e)?t.length:t.indexOf(" ",e):e)+i}Object.defineProperty(e,"__esModule",{value:!0}),e.TruncateFilterModule=o.module("filters.truncate",[]).filter("truncate",function(){return i})}.apply(e,n))||(t.exports=o)},function(t,e,s){var i,n;i=[s,e,s(1),s(491)],void 0===(n=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.prototype.$onInit=function(){this.recipientsCheck=void 0===this.recipientsCheck||this.recipientsCheck,this.originalBody=this.draft.body.slice(0)},o.prototype.canSend=function(){return(!this.recipientsCheck||0<this.draft.recipients.length)&&(void 0!==this.draft.body&&null!==this.draft.body&&0<this.draft.body.length&&this.draft.body!==this.originalBody&&this.hasBodyContent()||0<this.draft.files.length||void 0!==this.draft.quote&&void 0!==this.draft.quote.messages&&this.draft.quote.messages.some(function(t){return!1===t.revoked}))&&!1===this.draft.isModified&&!1===this.draft.isSaving&&!1===this.draft.isValidating&&!1===this.draft.isUploading&&!1===this.draftHasFailedUploaded()&&!1===this.draft.isSending&&this.draft.validation.validationCompleted&&this.draft.validation.validDraft},o.prototype.hasBodyContent=function(){var t,e="text/html"===this.draft.contentType?this.draft.body.indexOf("<div><br><br> --"):this.draft.body.indexOf("\n\n--");return 0<=e&&((t=document.createElement("div")).innerHTML=this.draft.body.substring(0,e).replace("<div><br></div>","")),void 0===t||0<t.innerHTML.length},o.prototype.draftHasFailedUploaded=function(){return 0<this.draft.files.filter(function(t){return void 0!==t.upload&&void 0!==t.upload.error}).length},o);function o(){this.violations=0}e.DraftSendButtonModule=i.module("components.DraftSendButton",[]).component("draftSendButton",{controller:n,bindings:{draft:"=",recipientsCheck:"<",send:"&"},template:s(492)})}.apply(e,i))||(t.exports=n)},function(t,e,r){var i,n;i=[r,e,r(1),r(61)],void 0===(n=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(s.$inject=["$rootScope","$scope","$window","$element"],s.prototype.attachFiles=function(t){t.preventDefault(),t.stopPropagation(),this.systemAttach()},s.prototype.systemAttach=function(){var t=this.$element[0].querySelectorAll("div[ngf-select]")[0];i.element(t).triggerHandler("click")},s.prototype.uploadFiles=function(t){!1!==i.isArray(t)&&0!==t.length&&this.$rootScope.$broadcast("files-dropped",t)},s);function s(t,e,i,n){this.$rootScope=t,this.$scope=e,this.$window=i,this.$element=n}e.AttachButton=o,e.AttachButtonModule=i.module("components.AttachButton",[n.DraftAttachmentsModule.name]).component("attachButton",{bindings:{draft:"<"},controller:o,template:r(493)})}.apply(e,i))||(t.exports=n)},function(t,e,r){var i,n;i=[r,e,r(1),r(494),r(502)],void 0===(n=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(s.$inject=["$scope","DraftsValidationService"],s.prototype.$onInit=function(){var t=this;this.unresolvedViolations=this.draft.validation.violationsUnresolved,this.setIconStatus(this.draft),this.$scope.$watch(function(){return t.draft.isValidating},function(){t.setIconStatus(t.draft)}),this.$scope.$watch(function(){return t.draft.validation},function(){t.unresolvedViolations=t.draft.validation.violationsUnresolved,t.setIconStatus(t.draft)},!0)},s.prototype.dismissViolation=function(t){t.preventDefault(),t.stopPropagation(),this.draft.validation=this.DraftsValidationService.dismissViolation(this.unresolvedViolations[0],this.draft)},s.prototype.setIconStatus=function(t){this.draft.isValidating?(this.iconStatus="unknown",this.info=".NOTIFICATIONS.UNKNOWN"):0===this.unresolvedViolations.length?(this.iconStatus="verified",this.info=".NOTIFICATIONS.OK"):0<t.validation.getErrors().length?(this.iconStatus="error",this.info=".NOTIFICATIONS.ERROR"):0<t.validation.getWarnings().length?(this.iconStatus="warning",this.info=".NOTIFICATIONS.WARNING"):0<t.validation.getSuggestions().length?(this.iconStatus="info",this.info=".NOTIFICATIONS.INFO"):(this.iconStatus="verified",this.info=".NOTIFICATIONS.OK")},s);function s(t,e){this.$scope=t,this.DraftsValidationService=e,this.iconStatus="unknown"}e.DraftValidationsBarModule=i.module("components.DraftValidationsBar",[n.DraftValidationResultsModule.name]).component("draftValidationsBar",{controller:o,bindings:{draft:"<"},template:r(503),transclude:!0})}.apply(e,i))||(t.exports=n)},function(t,e,c){var i,n;i=[c,e,c(1),c(9),c(77),c(171),c(550)],void 0===(n=function(t,e,i,n,o,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=(a.$inject=["$rootScope","$log","$timeout","$q","$state","$translate","DraftsService","FilesOutService","ReplyService","MessengerService"],a.prototype.$onInit=function(){this.submitTranslated=this.$translate.instant("draft-special.SUBMIT")},a.prototype.submitDraft=function(t){return this.currentState="submitting","initiation"===this.type?this.initiate(t):"response"===this.type?this.reply():this.$q.reject("incorrect type on draft-special set! can not determine whether if initiation or response: "+this.type)},a.prototype.initiate=function(t){var n=this;return new this.$q(function(e,i){if(!1===n.canSend())return n.currentState="sendingfailed",i("cannot initiate");void 0!==t&&(n.draft.subject=t),n.DraftsService.send(n.draft).then(function(t){return n.currentState="sent",n.MessengerService.toast("draft-special.SENT"),n.$state.go("conversations.view",{conversationId:t.conversation},{location:"replace"}),e()}).catch(function(t){return n.currentState="sendingfailed",n.$log.error("initiate called => .catch called, error: ",t),i(t)})})},a.prototype.reply=function(){var n=this;return new this.$q(function(e,i){if(!1===n.canSend())return n.currentState="sendingfailed",i("cannot reply");n.ReplyService.send(n.conversation.id,n.draft,n.accessRightGrantToken).then(function(t){return n.currentState="sent",n.draft.isSending=!1,n.$rootScope.$broadcast("conversations.replied",t),n.reset(),n.MessengerService.toast("draft-special.SENT"),e()}).catch(function(t){return n.currentState="sendingfailed",n.draft.isSending=!1,n.$log.error("Could not reply in special conversation",{error:t}),i("replying failed")})})},a.prototype.reset=function(){this.draft=new n.Draft},a.prototype.canSend=function(){switch(!0){case this.draft.isSending:case this.draft.isUploading:return!1;default:return!0}},a.prototype.updateDraft=function(t,e){null===this.draft.body&&(this.draft.body=""),void 0!==e&&(this.draft.subject=e),void 0!==t&&(this.draft.body=t)},a.prototype.saveDraft=function(t,e){var n=this;return this.updateDraft(t,e),"response"===this.type?this.$q.resolve(!0):this.$q(function(e,i){n.draft.isSaving&&(n.$log.warn("draft is currently being saved, not saving..."),n.$timeout.cancel(n.saveTimeout),n.saveTimeout=n.$timeout(function(){delete n.saveTimeout,n.saveDraft()},1e3),e(!1)),n.draft.isModified=!1,n.draft.isSaving=!0,n.DraftsService.save(n.draft).then(function(t){e(!0)}).catch(function(t){i(t)}).finally(function(){return n.draft.isSaving=!1})})},a.prototype.removeDraft=function(){void 0!==this.draft.id&&this.DraftsService.remove(this.draft)},a.prototype.cancelDraft=function(){this.draft.isUploading=!1,this.removeDraft(),this.$state.go("conversations.index")},a);function a(t,e,i,n,o,s,r,a,c,l){this.$rootScope=t,this.$log=e,this.$timeout=i,this.$q=n,this.$state=o,this.$translate=s,this.DraftsService=r,this.FilesOutService=a,this.ReplyService=c,this.MessengerService=l,this.currentState="pending"}e.DraftSpecial=r,e.DraftSpecialModule=i.module("components.draftSpecial",[o.SpecialsFormModule.name,s.SpecialsSectionModule.name]).component("draftSpecial",{bindings:{type:"@",conversation:"<",draft:"=",accessRightGrantToken:"<",subject:"@",formDefinition:"<"},controller:r,templateUrl:c(551)})}.apply(e,i))||(t.exports=n)},function(t,e,b){var i,n;i=[b,e,b(1),b(504),b(506),b(508),b(511),b(514),b(517),b(520),b(526),b(529),b(531),b(533),b(535),b(537),b(539),b(541),b(543),b(546)],void 0===(n=function(t,e,i,n,o,s,r,a,c,l,u,p,d,h,f,v,m,g,S){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var $=(y.$inject=["$log","$timeout"],y.prototype.$onInit=function(){this.formCtrl=this.specialsForm.formCtrl},y.prototype.setComponentVisibility=function(t,e){try{this.section.getComponentByKey(t).visible=e}catch(t){this.$log.warn("Could not get component",{error:t})}},y.prototype.closeAllSectionsBelow=function(){this.specialsForm.closeAllStepsBelow(this.stepperIndex)},y.prototype.openPreviousSection=function(){0<this.specialsForm.numberSteps&&0<this.stepperIndex&&this.specialsForm.goToStep(this.stepperIndex-1)},y.prototype.openNextSection=function(){var e=this;if(0<this.specialsForm.numberSteps&&this.stepperIndex<this.specialsForm.numberSteps){if(0===this.containsInputs().length)return this.section.isCompleted=!0,void this.specialsForm.goToStep(this.stepperIndex+1);!0===this.validateSectionInstant()?(this.section.isCompleted=!0,this.specialsForm.goToStep(this.stepperIndex+1),this.specialsForm.onSectionCompleted().catch(function(t){e.$log.error("error saving special section: ",{error:t})})):this.specialsForm.jumpToFirstError(this.errorList)}},y.prototype.openSection=function(){!1===this.section.isDisabled&&this.specialsForm.goToStep(this.stepperIndex)},y.prototype.cancel=function(){this.specialsForm.onCancelForm()},y.prototype.isStepCurrent=function(){return this.specialsForm.getCurrentStep()===this.stepperIndex},y.prototype.isStepFirst=function(){return!0===this.isStepCurrent()&&1===this.stepperIndex==1},y.prototype.isStepLast=function(){return this.stepperIndex===this.specialsForm.numberSteps},y.prototype.containsInputs=function(){return this.section.components.filter(function(t){return!1===t.isStatic()})},y.prototype.validateSectionInstant=function(){this.errorList=[];var t=this.containsInputs().map(function(t){return t.key});return 0<t.length?(this.errorList=this.specialsForm.validateComponents(t),this.sectionValid=0===this.errorList.length):0===t.length&&(this.sectionValid=!0),this.sectionValid},y.prototype.setComponentRequired=function(t,e){this.section.getComponentByKey(t).required=e},y.prototype.cancelValidation=function(){void 0!==this.validateTimeout&&(this.$timeout.cancel(this.validateTimeout),this.validateTimeout=void 0)},y.prototype.validateSection=function(){var t=this;this.cancelValidation(),this.validateTimeout=this.$timeout(function(){t.validateSectionInstant()},150,!0)},y.prototype.submitSpecial=function(){var e=this;this.cancelValidation(),this.errorList=this.specialsForm.validateForm(),this.formValid=0===this.errorList.length,!0===this.formValid?this.specialsForm.onSectionCompleted().then(function(){return e.isSent=!1,e.isSentFailed=!1,e.isSubmitting=!0,e.specialsForm.onSubmitSpecial()}).then(function(){e.isSent=!0}).catch(function(t){e.isSentFailed=!0,e.failMessage=t,e.$log.error("submitSpecial .catch => error during sending: ",t)}):this.specialsForm.jumpToFirstError(this.errorList)},y.prototype.logUnkownComponent=function(t){return this.$log.warn("Unkown component",{component:t})," \x3c!-- unkown component: "+JSON.stringify(t)+" --\x3e"},y);function y(t,e){this.$log=t,this.$timeout=e,this.isSubmitting=!1,this.isSent=!1,this.isSentFailed=!1,this.sectionValid=!0,this.formValid=!0,this.errorList=[]}e.SpecialsSection=$,e.SpecialsSectionModule=i.module("components.SpecialsSection",[n.SpecialsHiddenModule.name,o.SpecialsInputCheckboxModule.name,s.SpecialsInputCheckboxesModule.name,r.SpecialsInputCheckboxesSvgModule.name,a.SpecialsInputDateModule.name,c.SpecialsInputFilenamePatternModule.name,l.SpecialsInputImageModule.name,u.SpecialsInputRadioButtonModule.name,p.SpecialsInputSelectModule.name,d.SpecialsInputSsnModule.name,h.SpecialsInputTextAutocompleteModule.name,f.SpecialsInputTextModule.name,v.SpecialsInputTextareaModule.name,m.SpecialsStaticImageModule.name,g.SpecialsStaticTextModule.name,S.SpecialsStaticTextHeaderModule.name]).component("specialsSection",{controller:$,bindings:{section:"=",stepperTitle:"<",stepperIndex:"<"},templateUrl:b(547),require:{specialsForm:"^specialsForm"}})}.apply(e,i))||(t.exports=n)},function(t,e,a){var i,n;i=[a,e,a(1),a(18),a(5),a(558)],void 0===(n=function(t,e,i,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=(r.$inject=["$log","$translate","SpecialsService","AuthSessionService","AppSwitcherService"],r.prototype.$onInit=function(){this.AuthSessionService.hasScope(o.Scopes.SENDMESSAGES)&&void 0===this.AppSwitcherService.getContext().specialId&&this.options.push({icon:"create",label:this.translate("DRAFT"),state:"drafts.create"}),this.AuthSessionService.hasScope(o.Scopes.SPECIALSUSER)&&this.getSpecials()},r.prototype.getSpecials=function(){var e=this;this.SpecialsService.listSpecials().then(function(t){t.filter(function(t){return"active"===t.status&&0<t.flowInitiations.length}).filter(function(t){return t.id===e.AppSwitcherService.getContext().specialId}).forEach(function(t){e.options.push({label:e.translate("SPECIAL",{name:t.flowInitiations[0].messageDefinition.name.toLowerCase()}),icon:"mode_edit",state:"drafts.special",stateParams:{specialId:t.id,special:t}})})})},r.prototype.translate=function(t,e){return this.$translate.instant("compose-button."+t,e)},r);function r(t,e,i,n,o){this.$log=t,this.$translate=e,this.SpecialsService=i,this.AuthSessionService=n,this.AppSwitcherService=o,this.options=[],this.speedDialOpen=!1}e.ComposeButton=s,e.ComposeButtonModule=i.module("components.ComposeButton",[n.AppSwitcherModule.name]).component("composeButton",{controller:s,template:a(559)})}.apply(e,i))||(t.exports=n)},function(t,e,i){t.exports=i.p+"assets/tpl/index.ce2cd7.html"},function(t,e,i){t.exports=i.p+"assets/tpl/special.0fb4b5.html"},function(t,e,i){t.exports=i.p+"assets/img/shield.bae2c9.svg"},,,,,,,,,,,,,,,,,,,,function(t,e,i){var n,o;n=[i,e,i(1),i(276)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$scope","$timeout"],o.prototype.$onInit=function(){var t=this;this.$timeout(function(){t.field=document.getElementById(t.$scope.password)},0)},o.prototype.toggleVisibility=function(){this.isVisible=!this.isVisible,this.isVisible?this.field.setAttribute("type","text"):this.field.setAttribute("type","password")},o);function o(t,e){this.$scope=t,this.$timeout=e,this.isVisible=!1}e.ShowPasswordDirectiveModule=i.module("common.directive.ShowPasswordDirective",[]).directive("showPassword",function(){return{restrict:"E",template:'\n\t\t\t\t<div class="show-password">\n\t\t\t\t\t<md-icon\n\t\t\t\t\t\ttabindex="-1"\n\t\t\t\t\t\tclass="input-icon"\n\t\t\t\t\t\tng-click="$ctrl.toggleVisibility()"\n\t\t\t\t\t\tng-show="$ctrl.isVisible === true"\n\t\t\t\t\t>\n\t\t\t\t\t\tvisibility_off\n\t\t\t\t\t</md-icon>\n\t\t\t\t\t<md-icon\n\t\t\t\t\t\ttabindex="-1"\n\t\t\t\t\t\tclass="input-icon"\n\t\t\t\t\t\tng-click="$ctrl.toggleVisibility()"\n\t\t\t\t\t\tng-show="$ctrl.isVisible === false"\n\t\t\t\t\t>\n\t\t\t\t\t\tvisibility\n\t\t\t\t\t</md-icon>\n\t\t\t\t</div>\n\t\t\t\t',scope:{password:"@"},controller:n,controllerAs:"$ctrl"}})}.apply(e,n))||(t.exports=o)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Invite=function(t){this.id=null,this.email=null,this.expireDate=null,this.fullName=null,this.invitedBy=null,this.inviteMessage=null,this.notificationSend=null,this.responseDate=null,void 0!==t&&(this.id=t.id,this.email=t.email,this.status=t.status,this.expireDate=void 0===t.expireDate?null:t.expireDate,this.fullName=void 0===t.fullName?null:t.fullName,this.invitedBy=void 0===t.invitedBy?null:t.invitedBy,this.inviteMessage=void 0===t.inviteMessage?null:t.inviteMessage,this.notificationSend=void 0===t.notificationSend?null:t.notificationSend,this.responseDate=void 0===t.responseDate?null:t.responseDate)}}.apply(e,[i,e]))||(t.exports=n)},function(t,e,l){var i,n;i=[l,e,l(1),l(6),l(14),l(411)],void 0===(n=function(t,e,i,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s={US:[1],AS:[1684],AI:[1264],AG:[1268],BS:[1242],BB:[1246],BM:[1441],VG:[1284],CA:[1204,1226,1236,1249,1250,1289,1306,1343,1365,1387,1403,1416,1418,1431,1437,1438,1450,1506,1514,1519,1548,1579,1581,1587,1604,1613,1639,1647,1672,1705,1709,1742,1778,1780,1782,1807,1819,1825,1867,1873,1902,1905],KY:[1345],DM:[1767],DO:[1809,1829,1849],GD:[1473],GU:[1671],JM:[1876,1658],MS:[1664],MP:[1670],PR:[1787,1939],KN:[1869],LC:[1758],VC:[1784],SX:[1721],TT:[1868],TC:[1649],VI:[1340]},r={GB:[44],GG:[441481],IM:[441624],JE:[441534]},a=(c.$inject=["$log","$scope","GeoService"],c.prototype.$onInit=function(){var e=this;this.getCountriesInfo(),this.$scope.$watch(function(){return e.smsConflict},function(t){!0===t?(e.form.phoneNumber.$error.sameNumber=!0,e.form.phoneNumber.$setValidity("sameNumber",!1)):(e.form.phoneNumber.$error.sameNumber=!1,e.form.phoneNumber.$setValidity("sameNumber",!0))})},c.prototype.getCountriesInfo=function(){var i=this;this.GeoService.getCountriesInfo().then(function(t){i.countries=t.sort(function(t,e){return t.name>e.name?1:-1}),void 0===i.phoneNumber||""===i.phoneNumber?i.GeoService.getCurrentCountryIso().then(function(e){0!==i.countries.filter(function(t){return t.iso===e}).length&&(i.selectedCountry=i.countries.filter(function(t){return t.iso===e})[0])}).finally(function(){return i.loading=!1}):i.GeoService.validatePhonenumber(i.phoneNumber).then(function(e){0!==i.countries.filter(function(t){return t.iso===e.region}).length&&(i.selectedCountry=i.countries.filter(function(t){return t.iso===e.region})[0]),i.phoneNumber=e.formattedNumber}).finally(function(){return i.loading=!1}),i.$scope.$watch(function(){return i.phoneNumber},function(t){if((null==t||""===t)&&void 0!==i.form)return!0!==i.required&&void 0!==i.form.phoneNumber&&i.form.phoneNumber.$setValidity("invalidPhoneNumber",!0),void(!0!==i.smsConflict&&void 0!==i.form.phoneNumber&&i.form.phoneNumber.$setValidity("sameNumber",!0));i.validatePhoneNumber()})})},c.prototype.validatePhoneNumber=function(){var i=this,t=void 0===this.selectedCountry?void 0:this.selectedCountry.iso;this.GeoService.validatePhonenumber(this.phoneNumber,t).then(function(e){!1===e.canReceiveSms?i.form.phoneNumber.$setValidity("cannotReceiveSms",!1):(i.form.phoneNumber.$setValidity("cannotReceiveSms",!0),i.form.phoneNumber.$setValidity("invalidPhoneNumber",!0)),i.form.phoneNumber.$setViewValue(""+e.formattedNumber),i.form.phoneNumber.$render(),0!==i.countries.filter(function(t){return t.iso===e.region}).length&&(i.selectedCountry=i.countries.filter(function(t){return t.iso===e.region})[0])}).catch(function(t){i.form.phoneNumber.$setValidity("cannotReceiveSms",!0),i.form.phoneNumber.$setViewValue(""+i.phoneNumber),i.form.phoneNumber.$render(),t.status!==n.HTTP_CONFLICT&&i.$log.warn("Unexpected error for phone number validation",{error:t}),t.status===n.HTTP_CONFLICT&&i.form.phoneNumber.$setValidity("invalidPhoneNumber",!1)}).finally(function(){i.checkCountryCode(),i.checkAreaCode()})},c.prototype.isPhoneInputInvalid=function(){return void 0!==this.form.phoneNumber&&this.form.phoneNumber.$dirty&&this.form.phoneNumber.$invalid},c.prototype.checkCountryCode=function(){var i=this,t=this.countries.filter(function(t){var e=i.phoneNumber.match("^(\\+|(00))("+t.code+")");return null!==e&&1<=e.length});0!==t.length&&(this.selectedCountry=t[0])},c.prototype.checkAreaCode=function(){var t=this.phoneNumber.replace(/^(\s|\D|\+|00)*/g,"");"1"===t.charAt(0)&&this.findCountryISOForAreaCode(t,s),"4"===t.charAt(0)&&"4"===t.charAt(1)&&this.findCountryISOForAreaCode(t,r)},c.prototype.findCountryISOForAreaCode=function(t,n){var o=this;Object.keys(n).forEach(function(e){var i=t;n[e].some(function(t){if(new RegExp("^"+t.toString(),"g").test(i))return 0!==o.countries.filter(function(t){return t.iso===e}).length&&(o.selectedCountry=o.countries.filter(function(t){return t.iso===e})[0],!0)})})},c.prototype.changeCountryCode=function(){void 0!==this.phoneNumber&&(this.phoneNumber=""),this.form.countryCode.$setPristine()},c);function c(t,e,i){this.$log=t,this.$scope=e,this.GeoService=i,this.loading=!0,this.blankGif=o.BLANK_GIF}e.InputPhonenumber=a,e.InputPhonenumberModule=i.module("components.inputPhonenumber",[]).component("inputPhonenumber",{bindings:{form:"=",phoneNumber:"=",required:"<",smsConflict:"<"},controller:a,template:l(412)})}.apply(e,i))||(t.exports=n)},,,,,,function(t,e,i){t.exports=i(204)},function(t,e,i){var n,o;n=[i,e,i(1),i(37),i(209),i(648),i(690)],void 0===(o=function(t,e,i,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),window.addEventListener("error",function(t){if("Object doesn't support property or method 'createEventObject'"!==t.message){var e=new XMLHttpRequest;e.open("POST","/api/log"),e.setRequestHeader("Content-Type","application/json"),e.onerror=function(t){};var i=document.location.href.replace(new RegExp(n.TOKEN_REGEX,"g"),function(t){return"**TOKEN**."+t.split(".").pop()});e.send(JSON.stringify({message:("[FATAL] "+t.message).substr(0,255),channel:"WEBAPP",level:"ERROR",context:{colno:t.colno,file:t.filename,lineno:t.lineno,stacktrace:t.error.stack,url:i}}))}}),i.bootstrap(document.body,[o.zivver.name],{strictDi:!0})}.apply(e,n))||(t.exports=o)},,function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EMAIL_REGEX="([!#-'*+\\\\/-9=?A-Z^-~-]+(\\.[!#-'*+\\\\/-9=?A-Z^-~-]+)*)@[a-zA-Z0-9-]+\\.[a-zA-Z0-9-.]+"}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TOKEN_REGEX="eyJ0[A-Za-z0-9-_.+=]+|ZBT.[A-Za-z0-9-_.+=]*"}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UUID_REGEX="[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-[89ab][a-f0-9]{3}-[a-f0-9]{12}"}.apply(e,[i,e]))||(t.exports=n)},function(t,e,C){var i,n;i=[C,e,C(1),C(210),C(211),C(222),C(223),C(74),C(233),C(234),C(235),C(239),C(295),C(622),C(18),C(19),C(634),C(635),C(25),C(176),C(177),C(639),C(641),C(643),C(645)],void 0===(n=function(t,e,i,a,n,o,s,r,c,l,u,p,d,h,f,v,m,g,S){"use strict";function $(e){g.ErrorRoutes.forEach(function(t){return e.state(t)})}function y(t,e,i,n){var o=document.body,s=[];a.attach(o,{selector:"body, body *:not(specials-input-checkboxes-svg *)"}),e.onSuccess({},function(t){var e=t.to();o.setAttribute("state",e.name),void 0!==s&&(s.forEach(function(t){return o.classList.remove(t)}),s=[]),void 0!==e.data&&void 0!==e.data.bodyClass&&(s=e.data.bodyClass.split(" ")).forEach(function(t){return o.classList.add(t)})});var r=n.getItem("SESSION","application.theme");r&&("string"!=typeof r?i.loadTheme(r,!1):S.loadTheme(r))}function b(n,o,s,r,a){var c=!1;n.$on("api::tooManyConnectionErrors",function(){if(!c){var t=o.navigator.onLine?"UNAVAILABLE":"OFFLINE",e=r.instant("MAIN.API-ERROR."+t),i=s.alert().textContent(e).ok(r.instant("MAIN.TRY-AGAIN"));c=!0,s.show(i).then(function(){n.$broadcast("api::connectionErrorsReset"),c=!1,a.reload()})}})}function w(t){t.onSuccess({},function(t){var e=t.injector().get("$anchorScroll"),i=t.injector().get("$document"),n=t.injector().get("$mdUtil"),o=t.injector().get("$timeout"),s=i.find("body");e("top"),o(function(){var t=n.findFocusTarget(s);void 0!==t&&(t.focus(),n.forceFocus(t))},250,!1)}),t.onStart({},function(t){t.injector().get("LoggerService").trackAnalytics("event",{event:"app.start"})},{invokeLimit:1})}function E(t,e,i,n,o,s,r){e.debugInfoEnabled(!1),e.cssClassDirectivesEnabled(!1),e.commentDirectivesEnabled(!1),i.hashPrefix(""),i.html5Mode(!0),n.defaults.secure="https:"===window.location.protocol,o.errorOnUnhandledRejections(!1),t.constant("$MD_THEME_CSS",""),r.skipClickHijack(),s.iconSet("ziv",C(647),24)}$.$inject=["$stateProvider"],y.$inject=["$rootScope","$transitions","ThemeService","StorageService"],b.$inject=["$rootScope","$window","$mdDialog","$translate","$state"],w.$inject=["$transitions"],E.$inject=["$provide","$compileProvider","$locationProvider","$cookiesProvider","$qProvider","$mdIconProvider","$mdGestureProvider"],Object.defineProperty(e,"__esModule",{value:!0}),e.zivver=i.module("zivver",["ngAnimate","ngAria","ngCookies","ngMessages","ngSanitize","ngMaterial",n.UiRouterConfigModule.name,r.I18nModule.name,o.ApiInterceptorModule.name,c.MdTooltipDirectiveModule.name,l.HelpDirectiveModule.name,u.ZivverExternalsModule.name,v.ZivverServicesModule.name,p.AuthModule.name,d.AppModule.name,h.LandingModule.name,m.DocumentTitleServiceModule.name,f.AppSwitcherModule.name]).config(E).config($).config(s.decorateMdDialog).run(w).run(y).run(b)}.apply(e,i))||(t.exports=n)},,function(t,e,i){var n,o;n=[i,e,i(1),i(691),i(6),i(37),i(5),i(221)],void 0===(o=function(t,e,i,n,o,s,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UiRouterConfigModule=i.module("zivver.configUiRouter",["ui.router","oc.lazyLoad"]).config(["$urlServiceProvider",function(t){t.config.type("uuid",{encode:function(t){return t},decode:function(t){return t},is:function(t){return"string"==typeof t},equals:function(t,e){return t===e},pattern:new RegExp(s.UUID_REGEX)}),t.config.type("token",{encode:function(t){return t},decode:function(t){return t},is:function(){return!0},equals:function(){return!0},pattern:new RegExp(s.TOKEN_REGEX)}),t.rules.initial({state:"login"}),t.rules.otherwise({state:"_errors.not_found",params:{},options:{notify:!0,reload:!1}})}]).run(["$log","$state","$transitions",function(e,i,t){t.onBefore({},function(t){var e=function(t){var e=t.injector().get("AuthSessionService"),i=t.injector().get("LoginService"),n=t.to(),o=t.params(),s=!0,r=e.isAuthenticated(),a=e.hasRefreshToken();if(void 0!==n.data&&void 0!==n.data.authorizationRequired&&(s=n.data.authorizationRequired),!1===s){if(r&&"login"===n.name)return t.router.stateService.target("conversations.label");if(a&&"login"===n.name)return i.setLoginDestination("conversations.label"),t.router.stateService.target("login-refresh")}else if(!1===r)return i.setLoginDestination(n.name,o),t.router.stateService.target(a?"login-refresh":"login",o)}(t);if(void 0!==e)return e;var i=function(t){var e=t.injector().get("AuthSessionService"),i=t.injector().get("LoginService"),n=t.to(),o=t.params();if(!1!==e.isAuthenticated()){var s=[],r=e.getScopes();if(void 0!==n.data&&void 0!==n.data.scopesRequired&&(s=n.data.scopesRequired),0!==s.length&&!e.hasScopes(s))return e.hasScope(a.Scopes.FACTORAUTHENTICATOR)&&1===r.length?(i.setLoginDestination(n.name,o),t.router.stateService.target("login-extra-factor")):e.hasScope(a.Scopes.CHANGEPASSWORD)&&1===r.length&&"login-forced-password-change"!==n.name?(i.setLoginDestination(n.name,o),t.router.stateService.target("login-forced-password-change")):e.isDelegate()&&0===n.name.indexOf("organization")?t.router.stateService.target("conversations.label"):t.router.stateService.target("_errors.permissions",{prevState:n.name,prevParams:n.params,scopes:{required:s,given:r}})}}(t);return void 0!==i?i:void 0}),t.onSuccess({},function(t){t.injector().get("LoggerService").trackAnalytics("pageview",{state:t.to().name})}),i.defaultErrorHandler(function(t){t instanceof n.Rejection&&(2===t.type||3===t.type)||(t.detail.status===o.HTTP_UNAUTHORIZED?i.go("login-401",t.detail.data):t.detail.status===o.HTTP_NOT_FOUND?i.go("_errors.not_found"):(e.warn("Error changing to state",{error:t}),i.go("_errors.state_change")))})}])}.apply(e,n))||(t.exports=o)},,function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ERR_CONNECTION_REFUSED=-1,e.ZERO_RESPONSE=0,e.HTTP_OK=200,e.HTTP_NO_CONTENT=204,e.HTTP_BAD_REQUEST=400,e.HTTP_UNAUTHORIZED=401,e.HTTP_FORBIDDEN=403,e.HTTP_NOT_FOUND=404,e.HTTP_NOT_ACCEPTABLE=406,e.HTTP_CONFLICT=409,e.HTTP_GONE=410,e.HTTP_PRECONDITION_FAILED=412,e.HTTP_UNPROCESSABLE_ENTITY=422,e.HTTP_LOCKED=423,e.HTTP_TOO_MANY_REQUESTS=429,e.HTTP_INTERNAL_SERVER_ERROR=500,e.HTTP_BAD_GATEWAY=502,e.HTTP_SERVICE_UNAVAILABLE=503,e.HTTP_GATEWAY_TIMEOUT=504}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.scopesChanged="auth-scopes-changed",n.logoutSuccess="auth-logout-success",n.logoutOtherTab="auth-logout-other-tab",n.notAuthenticated="auth-not-authenticated",n);function n(){}e.AuthEvents=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),(i=e.GrantType||(e.GrantType={})).authorization_code="authorization_code",i.password="password",i.refresh_token="refresh_token",i.delegate="delegate"}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.prototype.isSms=function(){return"sms"===this.factorType},n.prototype.isTotp=function(){return"rfc6238_totp"===this.factorType},n);function n(t){void 0!==t&&(this.challengeInformation=t.challengeInformation,this.factorType=t.factorType,this.id=t.id)}e.Multifactor=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(o.prototype.setRequiredProperties=function(t){for(var e=0,i=o.requiredProperties;e<i.length;e++){var n=i[e];if(void 0===t[n])throw Error("Missing property "+n+" for Recipient");this[n]=t[n]}},o.prototype.setOptionalProperties=function(t){for(var e=0,i=o.optionalProperties;e<i.length;e++){var n=i[e];void 0!==t[n]&&(this[n]=t[n])}},o.requiredProperties=["otpType","status","id","secret","account","qrcode"],o.optionalProperties=["period","digits","counter"],o);function o(t){void 0!==t&&(this.setRequiredProperties(t),this.setOptionalProperties(t))}e.OtpSetup=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),(i=e.Scopes||(e.Scopes={})).CHANGEPASSWORD="CHANGEPASSWORD",i.FACTORAUTHENTICATOR="FACTORAUTHENTICATOR",i.LIMITEDACCESS="LIMITEDACCESS",i.LIMITEDREPLYMESSAGES="LIMITEDREPLYMESSAGES",i.ORGANIZATIONADMIN="ORGANIZATIONADMIN",i.RECEIVEMESSAGES="RECEIVEMESSAGES",i.SENDMESSAGES="SENDMESSAGES",i.SPECIALSADMIN="SPECIALSADMIN",i.SPECIALSUSER="SPECIALSUSER",i.USERADMIN="USERADMIN",i.USERREGISTRATION="USERREGISTRATION",i.USERECOVERYCODE="USERECOVERYCODE"}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}.apply(e,[i,e]))||(t.exports=n)},,function(t,e,i){var n,o;n=[i,e,i(1),i(5),i(6)],void 0===(o=function(t,e,i,r,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ApiInterceptorModule=i.module("common.ApiInterceptor",[]);var n=(o.$inject=["$rootScope","$q","$log","$injector","AuthSessionService"],o.prototype.checkAuthentication=function(e){return!1===this.isAuthenticationRequired(e)?e:this.AuthSessionService.isAuthenticated()?(e.headers.Authorization="Bearer "+this.AuthSessionService.getAccessToken(),e):this.AuthSessionService.hasRefreshToken()?this.$injector.get("LoginService").refresh().then(function(t){if(t.mfaRequired)throw Error("AuthInterceptor refresh resulted in MFA required. Not yet implemented");return e.headers.Authorization="Bearer "+t.accessToken,e}):void 0},o.prototype.isApiRequest=function(t){var e=t.url;return void 0!==e&&0===e.indexOf("/api/")},o.prototype.isAuthenticationRequired=function(t,e){return void 0===e&&(e=!0),!1!==this.isApiRequest(t)&&(!e||void 0===t.headers||void 0===t.headers.Authorization)&&(void 0===t.authenticationRequired||t.authenticationRequired)},o.prototype.retryRequest=function(t,e,i){var n=this;void 0===i&&(i=!0),t.retries=void 0===t.retries?1:t.retries+1;var o=this.$injector.get("$http");return this.$injector.get("$timeout")(function(){return n.$log.debug("retrying request "+t.method+": "+t.url),o(t)},i?e*t.retries:e,!1)},o);function o(t,e,i,n,o){var s=this;this.$rootScope=t,this.$q=e,this.$log=i,this.$injector=n,this.AuthSessionService=o,this.connectionErrors=0,this.request=function(t){return 0===t.url.indexOf("/api/")?(t.url=t.url.replace("/api/","/api/"),void 0===t.timeout&&(t.timeout=2e4),5<s.connectionErrors?(s.$rootScope.$broadcast("api::tooManyConnectionErrors"),s.$q.reject(new Error("too many requests"))):s.checkAuthentication(t)):t},this.response=function(t){var e=t.config;return!1===s.isApiRequest(e)||(s.connectionErrors=0<s.connectionErrors?s.connectionErrors-1:0),t},this.responseError=function(t){var e=t.config;if(!1===s.isApiRequest(e)||-1<e.url.indexOf("/api/files_out/"))return s.$q.reject(t);switch(t.status){case a.HTTP_INTERNAL_SERVER_ERROR:case a.HTTP_BAD_GATEWAY:case a.HTTP_SERVICE_UNAVAILABLE:case a.HTTP_GATEWAY_TIMEOUT:if("GET"===e.method&&void 0===e.retries||e.retries<3)return s.retryRequest(e,2e3);s.connectionErrors++,s.$log.debug("We now have "+s.connectionErrors+" failed requests");break;case a.HTTP_UNAUTHORIZED:s.isAuthenticationRequired(e,!1)&&s.$rootScope.$broadcast(r.AuthEvents.notAuthenticated,t);break;case a.HTTP_TOO_MANY_REQUESTS:if(void 0===e.retries||e.retries<3){e.retries=(e.retries||0)+1;var i=t.headers("Retry-After")?parseInt(t.headers("Retry-After")):2;return s.retryRequest(e,1e3*i,!1)}break;case a.ERR_CONNECTION_REFUSED:if(void 0!==e.timeout&&"number"==typeof e.timeout&&"GET"===e.method&&(void 0===e.retries||e.retries<3))return e.timeout=1.5*e.timeout,s.retryRequest(e,2e3)}return s.$q.reject({status:t.status,statusText:t.statusText,data:t.data,headers:t.headers,url:t.config.url})},this.$rootScope.$on("api::connectionErrorsReset",function(){s.connectionErrors=0})}e.ApiInterceptorModule.service("ApiInterceptor",n).config(["$httpProvider",function(t){t.interceptors.push(["$injector",function(t){return t.get("ApiInterceptor")}]),t.defaults.headers.common.Accept="application/json",t.useApplyAsync(!0)}])}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(7)],void 0===(o=function(t,e,o){"use strict";function i(t){t.decorator("$mdDialog",["$delegate","$mdMedia",function(t,e){var i=t.show.bind(t),n={controllerAs:"$ctrl",fullscreen:!1===e("gt-sm"),clickOutsideToClose:!0,escapeToClose:!0};return t.show=function(t){return i(o.__assign({},n,t))},t}])}i.$inject=["$provide"],Object.defineProperty(e,"__esModule",{value:!0}),e.decorateMdDialog=i}.apply(e,n))||(t.exports=o)},,function(t,e,i){var n={"./de":226,"./nl":227};function o(t){var e=s(t);return i(e)}function s(t){if(i.o(n,t))return n[t];var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}o.keys=function(){return Object.keys(n)},o.resolve=s,(t.exports=o).id=225},,,,,function(t,e,i){t.exports=i.p+"assets/i18n/en.f9a7d1.json"},function(t,e,i){t.exports=i.p+"assets/i18n/de.84a5e7.json"},function(t,e,i){t.exports=i.p+"assets/i18n/nl.6f718e.json"},function(t,e,i){var n,o;n=[i,e,i(49),i(1)],void 0===(o=function(t,e,i,n){"use strict";function o(t){var e=0;return void 0!==(new i.UAParser).getResult().device.type&&(e=1),[t[e]]}o.$inject=["$delegate"],Object.defineProperty(e,"__esModule",{value:!0}),e.MdTooltipDirectiveModule=n.module("ziv.MdTooltipDirective",[]).directive("mdTooltip",function(){return{replace:!0,template:'<span style="display:none"></span>',scope:{},link:function(t,e){e.remove(),t.$destroy()}}}).decorator("mdTooltipDirective",o)}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(1)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HelpDirectiveModule=i.module("zivver.HelpDirective",[]).directive("help",function(){return{replace:!1,template:'\n<md-icon>help_outline</md-icon>\n<md-tooltip md-direction="left" md-delay="200"><ng-transclude></ng-transclude></md-tooltip>\n',transclude:!0}})}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(1),i(236),i(238)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ZivverExternalsModule=i.module("zivver.external",["cfp.hotkeys","ngFileUpload"])}.apply(e,n))||(t.exports=o)},,,,function(t,e,d){var i,n;i=[d,e,d(1),d(240),d(249),d(80),d(257),d(273),d(195),d(277),d(285),d(53),d(293)],void 0===(n=function(t,e,i,n,o,s,r,a,c,l,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AuthModule=i.module("zivver.auth",[r.LoginModule.name,a.LogoutModule.name,l.SignupModule.name,n.BusinessSignupModule.name,o.ForgotPasswordModule.name,p.VersionModule.name,s.LanguageSelectModule.name,c.ShowPasswordDirectiveModule.name,u.TopicusModule.name]).config(["$stateProvider",function(t){t.state("_auth_layout",{template:d(294),data:{authorizationRequired:!1,bodyClass:"auth"}})}])}.apply(e,i))||(t.exports=n)},function(t,e,r){var i,n;i=[r,e,r(1),r(241),r(245),r(246)],void 0===(n=function(t,e,i,n,o){"use strict";function s(t){return t.forgetMe()}s.$inject=["AuthSessionService"],Object.defineProperty(e,"__esModule",{value:!0}),e.BusinessSignupModule=i.module("auth.business-signup",[o.BusinessSignupControllerModule.name,n.BusinessCreateControllerModule.name]),e.BusinessSignupModule.config(["$stateProvider",function(t){t.state({abstract:!0,parent:"_auth_layout",name:"_business-signup",url:"/signup/business",template:"<ui-view></ui-view>",resolve:{logoutExistingUser:s}}),t.state({parent:"_business-signup",name:"business-signup",url:"?{email}&{code}",templateUrl:r(247),controller:o.BusinessSignupController,controllerAs:"$ctrl",data:{title:"Sign up"},params:{email:{squash:!0,default:void 0},code:{squash:!0,default:void 0}}}),t.state({parent:"_business-signup",name:"business-signup-create",url:"/create/:token?theme",templateUrl:r(248),controller:n.BusinessCreateController,controllerAs:"$ctrl",data:{title:"Account creation"},params:{theme:{squash:!0,default:void 0}}})}])}.apply(e,i))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(1),i(6),i(79),i(38)],void 0===(o=function(t,e,i,u,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=(s.LOADING="LOADING",s.CREATE_ACCOUNT="CREATE_ACCOUNT",s.CREATE_ORGANIZATION="CREATE_ORGANIZATION",s.VERIFY_DETAILS="VERIFY_DETAILS",s.CANCEL="CANCEL",s.DONE="DONE",s.ERROR="ERROR",s);function s(){}var r=(a.$inject=["$rootScope","$scope","$log","$state","$stateParams","$translate","BusinessSignupService","LegalDocumentsService","LoginService"],a.prototype.onCreateAccountSubmit=function(){this.createAccountForm.$invalid||(this.formValues.password=this.createAccountForm.password.$viewValue,this.formValues.passwordAgain=this.createAccountForm.passwordAgain.$viewValue,this.substate=p.CREATE_ORGANIZATION)},a.prototype.onCreateBusinessBack=function(){this.substate=p.CREATE_ACCOUNT},a.prototype.onCreateBusinessSubmit=function(){this.createBusinessForm.$invalid||(this.substate=p.VERIFY_DETAILS)},a.prototype.onVerifyDetailsBack=function(){this.formValues.tos=!1,this.substate=p.CREATE_ORGANIZATION},a.prototype.onVerifyDetailsSubmit=function(){var e=this;this.substate=p.LOADING;var t={administrator:{name:this.formValues.accountOwnerFullName,password:this.formValues.password},features:this.features,legalDocumentSetId:this.activeLegalDocumentSet.id,organization:{ein:this.formValues.ein,name:this.formValues.businessName},token:this.token};this.BusinessSignupService.create(t).then(function(){e.substate=p.DONE}).catch(function(t){e.substate=p.ERROR,t.status===u.HTTP_GONE?e.error="AUTH.SIGNUP.CREATE.ERRORS.TOKENEXPIRED":(e.$log.warn("signup failed",{error:t}),e.error="AUTH.SIGNUP.CREATE.ERRORS.GENERICERROR")})},a.prototype.onLogin=function(){var t=this;this.substate=p.LOADING;var e=this.LoginService.login(this.email,this.formValues.password),i={};void 0!==this.$stateParams.theme&&(i={afterComplete:{stateName:"settings.specials",stateParams:{}}}),e.then(function(){return t.$state.go("organization.overview",i,{location:"replace"})})},a.prototype.showLegalDocument=function(e){return null!==this.activeLegalDocumentSet&&1===this.activeLegalDocumentSet.documents.filter(function(t){return t.legalDocumentType===e}).length},a.prototype.getLegalDocumentLink=function(e){var t=this.activeLegalDocumentSet.documents.filter(function(t){return t.legalDocumentType===e});if(1!==t.length)throw Error("Could not find "+e+" in documentSet");return t[0].uri},a);function a(n,o,t,e,i,s,r,a,c){var l=this;this.$rootScope=n,this.$scope=o,this.$log=t,this.$state=e,this.$stateParams=i,this.$translate=s,this.BusinessSignupService=r,this.LegalDocumentsService=a,this.LoginService=c,this.error=null,this.substate=p.LOADING,this.formValues={},this.email=null,this.features=[],this.legalDocumentSets=[],this.activeLegalDocumentSet=null,this.token=i.token,this.BusinessSignupService.validate(this.token).then(function(t){l.email=t.email,l.features=t.features,l.legalDocumentSets=t.legalDocumentSets,l.subscription=t.subscription,l.substate=p.CREATE_ACCOUNT,l.formValues.tos=!1;var e=l.$translate.use()||"en";l.activeLegalDocumentSet=l.LegalDocumentsService.findLegalDocumentSet(l.legalDocumentSets,"business",e,!1);var i=n.$on("$translateChangeSuccess",function(t,e){l.activeLegalDocumentSet=l.LegalDocumentsService.findLegalDocumentSet(l.legalDocumentSets,"business",e.language,!1)});o.$on("$destroy",i)}).catch(function(t){t.status===u.HTTP_GONE?l.error=".ERRORS.TOKENEXPIRED":(l.$log.error("Error validating signup",{error:t}),l.error=".ERRORS.GENERICERROR"),l.substate=p.ERROR})}e.BusinessCreateController=r,e.BusinessCreateControllerModule=i.module("auth.business-signup.BusinessCreateController",[n.PasswordComponentModule.name,o.PasswordStrengthDirectiveModule.name])}.apply(e,n))||(t.exports=o)},function(t,e,i){},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/PasswordComponent.a861fd.html"},function(t,e,i){var n,o;n=[i,e,i(1)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.FORM="FORM",o.DONE="DONE",o.ERROR="ERROR",o);function o(){}var s=(r.$inject=["$log","$stateParams","BusinessSignupService"],r.prototype.onSubmit=function(){var e=this;this.form.$invalid||(this.submittingForm=!0,this.BusinessSignupService.signup(this.formValues.code,this.formValues.email).then(function(){e.substate=n.DONE}).catch(function(t){e.errorTitle=".FAILEDTITLE",e.error=".FAILED",e.substate=n.ERROR,e.$log.warn("Error signing up",{error:t})}))},r);function r(t,e,i){this.$log=t,this.$stateParams=e,this.BusinessSignupService=i,this.formValues={},this.error=!1,this.errorTitle=!1,this.submittingForm=!1,this.substate=n.FORM,void 0!==e.email&&(this.formValues.email=e.email),void 0!==e.code&&(this.formValues.code=e.code)}e.BusinessSignupController=s,e.BusinessSignupControllerModule=i.module("auth.business-signup.BusinessSignupController",[])}.apply(e,n))||(t.exports=o)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/business-signup.36d690.html"},function(t,e,i){t.exports=i.p+"assets/tpl/business-create.915f36.html"},function(t,e,s){var i,n;i=[s,e,s(1),s(250),s(251),s(252)],void 0===(n=function(t,e,i,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ForgotPasswordModule=i.module("auth.forgotPassword",[n.ForgotPasswordControllerModule.name,o.ResetPasswordControllerModule.name]),e.ForgotPasswordModule.config(["$stateProvider",function(t){t.state({parent:"_auth_layout",name:"forgot-password",url:"/forgot-password?email",templateUrl:s(253),controller:n.ForgotPasswordController,controllerAs:"$ctrl",data:{title:"Forgot password"},params:{email:{squash:!0,default:void 0}}}),t.state({parent:"_auth_layout",name:"forgot-password-reset",url:"/forgot-password/reset/:token",templateUrl:s(254),controller:o.ResetPasswordController,controllerAs:"$ctrl",data:{}})}])}.apply(e,i))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(1)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$stateParams","PasswordService"],o.prototype.submitForm=function(){var t=this;this.substate="LOADING",this.PasswordService.initForget(this.formValues.username).then(function(){t.substate="FINISH"}).catch(function(){t.substate="ERROR"})},o);function o(t,e){this.PasswordService=e,this.substate="FORM",this.formValues={},this.formValues.username=t.email}e.ForgotPasswordController=n,e.ForgotPasswordControllerModule=i.module("auth.forgot-password.ForgotPasswordController",[])}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(1),i(10),i(6),i(38)],void 0===(o=function(t,e,i,c,l,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(s.$inject=["$log","$scope","$timeout","$state","$mdMedia","$translate","PasswordService"],s.prototype.resetPassword=function(){var e=this;return this.password=this.form.password.$viewValue,this.substate=u.LOADING,this.submittingForm=!0,this.PasswordService.resetPassword(this.formValues.token,this.password,this.formValues.recoveryCode).then(function(){e.substate=u.FINISH}).catch(function(t){switch(t.status){case l.HTTP_FORBIDDEN:e.substate=u.RECOVERY,e.$timeout(function(){e.form.recoveryCode.$setValidity("codeInvalid",!1),e.form.recoveryCode.$setDirty()},100,!0);break;case l.HTTP_CONFLICT:case l.HTTP_GONE:e.substate=u.EXPIRED;break;default:e.$log.error("unexpected error resetting password",{error:t}),e.substate=u.ERROR}}).finally(function(){e.submittingForm=!1})},s.prototype.nextStep=function(){!0===this.noRecoverySent?this.resetPassword():this.substate=u.RECOVERY},s.prototype.toggleSkipRecovery=function(){this.formValues.recoveryCode=void 0,this.form.recoveryCode.$setPristine(),this.form.recoveryCode.$setValidity("codeInvalid",!0),this.form.recoveryCode.$setValidity("codeInvalidLength",!0)},s);function s(t,e,i,n,o,s,r){var a=this;this.$log=t,this.$scope=e,this.$timeout=i,this.$state=n,this.$mdMedia=o,this.$translate=s,this.PasswordService=r,this.substate=u.LOADING,this.resetInfo=null,this.formValues={},this.noRecoverySent=!1,this.skipRecovery=!1,this.submittingForm=!1,this.formValues.token=this.$state.params.token,null!==this.formValues.token?(this.PasswordService.validateResetToken(this.formValues.token).then(function(t){a.resetInfo=t,void 0===a.resetInfo.recoverySent?a.noRecoverySent=!0:a.resetInfo.recoverySent=c(a.resetInfo.recoverySent).format("ddd D MMM YYYY HH:mm"),a.substate=u.FORM}).catch(function(t){t.status===l.HTTP_CONFLICT||t.status===l.HTTP_GONE?a.substate=u.EXPIRED:(a.substate=u.ERROR,a.$log.error("Error resetting password",{error:t}))}),this.$timeout(function(){a.$scope.$watch(function(){return a.formValues.recoveryCode},function(t){void 0!==t&&(a.form.recoveryCode.$setValidity("codeInvalid",!0),a.formValues.recoveryCode=t.replace(/\s+/g,""),0===t.length||25===t.length?a.form.recoveryCode.$setValidity("codeInvalidLength",!0):a.form.recoveryCode.$setValidity("codeInvalidLength",!1),a.skipRecovery=!1)}),a.$scope.$watch(function(){return a.$translate.use()},function(t){a.supportUrl="https://docs.zivver.com/"+t+"/references/general/recovery-code.html"})})):this.substate=u.ERROR}e.ResetPasswordController=o;var u=(r.LOADING="LOADING",r.FORM="FORM",r.RECOVERY="RECOVERY",r.FINISH="FINISH",r.ERROR="ERROR",r.EXPIRED="EXPIRED",r);function r(){}e.ResetPasswordControllerModule=i.module("auth.forgot-password.ResetPasswordController",[n.PasswordStrengthDirectiveModule.name])}.apply(e,n))||(t.exports=o)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/forgot-password.c43f22.html"},function(t,e,i){t.exports=i.p+"assets/tpl/reset-password.d5def2.html"},function(t,e,i){},function(t,e){t.exports='<label> <md-icon>language</md-icon> </label> <md-select ng-model=$ctrl.language aria-label="Choose language"> <md-option ng-repeat="(key, lang) in ::$ctrl.availableLanguages" ng-value=key>{{lang}}</md-option> </md-select> '},function(t,e,p){var i,n;i=[p,e,p(1),p(258),p(259),p(260),p(261),p(262),p(263),p(5),p(264),p(267)],void 0===(n=function(t,e,i,n,o,s,r,a,c,l,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LoginModule=i.module("auth.login",[s.LoginControllerModule.name,r.LoginErrorControllerModule.name,o.ExtraFactorControllerModule.name,a.SsoControllerModule.name,n.AuthorizeControllerModule.name,u.PasswordChangeModule.name,c.OAuthControllerModule.name]),e.LoginModule.config(["$stateProvider",function(t){t.state({parent:"_auth_layout",name:"login",url:"/login",template:p(268),controller:s.LoginController,controllerAs:"$ctrl",data:{title:"Log in to ZIVVER",bodyClass:"auth login"},params:{recipient:null,username:null}}),t.state({parent:"_auth_layout",name:"login-extra-factor",url:"/login/extra-factor",templateUrl:p(269),controller:o.ExtraFactorController,controllerAs:"$ctrl",data:{authorizationRequired:!0,bodyClass:"auth extra-factor",scopesRequired:[l.Scopes.FACTORAUTHENTICATOR]}}),t.state({parent:"_auth_layout",name:"login-authorize",url:"/login/authorize?page&code",controller:n.AuthorizeController,controllerAs:"$ctrl",template:'<md-progress-linear md-mode="query"></md-progress-linear>',params:{page:"/conversations/inbox"},data:{authorizationRequired:!1,bodyClass:"auth login-sso login-refresh"}}),t.state({parent:"_auth_layout",name:"login-sso",url:"/login/sso/:token",controller:a.SsoController,controllerAs:"$ctrl",template:p(270),data:{authorizationRequired:!1,bodyClass:"auth login-sso login-refresh"}}),t.state({parent:"_auth_layout",name:"login-forced-password-change",url:"/login/change-password",data:{authorizationRequired:!0,bodyClass:"auth extra-factor",scopesRequired:[l.Scopes.CHANGEPASSWORD]},params:{oldPassword:void 0},resolve:{oldPassword:["$stateParams",function(t){return t.oldPassword}]},template:'<password-change old-password="$resolve.oldPassword"></password-change>'}),t.state({parent:"_auth_layout",name:"login-401",controller:r.LoginErrorController,controllerAs:"$ctrl",templateUrl:p(271),params:{reason:void 0,details:{}}}),t.state({parent:"_auth_layout",name:"oauth-login",url:"/oauth/login?client_id&username&redirect_uri",template:p(272),data:{authorizationRequired:!0},controllerAs:"$ctrl",controller:c.OAuthController})}])}.apply(e,i))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(1),i(6)],void 0===(o=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(s.$inject=["$log","$window","$state","$stateParams","$translate","LoginService","AuthSessionService"],s.prototype.login=function(t){var o=this;return this.AuthSessionService.forgetMe(),this.LoginService.authCodeLogin(t,!1).then(function(t){var e,i=o.$stateParams.page,n={};switch(i){case"conversations/inbox":e="conversation.label";break;case"settings/profile":e="settings.profile";break;case"settings/security":e="settings.security";break;case"support/feedback":return void(o.$window.location.href="https://support.zivver.com/nl/login/authenticate/4?return=/"+o.$translate.use()+"/feedback");default:0===i.indexOf("conversations/open")?n={shareId:i.split("/")[1]}:(o.$log.warn("Unexpected value for `page` param: "+i),e="conversations.label")}o.LoginService.handleLoginResult(t,e,n)}).catch(function(t){t.status===n.HTTP_UNAUTHORIZED&&void 0!==t.data?!1===o.LoginService.check401Response(t.data)&&o.$state.go("login-401",{reason:"CODE_EXPIRED"}):o.$log.error("Error logging in with authorization code",{error:t})})},s);function s(t,e,i,n,o,s,r){this.$log=t,this.$window=e,this.$state=i,this.$stateParams=n,this.$translate=o,this.LoginService=s,this.AuthSessionService=r;var a=this.$stateParams.code;void 0===a&&i.go("_errors.not_found"),this.login(a)}e.AuthorizeController=o,e.AuthorizeControllerModule=i.module("auth.login.AuthorizeController",[])}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(1)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$scope","$log","$state","$timeout","$q","AuthSessionService","MultifactorService","LoginService"],o.prototype.init=function(){var e=this;this.LoginService.isTrustedDevice().then(function(t){if(t)return e.goToLoginDestination();e.MultifactorService.getFactors().then(function(t){if(e.factors=t,0===e.factors.length)return e.$log.error("MFA required but factors list empty"),e.$state.go("logout",{});e.selectFactor(e.factors[0]),e.$timeout(function(){e.substate="FORM"})})})},o.prototype.submitForm=function(){var e=this;if(!this.form.$invalid){var t=this.AuthSessionService.getAccessToken();if(void 0===t)return this.$log.info("cannot yet submit MFA form, accessToken expired. Refreshing first"),void this.LoginService.refresh().then(function(){e.submitForm()}).catch(function(t){e.$log.info("refreshing accessToken for MFA submitForm failed",{error:t})});this.MultifactorService.validateFactor(t,this.activeFactor.id,this.challengeResponse).then(function(t){if(t.mfaRequired)return e.$state.reload();e.AuthSessionService.setScopes(t.scope.split(" ")),e.substate="VALIDATED",e.trustDevice().then(function(){e.$timeout(function(){e.goToLoginDestination()},2e3,!1)})},this.validationError.bind(this))}},o.prototype.changeFactor=function(){this.nextFactor.id!==this.activeFactor.id&&this.selectFactor(this.nextFactor),this.substate="FORM"},o.prototype.chooseOtherFactor=function(){this.form.$setPristine(),this.challengeResponse=null,this.nextFactor=this.activeFactor,this.substate="CHOOSE-OTHER-METHOD"},o.prototype.validationError=function(){this.form.challengeResponse.$setValidity("validationResult",!1)},o.prototype.selectFactor=function(t){void 0!==this.activeFactor&&t.id===this.activeFactor.id||((this.activeFactor=t).isSms()?(this.sendSMScode(),this.icon="ziv:verification-sms",this.codeLabel="AUTH.LOGIN.EXTRAFACTOR.FORM.SMS.LABEL"):t.isTotp()?(this.icon="ziv:verification-app",this.codeLabel="AUTH.LOGIN.EXTRAFACTOR.FORM.TOTP.LABEL"):this.$log.error("Unexpected factorType",{factorType:t.factorType}))},o.prototype.sendSMScode=function(){var e=this,t=this.AuthSessionService.getAccessToken();if(void 0===t)return this.$log.info("cannot yet trigger sending SMS, accessToken expired. Refreshing first"),void this.LoginService.refresh().then(function(){e.sendSMScode()}).catch(function(t){e.$log.info("refreshing accessToken for MFA sendSMScode failed",{error:t})});this.MultifactorService.validateFactor(t,this.activeFactor.id).then(function(){e.$log.debug("SMS sent")},function(t){e.$log.warn("Error response after triggering multifactor SMS",{error:t}),e.substate="ERROR",e.error="Unexpected error occurred"})},o.prototype.goToLoginDestination=function(){var t=this.LoginService.getLoginDestination();return this.LoginService.clearLoginDestination(),this.$state.go(t.stateName,t.stateParams,{location:"replace"})},o.prototype.trustDevice=function(){var e=this;return!1===this.trustedDevice?this.$q.resolve():this.LoginService.trustDevice().catch(function(t){e.$log.error("Could not trust device",{error:t})})},o);function o(t,e,i,n,o,s,r,a){var c=this;this.$scope=t,this.$log=e,this.$state=i,this.$timeout=n,this.$q=o,this.AuthSessionService=s,this.MultifactorService=r,this.LoginService=a,this.factors=[],this.substate="LOADING",this.error=null,this.icon=null,this.codeLabel=null,this.hideTrustedDeviceCheckbox=!1,this.username=s.getUsername(),this.trustedDevice=!1,this.init(),this.$scope.$watch(function(){return c.challengeResponse},function(){void 0!==c.form&&c.form.challengeResponse.$setValidity("validationResult",!0)})}e.ExtraFactorController=n,e.ExtraFactorControllerModule=i.module("auth.login.ExtraFactorController",[])}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(1),i(5),i(6),i(52)],void 0===(o=function(t,e,i,n,o,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=(r.$inject=["$http","$injector","$log","$q","$rootScope","$scope","$state","$timeout","$translate","$uiRouterGlobals","$window","AccessRightGrantService","AuthSessionService","LoginService","MessengerService","StorageService"],r.prototype.submitForm=function(){var e=this;this.form.$invalid||(this.error=!1,this.formValues.rememberMe&&this.LoginService.setRememberMe(),this.submittingForm=!0,this.LoginService.login(this.formValues.username,this.formValues.password).then(function(t){return e.loginSuccess(t)}).catch(function(t){return e.loginFailed(t)}))},r.prototype.getLinkInfo=function(){var t=this.StorageService.getItem("LOCAL","topicus");null!==t&&(this.topicus=t)},r.prototype.loginSuccess=function(t){if(this.AccessRightGrantService.clear(),this.AuthSessionService.hasScope(n.Scopes.CHANGEPASSWORD)&&this.AuthSessionService.getScopes().length<=2)this.$state.go("login-forced-password-change",{oldPassword:this.formValues.password});else{var e=this.StorageService.getItem("SESSION","confirm-join",!0);if(null!==e&&e.email===this.formValues.username)return this.$state.go("signup-invite",{token:e.token});if(void 0!==this.topicus&&this.topicus.user===this.formValues.username)return this.$state.go("topicus",{action:"link",user:this.topicus.user,token:this.topicus.token},{location:"replace"});var i=this.LoginService.getLoginDestination();this.LoginService.handleLoginResult(t,i.stateName,i.stateParams)}},r.prototype.loginFailed=function(t){this.submittingForm=!1,t.status===o.HTTP_UNAUTHORIZED?!1===this.LoginService.check401Response(t.data)&&(this.error=".ERRORS.CREDENTIALS"):0===t.status||(this.error=".ERRORS.BADREQUEST")},r.prototype.checkAddressForSaml=function(t){var i=this;void 0!==this.abortSsoCheck&&(this.abortSsoCheck(),this.abortSsoCheck=void 0);var e={authenticationRequired:!1,params:{email_address:t},timeout:this.$q(function(t){i.abortSsoCheck=t})};this.$http.get("/api/sso/saml",e).then(function(e){e.data.forceRedirect?i.openRedirectUrl(e.data.redirectUrl):i.$translate(["AUTH.LOGIN.SSO.CONFIRM.TEXT","AUTH.LOGIN.SSO.CONFIRM.SAML","AUTH.LOGIN.SSO.CONFIRM.PASSWORD"]).then(function(t){i.MessengerService.confirm(t["AUTH.LOGIN.SSO.CONFIRM.TEXT"],"",{},t["AUTH.LOGIN.SSO.CONFIRM.SAML"],t["AUTH.LOGIN.SSO.CONFIRM.PASSWORD"],!1).then(function(){i.openRedirectUrl(e.data.redirectUrl)},function(){i.$window.document.getElementById("password").focus()})})}).catch(function(t){t.status===o.HTTP_NOT_FOUND||i.$log.error("Unexpected error checking /sso/saml",{error:t})})},r.prototype.openRedirectUrl=function(t){this.$window.location.href=t},r);function r(t,e,i,n,o,s,r,a,c,l,u,p,d,h,f,v){var m=this;this.$http=t,this.$injector=e,this.$log=i,this.$q=n,this.$rootScope=o,this.$scope=s,this.$state=r,this.$timeout=a,this.$translate=c,this.$uiRouterGlobals=l,this.$window=u,this.AccessRightGrantService=p,this.AuthSessionService=d,this.LoginService=h,this.MessengerService=f,this.StorageService=v,this.formValues={},this.submittingForm=!1,this.error=!1,this.expiration=g.SESSION_EXPIRATION_DAYS,this.formValues.username=this.$uiRouterGlobals.params.username,void 0!==this.$uiRouterGlobals.params.recipient&&(this.formValues.username=this.$uiRouterGlobals.params.recipient),this.$scope.$watch(function(){return m.formValues.username},function(t){null!=t&&""!==t&&m.$timeout(function(){m.checkAddressForSaml(t)},50,!1)}),this.getLinkInfo()}e.LoginController=s,e.LoginControllerModule=i.module("auth.login.LoginController",[])}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(1)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$state","AuthSessionService"],o);function o(t,e){this.$state=t,this.AuthSessionService=e,this.reason=t.params.reason,this.details=t.params.details,this.details.username=this.AuthSessionService.getUsername(),this.translateNs="AUTH.LOGIN-401."+this.reason}e.LoginErrorController=n,e.LoginErrorControllerModule=i.module("auth.login.LoginErrorController",[])}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(1),i(6)],void 0===(o=function(t,e,i,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$http","$log","$q","$scope","$state","$stateParams","AuthSessionService","LoginService","StorageService"],o.prototype.submitForm=function(){var e=this;this.submittingForm=!0,this.adoptToken(this.token,this.formValues.password).then(function(t){if(t.status===r.HTTP_OK)return e.login(e.token);t.status===r.HTTP_FORBIDDEN?e.form.password.$setValidity("validationResult",!1):t.status===r.HTTP_GONE?e.setError("GONE"):e.setError()}).catch(function(t){e.setError(),e.$log.warn("Uncaught error submitting SSO form",{error:t})}).finally(function(){e.submittingForm=!1})},o.prototype.checkAdoption=function(e){var i=this,t=this.adoptToken(e);t.then(function(t){if(t.status===r.HTTP_OK)return i.login(e);switch(t.status){case r.HTTP_NOT_FOUND:case r.HTTP_CONFLICT:i.submittingForm=!1,i.subState="FORM",i.username=t.data.email;break;case r.HTTP_GONE:i.setError("GONE");break;default:i.setError()}}),t.catch(function(){i.setError()})},o.prototype.getLinkInfo=function(){var t=this.StorageService.getItem("LOCAL","topicus");null!==t&&(this.topicus=t)},o.prototype.login=function(t){var i=this,e=this.LoginService.getLoginDestination();return this.LoginService.ssoLogin(t).then(function(t){if(void 0!==i.topicus)return i.StorageService.removeItem("LOCAL","topicus"),void 0!==i.topicus.draft?i.$state.go("drafts.edit",{draftId:i.topicus.draft,label:i.topicus.label},{location:"replace"}):i.$state.go("conversations.label",{label:i.topicus.label},{location:"replace"});i.LoginService.handleLoginResult(t,e.stateName,e.stateParams)}).catch(function(t){var e=!1;if(t.status===r.HTTP_UNAUTHORIZED)e=i.LoginService.check401Response(t.data);else if(t.status===r.HTTP_NOT_FOUND&&i.AuthSessionService.isAuthenticated())return i.$state.go("conversations.index");!1===e&&(i.setError(),i.$log.error("Error logging in with SSO",{error:t}))})},o.prototype.adoptToken=function(t,e){var n=this,o={authenticationRequired:!1},s={samlResponseJwt:t};return void 0!==e&&(s.password=e),this.$q(function(e,i){return n.$http.put("/api/sso/saml/adopt_saml_key",s,o).then(function(t){e(t)}).catch(function(t){-1<[r.HTTP_CONFLICT,r.HTTP_NOT_FOUND,r.HTTP_FORBIDDEN,r.HTTP_GONE].indexOf(t.status)?e(t):(n.$log.error("Unexpected error in SsoController::adoptToken",{error:t}),i(t))})})},o.prototype.setError=function(t){void 0===t&&(t="ERROR"),this.subState="ERROR",this.error=t},o);function o(t,e,i,n,o,s,r,a,c){var l=this;this.$http=t,this.$log=e,this.$q=i,this.$scope=n,this.$state=o,this.$stateParams=s,this.AuthSessionService=r,this.LoginService=a,this.StorageService=c,this.formValues={},this.subState="LOADING",this.token=this.$stateParams.token,this.getLinkInfo(),this.checkAdoption(this.token),this.$scope.$watch(function(){return l.formValues},function(){void 0!==l.form&&l.form.password.$setValidity("validationResult",!0)},!0)}e.SsoController=n,e.SsoControllerModule=i.module("auth.login.SsoController",[])}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(1)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$window","$state","$stateParams","AuthSessionService","LoginService"],o);function o(t,e,i,n,o){var s=n.getUsername(),r=(i.username||"").toLowerCase();if(n.isAuthenticated()&&s!==r&&""!==r)return n.forgetMe(),o.setLoginDestination(e.current.name,i),void e.go("login",{username:r});var a=t.document.getElementById("oAuthForm");a.action="/api/authentication/authorize",a.querySelectorAll("input[name=client_id]")[0].value=i.client_id,a.querySelectorAll("input[name=zivver_refresh_token]")[0].value=n.getRefreshToken(),a.querySelectorAll("input[name=redirect_uri]")[0].value=i.redirect_uri,a.submit()}e.OAuthController=n,e.OAuthControllerModule=i.module("auth.login.OAuthController",[])}.apply(e,n))||(t.exports=o)},function(t,e,r){var i,n;i=[r,e,r(1),r(6),r(265)],void 0===(n=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(s.$inject=["$scope","$http","$state","$mdDialog","$translate","AuthSessionService","LoginService","PasswordService"],s.prototype.$onInit=function(){var t=this;this.passwords.old=this.oldPassword,this.$scope.$watch(function(){return t.passwords.old},function(){void 0!==t.form&&void 0!==t.form.oldPassword&&t.form.oldPassword.$setValidity("passwordIncorrect",!0)})},s.prototype.updatePassword=function(){var e=this;if(this.passwords.next=this.form.password.$viewValue,this.passwords.old!==this.passwords.next)this.sending=!0,this.PasswordService.changePassword(this.passwords.old,this.passwords.next).then(function(){e.AuthSessionService.forgetMe(),e.LoginService.login(e.username,e.passwords.next).then(function(){var t=e.LoginService.getLoginDestination();return e.LoginService.clearLoginDestination(),e.$state.go(t.stateName,t.stateParams,{location:"replace"})})}).catch(function(t){e.sending=!1,t.status===n.HTTP_UNAUTHORIZED&&e.form.oldPassword.$setValidity("passwordIncorrect",!1)});else{var t=this.$mdDialog.alert().textContent(this.$translate.instant("password-change.NEW-PASSWORD-EQUALS-OLD")).ok(this.$translate.instant("MAIN.OK"));this.$mdDialog.show(t)}},s);function s(t,e,i,n,o,s,r,a){this.$scope=t,this.$http=e,this.$state=i,this.$mdDialog=n,this.$translate=o,this.AuthSessionService=s,this.LoginService=r,this.PasswordService=a,this.passwords={old:void 0,next:void 0},this.sending=!1,this.username=this.AuthSessionService.getUsernameFromLocalStorage()}e.PasswordChangeModule=i.module("components.passwordChange",[]).component("passwordChange",{bindings:{oldPassword:"<"},controller:o,templateUrl:r(266)})}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/PasswordChange.85c473.html"},function(t,e,i){},function(t,e){t.exports='<form name=$ctrl.form class=login novalidate ng-submit=$ctrl.submitForm() translate-namespace=AUTH.LOGIN> <h2 class=md-headline> <translate>.TITLE</translate> </h2> <h3 class=md-subhead> <translate>.SUBTITLE</translate> </h3> <div class=warning ng-show="$ctrl.error !== false" ng-class="{ \'warning-show\' : $ctrl.error !== false }"> <md-icon>warning</md-icon> <translate ng-if="$ctrl.error !== false">{{$ctrl.error}}</translate> </div> <md-input-container class=input-icon-label md-is-error="!$ctrl.form.username.$pristine && $ctrl.form.username.$invalid"> <md-icon class=md-primary>mail</md-icon> <label for=username> <translate>.FORM.EMAIL.LABEL</translate> </label> <input type=email id=username name=username required tabindex=0 md-autofocus md-no-asterisk autocomplete=off ng-model=$ctrl.formValues.username ng-model-options="{ updateOn: \'default blur\', debounce: { \'default\': 500, \'blur\': 0 } }" placeholder=" "/> <div ng-messages=$ctrl.form.username.$error> <div ng-message=required translate>.FORM.EMAIL.ERRORS.REQUIRED</div> <div ng-message=email translate>.FORM.EMAIL.ERRORS.EMAIL</div> </div> </md-input-container> <md-input-container class=input-icon-label md-is-error="$ctrl.form.password.$dirty && $ctrl.form.password.$invalid"> <md-icon class=md-primary>lock</md-icon> <label for=password> <translate>.FORM.PASSWORD.LABEL</translate> </label> <input type=password id=password name=password required ng-model=$ctrl.formValues.password md-no-asterisk placeholder=" " autocomplete=current-password /> <show-password password=password></show-password> </md-input-container> <div class=actions> <md-checkbox ng-model=$ctrl.formValues.rememberMe ng-model-options="{ updateOn: \'default\', debounce: { \'default\': 0 } }" aria-label="Remember me" class=md-primary> <translate translate-value-expiration="{{ $ctrl.expiration}}">.FORM.REMEMBERME.LABEL</translate> </md-checkbox> <md-button type=submit class="md-raised md-primary" ng-disabled="$ctrl.submittingForm || $ctrl.form.$invalid"> <translate>.FORM.SUBMIT.LABEL</translate> </md-button> </div> <div class=warning ng-show=$ctrl.formValues.rememberMe ng-class="{ \'warning-show\' : $ctrl.formValues.rememberMe }"> <md-icon>warning</md-icon> <translate>.FORM.REMEMBERME.WARNING</translate> </div> <div class=secondary-links> <span class=forgot-password> <a ui-sref="forgot-password({email: $ctrl.formValues.username})" translate>.ACTIONS.FORGOTPASSWORD</a> </span> <span class=signup> <a ui-sref="signup({email: $ctrl.formValues.username})" translate>.ACTIONS.SIGNUP</a> </span> </div> </form> '},function(t,e,i){t.exports=i.p+"assets/tpl/extraFactor.09d342.html"},function(t,e){t.exports='<div translate-namespace=AUTH.LOGIN.SSO> <div class=loader ng-if="$ctrl.subState === \'LOADING\'"> <md-progress-linear md-mode=query></md-progress-linear> </div> <div ng-if="$ctrl.subState === \'ERROR\'"> <p translate>{{ \'.\' + $ctrl.error }}</p> </div> <form name=$ctrl.form class=login novalidate ng-if="$ctrl.subState === \'FORM\'" ng-submit=$ctrl.submitForm()> <h2 class=md-headline> <translate>.TITLE</translate> </h2> <h3 class=md-subhead> <translate translate-value-username="{{ $ctrl.username }}">.SUBTITLE</translate> </h3> <p class=intro translate> .INTRO </p> <md-input-container class=input-icon-label md-is-error="!$ctrl.form.password.$pristine && $ctrl.form.password.$invalid"> <md-icon class=md-primary>lock</md-icon> <label for=password> <translate>.FORM.PASSWORD.LABEL</translate> </label> <input type=password id=password name=password required ng-model=$ctrl.formValues.password md-no-asterisk placeholder=" "/> <show-password password=password></show-password> <div ng-messages=$ctrl.form.password.$error> <div ng-message=required translate>.FORM.PASSWORD.REQUIRED</div> <div ng-message=validationResult translate>.FORM.PASSWORD.INVALID</div> </div> </md-input-container> <div class=actions> <span flex></span> <md-button type=submit class="md-raised md-primary" ng-disabled="$ctrl.submittingForm || $ctrl.form.$invalid"> <translate>.ACTIONS.SUBMIT</translate> </md-button> </div> </form> </div> '},function(t,e,i){t.exports=i.p+"assets/tpl/login-401.03f49c.html"},function(t,e){t.exports="<form id=oAuthForm enctype=application/x-www-form-urlencoded method=post> <input type=hidden name=response_type value=code /> <input type=hidden name=client_id /> <input type=hidden name=zivver_refresh_token /> <input type=hidden name=redirect_uri /> </form> "},function(t,e,o){var i,n;i=[o,e,o(1),o(274)],void 0===(n=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LogoutModule=i.module("auth.logout",[n.LogoutControllerModule.name]),e.LogoutModule.config(["$stateProvider",function(t){t.state("logout",{parent:"_auth_layout",controller:n.LogoutController,controllerAs:"$ctrl",templateUrl:o(275),data:{authorizationRequired:!1},params:{serverLogout:!0,message:"DEFAULT"}})}])}.apply(e,i))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(1),i(5)],void 0===(o=function(t,e,i,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$rootScope","$stateParams","$scope","AuthSessionService","LoginService"],o);function o(t,e,i,n,o){this.message=e.message;var s=n.getAccessToken();n.forgetMe(),e.serverLogout&&void 0!==s&&o.logout(s),t.$broadcast(r.AuthEvents.logoutSuccess),i.$on("$destroy",function(){window.location.reload()})}e.LogoutController=n,e.LogoutControllerModule=i.module("auth.logout.LogoutController",[])}.apply(e,n))||(t.exports=o)},function(t,e,i){t.exports=i.p+"assets/tpl/index.d4fe84.html"},function(t,e,i){},function(t,e,a){var i,n;i=[a,e,a(1),a(278),a(279),a(280),a(281)],void 0===(n=function(t,e,i,n,o,s){"use strict";function r(t){return t.forgetMe()}r.$inject=["AuthSessionService"],Object.defineProperty(e,"__esModule",{value:!0}),e.SignupModule=i.module("auth.signup",[n.SignupControllerModule.name,o.CreateControllerModule.name,s.InviteControllerModule.name]),e.SignupModule.config(["$stateProvider",function(t){t.state({abstract:!0,parent:"_auth_layout",name:"_signup",url:"/signup",template:"<ui-view></ui-view>"}),t.state({parent:"_signup",name:"signup",url:"?{email}",templateUrl:a(282),controller:n.SignupController,controllerAs:"$ctrl",data:{title:"Sign up for ZIVVER, for free  "},params:{email:{squash:!0,default:void 0}},resolve:{logoutExistingUser:r}}),t.state({parent:"_signup",name:"signup-create",url:"/create/:token?theme",params:{theme:{squash:!0,default:void 0}},templateUrl:a(283),controller:o.CreateController,controllerAs:"$ctrl",resolve:{logoutExistingUser:r}}),t.state({parent:"_signup",name:"signup-invite",url:"/invite/:token?theme",params:{theme:{squash:!0,default:void 0}},templateUrl:a(284),controller:s.InviteController,controllerAs:"$ctrl"})}])}.apply(e,i))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(1)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$log","$stateParams","SignupService"],o.prototype.submitForm=function(){var e=this;this.form.$invalid||(this.submittingForm=!0,this.SignupService.signup(this.formValues.email).then(function(){e.substate=s.DONE}).catch(function(t){e.errorTitle=".FAILEDTITLE",e.error=".FAILED",e.substate=s.ERROR,e.$log.warn("Error signing up",{error:t})}))},o);function o(t,e,i){this.$log=t,this.$stateParams=e,this.SignupService=i,this.formValues={},this.error=!1,this.errorTitle=!1,this.submittingForm=!1,this.substate=s.FORM,void 0!==e.email&&(this.formValues.email=e.email)}e.SignupController=n;var s=(r.FORM="FORM",r.DONE="DONE",r.ERROR="ERROR",r);function r(){}e.SignupControllerModule=i.module("auth.signup.SignupController",[])}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(1),i(6),i(79),i(38)],void 0===(o=function(t,e,i,p,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=(s.LOADING="LOADING",s.CREATE="CREATE",s.CANCEL="CANCEL",s.DONE="DONE",s.ERROR="ERROR",s);function s(){}var r=(a.$inject=["$rootScope","$scope","$log","$state","$stateParams","$translate","SignupService","LegalDocumentsService","LoginService","StorageService"],a.prototype.submitCreate=function(){this.form.$invalid||this.activate()},a.prototype.activate=function(){var e=this;this.substate=d.LOADING,this.formValues.password=this.form.password.$viewValue;var t={accountType:"personal",fullName:this.formValues.fullName,password:this.formValues.password,token:this.token,acceptLegalDocumentSet:this.activeLegalDocumentSet.id};this.SignupService.create(t).then(function(){e.substate=d.DONE}).catch(function(t){e.substate=d.ERROR,t.status===p.HTTP_GONE?e.error="AUTH.SIGNUP.CREATE.ERRORS.TOKENEXPIRED":(e.$log.warn("signup failed",{error:t}),e.error="AUTH.SIGNUP.CREATE.ERRORS.GENERICERROR")})},a.prototype.showLegalDocument=function(e){return null!==this.activeLegalDocumentSet&&1===this.activeLegalDocumentSet.documents.filter(function(t){return t.legalDocumentType===e}).length},a.prototype.getLegalDocumentLink=function(e){var t=this.activeLegalDocumentSet.documents.filter(function(t){return t.legalDocumentType===e});if(1!==t.length)throw Error("Could not find "+e+" in documentSet");return t[0].uri},a.prototype.login=function(){var t=this,e=this.LoginService.login(this.email,this.formValues.password),i={};void 0!==this.$stateParams.theme&&(i={afterComplete:{stateName:"settings.specials",stateParams:{}}}),e.then(function(){return void 0!==t.topicus&&t.topicus.user===t.email?t.$state.go("topicus",{action:"link",user:t.topicus.user,token:t.topicus.token},{location:"replace"}):t.$state.go("conversations.label",i,{location:"replace"})})},a.prototype.signup=function(){this.$state.go("signup")},a.prototype.change=function(){this.substate=d.CREATE,this.formValues.tos=!1},a.prototype.passwordStrongAndMatch=function(){return void 0!==this.form.password.$strength&&this.form.password.$viewValue===this.form.passwordAgain.$viewValue&&2<this.form.password.$strength.score},a.prototype.getLinkInfo=function(){var t=this.StorageService.getItem("LOCAL","topicus");null!==t&&(this.topicus=t)},a);function a(n,o,t,e,i,s,r,a,c,l){var u=this;this.$rootScope=n,this.$scope=o,this.$log=t,this.$state=e,this.$stateParams=i,this.$translate=s,this.SignupService=r,this.LegalDocumentsService=a,this.LoginService=c,this.StorageService=l,this.loading=!0,this.error=null,this.substate=d.LOADING,this.formValues={},this.email=null,this.legalDocumentSets=[],this.activeLegalDocumentSet=null,this.token=i.token,r.validate(this.token).then(function(t){u.email=t.emailAddress,u.subscription=t.subscription,u.substate=d.CREATE,u.legalDocumentSets=t.legalDocumentSets;var e=u.$translate.use()||"en";u.activeLegalDocumentSet=u.LegalDocumentsService.findLegalDocumentSet(u.legalDocumentSets,"personal",e,!1);var i=n.$on("$translateChangeSuccess",function(t,e){u.activeLegalDocumentSet=u.LegalDocumentsService.findLegalDocumentSet(u.legalDocumentSets,u.formValues.accountType,e.language,!1)});o.$on("$destroy",i)}).catch(function(t){t.status===p.HTTP_GONE?u.error=".ERRORS.TOKENEXPIRED":(u.$log.error("Error validating signup",{error:t}),u.error=".ERRORS.GENERICERROR"),u.substate=d.ERROR}).finally(function(){u.loading=!1}),this.getLinkInfo()}e.CreateController=r,e.CreateControllerModule=i.module("auth.signup.CreateController",[n.PasswordComponentModule.name,o.PasswordStrengthDirectiveModule.name])}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(1),i(6)],void 0===(o=function(t,e,i,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$rootScope","$scope","$log","$state","$stateParams","$translate","AuthSessionService","SignupService","LegalDocumentsService","StorageService","LoginService"],o.prototype.storeJoinToken=function(){this.StorageService.setItem("SESSION","confirm-join",{token:this.token,email:this.inviteInfo.email})},o.prototype.joinOrganization=function(){var e=this;return this.SignupService.joinOrganization(this.token).then(function(){e.state="JOINED",e.error=void 0,e.AuthSessionService.forgetMe()},function(t){e.state="ERROR",t.status===h.HTTP_GONE?e.error=".ERRORS.GONE":(e.error=".ERRORS.GENERIC",e.$log.error("Signup failed",{error:t}))})},o.prototype.submitForm=function(){var e=this;this.submittingForm=!0;var t=null===this.inviteInfo.fullName?this.formValues.fullName:this.inviteInfo.fullName;this.formValues.password=this.form.password.$viewValue,this.SignupService.acceptInvite(this.token,this.formValues.password,t,this.activeLegalDocumentSet.id).then(function(){e.state="DONE"}).catch(function(t){e.state="ERROR",t.status===h.HTTP_GONE?e.error=".ERRORS.GONE":t.status===h.HTTP_NOT_FOUND?e.error=".ERRORS.UNKNOWN":(e.error=".ERRORS.GENERIC",e.$log.error("Signup failed",{error:t}))}).finally(function(){e.submittingForm=!1})},o.prototype.getLegalDocumentLink=function(e){var t=this.activeLegalDocumentSet.documents.filter(function(t){return t.legalDocumentType===e});if(1!==t.length)throw Error("Could not find "+e+" in documentSet");return t[0].uri},o.prototype.ok=function(){var t=this,e=this.LoginService.login(this.inviteInfo.email,this.formValues.password),i={};void 0!==this.$stateParams.theme&&(i={afterComplete:{stateName:"settings.specials",stateParams:{}}}),e.then(function(){return t.$state.go("conversations.label",i,{location:"replace"})})},o.prototype.goToLogin=function(){return this.$state.go("login",{username:this.inviteInfo.email})},o.prototype.passwordStrongAndMatch=function(){return void 0!==this.form.password.$strength&&this.form.password.$viewValue===this.form.passwordAgain.$viewValue&&2<this.form.password.$strength.score},o);function o(t,e,i,n,o,s,r,a,c,l,u){var p=this;if(this.$rootScope=t,this.$log=i,this.$state=n,this.$stateParams=o,this.$translate=s,this.AuthSessionService=r,this.SignupService=a,this.LegalDocumentsService=c,this.StorageService=l,this.LoginService=u,this.token=null,this.inviteInfo=null,this.legalDocumentSets=[],this.activeLegalDocumentSet=null,this.formValues={},this.submittingForm=!1,this.state="LOADING",this.token=o.token,null===this.token)throw Error("Token is missing");this.SignupService.getInvite(this.token).then(function(t){if(p.inviteInfo=t,"validRegistered"===p.inviteInfo.eligible){if(p.AuthSessionService.getUsername()!==p.inviteInfo.email)return p.AuthSessionService.forgetMe(),p.storeJoinToken(),p.$state.go("login",{username:p.inviteInfo.email});p.joinOrganization().then(function(){p.StorageService.removeItem("SESSION","confirm-join")})}else p.AuthSessionService.forgetMe(),p.state="FORM";var e=p.$translate.use()||"en";p.activeLegalDocumentSet=p.LegalDocumentsService.findLegalDocumentSet(p.inviteInfo.legalDocumentSets,"business",e,!0)},function(t){p.state="ERROR",t.status===h.HTTP_CONFLICT?(p.inviteInfo=t.data,"invalidBecauseAdmin"===p.inviteInfo.eligible?p.error=".ERRORS.ADMIN":"invalidBecauseDomainClaimed"===p.inviteInfo.eligible?p.error=".ERRORS.DOMAIN-CLAIMED":"invalidBecauseFunctional"===p.inviteInfo.eligible?p.error=".ERRORS.FUNCTIONAL":"invalidBecauseSuspended"===p.inviteInfo.eligible?p.error=".ERRORS.SUSPENDED":"invalidAlreadyMember"===p.inviteInfo.eligible?p.error=".ERRORS.ALREADY-MEMBER":"invalidOrganizationCantInvite"===p.inviteInfo.eligible?p.error=".ERRORS.CANNOT-INVITE":"invalidTokenExpired"===p.inviteInfo.eligible&&(p.error=".ERRORS.TOKEN-EXPIRED")):p.error=".ERRORS.GENERIC"});var d=t.$on("$translateChangeSuccess",function(t,e){null!==p.inviteInfo&&(p.activeLegalDocumentSet=p.LegalDocumentsService.findLegalDocumentSet(p.inviteInfo.legalDocumentSets,"business",e.language,!0))});e.$on("$destroy",d)}e.InviteController=n,e.InviteControllerModule=i.module("auth.signup.InviteController",[])}.apply(e,n))||(t.exports=o)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/signup.a7ac95.html"},function(t,e,i){t.exports=i.p+"assets/tpl/create.5af845.html"},function(t,e,i){t.exports=i.p+"assets/tpl/invite.55e888.html"},function(t,e,o){var i,n;i=[o,e,o(1),o(286),o(289)],void 0===(n=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TopicusModule=i.module("auth.topicus",[n.TopicusControllerModule.name]),e.TopicusModule.config(["$stateProvider",function(t){t.state({parent:"_auth_layout",name:"topicus",url:"/topicus?user&action&{token:token}&label&draft",templateUrl:o(290),controller:n.TopicusController,controllerAs:"$ctrl",data:{title:"Link Topicus and ZIVVER accounts "},params:{draft:void 0,label:void 0}})}])}.apply(e,i))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(1),i(5),i(13)],void 0===(o=function(t,e,i,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=(r.$inject=["$log","$mdDialog","$rootScope","$state","$uiRouterGlobals","SsoService","AuthSessionService","StorageService"],r.prototype.proceed=function(){switch(this.action){case"CREATE":this.$state.go("signup",{email:this.user},{location:"replace"});break;case"LOGIN":case"LINK":!1===this.AuthSessionService.isAuthenticated()?this.$state.go("login",{username:this.user}):this.AuthSessionService.getUsername()===this.user?this.linkAccounts():this.switchAccountDialog()}},r.prototype.switchAccountDialog=function(){var t=this,e=o.WarningDialog.factory({explanation:"AUTH.TOPICUS.LOGOUT-DIALOG",explanationParams:{email:this.user,user:this.AuthSessionService.getUsername()},submitText:"MAIN.YES",cancelText:"MAIN.NO",type:o.WarningDialogTypes.error,translate:!0});this.$mdDialog.show(e).then(function(){t.AuthSessionService.forgetMe(),t.$rootScope.$broadcast(n.AuthEvents.logoutSuccess),t.$state.go("login",{username:t.user})})},r.prototype.linkAccounts=function(){var e=this;return this.SsoService.link(this.token).then(function(){e.clearToken()}).catch(function(t){e.$log.warn("linking accounts failed",{error:t})}).finally(function(){return e.$state.go("conversations.label",{},{location:"replace"})})},r.prototype.storeToken=function(){this.StorageService.setItem("LOCAL","topicus",{draft:this.draft,label:this.label,token:this.token,user:this.user})},r.prototype.clearToken=function(){this.StorageService.removeItem("LOCAL","topicus")},r);function r(t,e,i,n,o,s,r,a){this.$log=t,this.$mdDialog=e,this.$rootScope=i,this.$state=n,this.$uiRouterGlobals=o,this.SsoService=s,this.AuthSessionService=r,this.StorageService=a,this.validActions=["CREATE","LOGIN","LINK","REDIRECT"],this.loading=!0;var c=o.params,l=c.action,u=c.draft,p=c.label,d=c.token,h=c.user;0<[l,d,h].filter(function(t){return void 0===t||"true"===t}).length?n.go("_errors.not_found"):(this.action=l.toUpperCase(),this.draft=u,this.label=p,this.token=d,this.user=h,-1!==this.validActions.indexOf(this.action)?(this.storeToken(),"REDIRECT"===this.action&&(this.AuthSessionService.getUsername()===this.user?(this.clearToken(),void 0!==this.draft?this.$state.go("drafts.edit",{draftId:this.draft,label:this.label},{location:"replace"}):this.$state.go("conversations.label",{label:this.label},{location:"replace"})):this.$state.go("login-sso",{token:this.token},{location:"replace"})),this.AuthSessionService.getUsername()===this.user&&(this.action="LINK"),this.loading=!1):n.go("_errors.not_found"))}e.TopicusController=s,e.TopicusControllerModule=i.module("auth.topicus.TopicusController",[])}.apply(e,n))||(t.exports=o)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/WarningDialog.9a27ac.html"},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/topicus.349c9f.html"},function(t,e,i){},function(t,e){t.exports='<span> <md-tooltip ng-if=":: $ctrl.withApi">API {{ $ctrl.api }}, BACKEND: {{ $ctrl.backend }}, BACKEND-API {{ $ctrl.backendApi }}</md-tooltip> v{{:: $ctrl.app }} </span> '},function(t,e,i){},function(t,e){t.exports="<div class=auth translate-cloak> <header> <h1><a ui-sref=login>ZIVVER</a></h1> </header> <main ui-view></main> <footer> <version></version> </footer> </div> <language-select></language-select> "},function(t,e,m){var i,n;i=[m,e,m(1),m(296),m(304),m(5),m(305),m(571),m(605),m(608),m(612),m(615),m(616),m(617),m(618),m(619)],void 0===(n=function(t,e,i,n,o,s,r,a,c,l,u,p,d,h,f){"use strict";function v(e,i,t){return t.get().then(function(t){var e=i.use();return t.language!==e&&i.use(t.language),t}).catch(function(t){e.error("Could not resolve profile in app/index",{error:t})})}v.$inject=["$log","$translate","ProfileService"],Object.defineProperty(e,"__esModule",{value:!0}),e.AppModule=i.module("zivver.app",[n.AppControllerModule.name,c.BackButtonModule.name,r.ConversationsModule.name,a.DraftsModule.name,l.ProfileMenuModule.name,o.RefreshControllerModule.name,u.SidenavModule.name]),e.AppModule.config(["$stateProvider","hotkeysProvider",function(e,t){t.includeCheatSheet=!1,e.state({abstract:!0,name:"_app_layout",resolve:{profile:v},data:{authorizationRequired:!0,scopesRequired:[s.Scopes.LIMITEDACCESS],bodyClass:"app"},template:m(620),controller:n.AppController,controllerAs:"$app"}),e.state({name:"login-refresh",controller:o.RefreshController,controllerAs:"$ctrl",template:m(621),data:{authorizationRequired:!1,bodyClass:"app login-refresh"}}),p.ContactsRoutes.forEach(function(t){return e.state(t)}),h.SettingsRoutes.forEach(function(t){return e.state(t)}),f.SpecialsRoutes.forEach(function(t){return e.state(t)}),d.OrganizationRoutes.forEach(function(t){return e.state(t)})}])}.apply(e,i))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(1),i(5),i(25)],void 0===(o=function(t,e,g,S,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(o.$inject=["$rootScope","$scope","$window","$timeout","$cacheFactory","$state","$transitions","$mdDialog","$translate","AuthSessionService","LoggerService","LoginService","WebSocketService","profile"],o.prototype.filesDropped=function(t){this.$rootScope.$broadcast("files-dropped",t)},o.prototype.toggleSidenav=function(t){void 0!==t&&(t.stopPropagation(),t.preventDefault()),this.$rootScope.$broadcast("sidenav:toggle")},o.prototype.loggedOutReset=function(){for(var t=0,e=Object.keys(this.$cacheFactory.info());t<e.length;t++){var i=e[t];if("templates"===i)break;this.$cacheFactory.get(i).removeAll()}this.LoggerService.resetDefaultContext(),this.WebSocketService.close(),this.profile.isGuest()&&n.unloadTheme()},o.prototype.onNotAuthenticated=function(t){var e=this;if(!this.LoginService.check401Response(t))if(this.AuthSessionService.hasRefreshToken()){var i=this.$mdDialog.alert().textContent(this.$translate.instant("APP.ERROR.LOGGED-OUT-TEMPORARILY")).hasBackdrop(!0).ok(this.$translate.instant("APP.REFRESH"));this.$mdDialog.show(i).then(function(){e.LoginService.setLoginDestination(e.$state.current.name,e.$state.params),e.$state.go("login-refresh")})}else this.$rootScope.$broadcast(S.AuthEvents.logoutSuccess),this.LoginService.setLoginDestination(this.$state.current.name,this.$state.params),this.$state.go("login",{},{location:"replace"})},o.prototype.onLogoutOtherTab=function(t){var e=this,i=this.$mdDialog.confirm().textContent(this.$translate.instant("APP.ERROR.LOGGED-OUT-OTHER-TAB")).hasBackdrop(!0).ok(this.$translate.instant("APP.RE-LOGIN")).cancel(this.$translate.instant("MAIN.CANCEL"));this.$mdDialog.show(i).then(function(){e.$rootScope.$broadcast(S.AuthEvents.logoutSuccess),e.AuthSessionService.forgetMe(),e.LoginService.setLoginDestination(e.$state.current.name,e.$state.params),e.$state.go("login",{username:e.isGuest?null:t},{location:"replace"})},function(){e.$window.location.href="https://www.zivver.com"})},o.prototype.openWebsocket=function(){var t,e=this,i=!1===this.profile.isGuest()&&!1===this.AuthSessionService.isDelegate(),n=i&&void 0!==this.profile.uuid;"visible"===this.$window.document.visibilityState&&(this.WebSocketService.open(),i&&this.WebSocketService.setPresence(this.profile.presence),n&&this.WebSocketService.getPresence(this.profile.uuid)),this.$window.document.addEventListener("visibilitychange",function(){void 0!==t&&e.$timeout.cancel(t),t=e.$timeout(function(){t=void 0,"visible"===e.$window.document.visibilityState?(e.WebSocketService.open(),i&&e.WebSocketService.setPresence(e.profile.presence),n&&e.WebSocketService.getPresence(e.profile.uuid)):e.WebSocketService.close()},6e4,!1)})},o);function o(t,e,i,n,o,s,r,a,c,l,u,p,d,h){var f=this;this.$rootScope=t,this.$scope=e,this.$window=i,this.$timeout=n,this.$cacheFactory=o,this.$state=s,this.$transitions=r,this.$mdDialog=a,this.$translate=c,this.AuthSessionService=l,this.LoggerService=u,this.LoginService=p,this.WebSocketService=d,this.profile=h,this.isGuest=!0,this.isGuest=this.profile.isGuest(),this.LoggerService.addToDefaultContext("accountType",h.accountType),void 0!==h.uuid&&this.LoggerService.addToDefaultContext("accountUuid",h.uuid),e.$on("profile-updated",function(t,e){f.profile.language!==e.profile.language&&f.$translate.use(e.profile.language),f.profile=e.profile}),t.$on(S.AuthEvents.logoutSuccess,function(){f.loggedOutReset()});var v=e.$on(S.AuthEvents.notAuthenticated,function(t,e){v(),f.onNotAuthenticated(e.data)}),m=e.$on(S.AuthEvents.logoutOtherTab,function(t,e){m(),f.onLogoutOtherTab(e.username)});this.$transitions.onStart({},function(t){g.element(document.body).hasClass("md-dialog-is-showing")&&(t.abort(),a.cancel())}),this.$timeout(function(){f.openWebsocket()},1e3)}e.AppController=i,e.AppControllerModule=g.module("zivver.app.AppController",[])}.apply(e,n))||(t.exports=o)},function(t,e,i){t.exports=i.p+"assets/themes/telede/theme.css"},function(t,e,i){t.exports=i.p+"assets/themes/teleecg/theme.css"},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.logoSvg=i(81),e.iconSvg=i(300),e.staticImageUrls={"/assets/themes/telede/intro.svg":i(301)}}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){t.exports=i.p+"assets/themes/img/icon.5f7da1.svg"},function(t,e,i){t.exports=i.p+"assets/themes/img/intro.3e9de0.svg"},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.logoSvg=i(82),e.iconSvg=i(303),e.staticImageUrls={}}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){t.exports=i.p+"assets/themes/img/icon.435cd5.svg"},function(t,e,i){var n,o;n=[i,e,i(1),i(5),i(6)],void 0===(o=function(t,e,i,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=(r.$inject=["$rootScope","$scope","$log","$timeout","$q","$state","$mdDialog","$translate","LoginService","AuthSessionService"],r.prototype.tryAgain=function(){var t=this;this.attempts=0,this.connectionError=!1,this.$rootScope.$broadcast("api::connectionErrorsReset"),this.$rootScope.$applyAsync(function(){return t.refresh()})},r.prototype.loginAgain=function(){var t=this.AuthSessionService.getUsernameFromLocalStorage();this.LoginService.clearLoginDestination(),this.AuthSessionService.forgetMe(),this.$rootScope.$broadcast(n.AuthEvents.logoutSuccess),this.$state.go("login",{username:t})},r.prototype.refresh=function(){var i=this,t=this.LoginService.refresh(!0).then(function(t){return i.attempts=0,i.$timeout.cancel(i.refreshTimeout),t}).catch(function(t){i.refreshFailed(t)}),e=this.$q(function(t){i.$timeout(t,500)});this.$q.all([t,e]).then(function(t){var e=t[0];i.$scope.$$destroyed||i.LoginService.handleLoginResult(e)})},r.prototype.refreshFailed=function(t){var e=this;if(!this.$scope.$$destroyed)if(t.status===o.HTTP_UNAUTHORIZED){if(this.LoginService.check401Response(t.data))return;this.authenticationError=!0}else{var i=5e3+5e3*this.attempts;if(this.$log.debug("Refreshing failed, trying again in "+i/1e3+" seconds"),this.attempts++,5<this.attempts)return void(this.connectionError=!0);this.refreshTimeout=this.$timeout(function(){e.$scope.$$destroyed||e.refresh()},i,!1)}},r);function r(t,e,i,n,o,s,r,a,c,l){this.$rootScope=t,this.$scope=e,this.$log=i,this.$timeout=n,this.$q=o,this.$state=s,this.$mdDialog=r,this.$translate=a,this.LoginService=c,this.AuthSessionService=l,this.authenticationError=!1,this.connectionError=!1,this.attempts=0,this.refresh()}e.RefreshController=s,e.RefreshControllerModule=i.module("app.RefreshController",[])}.apply(e,n))||(t.exports=o)},function(t,e,p){var i,n;i=[p,e,p(1),p(306),p(318),p(435),p(557),p(8),p(563),p(566)],void 0===(n=function(t,e,i,n,o,s,r,a,c){"use strict";function l(e,i,t,n,o,s){if(s.isGuest())return e.resolve(!1);var r=t.shareId;if(!1===o.hasToken(r))return e.resolve(!1);var a=o.getToken(r);return n.verifyAdoptShareToken(a).then(function(t){return!1===t.isAdoptable?e.resolve(!1):n.adoptShareToken(a).then(function(){return o.removeToken(r),e.resolve(!0)}).catch(function(t){return o.removeToken(r),i.error("adopting shareToken failed",{error:t}),e.resolve(!1)})}).catch(function(t){return o.removeToken(r),i.error("verifying shareToken failed",{error:t}),e.resolve(!1)})}function u(n,t,o,s,r){return t(function(e){var t=new a.Label;t.name="inbox",t.isSystemLabel=!0;var i=new a.LabelCollection([t]);if(r.isGuest())return e(i);o.getLabels().then(function(t){s.setLabels(t),e(t)}).catch(function(t){n.warn("Error getting labels",{error:t}),e(i)})})}l.$inject=["$q","$log","$stateParams","KeysService","ShareTokenService","profile"],u.$inject=["$log","$q","LabelService","ConversationsService","profile"],Object.defineProperty(e,"__esModule",{value:!0}),e.ConversationsModule=i.module("app.conversations",[n.IndexControllerModule.name,o.OpenControllerModule.name,s.ViewControllerModule.name,r.ListControllerModule.name,c.ConversationErrorModule.name]),e.ConversationsModule.config(["$stateProvider",function(t){t.state({abstract:!0,parent:"_app_layout",name:"conversations",url:"/conversations",data:{title:"Conversations",bodyClass:"app conversations"},resolve:{labelCollection:u},views:{"list@_app_layout":{template:p(567),controller:r.ListController,controllerAs:"$ctrl"},"main@_app_layout":{template:"<div class='conversations' layout='row' layout-wrap ui-view></div>"}}}),t.state({name:"conversations.label",url:"/{label}?{keywords}",controller:n.IndexController,controllerAs:"$ctrl",template:p(568),params:{keywords:{squash:!0},label:"inbox"},reloadOnSearch:!1}),t.state({name:"conversations.open",url:"/open/{shareId:uuid}?recipient&showInfo&deliverMessageId",controller:o.OpenController,controllerAs:"$ctrl",template:p(569),resolve:{shareTokenAdopt:l},params:{label:"inbox",deliverMessageId:void 0,recipient:{squash:!0}}}),t.state({name:"conversations.view",url:"/{label}/{conversationId:uuid}?{keywords}",controller:s.ViewController,controllerAs:"$ctrl",template:p(570),params:{label:"inbox",keywords:{squash:!0},showInfo:void 0,deliverMessageId:void 0},reloadOnSearch:!1}),t.state({name:"conversations.error",params:{conversation:void 0,share:void 0,error:"UNKNOWN",label:"inbox"},component:"conversationError"}),t.state({name:"conversations.index",url:"/index",onEnter:["$state",function(t){return t.go("conversations.label",{label:"inbox"})}]}),t.state({name:"conversations.view-from-mail",url:"/view/{conversationId:uuid}",params:{reply:null},onEnter:["$state","$stateParams",function(t,e){return t.go("conversations.view",{conversationId:e.conversationId})}]})}])}.apply(e,i))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(1),i(307)],void 0===(o=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(s.$inject=["$stateParams","$mdMedia"],s);function s(t,e){this.$stateParams=t,this.$mdMedia=e,this.label=this.$stateParams.label,"archive"===this.label?this.placeholderItem="archive":"trash"===this.label?this.placeholderItem="trash":this.placeholderItem="conversations"}e.IndexController=o,e.IndexControllerModule=i.module("app.conversations.IndexController",[n.PlaceholderModule.name])}.apply(e,n))||(t.exports=o)},function(t,e,r){var i,n;i=[r,e,r(1),r(18),r(311)],void 0===(n=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(s.$inject=["$state","$mdMedia","AppSwitcherService"],s.prototype.$onInit=function(){this.isSpecial=void 0!==this.AppSwitcherService.getContext().specialId,!1===this.isSpecial&&(this.link=this.$state.href("drafts.create",{}),this.text="."+this.item.toUpperCase(),!1===this.$mdMedia("gt-sm")&&(this.text+="-SMALL"),"conversations"===this.item?this.image=r(312):"archive"===this.item?this.image=r(313):"drafts"===this.item?this.image=r(314):"trash"===this.item?this.image=r(315):0<=this.item.indexOf("contacts")&&(this.image=r(316)))},s);function s(t,e,i){this.$state=t,this.$mdMedia=e,this.AppSwitcherService=i}e.PlaceholderModule=i.module("components.Placeholder",[n.AppSwitcherModule.name]).component("placeholder",{bindings:{item:"<"},controller:o,templateUrl:r(317)})}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/img/app_icon.fa2788.svg"},function(t,e){t.exports='<div ng-if="$ctrl.contexts.length > 1"> <a ng-click=$ctrl.toggleDropdown() class=dropdown-toggle> <img ng-src="{{ $ctrl.current.icon }}" width=40 height=40 /> <md-icon>{{ $ctrl.open ? \'arrow_drop_up\' : \'arrow_drop_down\' }}</md-icon> </a> <div class=dropdown ng-if="$ctrl.open === true"> <ul> <li ng-repeat="$item in $ctrl.contexts track by $index" ng-click=$ctrl.activateContext($item) ng-class="{ active : $item.specialId === $ctrl.current.specialId }"> <img ng-src="{{:: $item.icon }}" width=40 height=40 /> <span>{{:: $item.name }}</span> </li> </ul> </div> </div> '},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/img/conversations.c539d2.svg"},function(t,e,i){t.exports=i.p+"assets/img/archive.702e34.svg"},function(t,e,i){t.exports=i.p+"assets/img/drafts.a69e93.svg"},function(t,e,i){t.exports=i.p+"assets/img/trash.a61e4e.svg"},function(t,e,i){t.exports=i.p+"assets/img/contacts.3ffb9b.svg"},function(t,e,i){t.exports=i.p+"assets/tpl/Placeholder.fdc8d7.html"},function(t,e,i){var n,o;n=[i,e,i(7),i(1),i(18),i(6),i(5),i(319),i(83),i(161)],void 0===(o=function(t,e,i,n,o,s,r,a,c,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=(p.$inject=["$q","$log","$scope","$state","$stateParams","AuthSessionService","AppSwitcherService","ConversationsService","DelegateAccountService","profile"],p.prototype.handleShareErrors=function(t){var n=this;if(this.share={id:this.$stateParams.shareId},t.status===s.HTTP_FORBIDDEN)switch(t.data.reason){case"notAdopted":this.goToErrorState("SHARE-ADOPT");break;case"notDecryptable":default:!0===this.AuthSessionService.hasScopes([r.Scopes.USERECOVERYCODE],"AND")?this.goToErrorState("SHARE-DECRYPT-RECOVER"):this.goToErrorState("SHARE-DECRYPT")}else if(t.status===s.HTTP_NOT_FOUND){var o=this.$stateParams.recipient;void 0!==o&&o!==this.profile.email?this.DelegateAccountService.getDelegations().then(function(t){var e=t.reduce(function(t,e){return t.concat(e.aliases,[e.email])},[]),i=e.filter(function(t){return t===o})[0];void 0!==i?(n.delegate=i,n.loading=!1):(n.goToErrorState("NOT_FOUND"),n.$log.info("recipient was not in list of delegates",{recipient:o,delegates:e}))}).catch(function(t){n.goToErrorState("NOT_FOUND"),n.$log.error("error getting delegations in OpenController",{error:t})}):this.goToErrorState("NOT_FOUND")}else this.goToErrorState("UNKNOWN"),this.$log.error("unexpected error in conversations/OpenController",{error:t})},p.prototype.goToConversationView=function(){var t;t=void 0!==this.conversation.systemLabel?this.conversation.systemLabel.name:"inbox",-1===this.conversation.customLabels.map(function(t){return t.name}).concat([t]).indexOf(this.label)&&(this.label=t),this.$state.go("conversations.view",i.__assign({conversationId:this.share.conversationId,label:this.label},this.$stateParams),{location:"replace"})},p.prototype.goToErrorState=function(t,e){void 0===t&&(t="UNKNOWN"),this.$state.go("conversations.error",{error:t,delegate:e,conversation:this.conversation||this.$stateParams.conversation,share:this.share||this.$stateParams.share},{location:!1})},p);function p(t,e,i,n,o,s,r,a,c,l){var u=this;this.$q=t,this.$log=e,this.$scope=i,this.$state=n,this.$stateParams=o,this.AuthSessionService=s,this.AppSwitcherService=r,this.ConversationsService=a,this.DelegateAccountService=c,this.profile=l,this.loading=!0,this.label=this.$stateParams.label,void 0!==this.$stateParams.shareId&&this.ConversationsService.getShare(this.$stateParams.shareId).then(function(t){if(u.share=t,!l.isGuest()||!1!==t.isAccessGranted())return u.ConversationsService.get(t.conversationId).then(function(t){u.conversation=t})}).then(function(){if(void 0!==u.conversation&&u.conversation.specialId!==u.AppSwitcherService.getContext().specialId){u.$log.debug("conversation special id does not match context's. Switching");var t="conversations.open",e={shareId:u.share.id,label:u.$stateParams.label};void 0===u.conversation.specialId?u.AppSwitcherService.switchContext(u.AppSwitcherService.getDefaultContext(),t,e):u.AppSwitcherService.switchToSpecialId(u.conversation.specialId,t,e).then(function(t){t||(u.$log.warn("Switching to special failed, context not found or active",{specialId:u.conversation.specialId}),u.share.isAccessGranted()?u.goToConversationView():u.loading=!1)})}else u.share.isAccessGranted()?u.goToConversationView():u.loading=!1}).catch(function(t){return u.handleShareErrors(t)})}e.OpenController=u,e.OpenControllerModule=n.module("app.conversations.OpenController",[o.AppSwitcherModule.name,a.ConversationForDelegateModule.name,c.ConversationHeaderModule.name,l.ConversationChallengeModule.name])}.apply(e,n))||(t.exports=o)},function(t,e,r){var i,n;i=[r,e,r(1),r(39),r(320)],void 0===(n=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(s.$inject=["$window","$timeout","$state","LoginService"],s.prototype.switchToDelegate=function(){var t=this;this.switched=!0,this.LoginService.switchAccount(this.delegate).then(function(){n.locationReload("conversations.open",{shareId:t.shareId,recipient:void 0},t.$window,t.$state)})},s);function s(t,e,i,n){this.$window=t,this.$timeout=e,this.$state=i,this.LoginService=n,this.switched=!1}e.ConversationForDelegateModule=i.module("components.conversationForDelegate",[]).component("conversationForDelegate",{bindings:{delegate:"<",profileEmail:"<",shareId:"<"},controller:o,templateUrl:r(321)})}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/ConversationForDelegate.3d03cd.html"},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AccessRightGrant=function(t){this.accessRights=[],this.accessRights=t.accessRights||[],this.token=t.token}}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(54)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.prototype.summarizeParticipants=function(e,t){void 0===t&&(t=3);var i=this.participants.filter(function(t){return t.email!==e.email}).map(function(t){return t.fullNameOrEmail()});0===i.length&&(i=this.participants.map(function(t){return t.fullNameOrEmail()}));var n=i.slice(0,t).join(", ");return i.length>t&&(n+="... + "+(i.length-t)),n},o.prototype.updateLabelCollection=function(t){var e=this,i=t.sysLabels.filter(function(t){return-1<e.labelIdList.indexOf(t.id)});1===i.length?this.systemLabel=i[0]:0===i.length&&0<t.sysLabels.length&&(this.systemLabel=t.sysLabels[0]),this.customLabels=t.userLabels.filter(function(t){return-1<e.labelIdList.indexOf(t.id)})},o.prototype.removeLabelById=function(e){this.labelIdList=this.labelIdList.filter(function(t){return t!==e})},o);function o(t,e){this.counters={files:0,messages:0,unread:0},this.isSelected=!1,this.customLabels=[],void 0!==t&&(this.id=t.id,this.specialId=t.specialId,this.counters=t.counters,this.created=t.created,this.displayAsChat=t.displayAsChat,this.readMarker=t.readMarker,this.sendNotifications=t.sendNotifications,this.sendNotificationsDefault=t.sendNotificationsDefault,this.lastMessage=t.lastMessage,this.labelIdList=t.labels,this.participants=t.participants.map(function(t){return new i.Participant(t)}).sort(function(t,e){return t.fullNameOrEmail().localeCompare(e.fullNameOrEmail())}),this.subject=t.subject||null,this.share=t.share||null,this.createdDate=new Date(this.created),this.lastMessageDate=new Date(this.lastMessage),this.readMarkerDate=new Date(this.readMarker),void 0!==e&&this.updateLabelCollection(e))}e.Conversation=n}.apply(e,n))||(t.exports=o)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ConversationEvent=function(t){void 0!==t&&(this.createdDate=new Date(t.created),this.originator=t.originator,this.subject=t.subject,this.eventType=t.eventType,this.id=[this.createdDate.getTime(),this.eventType,this.originator,this.subject].join("|"),"removed"===this.eventType&&this.originator===this.subject&&(this.eventType="left"))}}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Label=function(t){void 0!==t&&(this.counter=t.counter,this.id=t.id,this.isSystemLabel=t.isSystemLabel,this.labelColor=t.labelColor,this.name=this.isSystemLabel?t.name.toLowerCase():t.name)}}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=["inbox","archive","trash"],n=(o.prototype.sortCollection=function(){this.sysLabels.sort(this.sysLabelSorter),this.userLabels.sort(function(t,e){return t.name.localeCompare(e.name)})},o.prototype.sysLabelSorter=function(t,e){return i.indexOf(t.name)>i.indexOf(e.name)?1:-1},o.prototype.getAll=function(){return this.sysLabels.concat(this.userLabels)},o.prototype.add=function(t){this.userLabels.push(t),this.sortCollection()},o.prototype.update=function(e,i){this.userLabels=this.userLabels.map(function(t){return t.id===e&&(t.name=i.name,t.labelColor=i.color),t}),this.sortCollection()},o.prototype.remove=function(e){this.userLabels=this.userLabels.filter(function(t){return t.id!==e}),this.sortCollection()},o);function o(t){this.sysLabels=[],this.userLabels=[],this.sysLabels=t.filter(function(t){return!0===t.isSystemLabel}),this.userLabels=t.filter(function(t){return!1===t.isSystemLabel}),this.sortCollection()}e.LabelCollection=n}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LabelColors={"#00ccaa":"#ccfff6","#ffcc00":"#fff5cc","#ff8800":"#ffe7cc","#ff4400":"#ffdacc","#8800ff":"#e7ccff","#ff00cc":"#ffccf5","#ddaa44":"#f7ebd4","#b0b0b0":"#e6e6e6","#111111":"#a6a6a6"}}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.Updated="labels:updated",n.Deleted="labels:deleted",n);function n(){}e.LabelEvents=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.prototype.setAccessRightGrant=function(t){this.accessRightGrant=t},n.prototype.getAccessRightType=function(){return this.accessRight.accessType},n.prototype.getChallengeInformation=function(){return this.accessRight.challengeInformation},n.prototype.isAccessGranted=function(){return void 0!==this.accessRightGrant&&this.accessRights.length===this.accessRightGrant.accessRights.length},n.prototype.isEmailAccessRight=function(){return"email"===this.getAccessRightType()},n.prototype.isGeneratedCodeAccessRight=function(){return"generatedCode"===this.getAccessRightType()},n.prototype.isSmsAccessRight=function(){return"sms"===this.getAccessRightType()},n.prototype.isPasswordAccessRight=function(){return"password"===this.getAccessRightType()},n.prototype.isZivverAccessRight=function(){return"zivver"===this.getAccessRightType()},n);function n(t){this.accessRights=[],this.accessRights=t.accessRights,this.accessRight=t.accessRights[0],this.conversationCreatorAccountUuid=t.conversationCreatorAccountUuid,this.conversationId=t.conversationId,this.id=t.id}e.Share=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),(i=e.SystemLabel||(e.SystemLabel={})).INBOX="INBOX",i.ARCHIVE="ARCHIVE",i.TRASH="TRASH"}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/LabelsDialog.e090ce.html"},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.RecipientsInvalid="client::recipients:invalid",n.MaxFiles="client::files:maxfiles",n.FileSize="client::files:filesize",n.UploadFailed="client::files:uploadfailed",n);function n(){}e.ClientViolationTypes=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(55),i(90),i(92),i(93)],void 0===(o=function(t,e,i,n,o,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=(Object.defineProperty(a.prototype,"body",{get:function(){return this._body||""},set:function(t){this._body=t,this.isModified=!0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"subject",{get:function(){return this._subject},set:function(t){this._subject=t,this.isModified=!0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"contentType",{get:function(){return this._contentType},set:function(t){this._contentType=t,this.isModified=!0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"recipients",{get:function(){return this._recipients},set:function(t){this._recipients=t,this.isModified=!0},enumerable:!0,configurable:!0}),a.prototype.addAttachment=function(t){this.files.push(t),this.isModified=!0},a.prototype.removeAttachment=function(e){var t=this.files.length;this.files=this.files.filter(function(t){return t.id!==e.id}),this.validation=this.validation.removeViolationsForFile(e.fileslotId),this.isModified=t!==this.files.length||this.isModified},a.prototype.isPlain=function(){return"plain"===this.draftType},a.prototype.isFoward=function(){return"forward"===this.draftType},a.prototype.isReply=function(){return"reply"===this.draftType},a.prototype.toRequestEntity=function(){return{body:this.body,contentType:this.contentType,creatorType:"webapp",draftType:this.draftType,files:this.files.map(function(t){return t.fileslotId}),messageDefinitionId:this.messageDefinitionId,recipients:this.recipients.filter(function(t){return t.emailIsValid}).map(function(t){return t.toRequestEntity()}),scheduledExpiration:this.scheduledExpiration,subject:this.subject}},a.prototype.getFilenameById=function(e){var t=this.files.filter(function(t){return t.id===e});return t.length?t.shift().name:e},a.prototype.summarizeRecipients=function(e,t){void 0===t&&(t=3);var i=this.recipients.filter(function(t){return t.email!==e.email}).map(function(t){return t.fullNameOrEmail()}),n=i.slice(0,t).join(", ");return i.length>t&&(n+="... + "+(i.length-t)),n},a);function a(t){this._contentType="text/html",this._recipients=[],this.files=[],this.draftType="plain",this.isModified=!1,this.isUploading=!1,this.isValidating=!1,this.isSaving=!1,this.isSending=!1,this.isSelected=!1,this.validation=new n.ValidationStatus,void 0!==t&&(this._body=t.body,this._contentType=t.contentType,this._subject=t.subject,this._recipients=t.recipients.map(function(t){return new i.Recipient(t)}),this.id=t.id,this.createdDate=new Date(t.created),this.draftType=t.draftType,this.files=t.files.map(function(t){return new s.DraftAttachment(t)}),this.messageDefinitionId=t.messageDefinitionId,this.modifiedDate=new Date(t.modified),this.scheduledExpiration=t.scheduledExpiration,t.quote instanceof o.DraftQuote?this.quote=t.quote:void 0!==t.quote&&(this.quote=new o.DraftQuote(t.quote)))}e.Draft=r}.apply(e,n))||(t.exports=o)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FinalizeResult=function(t){this.conversation=t.conversation}}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.error="violation-error",n.okay="violation-okay",n.suggestion="violation-suggestion",n.unkown="violation-unknown",n.validating="violation-validating",n.warning="violation-warning",n);function n(){}e.ViolationClassNames=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,a){var i,n;i=[a,e,a(1),a(19),a(14),a(405)],void 0===(n=function(t,e,i,s,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(r.$inject=["$scope","$timeout","$log","$element","WebSocketService"],r.prototype.$onInit=function(){this.imgSrc=this.getImgSrc(),this.altText=this.getAltText(),this.showPresence&&this.registerPresence()},r.prototype.$onChanges=function(t){t.participant&&this.showPresence&&this.registerPresence()},r.prototype.$postLink=function(){var e=this;this.$element[0].querySelectorAll("img")[0].onerror=function(){var t=e.imgSrc+"";e.$log.warn("Error loading participant's avatar ("+e.participant.email+"): "+t),e.imgSrc=e.getImgSrc(!0),e.$scope.$applyAsync()}},r.prototype.getImgSrc=function(t){if(void 0===t&&(t=!1),!1===t&&"string"==typeof this.participant.picture)return this.participant.picture;var e=this.participant.fullNameOrEmail().substr(0,1);return void 0!==n.LETTER_AVATRS[e]?n.LETTER_AVATRS[e]:n.UNKNOWN_PERSON},r.prototype.getAltText=function(){if(void 0===this.participant)return"";var t=this.participant.email;return null!==this.participant.fullName&&(t=this.participant.fullName+" <"+this.participant.email+">"),t},r.prototype.registerPresence=function(){var o=this;void 0!==this.participant.uuid&&(this.presence=this.WebSocketService.getPresence(this.participant.uuid),this.$scope.$on(s.WebSocketEvents.PRESENCE_CHANGED,function(t,e){var i=e.accountUuid,n=e.presence;i===o.participant.uuid&&o.$timeout(function(){o.presence=n},100,!0)}))},r);function r(t,e,i,n,o){this.$scope=t,this.$timeout=e,this.$log=i,this.$element=n,this.WebSocketService=o,this.presence=s.WebsocketPresenceEnum.offline,this.showPresence=!1}e.ParticipantAvatarModule=i.module("components.ParticipantAvatar",[]).component("participantAvatar",{bindings:{participant:"<",showPresence:"<"},controller:o,template:a(406),transclude:!0})}.apply(e,i))||(t.exports=n)},function(t,e,i){t.exports=i.p+"assets/img/blank.d89746.gif"},function(t,e,i){t.exports=i.p+"assets/img/A.b297d0.svg"},function(t,e,i){t.exports=i.p+"assets/img/B.64415a.svg"},function(t,e,i){t.exports=i.p+"assets/img/C.fcd743.svg"},function(t,e,i){t.exports=i.p+"assets/img/D.3bf19b.svg"},function(t,e,i){t.exports=i.p+"assets/img/E.d613f0.svg"},function(t,e,i){t.exports=i.p+"assets/img/F.01afb2.svg"},function(t,e,i){t.exports=i.p+"assets/img/G.2c211b.svg"},function(t,e,i){t.exports=i.p+"assets/img/H.7e0f35.svg"},function(t,e,i){t.exports=i.p+"assets/img/I.e8bb63.svg"},function(t,e,i){t.exports=i.p+"assets/img/J.2c1970.svg"},function(t,e,i){t.exports=i.p+"assets/img/K.cd4de4.svg"},function(t,e,i){t.exports=i.p+"assets/img/L.3ee77c.svg"},function(t,e,i){t.exports=i.p+"assets/img/M.517243.svg"},function(t,e,i){t.exports=i.p+"assets/img/N.074ba2.svg"},function(t,e,i){t.exports=i.p+"assets/img/O.6182a8.svg"},function(t,e,i){t.exports=i.p+"assets/img/P.3fa8a8.svg"},function(t,e,i){t.exports=i.p+"assets/img/Q.096e78.svg"},function(t,e,i){t.exports=i.p+"assets/img/R.05e6c3.svg"},function(t,e,i){t.exports=i.p+"assets/img/S.866545.svg"},function(t,e,i){t.exports=i.p+"assets/img/T.1b076e.svg"},function(t,e,i){t.exports=i.p+"assets/img/U.5a08b7.svg"},function(t,e,i){t.exports=i.p+"assets/img/V.e52765.svg"},function(t,e,i){t.exports=i.p+"assets/img/W.68a4ae.svg"},function(t,e,i){t.exports=i.p+"assets/img/X.1725db.svg"},function(t,e,i){t.exports=i.p+"assets/img/Y.d1779c.svg"},function(t,e,i){t.exports=i.p+"assets/img/Z.c0a4dc.svg"},function(t,e,i){t.exports=i.p+"assets/img/presence-offline.9f5109.svg"},function(t,e,i){t.exports=i.p+"assets/img/presence-offline-dnd.47b0f9.svg"},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BusinessRule=function(t){this.id=t.id,this.displayName=t.displayName,this.description=t.description,this.enabled=t.enabled,this.allowEnabled=t.allowEnabled,this.violationLevel=t.violationLevel,this.blocking=t.blocking,this.category=t.category}}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.InviteInfo=function(t){this.fullName=null,this.inviteMessage=null,this.inviterFullName=null,this.inviterOrganisation=null,void 0!==t&&(this.email=t.email,this.eligible=t.eligible,this.expireDate=t.expireDate,this.fullName=t.fullName||null,this.inviteMessage=t.inviteMessage||null,this.inviterEmail=t.inviterEmail,this.inviterFullName=t.inviterFullName||null,this.inviterOrganisation=t.inviterOrganisation||null,this.legalDocumentSets=t.legalDocumentSets||[],this.nickName=t.nickName,this.notificationSend=t.notificationSend,this.status=t.status)}}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(57)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ConversationFlow=function(t){this.responses=[],this.allowNormalReply=t.allowNormalReply,this.allowQuote=t.allowQuote,this.allowAddAnyRecipient=t.allowAddAnyRecipient,this.allowedAddRecipients=t.allowedAddRecipients||[],this.specialId=t.specialId,this.responses=t.responses.map(function(t){return new i.MessageDefinition(t)})}}.apply(e,n))||(t.exports=o)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.OrganizationSpecial=function(t){this.users=[],this.additionalInfo=t.additionalInfo,this.description=t.description,this.id=t.id,this.name=t.name,this.roles=t.roles}}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(25),i(150)],void 0===(o=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(s.prototype.setStaticImagUrls=function(){var e=this;this.flowInitiations=this.flowInitiations.map(function(t){return t.messageDefinition.formDefinition.sections=t.messageDefinition.formDefinition.sections.map(function(t){return t.components=t.components.map(function(t){return"staticImage"===t.componentType&&(t.imgUrl=e.staticImageUrls[t.imgUrl]),t}),t}),t})},s);function s(t){this.id=t.id,this.name=t.name,this.status=t.status,this.theme=t.theme,this.description=t.description,this.additionalInfo=t.additionalInfo,this.flowInitiations=void 0!==t.flowInitiations?t.flowInitiations.map(function(t){return new n.FlowInitiation(t)}):[],this.staticImageUrls=i.importSpecialTheme(this.theme).staticImageUrls,this.setStaticImagUrls()}e.Special=o}.apply(e,n))||(t.exports=o)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.prototype.toRequestEntity=function(t){void 0===t&&(t=!1);var e={name:this.name,message:this.message,role:this.role.id};return!0===t?e.resendInvite=this.resendInvite:e.email=this.email,e},n);function n(t){void 0!==t&&(this.id=t.id,this.email=t.email,this.name=t.name,this.role=t.role)}e.SpecialInvite=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.prototype.getNameOrEmail=function(){return void 0!==this.name?this.name:this.email},n);function n(t){this.id=t.id,this.email=t.email,this.name=t.name,this.role=t.role,this.status=t.status}e.SpecialUser=i}.apply(e,[i,e]))||(t.exports=n)},function(t,e,u){var i,n;i=[u,e,u(1),u(19),u(156),u(157),u(158),u(396),u(403)],void 0===(n=function(t,e,i,n,o,s,r,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=(l.$inject=["$mdDialog","$translate","$timeout","$scope","$window","$injector","name","steps","coverStyle","style","params"],l.factory=function(t,e){return{controller:l,locals:{name:t,steps:e.steps,coverStyle:e.coverStyle,style:e.style,params:e.params},templateUrl:u(404)}},l.prototype.onKeydown=function(t){var e=this.wizardController;13===t&&(e.steps===e.selectedStep+1&&e.completeEnabled&&e.showComplete?e.onComplete():e.nextEnabled&&e.showNext&&e.onNext())},l.prototype.destroy=function(){var e=this;this.$injector.get("WizardService").close(),this.selectedStepWatch(),this.numStepsWatch(),this.viewportListeners.forEach(function(t){return t.apply(e)})},l.prototype.createWizardController=function(){var e=this,t=this.$injector.get("WizardService"),i=this.wizardController=t.createDefaultController();i.steps=this.steps||1,i.nextEnabled=!1,i.restart=function(){e.name=e.nameDefault,e.style=e.styleDefault,void 0!==e.params.wizardError&&delete e.params.wizardError},i.dotsClicked=function(){e.currentStyle=0===i.selectedStep?e.coverStyle:e.style},i.onCancel=function(t){i.cancelDelegate().then(function(){e.destroy(),e.$mdDialog.cancel(t)})},i.onBack=function(){e.currentStyle=1===i.selectedStep?e.coverStyle:e.style,i.backDelegate().then(function(){})},i.onNext=function(){e.currentStyle=e.style,i.nextDelegate().then(function(){})},i.onComplete=function(){i.completeDelegate().then(function(t){e.destroy(),e.$scope.$broadcast("download:backupCodes"),e.$mdDialog.hide(t)})},i.onSkip=function(){e.currentStyle=e.style,i.skipDelegate().then(function(){})},i.onClose=function(){i.cancelDelegate().then(function(){e.$mdDialog.hide()})}},l.prototype.setDefaultStyles=function(){void 0===this.coverStyle&&void 0===this.style&&(this.coverStyle=a.WizardStyle.blue,this.style=a.WizardStyle.grey),this.currentStyle=this.coverStyle},l.prototype.translateControls=function(){var t=this.wizardController.translations;for(var e in t)this.wizardController.translations[e]=this.$translate.instant(t[e])},l.prototype.watchForStepUpdates=function(){var t=this,e=this.wizardController;this.selectedStepWatch=this.$scope.$watch(function(){return e.selectedStep},function(){t.updateDots()}),this.numStepsWatch=this.$scope.$watch(function(){return e.steps},function(){t.updateDots()})},l.prototype.updateDots=function(){this.dots=Array(this.wizardController.steps+1).join("d").split("").map(function(t){return"faded"}),this.dots[this.wizardController.selectedStep]="current"},l.prototype.updateOnViewportChanges=function(){var i=this;this.viewportListeners=[n.DeviceService.Events.OrientationChanged].map(function(t){return i.$scope.$on(t,function(t,e){return i.fixOrientationChange(e)})})},l.prototype.fixOrientationChange=function(t){var e=this;"portrait"===t&&this.$timeout(function(){e.container.removeAttribute("style"),e.container.setAttribute("style","top: 0px; height: 100%;")},100)},l.prototype.getContainer=function(){this.container=[].slice.call(this.$window.document.getElementsByClassName("md-dialog-container"))[0]},l);function l(t,e,i,n,o,s,r,a,c,l,u){var p=this;this.$mdDialog=t,this.$translate=e,this.$timeout=i,this.$scope=n,this.$window=o,this.$injector=s,this.name=r,this.steps=a,this.coverStyle=c,this.style=l,this.params=u,this.dots=[],this.viewportListeners=[],this.$timeout(function(){p.getContainer()},1e3),this.nameDefault=this.name,this.styleDefault=this.style,this.setDefaultStyles(),this.createWizardController(),this.translateControls(),this.watchForStepUpdates(),this.updateOnViewportChanges()}e.WizardDialog=c,e.WizardDialogModule=i.module("components.wizardDialog",[o.WizardVerificationModule.name,s.WizardBusinessRulesModule.name,r.WizardMfaModule.name])}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/WizardVerification.8b8fa2.html"},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/WizardBusinessRules.cbc548.html"},function(t,e,r){var i,n;i=[r,e,r(1),r(5),r(382)],void 0===(n=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(s.$inject=["MultifactorService","MessengerService","DeviceService","$log","$window","$q"],s.prototype.$onInit=function(){var e=this;this.MultifactorService.setupOtp("totp").then(function(t){e.totpSetup=new n.OtpSetup(t),e.qrCode="data:image/png;base64,"+e.totpSetup.qrcode}),this.control.next=function(){return e.$q.resolve(e.totpSetup)}},s.prototype.copyAuthCode=function(){try{var t=this.$window.document.getElementById("manualAuthCode"),e=document.createRange(),i=this.$window.getSelection();e.selectNodeContents(t),i.removeAllRanges(),i.addRange(e),document.execCommand("copy"),this.MessengerService.toast("mfa-totp-setup.COPIED",{},!0)}catch(t){this.$log.info("mfa-totp-setup :: user tried to copy totp code but command does not exist: "+t)}},s);function s(t,e,i,n,o,s){this.MultifactorService=t,this.MessengerService=e,this.DeviceService=i,this.$log=n,this.$window=o,this.$q=s,this.qrCode=null}e.MfaTotpSetupModule=i.module("components.mfaTotpSetup",[]).component("mfaTotpSetup",{bindings:{control:"=",totpSetup:"<",isSetup:"<"},controller:o,templateUrl:r(383)})}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/MfaTotpSetup.c15044.html"},function(t,e,a){var i,n;i=[a,e,a(1),a(5),a(6)],void 0===(n=function(t,e,i,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=(r.$inject=["$scope","$q","$log","MultifactorService"],r.prototype.$onInit=function(){var e=this;this.control.next=function(){var t=e.form.authenticatorCode;return t.$valid?e.MultifactorService.validateOtpSetup("rfc6238_totp",e.authenticatorCode).then(function(){return new n.Multifactor({id:e.totpSetup.id,factorType:"rfc6238_totp"})}).catch(function(t){return t.status===o.HTTP_CONFLICT?e.form.authenticatorCode.$setValidity("otpValidationResult",!1):e.$log.error("MfaTotpValidate::validateCode() unknown error: "+t.toString()),e.$q.reject(t)}):(t.$setDirty(),document.getElementById("authenticatorCode").focus(),e.$q.reject("authenticator code invalid"))}},r.prototype.$postLink=function(){var e=this;this.$scope.$watch(function(){return e.authenticatorCode},function(t){null!==t&&void 0!==e.form&&e.form.authenticatorCode.$setValidity("otpValidationResult",!0)})},r);function r(t,e,i,n){this.$scope=t,this.$q=e,this.$log=i,this.MultifactorService=n}e.MfaTotpValidateModule=i.module("components.mfaTotpValidate",[]).component("mfaTotpValidate",{bindings:{control:"=",totpSetup:"<",isSetup:"<"},controller:s,templateUrl:a(385)})}.apply(e,i))||(t.exports=n)},function(t,e,i){t.exports=i.p+"assets/tpl/MfaTotpValidate.f4f330.html"},function(t,e,a){var i,n;i=[a,e,a(1),a(6),a(387)],void 0===(n=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o="phoneNumber",s=(r.$inject=["$scope","$window","$q","MultifactorService"],r.prototype.$onInit=function(){var e=this;this.control.next=function(){var t=e.form[o];return t.$valid?e.sendCode().then(function(t){return e.$q.resolve(t)}):(t.$setDirty(),e.$window.document.getElementById(o).focus(),e.$q.reject("phone number invalid"))}},r.prototype.$postLink=function(){var t=this;this.$scope.$watch(function(){return t.phoneNumber},function(){t.smsConflict=!1})},r.prototype.sendCode=function(){var e=this;return this.MultifactorService.setupSmsFactor(this.phoneNumber).then(function(t){return{factorId:t.id,phoneNumber:e.phoneNumber}}).catch(function(t){t.status===n.HTTP_CONFLICT&&(e.smsConflict=!0)})},r);function r(t,e,i,n){this.$scope=t,this.$window=e,this.$q=i,this.MultifactorService=n}e.MfaSmsSetup=s,e.MfaSmsSetupModule=i.module("components.MfaSmsSetup",[]).component("mfaSmsSetup",{bindings:{control:"=",phoneNumber:"<",context:"@"},controller:s,templateUrl:a(388)})}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/MfaSmsSetup.c57e0b.html"},function(t,e,c){var i,n;i=[c,e,c(1),c(6),c(5)],void 0===(n=function(t,e,i,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s="authcode",r=(a.$inject=["$scope","$log","$window","$q","MultifactorService","MessengerService"],a.prototype.$onInit=function(){var i=this;this.control.next=function(){var e=i.form[s];return e.$valid?i.MultifactorService.validateSmsSetup(i.phoneNumber,i.authcode).then(function(){return new o.Multifactor({id:i.factorId,challengeInformation:i.phoneNumber,factorType:"sms"})}).catch(function(t){return t.status===n.HTTP_CONFLICT&&(e.$setDirty(),e.$setValidity("otpValidationResult",!1)),i.$q.reject(t)}):(e.$setDirty(),i.$window.document.getElementById(s).focus(),i.$q.reject("no code entered"))}},a.prototype.$postLink=function(){var e=this;this.$scope.$watch(function(){return e.authcode},function(t){null!==t&&void 0!==e.form&&e.form[s].$setValidity("otpValidationResult",!0)})},a.prototype.reSendCode=function(){var e=this;this.MultifactorService.setupSmsFactor(this.phoneNumber).then(function(t){e.MessengerService.toast("mfa-sms-validate.RESEND.TOAST",{},!0),e.factorId=t.id}).catch(function(t){t.status===n.HTTP_CONFLICT&&e.$log.error("RE-sending 2FA code to a phone number that already had 2FA sms set up for it, this should not occur.")})},a);function a(t,e,i,n,o,s){this.$scope=t,this.$log=e,this.$window=i,this.$q=n,this.MultifactorService=o,this.MessengerService=s}e.MfaSmsValidate=r,e.MfaSmsValidateModule=i.module("components.MfaSmsValidate",[]).component("mfaSmsValidate",{bindings:{control:"=",phoneNumber:"<",factorId:"="},controller:r,templateUrl:c(390)})}.apply(e,i))||(t.exports=n)},function(t,e,i){t.exports=i.p+"assets/tpl/MfaSmsValidate.0808ac.html"},function(t,e,s){var i,n;i=[s,e,s(1),s(392)],void 0===(n=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$http","$log","$scope","$timeout","$injector","MultifactorService","DeviceService"],o.prototype.$onInit=function(){var i=this;this.introText=void 0===this.introText?"SECURITY-SETTINGS":this.introText,this.isDesktop=this.DeviceService.isDesktop(),this.getBackupCodes(),this.$scope.$on("download:backupCodes",function(){i.getDownloadLink().then(function(t){var e=document.createElement("a");e.setAttribute("href",t),e.setAttribute("download","backupCodes"),i.DeviceService.simulateMouseClick(e),i.$timeout(function(){e.remove()},1e3)})})},o.prototype.getBackupCodes=function(){this.fetchBackupCodes()},o.prototype.generateBackupCodes=function(){this.fetchBackupCodes(!0)},o.prototype.fetchBackupCodes=function(t){var e=this;void 0===t&&(t=!1),this.loading=!0,this.error=!1;var i=t?this.MultifactorService.generateBackupcodes():this.MultifactorService.getBackupcodes();i.then(function(t){e.codes=t.authcodes,e.generatedAt=new Date(t.creationTime)}),i.catch(function(t){e.$log.warn("Error getting backup codes",{error:t}),e.error=!0}),i.finally(function(){e.loading=!1})},o.prototype.downloadCodes=function(t){var i=this;if(!1===this.canDownload){t.preventDefault();var n=t.target;"A"!==n.tagName&&(n=n.parentElement),this.getDownloadLink().then(function(t){var e;i.downloadLink=t;try{e=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1})}catch(t){(e=document.createEvent("MouseEvent")).initEvent("click",!1,!1,{view:window})}i.$timeout(function(){i.canDownload=!0,n.dispatchEvent(e),i.$timeout(function(){i.canDownload=!1,i.downloadLink=void 0},250,!1)})})}},o.prototype.getDownloadLink=function(){var e=this,i="authentication/multifactor/backupcodes/download",t=this.$http.get("/api/"+i);return t.catch(function(t){e.$log.warn("<mfa-backup-codes> Error obtaining download_token",{error:t})}),t.then(function(t){return"/api/"+i+"/content?download_token="+t.data.token})},o);function o(t,e,i,n,o,s,r){this.$http=t,this.$log=e,this.$scope=i,this.$timeout=n,this.$injector=o,this.MultifactorService=s,this.DeviceService=r,this.loading=!0,this.error=!1,this.canDownload=!1}e.MfaBackupCodesModule=i.module("components.mfa-backup-codes",[]).component("mfaBackupCodes",{bindings:{introText:"@"},controller:n,templateUrl:s(393)})}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/MfaBackupCodes.84d648.html"},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/WizardMfa.70be67.html"},function(t,e,i){var n,o;n=[i,e,i(7),i(397),i(398),i(399),i(400),i(401),i(402)],void 0===(o=function(t,e,i,n,o,s,r,a,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i.__exportStar(n,e),i.__exportStar(o,e),i.__exportStar(s,e),i.__exportStar(r,e),i.__exportStar(a,e),i.__exportStar(c,e)}.apply(e,n))||(t.exports=o)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),(i=e.WizardStyle||(e.WizardStyle={})).grey="grey",i.blue="blue",i.error="error"}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/WizardDialog.8c6f9f.html"},function(t,e,i){},function(t,e){t.exports='<img class=md-user-avatar alt="{{:: $ctrl.altText }}" ng-src="{{ $ctrl.imgSrc }}"/> <span ng-if=$ctrl.showPresence class=presence ng-class="\'presence-\' + $ctrl.presence"></span> '},function(t,e,i){},function(t,e){t.exports='<div ng-switch=$ctrl.participants.length> <div class="participants participant-single" ng-switch-when=0> <span></span> </div> <div class="participants participant-single" ng-switch-when=1> <participant-avatar participant=$ctrl.participants[0]></participant-avatar> </div> <div class="participants participant-multiple" layout=row layout-align="center center" layout-wrap ng-switch-default> <participant-avatar ng-repeat="item in $ctrl.participants.slice(0,3)" participant=item class="md-avatar md-avatar-small"></participant-avatar> <div class=extra-participants ng-if="$ctrl.participants.length > 3"> <span>+{{ $ctrl.participants.length-3 }}</span> </div> </div> </div> '},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/DraftViolationItem.4a1afb.html"},function(t,e,i){},function(t,e){t.exports='<div class=phone-number-container ng-class="{\'phone-input-invalid\': $ctrl.isPhoneInputInvalid()}" translate-namespace=input-phonenumber layout=row layout-align="start center"> <div layout=row layout-margin ng-if="$ctrl.loading === true"> <md-progress-circular md-mode=query md-diameter=20></md-progress-circular> </div> <md-input-container class=country-code ng-if="$ctrl.loading === false"> <md-select id=countryCode name=countryCode ng-model=$ctrl.selectedCountry aria-label="Choose country code" ng-change=$ctrl.changeCountryCode()> <md-option ng-repeat="country in $ctrl.countries" ng-value=country> <div flex layout=row layout-align="space-between center"> <img ng-src={{$ctrl.blankGif}} class="flag flag-{{country.iso.toLowerCase()}}"/> <div class=country-explicit> <span>{{country.name}}</span> <span class=dark-gray>(+{{country.code}})</span> </div> </div> </md-option> </md-select> </md-input-container> <md-input-container class=phone-number-input flex md-is-error="$ctrl.form.phoneNumber.$dirty && $ctrl.form.phoneNumber.$invalid"> <label translate>.PLACEHOLDER</label> <input type=tel id=phoneNumber name=phoneNumber aria-label="Enter phone number" ng-required=$ctrl.required autocomplete=off ng-model=$ctrl.phoneNumber ng-model-options="{ updateOn: \'default blur paste\', debounce: { \'default\': 1000, \'blur\': 0, \'paste\' : 0 } }" md-no-asterisk> <div ng-messages=$ctrl.form.phoneNumber.$error class=error-message> <div ng-message=required translate>.ERROR.REQUIRED</div> <div ng-message=cannotReceiveSms translate>.ERROR.CANNOT-RECEIVE-SMS</div> <div ng-message=invalidPhoneNumber translate>.ERROR.INVALID-NUMBER</div> <div ng-message=sameNumber translate>.ERROR.SAME-NUMBER-CONFLICT</div> </div> </md-input-container> </div> '},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/RecipientDialog.afa5bc.html"},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/img/bcc.18652a.svg"},function(t,e,i){t.exports=i.p+"assets/tpl/ParticipantsList.e2f534.html"},function(t,e,a){var i,n;i=[a,e,a(1),a(9),a(58),a(419)],void 0===(n=function(t,e,i,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=(r.$inject=["$scope","$element","$q","$mdDialog","$mdMedia","ContactsService"],r.prototype.setPadlock=function(){this.showPadlock=void 0!==this.recipient.accessRightSetup&&"generatedCode"!==this.recipient.accessRightSetup.accessType},r.prototype.showDialog=function(){var e=this,t=new o.RecipientDialog;t.resolve.recipient=function(){return void 0!==e.recipient.verifications?e.$q.resolve(i.copy(e.recipient)):e.ContactsService.get(e.recipient.email).then(function(t){return t.toRecipient()})},t.locals.violations=this.validation.getViolationsForRecipient(this.recipient),this.$mdDialog.show(t).then(function(t){e.recipient=i.extend(e.recipient,t),e.setPadlock()})},r.prototype.setViolationsClass=function(){var e=this;Object.keys(n.ViolationClassNames).map(function(t){return e.mdChip.removeClass(n.ViolationClassNames[t])});var t=this.validation.getViolationsForRecipient(this.recipient),i=t.map(function(t){return t.violationLevel});-1<i.indexOf("error")?(this.mdChip.addClass(n.ViolationClassNames.error),this.iconStatus="error"):-1<i.indexOf("warning")?(this.mdChip.addClass(n.ViolationClassNames.warning),this.iconStatus="warning"):-1<i.indexOf("suggestion")?(this.mdChip.addClass(n.ViolationClassNames.suggestion),this.iconStatus="info"):!1===this.validation.validationCompleted?(this.mdChip.addClass(n.ViolationClassNames.validating),this.iconStatus="unknown"):this.validation.validationCompleted&&0===t.length?(this.mdChip.addClass(n.ViolationClassNames.okay),this.iconStatus="verified"):(this.mdChip.addClass(n.ViolationClassNames.unkown),this.iconStatus="unknown")},r);function r(t,e,i,n,o,s){var r=this;this.$scope=t,this.$element=e,this.$q=i,this.$mdDialog=n,this.$mdMedia=o,this.ContactsService=s,this.showPadlock=!1,this.iconStatus="unknown",this.mdChip=this.$element.parent().parent().parent(),this.$scope.$watch(function(){return r.validation.violationsUnresolved},function(){r.setViolationsClass(),r.setPadlock()})}e.RecipientChipModule=i.module("components.recipientChip",[o.RecipientDialogModule.name]).component("recipientChip",{bindings:{recipient:"=",validation:"<"},controller:s,templateUrl:a(420),transclude:!0})}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/RecipientChip.3f25e9.html"},function(t,e,i){var n,o;n=[i,e,i(1),i(14)],void 0===(o=function(t,e,s,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$scope","$log","$element","ContactsService"],o.prototype.setContactPicture=function(i){var n=this;void 0===i.picture?(this.setLetterAvatarFromFirstLetter(i),this.ContactsService.get(i.email).then(function(t){var e=t.toRecipient();void 0===e.picture?n.setLetterAvatarFromFirstLetter(i):n.$element.attr("src",e.picture)}).catch(function(){n.setLetterAvatarFromFirstLetter(i)})):this.$element.attr("src",i.picture)},o.prototype.setAltText=function(t){var e=void 0===t.fullName?t.email:t.fullName+" <"+t.email+">";this.$element.attr("alt",e)},o.prototype.getFirstLetter=function(t){return void 0!==t.fullName?t.fullName.substring(0,1):null!==t.email&&void 0!==t.email?t.email.substring(0,1):void 0},o.prototype.setLetterAvatarFromFirstLetter=function(t){var e=this.getFirstLetter(t);void 0!==e&&null!==e.match(/[a-z]/i)?(this.$element.attr("src",i.LETTER_AVATRS[e.toLowerCase()]),this.$element.addClass("letter-avatar")):this.$element.attr("src",i.UNKNOWN_PERSON)},o);function o(t,e,i,n){var o=this;if(this.$log=e,this.$element=i,this.ContactsService=n,"IMG"!==this.$element[0].tagName)throw Error("ziv-recipient-avatar directive only works on img tags!");this.$element[0].onerror=function(){o.$log.warn("Could not load avatar for recipient "+o.recipient.email+": "+o.recipient.picture),o.setLetterAvatarFromFirstLetter(o.recipient),t.$applyAsync()},this.recipient=t.recipient,this.setContactPicture(this.recipient),this.setAltText(this.recipient),t.$watch(function(){return o.recipient},function(t,e){!1===s.equals(t,e)&&(o.setAltText(t),o.setContactPicture(t))},!0)}e.RecipientAvatarDirectiveModule=s.module("common.RecipientAvatarDirective",[]).directive("zivRecipientAvatar",function(){return{restrict:"A",scope:{recipient:"<"},controller:n}})}.apply(e,n))||(t.exports=o)},function(t,e,i){},function(t,e){t.exports='<md-chips ng-model=$ctrl.recipients class=md-contact-chips md-require-match=true md-on-add=$ctrl.onAdd($chip)> <md-chip-template> <recipient-chip recipient=$chip validation=$ctrl.validation></recipient-chip>. </md-chip-template> <md-autocomplete md-items="item in $ctrl.searchContacts(term)" md-item-text=item.email md-search-text=$ctrl.searchFor md-menu-class=md-contact-chips-suggestions md-no-cache=true md-autoselect=true md-autofocus=false md-delay=300 md-min-length=3 md-dropdown-items=11 md-blur=$ctrl.onBlur(); ng-paste=$ctrl.onPaste($event) placeholder="{{\'DRAFTS.EDIT.RECIPIENTS.ADD-FIRST\' | translate }}"> <md-item-template> <div ng-attr-title={{item.email}} layout=row flex=100 class=contact-suggestion> <div class=contact-avatar> <img ng-src="{{ item.picture || $ctrl.unknownPerson }}" class=md-user-avatar> </div> <div class=contact-details layout=column layout-align="center start" ng-class="{\'double-line\': item.fullName !== undefined && item.email !== undefined, \'single-line\': item.fullName === undefined}"> <div class="contact-name truncate" ng-if="item.fullName !== undefined" md-highlight-text=$ctrl.searchFor md-highlight-flags=ig>{{item.fullName}}</div> <div class="contact-email truncate" ng-if="item.email !== undefined" md-highlight-text=$ctrl.searchFor md-highlight-flags=ig>{{item.email}}</div> </div> </div> </md-item-template> </md-autocomplete> </md-chips> '},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/ConversationInfo.d437e4.html"},function(t,e,s){var i,n;i=[s,e,s(1),s(427)],void 0===(n=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$mdDialog","input","profile","accountPreference"],o.prototype.showSettingsPage=function(){this.$mdDialog.cancel("settings.notifications")},o.prototype.submit=function(){this.input.enable!==this.enable||this.input.useDefault!==this.useDefault?this.$mdDialog.hide({useDefault:this.useDefault,enable:this.useDefault?this.accountPreference:this.enable}):this.cancel()},o.prototype.setNotification=function(t){this.enable=t},o.prototype.cancel=function(){this.$mdDialog.cancel()},o.factory=function(t,e){return{controller:o,locals:{input:t,profile:e},resolve:{},templateUrl:s(428)}},o);function o(t,e,i,n){this.$mdDialog=t,this.input=e,this.profile=i,this.accountPreference=n,this.useDefault=e.useDefault&&!1===this.profile.isGuest(),this.enable=e.enable}e.NotificationsDialog=n,e.NotificationsDialogModule=i.module("common.notificationsDialog",[])}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/NotificationsDialog.1575b5.html"},function(t,e,i){},function(t,e){t.exports='<div translate-namespace=conversation-header class=zv-subheader layout=row> <aside class=header flex></aside> <aside class="header middle" layout=row layout-align="space-between center" layout-padding> <back-button hide-gt-sm ng-if=":: $ctrl.profile.isGuest() === false"></back-button> <div class=spacer hide-gt-sm ng-if=":: $ctrl.profile.isGuest()"></div> <div class=title flex ng-click=$ctrl.openInfoPane() ng-if=$ctrl.conversation> <h5 class="md-title truncate">{{:: $ctrl.conversation.subject }}</h5> <div layout=row layout-align="space-between center"> <div class=participants-amount ng-class="{\'truncate\': $ctrl.$mdMedia(\'xs\')}"> <span class=participant-length>{{ $ctrl.conversation.participants.length}}</span> <md-icon class=icon-16>person</md-icon> </div> <div layout=row class=truncate> <span class=participants>{{ $ctrl.participantsInfo }}</span> <span class=all-participants hide>{{ $ctrl.allParticipants }}</span> </div> </div> </div> <div class=actions layout=row layout-align="end center" hide-xs ng-if="$ctrl.actions.length > 0"> <md-button ng-repeat="action in $ctrl.actions | limitTo:2" ng-click=$ctrl[action.onClick]($event); class=md-icon-button ng-class=action.icon> <md-tooltip md-delay=500> <translate>{{:: action.label }}</translate> </md-tooltip> <md-icon>{{ action.icon }}</md-icon> </md-button> <md-menu md-position-mode="target-right target"> <md-button class=md-icon-button ng-click="$ctrl.openActionsMenu($mdMenu, $event)"> <md-icon md-menu-origin>more_vert</md-icon> </md-button> <md-menu-content width=4> <md-menu-item ng-repeat="action in $ctrl.actions | limitTo: (2 - $ctrl.actions.length)" ng-class=action.icon> <md-button ng-click=$ctrl[action.onClick]($event)> <md-icon>{{ action.icon }}</md-icon> <span translate>{{ action.label }}</span> </md-button> </md-menu-item> </md-menu-content> </md-menu> </div> <div class=actions layout=row layout-align="end center" hide-gt-xs ng-if="$ctrl.actions.length > 0"> <md-menu md-position-mode="target-right target"> <md-button class=md-icon-button ng-click="$ctrl.openActionsMenu($mdMenu, $event)"> <md-icon md-menu-origin>more_vert</md-icon> </md-button> <md-menu-content width=4> <md-menu-item ng-class=action.icon ng-repeat="action in $ctrl.actions track by $index"> <md-button ng-click=$ctrl[action.onClick]($event); class=""> <md-icon>{{ action.icon }}</md-icon> <span translate>{{ action.label }}</span> </md-button> </md-menu-item> </md-menu-content> </md-menu> </div> </aside> <aside class=header flex></aside> <sidepane ng-if="$ctrl.showInfoPane === true" on-close=$ctrl.sidePaneClosed()> <pane-title> <translate>.INFO-PANE-TITLE</translate> </pane-title> <pane-content> <conversation-info profile=$ctrl.profile conversation=$ctrl.conversation></conversation-info> </pane-content> </sidepane> </div> '},function(t,e,i){},function(t,e,i){t.exports='<form name=$ctrl.form novalidate ng-submit=$ctrl.validateChallenge() autocomplete=off translate-namespace=conversation-challenge> <div class=challenge ng-if="$ctrl.error === false && $ctrl.share.isEmailAccessRight()"> <div class=email> <img src='+i(433)+'> <span translate>.EMAIL.INTRO.CHECK</span> </div> <p translate translate-value-email="{{ $ctrl.profile.email }}">.EMAIL.INTRO.CODE</p> <p translate translate-value-subject="{{ $ctrl.conversation.subject }}">.EMAIL.INTRO.SUBJECT</p> <md-input-container class=access-code md-no-float md-is-error="$ctrl.form.response.$pristine === false && $ctrl.form.response.$invalid" flex> <label for=response> <translate>.EMAIL.LABEL</translate> </label> <input id=response name=response ng-model=$ctrl.formValues.response ng-attr-type="{{ $ctrl.inputType }}" ng-attr-pattern="{{ $ctrl.inputPattern }}" required md-no-asterisk placeholder=" " autofocus> <div ng-messages=$ctrl.form.response.$error> <div ng-message=email><translate>.EMAIL.ERROR</translate></div> </div> </md-input-container> <md-button type=submit class="md-raised md-primary" id=unlock ng-click=$ctrl.validateChallenge()> <translate>.UNLOCK</translate> </md-button> <p class=small-note> <translate>.RESEND-EMAIL.INTRO</translate> <a href=# ng-click=$ctrl.triggerChallenge() ng-class="$ctrl.preventDoubleClick ? \'disabled\' : \'resend\'"> <translate>.RESEND-EMAIL.SEND</translate> </a> </p> </div> <div layout=row layout-fill layout-wrap layout-margin ng-if="$ctrl.error === false && $ctrl.share.isEmailAccessRight() === false"> <div ng-if="$ctrl.notified === false"> <p flex=100 ng-if=$ctrl.share.isPasswordAccessRight()> <translate>.ACCESS-CODE.INTRO</translate> </p> <p flex=100 ng-if=$ctrl.share.isGeneratedCodeAccessRight()> <translate>.GENERATED-CODE.INTRO</translate> </p> <p flex=100 ng-if=$ctrl.share.isSmsAccessRight()> <translate ng-if="$ctrl.challengeSent === false && $ctrl.isWrongNumber === false" translate-value-phone="{{ $ctrl.share.getChallengeInformation() }}">.SMS.INTRO</translate> <translate ng-if="$ctrl.challengeSent === true" translate-value-phone="{{ $ctrl.share.getChallengeInformation() }}">.SMS.SENT</translate> <translate ng-if="$ctrl.isWrongNumber === true" translate-value-phone="{{ $ctrl.share.getChallengeInformation() }}">.SMS.WRONG-NUMBER.INTRO</translate> </p> </div> <div class=notified ng-if="$ctrl.notified === true" flex=100> <h2 class=md-title layout-align=center> <translate>.SMS.WRONG-NUMBER.NOTIFIED.TITLE</translate> </h2> <p><translate>.SMS.WRONG-NUMBER.NOTIFIED.MESSAGE</translate></p> <img src='+i(434)+' /> </div> <div flex=100 layout=row ng-if=$ctrl.showMainActions()> <md-input-container md-is-error="$ctrl.form.response.$pristine === false && $ctrl.form.response.$invalid" flex> <label for=response> <translate ng-if=$ctrl.share.isGeneratedCodeAccessRight()>.GENERATED-CODE.LABEL</translate> <translate ng-if=$ctrl.share.isPasswordAccessRight()>.ACCESS-CODE.LABEL</translate> <translate ng-if=$ctrl.share.isSmsAccessRight()>.SMS.LABEL</translate> </label> <input id=response name=response ng-model=$ctrl.formValues.response ng-attr-type="{{ $ctrl.inputType }}" ng-attr-pattern="{{ $ctrl.inputPattern }}" required md-no-asterisk placeholder=" " autofocus> <div ng-messages=$ctrl.form.response.$error> <div ng-message=generatedCode><translate>.GENERATED-CODE.ERROR</translate></div> <div ng-message=password><translate>.ACCESS-CODE.ERROR</translate></div> <div ng-message=sms><translate>.SMS.ERROR</translate></div> </div> </md-input-container> </div> <div flex=100 class=md-actions layout=column layout-align="space-between stretch" ng-if="$ctrl.notified === false"> <md-button layout-margin type=submit class="md-primary md-raised" ng-disabled="$ctrl.form.$invalid || $ctrl.inProgress" ng-if=$ctrl.showMainActions()> <md-icon>lock</md-icon> <translate>.UNLOCK</translate> </md-button> <md-button layout-margin class="md-raised md-primary" ng-click=$ctrl.triggerChallenge(false) ng-if=$ctrl.showSendCodeButton() ng-disabled=$ctrl.inProgress aria-label="Send me my code"> <translate ng-if=$ctrl.share.isSmsAccessRight()>.SEND-SMS</translate> <translate ng-if=$ctrl.share.isEmailAccessRight()>.SEND-EMAIL</translate> </md-button> <md-button layout-margin class="md-primary wrong-number-guest" ng-click=$ctrl.setWrongNumber() ng-if=$ctrl.showNotMyNumberButton() ng-disabled=$ctrl.inProgress aria-label="This is not my number"> <translate>.SMS.WRONG-NUMBER.BUTTON</translate> </md-button> <md-button layout-margin class="md-primary md-raised" ng-click=$ctrl.notifySender() ng-if=$ctrl.showNotifyButton() ng-disabled=$ctrl.inProgress aria-label=Notify> <translate>.SMS.WRONG-NUMBER.NOTIFY</translate> </md-button> <md-button layout-margin class="md-primary wrong-number-guest" ng-click=$ctrl.back() ng-if=$ctrl.showNotifyButton() ng-disabled=$ctrl.inProgress aria-label="Go back"> <translate>.SMS.WRONG-NUMBER.BACK</translate> </md-button> </div> <div ng-if="$ctrl.share.isSmsAccessRight() && $ctrl.showSecondaryActions() === false" flex=100 layout=row layout-align="center center"> <a ng-href={{$ctrl.supportUrl}} target=_blank translate>.GET-SUPPORT</a> </div> <div flex=100 layout=row layout-align="space-around center" class="md-actions secondary" ng-if=$ctrl.showSecondaryActions()> <div ng-if="$ctrl.inProgress === false && $ctrl.isWrongNumber === false"> <a href=# ng-click=$ctrl.triggerChallenge() ng-class="$ctrl.preventDoubleClick ? \'disabled\' : \'resend\'"> <translate ng-if=$ctrl.share.isSmsAccessRight()>.RESEND-SMS</translate> <translate ng-if=$ctrl.share.isEmailAccessRight()>.RESEND-EMAIL.LABEL</translate> </a> </div> <div ng-if=$ctrl.share.isSmsAccessRight()> <a ng-href={{$ctrl.supportUrl}} target=_blank translate>.GET-SUPPORT</a> </div> <div ng-if="$ctrl.share.isSmsAccessRight() && $ctrl.profile.isGuest() && $ctrl.isWrongNumber === false"> <a href=# ng-click=$ctrl.setWrongNumber() ng-disabled=$ctrl.inProgress aria-label="This is not my number"> <translate>.SMS.WRONG-NUMBER.BUTTON</translate> </a> </div> </div> <div flex=100 layout=row layout-sm=column class="md-actions progress" ng-if="$ctrl.inProgress === true"> <p> <md-progress-circular class=md-hue-2 md-diameter=16px></md-progress-circular> <translate ng-if=$ctrl.share.isSmsAccessRight()>.SENDING-SMS</translate> <translate ng-if=$ctrl.share.isEmailAccessRight()>.SENDING-EMAIL</translate> </p> </div> </div> <div class="challenge message-info" ng-if="$ctrl.error === false && $ctrl.share.isEmailAccessRight()"> <p class=small-note translate>.INFO.INTRO</p> <p class=info> <span class="label small-note" translate>.INFO.SUBJECT</span> <span class=small-note>{{$ctrl.conversation.subject}}</span> </p> <p class="info truncate"> <span class="label small-note" translate>.INFO.PARTICIPANTS</span> <span class="small-note recipients">{{ $ctrl.summarizeRecipients($ctrl.profile) }}</span> <md-tooltip md-delay=500 md-direction=top class=challenge-participant-tooltip> <span>{{$ctrl.participants}}</span> </md-tooltip> </p> <p class=support> <a class=small-note ng-href={{$ctrl.zivverUrl}} target=_blank>ZIVVER</a> <span class=small-note translate> .INFO.SUPPORT</span> <a class=small-note ng-href={{$ctrl.supportUrl}} target=_blank translate>.INFO.WHY</a> </p> </div> <div layout=row layout-fill layout-wrap layout-margin ng-if="$ctrl.error === true"> <div class=notified flex=100> <p layout-align=center> <translate ng-if="$ctrl.screen === \'CHALLENGE\'">.ERROR.CHALLENGE</translate> <translate ng-if="$ctrl.screen === \'NOTIFY\'">.ERROR.NOTIFY</translate> </p> <div flex=100 class=md-actions layout=column layout-align="space-between stretch"> <md-button layout-margin type=submit ng-click=$ctrl.reloadPage() class="md-primary md-raised"> <translate>.ERROR.RETRY</translate> </md-button> </div> </div> </div> </form> '},function(t,e,i){t.exports=i.p+"assets/img/open_email.18ef08.svg"},function(t,e,i){t.exports=i.p+"assets/img/sent.6eba3f.svg"},function(t,e,i){var n,o;n=[i,e,i(7),i(1),i(19),i(8),i(6),i(5),i(162),i(163),i(83),i(88),i(442),i(445),i(165),i(483),i(29),i(554),i(13)],void 0===(o=function(t,e,y,n,o,b,s,r,i,a,c,l,u,p,d,h,f,v,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g="CONVERSATIONS.VIEW",S=($.$inject=["$anchorScroll","$animate","$log","$mdDialog","$rootScope","$scope","$state","$stateParams","$timeout","$window","ConversationsService","LabelService","MessengerService","$mdMedia","StorageService","SurveyService","WebSocketService","labelCollection","profile"],$.prototype.refreshDownloadToken=function(){var e=this;return this.ConversationsService.getShareDownloadToken(this.share).then(function(t){return e.downloadToken=t}).catch(function(t){e.$log.error("Something went wrong while getting the share the download token",{error:t}),e.MessengerService.toast("CONVERSATIONS.VIEW.DOWNLOAD-TOKEN-ERROR")})},$.prototype.loadMessages=function(){var e=this;this.cancelRefresh(),"hidden"===this.$window.document.visibilityState&&0<this.messages.length?this.initRefresh():(this.refreshing=!0,this.ConversationsService.listMessages(this.conversation.id,this.share.accessRightGrant.token,this.profile.email).then(function(t){e.messages=t.items.map(function(t){return t.isNew=t.createdDate>e.conversation.readMarkerDate,t}),e.messagesAndEvents=[].concat(e.messages,t.events).sort(function(t,e){return t.createdDate>e.createdDate?1:-1}),e.hasEvents=0!==t.events.length,e.updateReadMarker(),e.autoScroll(),e.$timeout(function(){e.refreshing=!1,e.initRefresh()},1e3)}).catch(function(t){t.status===s.HTTP_FORBIDDEN?e.error("HTTP_FORBIDDEN"):t.status===s.HTTP_NOT_FOUND?0<e.messages.length?e.error("LOGGEDOUT"):(e.$log.warn("loading conversation messages resulted in a 404"),e.error("UNKNOWN")):t.status===s.HTTP_UNAUTHORIZED?e.error("LOGGEDOUT"):t.status===s.ERR_CONNECTION_REFUSED||t.status===s.ZERO_RESPONSE?(e.$log.info("No clue what happend, try again"),e.initRefresh()):(e.$log.error("unexpected error loading conversation messages",{error:t}),e.error("UNKNOWN"))}).finally(function(){e.loading=!1}))},$.prototype.refresh=function(){this.$scope.$$destroyed||(this.refreshing?this.initRefresh():this.loadMessages())},$.prototype.updateReadMarker=function(){var t=this;if(0!==this.messages.length&&"hidden"!==this.$window.document.visibilityState){var e=this.getLastMessageDate();e<=this.conversation.readMarkerDate||(this.readMarkerUpdateTimeout&&this.$timeout.cancel(this.readMarkerUpdateTimeout),this.readMarkerUpdateTimeout=this.$timeout(function(){t.$log.debug("Updating readMarker to "+e),t.conversation.readMarkerDate=e,t.conversation.readMarker=e.toISOString(),t.conversation.counters.unread=0,t.ConversationsService.updateReadMarker(t.conversation.id,t.conversation.readMarker),t.messages.filter(function(t){return t.isNew}).forEach(function(t){t.isNew=t.createdDate>e}),t.$rootScope.$broadcast("conversation:updated",t.conversation)},2e3,!1))}},$.prototype.closeSurvey=function(){this.isSurveyAvailable=!1,this.setShowSurvey(),this.SurveyService.removeSurvey("customer_effort_score",this.share.id)},$.prototype.setShowSurvey=function(){this.showSurvey=this.isSurveyAvailable&&(this.$mdMedia("xs")&&!1===this.isReplyMode||!1===this.$mdMedia("xs"))},$.prototype.onConversationReplied=function(t){var e=this,i=0<this.messages.length?this.messages.slice(-1)[0].id:-1;this.conversation.readMarkerDate=t.createdDate,t.isNew=!1,t.isOwn=!0,this.messages.push(t),this.messagesAndEvents.push(t),this.$timeout(function(){e.$anchorScroll("msg-"+t.id)},300,!1),i+1<t.id?this.refresh():this.conversation.lastMessageDate=t.createdDate,this.$rootScope.$broadcast("conversation:updated",this.conversation)},$.prototype.cancelRefresh=function(){this.refreshing=!0,void 0!==this.refreshTimeout&&(this.$timeout.cancel(this.refreshTimeout),this.refreshTimeout=void 0)},$.prototype.initRefresh=function(){var t=this;this.WebSocketService.isOpen()||(this.refreshTimeout=this.$timeout(function(){t.refresh()},1e4,!1))},$.prototype.error=function(t){this.$state.go("conversations.error",{error:t,conversation:this.conversation},{location:!1})},$.prototype.assignLabelFromStorage=function(){var e=this,t=this.StorageService.getItem("SESSION","draft-label"),i=this.StorageService.getItem("SESSION","conversation-label");void 0!==t&&void 0!==i&&void 0!==this.conversation&&i===this.conversation.id&&this.ConversationsService.setConversationLabels(this.conversation,[t]).then(function(){e.StorageService.removeItem("SESSION","draft-label"),e.StorageService.removeItem("SESSION","conversation-label"),e.LabelService.getLabelsAndBroadcast()}).catch(function(t){e.$log.error("Error setting (session storage) label to conversation",{error:t})})},$.prototype.registerEvents=function(){var t,i=this;function e(){i.$timeout(function(){"visible"===i.$window.document.visibilityState&&i.refresh()},500)}this.$scope.$on(b.LabelEvents.Updated,function(t,e){i.labelCollection=e,void 0!==i.conversation&&i.conversation.updateLabelCollection(i.labelCollection)}),this.$scope.$on(b.LabelEvents.Deleted,function(t,e){i.conversation.removeLabelById(e)}),this.$scope.$on("conversations.replied",function(t,e){i.onConversationReplied(e)}),this.$scope.$on("conversations.participants",function(t,e){i.conversation.participants=e}),this.$scope.$on("reply.btn.visibility.change",function(t,e){i.isReplyMode=!e,i.setShowSurvey()}),this.$scope.$on(r.AuthEvents.logoutOtherTab,function(){i.cancelRefresh(),i.error("LOGGEDOUT")}),this.$scope.$on("$destroy",function(){i.cancelRefresh()}),this.$scope.$on("push.conversations",function(t,e){i.conversation.share===e.shareId&&i.$state.reload()}),this.$scope.$on(o.WebSocketEvents.CONVERSATION_UPDATED,function(t,e){e===i.conversation.id&&i.refresh()}),this.$scope.$on("conversation:updated",function(t,e){i.conversation=e,i.refresh()}),this.$window.document.addEventListener("visibilitychange",e),this.$scope.$on("$destroy",function(){i.$window.document.removeEventListener("visibilitychange",e)}),void 0!==this.messagesViewEl&&this.messagesViewEl.addEventListener("scroll",function(){void 0!==t&&i.$timeout.cancel(t),t=i.$timeout(function(){i.StorageService.setItem("SESSION","offset."+i.share.id,i.messagesViewEl.scrollTop.toString())},250,!1)})},$.prototype.getLastMessageDate=function(){if(0!==this.messages.length)return this.messages[this.messages.length-1].createdDate},$.prototype.autoScroll=function(){var t=this;this.autoScroll=n.noop;var e=this.StorageService.getItem("SESSION","offset."+this.share.id);if(e)this.$timeout(function(){t.messagesViewEl.scrollTop=e},300,!1);else{var i=this.messages.filter(function(t){return t.isNew}).slice(0,1);0===i.length&&(i=this.messages.slice(-1)),0<i.length&&this.$timeout(function(){t.$anchorScroll("msg-"+i[0].id)},300,!1)}},$.prototype.openSidePane=function(){this.showInfoPane=!0},$.prototype.sidePaneClosed=function(){this.showInfoPane=!1},$.prototype.deliverMessageDirect=function(t,e){var i=this;this.ConversationsService.deliverMessage(this.conversation.id,parseInt(t),e).then(function(){i.showDeliverMessageDialog()}).catch(function(t){i.showDeliverMessageDialog(t.status)})},$.prototype.showDeliverMessageDialog=function(t){var e;switch(t){case s.HTTP_FORBIDDEN:e="FORBIDDEN";break;case s.HTTP_NOT_FOUND:e="NOT-FOUND";break;case s.HTTP_GONE:e="GONE";break;default:e="SUCCESS"}var i=m.WarningDialog.factory({title:g+".DELIVER-MESSAGE-DIALOG."+e+".TITLE",explanation:g+".DELIVER-MESSAGE-DIALOG."+e+".EXPLANATION",cancelText:"MAIN.OK",hideSubmit:!0,type:m.WarningDialogTypes.info});this.$mdDialog.show(i).then(function(){})},$);function $(t,e,i,n,o,s,r,a,c,l,u,p,d,h,f,v,m,g,S){var $=this;this.$anchorScroll=t,this.$animate=e,this.$log=i,this.$mdDialog=n,this.$rootScope=o,this.$scope=s,this.$state=r,this.$stateParams=a,this.$timeout=c,this.$window=l,this.ConversationsService=u,this.LabelService=p,this.MessengerService=d,this.$mdMedia=h,this.StorageService=f,this.SurveyService=v,this.WebSocketService=m,this.labelCollection=g,this.profile=S,this.hasEvents=!1,this.loading=!0,this.messages=[],this.messagesAndEvents=[],this.suspendedEvents=[],this.isReplyMode=!1,this.isSurveyAvailable=!1,this.showSurvey=!1,this.refreshing=!1,this.label=a.label,this.messagesViewEl=this.$window.document.getElementsByClassName("messages-view")[0],this.$animate.enabled(this.messagesViewEl,!1),this.registerEvents(),this.ConversationsService.get(this.$stateParams.conversationId).then(function(e){return $.showInfoPane=a.showInfo||!1,$.conversation=e,$.suspendedEvents=e.participants.filter(function(t){return!1===t.active}).map(function(t){var e=new b.ConversationEvent;return e.eventType="suspended",e.originator=t.email,e}),$.messagesAndEvents=Array.apply(null,Array($.conversation.counters.messages)).map(function(t,e){return{id:e}}),e.displayAsChat&&$.MessengerService.alert("CONVERSATIONS.VIEW.DISPLAY-AS-CHAT-TOAST").then(function(){$.ConversationsService.updateConversation($.conversation.id,{displayAsChat:!1})}),$.ConversationsService.getShare(e.share).then(function(t){$.share=t,$.profile.isGuest()&&$.SurveyService.getSurvey("customer_effort_score",t.id).then(function(t){$.isSurveyAvailable=t,$.setShowSurvey()}),$.$scope.$watch(function(){return $.share.downloadToken},function(t){void 0===t&&$.refreshDownloadToken()}),t.isAccessGranted()?$.refreshDownloadToken().then(function(){$.loadMessages(),void 0!==a.deliverMessageId&&$.deliverMessageDirect(a.deliverMessageId,t.accessRightGrant.token)}):$.$state.go("conversations.open",y.__assign({shareId:t.id},$.$stateParams))}).catch(function(t){$.$log.error("Error getting conversation share",{error:t}),$.$state.go("conversations.open",y.__assign({shareId:e.share},$.$stateParams))})}).catch(function(t){$.$log.error("Error getting conversation info",{error:t}),void 0!==$.conversation?$.$state.go("conversations.open",y.__assign({shareId:$.conversation.share},$.$stateParams)):$.$state.go("conversations.error",{error:"NOT_FOUND"},{location:!1})}).finally(function(){$.assignLabelFromStorage(),$.loading=!1})}e.ViewController=S,e.ViewControllerModule=n.module("app.conversations.ViewController",[i.AttachmentCarouselModule.name,a.ConversationEventModule.name,c.ConversationHeaderModule.name,l.ConversationInfoModule.name,u.ConversationLabelModule.name,p.ConversationMessageModule.name,d.ConversationQuoteModule.name,h.ConversationReplyModule.name,f.SidepaneModule.name,v.SurveyToolModule.name])}.apply(e,n))||(t.exports=o)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/img/no-preview_EN.9767e2.svg"},function(t,e,i){t.exports=i.p+"assets/img/no-preview_NL.4920a6.svg"},function(t,e,i){t.exports=i.p+"assets/tpl/AttachmentCarousel.581995.html"},function(t,e,i){},function(t,e){t.exports='<div translate-namespace=conversation-event ng-class=$ctrl.eventLevel layout=row layout-align="space-between center"> <div class=icon> <md-icon ng-bind=$ctrl.icon></md-icon> </div> <span class=text flex> {{ $ctrl.text }} </span> <time class=moment-date datetime="{{:: $ctrl.event.createdDate | date : \'yyyy-MM-dd HH:mm:ss\' }}" ng-if="$ctrl.event.createdDate !== undefined"> {{ $ctrl.event.createdDate | momentAgo }} </time> </div> '},function(t,e,r){var i,n;i=[r,e,r(1),r(8),r(443)],void 0===(n=function(t,e,i,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(s.$inject=["$log","$scope","ConversationsService","LabelService"],s.prototype.$onInit=function(){this.mini=void 0!==this.mini&&this.mini,this.backgroundColor=this.getPastelColorFor(this.label),this.registerEvents()},s.prototype.registerEvents=function(){var n=this;this.$scope.$on(o.LabelEvents.Updated,function(t,e){var i=e.userLabels.filter(function(t){return t.id===n.label.id})[0];n.label.labelColor=i.labelColor})},s.prototype.$doCheck=function(){this.backgroundColor=this.getPastelColorFor(this.label)},s.prototype.removeSelf=function(){var e=this,t=this.conversation.customLabels.filter(function(t){return t.id!==e.label.id}),i=this.ConversationsService.setConversationLabels(this.conversation,t);i.then(function(){e.LabelService.getLabelsAndBroadcast()}),i.catch(function(t){e.$log.warn("Setting labels failed...",t)})},s.prototype.getPastelColorFor=function(t){if(!1===t.isSystemLabel)return void 0===o.LabelColors[t.labelColor]?(this.$log.warn("No pastel color defined for "+t.labelColor),"#FFFFFF"):o.LabelColors[t.labelColor];switch(t.name.toLowerCase()){case"inbox":return"#AFD5E9";case"archive":return"#FF9999";default:return"#FFFFFF"}},s);function s(t,e,i,n){this.$log=t,this.$scope=e,this.ConversationsService=i,this.LabelService=n}e.ConversationLabelComponent=n,e.ConversationLabelModule=i.module("components.ConversationLabel",[]).component("conversationLabel",{bindings:{label:"<",mini:"<",conversation:"<"},controller:n,template:r(444)})}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e){t.exports="<div class=pricetag ng-class=\"{ 'pricetag-mini' : $ctrl.mini }\" ng-style=\"{'background': $ctrl.backgroundColor, 'border-color': $ctrl.label.labelColor}\"> <div ng-if=\"$ctrl.mini === false\" ng-click=$ctrl.removeSelf() class=remove> <md-icon>close</md-icon> </div> {{ $ctrl.label.name }} </div> "},function(t,e,b){var i,n;i=[b,e,b(7),b(1),b(10),b(8),b(446),b(457),b(460),b(463),b(467),b(9),b(468),b(29),b(13),b(471),b(474),b(60),b(479)],void 0===(n=function(t,e,s,i,n,o,r,a,c,l,u,p,d,h,f,v,m,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var S="conversation-message",$=(y.$inject=["$scope","$element","$injector","$log","$mdMedia","$q","$rootScope","$state","$timeout","$mdDialog","$translate","ConversationsService","DeviceService","MessengerService","PrintService"],y.prototype.$onInit=function(){var t=this;this.canCreateDraft=!1===this.profile.isGuest(),this.showCounters=this.profile.email===this.message.sender,void 0!==this.conversation&&(this.canQuote=void 0===this.conversation.flow||this.conversation.flow.allowQuote);try{this.sender=this.getSender()}catch(t){this.$log.error(t,{messageId:this.message.id,shareId:this.share.id})}this.setContentTypeClass(),this.$scope.$on("reset-access-from-bar",function(){return t.unRevokeAccess()}),this.$scope.$on("edit-settings-from-bar",function(){return t.revokeAccess()})},y.prototype.getSender=function(){var e=this;if(void 0===this.conversation)throw new Error("no conversation nor quote defined");var t=this.conversation.participants.filter(function(t){return t.email===e.message.sender})[0];return void 0!==t?t:new o.Participant({email:this.message.sender,active:!0})},y.prototype.setContentTypeClass=function(){this.contentType=this.message.contentType.replace("/","-")},y.prototype.openMenu=function(t,e){t.open(e)},y.prototype.revokeAccess=function(){var o=this,t={isDraft:!1,isEnabled:void 0!==this.message.scheduledExpiration&&void 0!==this.message.scheduledExpiration.expiresAt,scheduledExpiration:s.__assign({},this.message.scheduledExpiration)},e=g.ExpirationDialog.factory(t);this.$q(function(i,n){o.$mdDialog.show(e).then(function(t){if(!1===t.isEnabled)o.ConversationsService.unscheduleAccessRemoval(o.conversation.id,o.message.id).then(function(){o.$log.debug("Scheduled expiration removed",{conversationId:o.conversation.id,messageId:o.message.id}),o.MessengerService.toast(S+".COUNTERMAND.SUCCESS",{},!0),i()}).catch(function(t){o.$log.error("An error has occurred while removing a scheduled expiration",{error:t}),o.MessengerService.toast(S+".COUNTERMAND.ERROR",{},!0),n(t)});else if(void 0!==t.scheduledExpiration.expiresIn){var e=f.WarningDialog.factory({title:S+"."+t.scheduledExpiration.action.toUpperCase()+"-WARN.TITLE",explanation:S+"."+t.scheduledExpiration.action.toUpperCase()+"-WARN.SCHEDULED",submitText:"MAIN.OK",type:"delete"===t.scheduledExpiration.action?f.WarningDialogTypes.error:f.WarningDialogTypes.info});o.$mdDialog.show(e).then(function(){o.ConversationsService.scheduleAccessRemoval(o.conversation.id,o.message.id,{expiresIn:t.scheduledExpiration.expiresIn,action:t.scheduledExpiration.action}).then(function(){o.message.scheduledExpiration=s.__assign({},t.scheduledExpiration),i()}).catch(function(t){return n(t)})})}else e=f.WarningDialog.factory({title:S+"."+t.scheduledExpiration.action.toUpperCase()+"-WARN.TITLE",explanation:S+"."+t.scheduledExpiration.action.toUpperCase()+"-WARN.DIRECT",submitText:"MAIN.OK",type:"delete"===t.scheduledExpiration.action?f.WarningDialogTypes.error:f.WarningDialogTypes.info}),o.$mdDialog.show(e).then(function(){o.ConversationsService.revokeMessage(o.conversation.id,o.message.id,t.scheduledExpiration.action).then(function(){o.message.scheduledExpiration=s.__assign({},t.scheduledExpiration),o.message.revoked=!0,i()}).catch(function(t){n(t)})})})}).then(function(){o.$log.debug("Scheduled access revoke set",{conversationId:o.conversation.id,messageId:o.message.id,action:o.message.scheduledExpiration.action,date:o.message.scheduledExpiration.expiresAt}),o.$rootScope.$broadcast("conversation:updated",o.conversation)}).catch(function(t){o.$log.error("Error occurred while trying to revoke the message",{error:t}),o.MessengerService.toast(S+".REVOKE-ERROR",{},!0)})},y.prototype.unRevokeAccess=function(){var t=this,e=f.WarningDialog.factory({title:S+".UNREVOKE-TITLE",explanation:S+".UNREVOKE-CONFIRM",submitText:"MAIN.OK",type:f.WarningDialogTypes.info});this.$mdDialog.show(e).then(function(){t.ConversationsService.unrevokeMessage(t.conversation.id,t.message.id).then(function(){t.message.revoked=!1})})},y.prototype.downloadMessage=function(e,t){var i=this;if(void 0!==this.downloadMessageUrl)return this.DeviceService.simulateMouseClick(this.$element[0].querySelector(".downloadMessage")),void this.$timeout(function(){i.downloadMessageUrl=void 0},300,!1);e.preventDefault(),this.ConversationsService.getMessageDownloadUrl(this.share,this.conversation.id,this.message.id,t).then(function(t){i.downloadMessageUrl=t,i.$scope.$watch(function(){return i.share.downloadToken},function(t){void 0===t&&(i.downloadMessageUrl=void 0)}),i.DeviceService.simulateMouseClick(e.target)}).catch(function(t){i.$log.error("Could not get attachment download url",{error:t})})},y.prototype.replyMessage=function(){this.forkMessage("reply",[this.message.participant])},y.prototype.forwardMessage=function(){this.forkMessage("forward")},y.prototype.forkMessage=function(t,e){if(!1!==this.canCreateDraft){var i={draftType:t,quote:{conversationId:this.conversation.id,messageIds:[this.message.id]},share:this.share,subject:("forward"===t?"FW":"RE")+": "+this.conversation.subject};void 0!==e&&(i.recipients=e.map(function(t){return new p.Recipient({email:t.email,fullName:t.fullName})})),this.$state.go("drafts.create",i)}else this.$log.warn("Guest user is trying to reply or user can not create drafts.")},y.prototype.printMessage=function(){this.PrintService.printConversation(this.conversation,this.$element[0].parentElement)},y.prototype.isValidDomain=function(){var e=this.profile.email.split("@")[1];return["zivver.com","hummingbirdair.eu","nectartransport.eu","eurocross.nl"].some(function(t){return t===e})},y.prototype.getSecurityLevel=function(){var s=this;this.ConversationsService.getSecurityLevel(this.profile.email).then(function(t){var e=s.$translate.use().toLowerCase(),i=S+".DIALOG.SEND-COPY.TLS",n="tls";"dane"===t.toLowerCase()&&(i=S+".DIALOG.SEND-COPY.DANE",n="dane");var o=f.WarningDialog.factory({title:S+".DIALOG.SEND-COPY.TITLE",explanation:i,explanationParams:{link:"https://docs.zivver.com/"+e+"/references/general/save-zivver-message.html"},submitText:"MAIN.SEND",type:f.WarningDialogTypes.info,translate:!0});s.$mdDialog.show(o).then(function(){return s.sendCopyToInbox(n)})}).catch(function(t){s.MessengerService.toast(S+".DIALOG.SEND-COPY.ERROR"),s.$log.error("Error getting security level",{error:t})})},y.prototype.sendCopyToInbox=function(t){var e=this;this.ConversationsService.sendCopyToInbox(this.conversation.id,this.message.id,t).then(function(){return e.$log.info("copy of message sent successfully")})},y.prototype.openSidePane=function(){this.showSidePane=!0},y.prototype.closeSidePane=function(){this.showSidePane=!1},y.prototype.showExpirationBar=function(){return!0===this.message.revoked||(void 0!==this.message.scheduledExpiration?this.message.scheduledExpiration.action&&this.message.scheduledExpiration.expiresAt&&!1===this.message.deleted:void 0)},y.prototype.openServicesDialog=function(t){this.$mdDialog.show(m.ConnectedServicesDialog.factory(this.conversation.id,t.id,this.share.accessRightGrant.token))},y.prototype.isRevokedBccQuote=function(){return void 0!==this.message.quote&&!0===this.message.revoked&&void 0!==this.message.quote.messages[0]&&!0===this.message.quote.messages[0].isBcc&&null===this.message.quote.messages[0].body},y.prototype.showOriginal=function(){var e=this;this.ConversationsService.get(this.message.quote.conversationInfo.id).then(function(t){e.$state.go("conversations.open",{shareId:t.share,label:t.systemLabel.name},{reload:!0})})},y.prototype.showRevokedNotice=function(){return(void 0===this.message.deleted||!1===this.message.deleted)&&this.message.revoked},y.prototype.getMessageAction=function(){return void 0===this.message.scheduledExpiration&&!0===this.message.revoked&&this.message.isOwn?"revoked-own":this.message.isOwn&&void 0!==this.message.scheduledExpiration.action?"revoke"===this.message.scheduledExpiration.action?"revoke-own-recipients":"revoke-own-everyone":this.message.scheduledExpiration.action},y.prototype.showRevokeButton=function(){return this.message.isOwn&&!1===this.message.revoked},y.prototype.hasActions=function(){return!0===this.message.isOwn||!0===this.canCreateDraft},y.prototype.showSenderWithLink=function(){return void 0===this.message.sentByDelegate&&(!1===this.message.isOwn||void 0===this.message.isOwn)&&!0===this.canCreateDraft},y.prototype.showSender=function(){return void 0===this.message.sentByDelegate&&(!0===this.message.isOwn||!1===this.canCreateDraft)},y);function y(t,e,i,n,o,s,r,a,c,l,u,p,d,h,f){this.$scope=t,this.$element=e,this.$injector=i,this.$log=n,this.$mdMedia=o,this.$q=s,this.$rootScope=r,this.$state=a,this.$timeout=c,this.$mdDialog=l,this.$translate=u,this.ConversationsService=p,this.DeviceService=d,this.MessengerService=h,this.PrintService=f,this.showSidePane=!1}e.ConversationMessage=$,e.ConversationMessageModule=i.module("components.ConversationMessage",[l.MessageCountersModule.name,d.MessageInfoComponentModule.name,r.ConversationAttachmentsModule.name,a.ConversationMessageBodyModule.name,c.ConversationSpecialModule.name,v.ExpirationBarModule.name,u.MomentAgoFilterModule.name,h.SidepaneModule.name,f.WarningDialogModule.name]).component("conversationMessage",{bindings:{conversation:"<",downloadToken:"<",message:"<",profile:"<",share:"<"},controller:$,template:b(480)})}.apply(e,i))||(t.exports=n)},function(t,e,p){var i,n;i=[p,e,p(1),p(162),p(447),p(29),p(164),p(453)],void 0===(n=function(t,e,i,n,o,s,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=p(454),c=p(455),l=(u.$inject=["$element","$injector","$log","$scope","$translate","ConversationsService","DeviceService","MediaService","MessengerService"],u.prototype.$onChanges=function(t){var e=this,i=t.attachments,n=t.downloadToken;void 0!==i&&i.isFirstChange()&&i.currentValue.forEach(function(t){e.canPreview(t)?(e.getPreviewThumbnail(t),e.previews.push(t)):e.noPreviews.push(t)}),void 0!==n&&(this.previews.forEach(function(t){return t.downloadUrl=e.getDownloadUrl(e.share.id,t.id,n.currentValue)}),this.noPreviews.forEach(function(t){return t.downloadUrl=e.getDownloadUrl(e.share.id,t.id,n.currentValue)}))},u.prototype.getDownloadUrl=function(t,e,i){return"/api/shares_in/"+t+"/files/"+e+"/download/content?download_token="+i},u.prototype.preview=function(t,e){if(t.stopPropagation(),t.preventDefault(),e.isPdf())return e.downloadUrl+="&content_disposition=false",void window.open(e.downloadUrl,"_blank");this.previewAttachment=e},u.prototype.downloadAttachment=function(t,e){!1===e.downloadable&&(t.preventDefault(),this.$log.warn("Attached file is not downloadable",{share:this.share.id,file:e.id}),this.MessengerService.toast("conversation-attachments.NOT-DOWNLOADABLE",{},!0))},u.prototype.getPreviewThumbnail=function(e){var i=this;e.isPdf()?e.setBackgroundImage(c,!0):e.isImage()&&(e.setBackgroundImage(a,!0),this.ConversationsService.getFileDownloadUrl(this.share,e.id).then(function(t){e.isSvg()?e.setBackgroundImage(t,!1):i.MediaService.resize(t,240,150,"fitIn").then(function(t){i.preloadImage(e,t)})}))},u.prototype.canPreview=function(t){return!!t.isImage()||!!t.isPdf()},u.prototype.preloadImage=function(t,e){var i=this,n=this.$element[0],o=document.createElement("img");o.src=e,o.classList.add("preload"),o.onload=function(){t.setBackgroundImage(e,!1),n.removeChild(o)},o.onerror=function(){i.$log.error("Could not load attachment thumbnail",{fileId:t.id,fileSize:t.size}),n.removeChild(o)},n.appendChild(o)},u.prototype.isSelectedAttachment=function(t){return!0===this.showSidePane&&void 0!==this.attachment&&this.attachment.id===t.id},u.prototype.openPaneInfo=function(t,e){t.preventDefault(),this.attachment=e,this.openSidePane()},u.prototype.openSidePane=function(){this.showSidePane=!0},u.prototype.closeSidePane=function(){this.showSidePane=!1},u);function u(t,e,i,n,o,s,r,a,c){this.$element=t,this.$injector=e,this.$log=i,this.$scope=n,this.$translate=o,this.ConversationsService=s,this.DeviceService=r,this.MediaService=a,this.MessengerService=c,this.previews=[],this.noPreviews=[],this.showSidePane=!1}e.ConversationAttachments=l,e.ConversationAttachmentsModule=i.module("zivver.components.conversationAttachments",[n.AttachmentCarouselModule.name,o.AttachmentInfoModule.name,r.FormatBytesFilterModule.name,s.SidepaneModule.name]).component("conversationAttachments",{bindings:{profile:"<",attachments:"<",share:"<",downloadToken:"<"},controller:l,template:p(456)})}.apply(e,i))||(t.exports=n)},function(t,e,a){var i,n;i=[a,e,a(1),a(8),a(448),a(449)],void 0===(n=function(t,e,i,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=(r.$inject=["$scope","$log","ConversationsService"],r.prototype.$onInit=function(){var t=this;void 0!==this.share&&void 0!==this.attachment?this.$scope.$watch(function(){return t.attachment.id},function(){t.getAttachmentInfo()},!0):this.$log.warn("AttachmentInfo: Share or Attachment undefined")},r.prototype.getAttachmentInfo=function(){var e=this;this.ConversationsService.getAttachmentInfo(this.share.id,this.attachment.id).then(function(t){e.opens=t.openedBy.map(function(t){return new n.Participant(t)}).sort(e.sortParticipants),e.notYetOpened=t.notYetOpenedBy.map(function(t){return new n.Participant(t)}).sort(e.sortParticipants)}).catch(function(t){403===t.status?e.$log.debug("Not all attachment info is provided to recipients of a message"):e.$log.warn("Error getting attachment info",{error:t})})},r.prototype.sortParticipants=function(t,e){return t.fullNameOrEmail().localeCompare(e.fullNameOrEmail())},r);function r(t,e,i){this.$scope=t,this.$log=e,this.ConversationsService=i,this.opens=[],this.notYetOpened=[]}e.AttachmentInfoModule=i.module("zivver.components.AttachmentInfo",[o.FiletypeIconModule.name]).component("attachmentInfo",{bindings:{profile:"<",share:"<",attachment:"<"},controller:s,templateUrl:a(450)})}.apply(e,i))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(1)],void 0===(o=function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.$inject=["$scope","$window","$element"],n.prototype.setIcon=function(t){var e;e=t.isImage()||t.isSvg()?"photo":t.isPdf()?"image_in_pdf":"description",this.$element[0].innerHTML=e},n);function n(t,e,i){var n=this;this.$scope=t,this.$window=e,this.$element=i,this.attachment=t.attachment,this.setIcon(this.attachment),this.$scope.$watch(function(){return t.attachment},function(t,e){!1===o.equals(t,e)&&n.setIcon(t)},!0)}e.FiletypeIconModule=o.module("zivver.FiletypeIcon",[]).directive("filetypeIcon",function(){return{restrict:"A",scope:{attachment:"<"},controller:i}})}.apply(e,n))||(t.exports=o)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/AttachmentInfo.be22d8.html"},function(t,e,i){},function(t,e){t.exports='<md-sidenav md-component-id=sidepane class="md-sidenav-right md-whiteframe-4dp"> <md-toolbar class=md-theme-light layout=row layout-align="space-between center"> <md-button class=md-icon-button ng-click=$ctrl.closePane()> <md-icon>arrow_forward</md-icon> </md-button> <h1 class="md-toolbar-tools md-truncate" ng-transclude=title></h1> </md-toolbar> <md-content ng-transclude=content></md-content> </md-sidenav> '},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/img/filetype-image.6a4fef.svg"},function(t,e,i){t.exports=i.p+"assets/img/filetype-pdf.a24136.svg"},function(t,e){t.exports='<div class=previews> <div ng-repeat="att in $ctrl.previews track by att.id" class=attachment ng-class="{ \'selected\' : $ctrl.isSelectedAttachment(att) }"> <div class=preview ng-click="$ctrl.preview($event, att);" ng-style=att.style> <md-icon>remove_red_eye</md-icon> </div> <a class=download ng-click="$ctrl.downloadAttachment($event, att);" ng-href="{{ att.downloadUrl }}" download="{{:: att.name }}" target=_blank> <md-icon>file_download</md-icon> <span class="truncate filename" title="{{:: att.name }} ({{:: att.size | formatBytes }})"> {{ att.name }} </span> </a> <a class=info ng-click="$ctrl.openPaneInfo($event, att);"> <md-icon>info</md-icon> </a> </div> </div> <div class=noPreviews> <div ng-repeat="att in $ctrl.noPreviews track by att.id" ng-class="{ \'selected\' : $ctrl.isSelectedAttachment(att) }" class=attachment> <a class=download ng-click="$ctrl.downloadAttachment($event, att);" ng-href="{{ att.downloadUrl }}" download="{{:: att.name }}" target=_blank> <md-icon>file_download</md-icon> <span class="truncate filename" title="{{:: att.name }} ({{:: att.size | formatBytes }})"> {{ att.name }} </span> </a> <a class=info ng-click="$ctrl.openPaneInfo($event, att);"> <md-icon>info</md-icon> </a> </div> </div> <attachment-carousel ng-if="$ctrl.previewAttachment !== undefined" attachments=$ctrl.previews preview-attachment=$ctrl.previewAttachment download-token=$ctrl.downloadToken share=":: $ctrl.share"> </attachment-carousel> <sidepane ng-if="$ctrl.showSidePane === true && $ctrl.attachments.length > 0" on-close=$ctrl.closeSidePane()> <pane-title> <translate>conversation-attachments.ATTACHMENT-PANE</translate> </pane-title> <pane-content> <attachment-info ng-if="$ctrl.attachment !== undefined" attachment=$ctrl.attachment share=$ctrl.share profile=$ctrl.profile></attachment-info> </pane-content> </sidepane> '},function(t,e,s){var i,n;i=[s,e,s(1),s(458)],void 0===(n=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$q","$filter","$sce","ConversationsService","MediaService","SanitizeService"],o.prototype.$onInit=function(){switch(this.contentType){case"text/html":this.setHtmlContent();break;case"text/plain":this.setTextContent()}this.contentType=this.contentType.replace("/","-")},o.prototype.setTextContent=function(){if(this.body){var t=this.$filter("linky")(this.body,"_blank",{rel:"noopener noreferrer"});t=t.replace(/(\r\n|\n\r|\r|\n|&#10;&#13;|&#13;&#10;|&#10;|&#13;)/g,"<br/>$1"),this.trustedBody=this.$sce.trustAsHtml(t)}},o.prototype.setHtmlContent=function(){for(var t=this,e=this.SanitizeService.sanitizeHtml(this.body,this.inlineImages),n=[],i=function(e){if(e.classList.contains("external")){var t=o.MediaService.proxy(e.getAttribute("title")).then(function(t){e.setAttribute("src",t)});n.push(t)}else if(e.classList.contains("internal")){var i=e.getAttribute("attachmentId");t=o.ConversationsService.getFileDownloadUrl(o.share,i).then(function(t){e.setAttribute("src",t)}),n.push(t)}},o=this,s=0,r=[].slice.call(e.querySelectorAll("img"));s<r.length;s++)i(r[s]);this.$q.all(n).then(function(){t.trustedBody=t.$sce.trustAsHtml(e.innerHTML)})},o);function o(t,e,i,n,o,s){this.$q=t,this.$filter=e,this.$sce=i,this.ConversationsService=n,this.MediaService=o,this.SanitizeService=s}e.ConversationMessageBody=n,e.ConversationMessageBodyModule=i.module("components.ConversationMessageBody",[]).component("conversationMessageBody",{bindings:{body:"<",contentType:"<",inlineImages:"<",share:"<"},controller:n,template:s(459)})}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e){t.exports='<div class="message-body content-type-{{ $ctrl.contentType }}" ng-bind-html=$ctrl.trustedBody ng-if="$ctrl.body.length > 0"> </div> '},function(t,e,c){var i,n;i=[c,e,c(1),c(10),c(15),c(14),c(461)],void 0===(n=function(t,e,i,s,o,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(a.$inject=["$q","$log","ConversationsService","SpecialsService","MediaService"],a.prototype.$onInit=function(){var n=this,t=this.SpecialsService.translateFormDefinition(new o.FormDefinition(this.message.messageDefinition.formDefinition));try{this.specialData=JSON.parse(this.message.body)}catch(t){return void this.$log.error("ConversationSpecial::Could not parse special JSON",{error:t})}t.sections.forEach(function(t){t.components.forEach(function(t){var e=n.specialData.data[t.key];if(void 0!==e){if("inputImage"===t.componentType){var i=[].concat(n.message.files,n.message.inlineImages).filter(function(t){return t.id===e})[0];n.images.push(i),t.attachment=i,n.renderImageItem(t)}e instanceof Array?t.answerArray=e.map(function(t){return new o.FormChoice({value:t})}):t.answer=new o.FormChoice({value:e})}else t.visible=!1})}),this.sections=t.sections.filter(function(t){return 0<t.components.filter(function(t){return void 0!==t.renderType}).length}).filter(function(t){return 0<t.components.filter(function(t){return null!==t.getAnswer()}).length})},a.prototype.renderTextItem=function(i){var n=this,t=i.getAnswer();if(null===t)return"-";if("inputDate"===i.componentType)return s(t).format("D MMMM YYYY");var e=[];if(e=t instanceof Array?t:[t],void 0!==i.choices&&0<i.choices.length){var o=[];return e.forEach(function(e){var t=i.choices.filter(function(t){return t.value===e});0===t.length?n.$log.warn("Could not find choice for answer",{answer:e,choices:i.choices}):o.push(t[0].labelTranslated)}),o.join(", ")}return e.join(", ")},a.prototype.renderImageItem=function(e){var i=this;e.imgUrl=r.BLANK_GIF,!1!==e.attachment.downloadable?this.getDownloadUrl(e.attachment).then(function(t){return e.attachment.downloadUrl=t,i.MediaService.resize(t,320,240)}).then(function(t){e.imgUrl=t}).catch(function(t){i.$log.error("Error getting special image download/thumbail url",{error:t,fileId:e.attachment.id,shareId:i.share.id})}):this.$log.warn("Attached file in conversation-special is not downloadable",{share:this.share.id,file:e.attachment.id})},a.prototype.openCarousel=function(t){this.previewAttachment=t},a.prototype.getDownloadUrl=function(i){var n=this;return this.$q(function(e){if(!1===i.downloadable)return n.$log.warn("Attached file in conversation-special is not downloadable",{share:n.share.id,file:i.id}),e(r.BLANK_GIF);var t=n.ConversationsService.getFileDownloadUrl(n.share,i.id);t.then(function(t){e(t)}),t.catch(function(t){n.$log.error("Could not get download url",{error:t,file:i}),e(r.BLANK_GIF)})})},a);function a(t,e,i,n,o){this.$q=t,this.$log=e,this.ConversationsService=i,this.SpecialsService=n,this.MediaService=o,this.images=[]}e.ConversationSpecial=n,e.ConversationSpecialModule=i.module("components.conversationSpecial",[]).component("conversationSpecial",{bindings:{downloadToken:"<",message:"<",share:"<"},controller:n,templateUrl:c(462)})}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/ConversationSpecial.2182ce.html"},function(t,e,s){var i,n;i=[s,e,s(1),s(464)],void 0===(n=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$translate"],o.prototype.$onInit=function(){this.updateFlags()},o.prototype.$onChanges=function(t){t.counters&&this.$onInit()},o.prototype.hasParticipants=function(){return void 0!==this.participants},o.prototype.updateFlags=function(){var t=this.counters.opens;if(!1!==this.hasParticipants()){if(t===this.participants.length)return this.opensIcon="drafts",void(this.opensTooltip=this.translate("OPENS-TOOLTIP.ALL"));if(1===t&&t<this.participants.length)return this.opensIcon="mail",void(this.opensTooltip=this.translate("OPENS-TOOLTIP.NONE"));this.opensIcon="drafts",this.opensTooltip=this.translate("OPENS-TOOLTIP.SOME")}},o);function o(i){this.bccIcon=s(465),this.translate=function(t,e){return i.instant("message-counters."+t,e)}}e.MessageCounters=n,e.MessageCountersModule=i.module("components.MessageCounters",[]).component("messageCounters",{bindings:{counters:"<",isBcc:"<",participants:"<",quoted:"<"},controller:n,template:s(466)})}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/img/bcc.947132.svg"},function(t,e){t.exports='<div translate-namespace=message-counters class=message-counters ng-class="{\n\t\t\'warn\' : $ctrl.counters.hardBounces > 0\n\t}" ng-if=$ctrl.hasParticipants()> <div class=counters> <div ng-if="$ctrl.counters.hardBounces > 0" class=hard-bounces> <span>{{ $ctrl.counters.hardBounces }}</span> <md-icon>call_missed_outgoing</md-icon> <md-tooltip md-direction=left md-delay=500> <translate translate-values="{ count: $ctrl.counters.hardBounces }">.HARD-BOUNCES-TOOLTIP</translate> </md-tooltip> </div> <div ng-if="$ctrl.counters.softBounces > 0"> <span>{{ $ctrl.counters.softBounces }}</span> <md-icon>beach_access</md-icon> <md-tooltip md-direction=left md-delay=500> <translate translate-values="{ count: $ctrl.counters.softBounces }">.SOFT-BOUNCES-TOOLTIP</translate> </md-tooltip> </div> <div> <md-icon ng-class="{\n\t\t\t\t\t\'md-primary\': $ctrl.counters.opens >= $ctrl.participants.length\n\t\t\t\t}" ng-bind=$ctrl.opensIcon aria-label="Opening counter"> </md-icon> <md-tooltip md-direction=left md-delay=500> {{ $ctrl.opensTooltip }} </md-tooltip> </div> <div ng-if="$ctrl.quoted === true && $ctrl.isBcc === false" flex flex-xs=100> <md-icon class=forward-icon md-svg-src=ziv:forward-arrow aria-label="Quoted counter"> </md-icon> <md-tooltip md-direction=left md-delay=500> <translate>.QUOTED</translate> </md-tooltip> </div> <div ng-if=$ctrl.isBcc flex flex-xs=100> <img class=bcc-icon ng-src="{{ $ctrl.bccIcon }}"/> <md-tooltip md-direction=left md-delay=500> <translate>.BCC</translate> </md-tooltip> </div> </div> </div> '},function(t,e,i){var n,o;n=[i,e,i(1),i(10)],void 0===(o=function(t,e,i,u){"use strict";function n(l){return function(t){var e=u(new Date),i=u(t.toISOString()),n=e.diff(i,"days"),o=e.isSame(i,"year"),s=o&&n<1,r=!(o&&n<=14),a=(l("xs")||s||r?"":"ddd, ")+(s?"":"D MMM")+(o?"":" YYYY")+(s?"HH:mm":", HH:mm"),c=l("xs")||r?"":" ("+u(i).fromNow()+")";return(i.format(a)+c).replace(/\.,/g,".")}}Object.defineProperty(e,"__esModule",{value:!0}),e.momentAgo=n,e.MomentAgoFilterModule=i.module("filters.momentAgo",[]).filter("momentAgo",["$mdMedia",n])}.apply(e,n))||(t.exports=o)},function(t,e,a){var i,n;i=[a,e,a(1),a(8),a(56),a(469)],void 0===(n=function(t,e,i,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=(r.$inject=["$scope","$log","ConversationsService"],r.prototype.$onInit=function(){var t=this;void 0!==this.message.sentByDelegate&&(this.sentBy=[new n.Participant(this.message.sentByDelegate)]),this.$scope.$watch(function(){return t.message},function(){t.message&&void 0!==t.message&&t.getReadInfo()},!0)},r.prototype.getReadInfo=function(){var i=this;void 0!==this.conversation&&this.ConversationsService.getMessageOpenedBy(this.conversation.id,this.message.id).then(function(t){i.opens=t.openedBy.map(function(t){return new n.Participant(t)}).filter(i.filterParticipants.bind(i)).sort(i.sortParticipants),i.bccRecipients=t.bccRecipients.map(function(t){return new n.Participant(t)}).filter(i.filterParticipants.bind(i)).sort(i.sortParticipants),i.notYetOpened=t.notYetOpenedBy.map(function(t){return new n.Participant(t)}).filter(i.filterParticipants.bind(i)).sort(i.sortParticipants),i.quotedBy=(t.quotedBy||[]).map(function(t){return{count:t.count,participant:new n.Participant(t.participant)}}).sort(function(t,e){return i.sortParticipants(t.participant,e.participant)}),i.outOfOffice=t.softBouncedBy.map(function(t){return new n.Participant(t)}).sort(i.sortParticipants),i.bounces=t.hardBouncedBy.map(function(t){return new n.Participant(t)}).sort(i.sortParticipants)}).catch(function(t){i.$log.warn("Error getting conversation message read info",{error:t})})},r.prototype.filterParticipants=function(t){return 1===this.conversation.participants.length||t.email!==this.profile.email},r.prototype.sortParticipants=function(t,e){return t.fullNameOrEmail().localeCompare(e.fullNameOrEmail())},r);function r(t,e,i){this.$scope=t,this.$log=e,this.ConversationsService=i,this.infoType="MESSAGE",this.bounces=[],this.notYetOpened=[],this.opens=[],this.bccRecipients=[],this.outOfOffice=[],this.sentBy=[],this.quotedBy=[]}e.MessageInfoComponentModule=i.module("zivver.components.MessageInfo",[o.ParticipantsListModule.name]).component("messageInfo",{bindings:{conversation:"<",message:"<",profile:"<"},controller:s,templateUrl:a(470)})}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/MessageInfo.d3f290.html"},function(t,e,r){var i,n;i=[r,e,r(1),r(10),r(472)],void 0===(n=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(s.$inject=["$mdDialog","$mdMedia","$rootScope","$scope","$translate"],s.prototype.$onInit=function(){var t=this;n.locale(""+this.$translate.use()),this.translateDescription(),this.$rootScope.$on("$translateChangeSuccess",function(){t.translateDescription()})},s.prototype.translateDescription=function(){void 0!==this.scheduledExpiration?(this.expirationDuration=n(this.scheduledExpiration.expiresAt).fromNow(),this.description=this.translate(this.action.toUpperCase(),{expirationDuration:this.expirationDuration,actor:this.actor})):this.description=this.translate(this.action.toUpperCase(),{actor:this.actor})},s.prototype.editExpirationSetting=function(){this.$scope.$emit("edit-settings-from-bar")},s.prototype.resetAccess=function(){this.$scope.$emit("reset-access-from-bar")},s.prototype.showEditButton=function(){return"revoked-own"!==this.action&&!0===this.isOwn},s.prototype.showResetButton=function(){return"revoked-own"===this.action&&!0===this.isOwn},s);function s(t,e,i,n,o){this.$mdDialog=t,this.$mdMedia=e,this.$rootScope=i,this.$scope=n,this.$translate=o,this.translate=function(t,e){return o.instant("expiration-bar."+t,e)}}e.ExpirationBar=o,e.ExpirationBarModule=i.module("components.ExpirationBar",[]).component("expirationBar",{bindings:{action:"<",actor:"<",isOwn:"<",scheduledExpiration:"<"},controller:o,template:r(473)})}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e){t.exports='<div flex ng-class=$ctrl.action layout=row layout-align="space-between center" translate-namespace=expiration-bar> <div aria-label="Open expiration settings" layout=row layout-align="space-between center"> <div flex> <md-icon ng-class=$ctrl.action class=left-icon>history</md-icon> <span class=description>{{ $ctrl.description }}</span> </div> <md-button ng-if=$ctrl.showEditButton() ng-click=$ctrl.editExpirationSetting()> <translate>.EDIT</translate> </md-button> <md-button ng-if=$ctrl.showResetButton() ng-click=$ctrl.resetAccess()> <translate>.RESET</translate> </md-button> </div> </div> '},function(t,e,s){var i,n;i=[s,e,s(475)],void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="services-dialog",n=(o.$inject=["$log","$mdDialog","ConnectedServicesService","ConversationsService","MessengerService","conversationId","messageId","token"],o.factory=function(t,e,i){return{controller:o,locals:{conversationId:t,messageId:e,token:i},templateUrl:s(476)}},o.prototype.$onInit=function(){this.listConnectedServices()},o.prototype.cancel=function(){this.$mdDialog.cancel()},o.prototype.listConnectedServices=function(){var e=this;return this.ConnectedServicesService.listAsUser().then(function(t){e.services=t.items.filter(function(t){return!0===t.enabled})}).catch(function(t){e.$log.error("Error getting list of organization services in share dialog",{error:t}),e.error=!0}).finally(function(){e.loading=!1})},o.prototype.selectService=function(t){this.serviceId=t.id},o.prototype.submit=function(){var e=this;this.sharing=!0,this.ConversationsService.deliverWithService(this.conversationId,this.messageId,this.token,this.serviceId).then(function(){e.serviceId=void 0,e.MessengerService.toast(i+".TOAST.SUCCESS")}).catch(function(t){e.MessengerService.toast(i+".TOAST.FAILED")}).finally(function(){e.sharing=!1,e.$mdDialog.hide()})},o);function o(t,e,i,n,o,s,r,a){this.$log=t,this.$mdDialog=e,this.ConnectedServicesService=i,this.ConversationsService=n,this.MessengerService=o,this.conversationId=s,this.messageId=r,this.token=a,this.services=[],this.loading=!0,this.sharing=!1,this.error=!1}e.ConnectedServicesDialog=n}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/ConnectedServicesDialog.382a4c.html"},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/ExpirationDialog.42ae4a.html"},function(t,e,i){},function(t,e){t.exports='<md-card id="msg-{{:: $ctrl.message.id }}" translate-namespace=conversation-message layout-wrap ng-class="{\n\t\t\'own\' : $ctrl.message.isOwn === true,\n\t\t\'new\': $ctrl.message.isNew === true,\n\t\t\'revoked\' : $ctrl.message.revoked === true,\n\t\t\'selected\' : $ctrl.showSidePane === true\n\t}"> <div layout=row flex> <expiration-bar ng-if=$ctrl.showExpirationBar() action=$ctrl.getMessageAction() actor=$ctrl.message.sender is-own=$ctrl.message.isOwn scheduled-expiration=$ctrl.message.scheduledExpiration> </expiration-bar> </div> <div class=header-container layout=row layout-align="space-between start" ng-class="{\'hasExpirationBar\': $ctrl.showExpirationBar()}"> <md-card-header> <md-card-avatar> <participant-avatar participant=":: $ctrl.sender" show-presence=true></participant-avatar> </md-card-avatar> <md-card-header-text> <span class=md-title layout=row layout-align="space-between center"> <div class=sender-info flex> <span class="truncate fullname" ng-if=$ctrl.sender.fullName> {{:: $ctrl.sender.fullName }} </span> <span class="truncate md-subhead sender"> <span class="truncate sent-by" ng-if=":: $ctrl.message.sentByDelegate" translate translate-values="{ delegate : $ctrl.message.sentByDelegate.fullName}"> .SENT-BY </span> <a class="truncate sent-by" ng-if=$ctrl.showSenderWithLink() ui-sref="drafts.create({ to: [ $ctrl.sender.email ]})"> {{:: $ctrl.sender.email }} </a> <span class="truncate sent-by" ng-if=$ctrl.showSender()> {{:: $ctrl.sender.email }} </span> </span> </div> <div layout=row layout-align="space-between center" class=time-actions-wrapper> <time class=moment-date datetime="{{:: $ctrl.message.createdDate | date : \'yyyy-MM-dd HH:mm:ss\' }}" ng-if="$ctrl.$mdMedia(\'gt-xs\')"> {{:: $ctrl.message.createdDate | momentAgo }} </time> <div class=menu-actions ng-class="{ \'hide-actions\' : $ctrl.isRevokedBccQuote() }" ng-if="$ctrl.sender.active === true"> <md-menu md-position-mode="target-right bottom"> <md-button aria-label="Open interactions menu" class=save ng-click="$ctrl.openMenu($mdMenu, $event)"> <translate>.SAVE</translate> <md-icon md-menu-origin class=drop-down>arrow_drop_down</md-icon> </md-button> <md-menu-content class=message-info width=4> <md-menu-item ng-if="$ctrl.isValidDomain() === true"> <md-button aria-label=file_copy ng-click=$ctrl.getSecurityLevel()> <md-icon>input</md-icon> <span translate translate-value-email="{{ $ctrl.profile.email }}"> .ACTIONS.SEND-COPY </span> </md-button> </md-menu-item> <md-menu-item class=download-message> <md-button aria-label="Download message" ng-click=$ctrl.downloadMessage($event); ng-disabled=$ctrl.message.revoked> <md-icon>file_download</md-icon> <translate>.ACTIONS.DOWNLOAD</translate> </md-button> </md-menu-item> <md-menu-item class=print-message> <md-button aria-label="Print message" ng-click=$ctrl.printMessage() ng-disabled=$ctrl.message.revoked> <md-icon>print</md-icon> <translate>.ACTIONS.PRINT</translate> </md-button> </md-menu-item> </md-menu-content> </md-menu> </div> <div class=menu-actions ng-class="{ \'hide-actions\' : $ctrl.isRevokedBccQuote() }" ng-if="$ctrl.hasActions() && $ctrl.sender.active === true"> <md-menu md-position-mode="target-right bottom"> <md-button aria-label="Open interactions menu" class=md-icon-button ng-click="$ctrl.openMenu($mdMenu, $event)"> <md-icon md-menu-origin>more_vert</md-icon> </md-button> <md-menu-content class=message-info width=4> <md-menu-item ng-if=":: $ctrl.message.isOwn === false && $ctrl.canCreateDraft"> <md-button aria-label=Reply ng-click=$ctrl.replyMessage(); ng-disabled="$ctrl.canQuote === false || $ctrl.message.revoked"> <md-icon>reply</md-icon> <translate>.ACTIONS.REPLY</translate> </md-button> </md-menu-item> <md-menu-item ng-if=":: $ctrl.canCreateDraft"> <md-button aria-label=Forward ng-click=$ctrl.forwardMessage(); ng-disabled="$ctrl.canQuote === false || $ctrl.message.revoked"> <md-icon>forward</md-icon> <translate>.ACTIONS.FORWARD</translate> </md-button> </md-menu-item> <md-menu-item ng-if="$ctrl.message.isOwn && $ctrl.message.revoked === false"> <md-button aria-label="Revoke access to this message" ng-click=$ctrl.revokeAccess(); ng-disabled=$ctrl.message.revoked> <md-icon>remove_circle</md-icon> <translate>.ACTIONS.REVOKE</translate> </md-button> </md-menu-item> <md-menu-item ng-if="$ctrl.message.isOwn && $ctrl.message.revoked"> <md-button aria-label="Unrevoke access to this message" ng-click=$ctrl.unRevokeAccess();> <md-icon>undo</md-icon> <translate>.ACTIONS.UNREVOKE</translate> </md-button> </md-menu-item> <md-menu-item ng-if=":: $ctrl.showCounters === true"> <md-button aria-label="Open message info sidenav" ng-click=$ctrl.openSidePane()> <md-icon>info</md-icon> <translate>.ACTIONS.INFO</translate> </md-button> </md-menu-item> <md-menu-item ng-if="$ctrl.profile.features.hasConnectedServices === true"> <md-button aria-label="Share message" ng-click=$ctrl.openServicesDialog($ctrl.message)> <md-icon>share</md-icon> <translate>.ACTIONS.SHARE</translate> </md-button> </md-menu-item> </md-menu-content> </md-menu> </div> </div> </span> <time class=moment-date datetime="{{:: $ctrl.message.createdDate | date : \'yyyy-MM-dd HH:mm:ss\' }}" flex ng-if="$ctrl.$mdMedia(\'xs\')"> {{:: $ctrl.message.createdDate | momentAgo }} </time> </md-card-header-text> </md-card-header> </div> <md-card-content ng-switch=":: $ctrl.message.contentType" ng-class="[ $ctrl.contentType, { \'no-counters\' : $ctrl.showCounters === false } ]"> <div class=revoked-notice ng-if=$ctrl.showRevokedNotice()> <p translate translate-compile ng-if=$ctrl.isRevokedBccQuote()> .REVOKED-OWN-MESSAGE.BCC-ORIGINAL </p> </div> <conversation-special ng-switch-when=application/zivver-special+json ng-if="$ctrl.message.revoked === false" download-token=$ctrl.downloadToken message=$ctrl.message share=$ctrl.share></conversation-special> <div class=bcc-info ng-if=$ctrl.message.isBcc translate translate-compile> .BCC-INFO </div> <conversation-message-body ng-switch-default content-type=":: $ctrl.message.contentType" body=":: $ctrl.message.body" inline-images=":: $ctrl.message.inlineImages" share=$ctrl.share></conversation-message-body> <conversation-attachments ng-if="$ctrl.message.files.length > 0" ng-class="{ \'no-message\' : $ctrl.message.body === \'\' }" profile=$ctrl.profile attachments=$ctrl.message.files download-token=$ctrl.downloadToken share=$ctrl.share></conversation-attachments> <conversation-quote ng-if=":: $ctrl.message.quote && $ctrl.isRevokedBccQuote() === false" quote=":: $ctrl.message.quote" conversation=$ctrl.conversation profile=$ctrl.profile share=$ctrl.share class=conversation-quote download-token=$ctrl.downloadToken></conversation-quote> <div class=counters ng-if=":: $ctrl.showCounters" ng-class="{ \'has-bounces\' : ($ctrl.message.counters.hardBounces > 0 || $ctrl.message.counters.softBounces > 0)}"> <message-counters participants=$ctrl.conversation.participants counters=$ctrl.message.counters quoted=$ctrl.message.quoted is-bcc=$ctrl.message.isBcc ng-click=$ctrl.openSidePane()></message-counters> </div> </md-card-content> <a ng-href="{{ $ctrl.downloadMessageUrl }}" target=_blank class="downloadMessage needsclick" download></a> <sidepane ng-if="$ctrl.showCounters === true && $ctrl.showSidePane === true" on-close=$ctrl.closeSidePane()> <pane-title> <translate>.INFO-PANE</translate> </pane-title> <pane-content> <message-info profile=$ctrl.profile conversation=$ctrl.conversation message=$ctrl.message></message-info> </pane-content> </sidepane> </md-card> '},function(t,e,i){},function(t,e){t.exports='<div translate-namespace=conversation-quote> <ng-repeat ng-repeat="message in $ctrl.quote.messages | orderBy:\'id\' track by message.id"> <div class=message-quoted ng-class="{\n\t\t\t\t revoked : message.revoked,\n\t\t\t\t bcc : message.isBcc,\n\t\t\t\t forwardedConversation : $ctrl.isForwardedConversation,\n\t\t\t\t selected : $ctrl.isSelectedMessage(message.id)\n\t\t\t }" layout=row layout-xs=column flex> <div class=labels> <span translate ng-if=message.isBcc> .BCC-LABEL </span> <span translate class=original ng-if="message.isBcc && $ctrl.isOwnMessage(message)" ng-click=$ctrl.showOriginal()> .BCC-ORIGINAL </span> </div> <div class="fill-width header quote-information" layout=row layout-align="space-between center"> <span ng-if=$ctrl.isSenderVisible(message) class="sender truncate"> {{:: message.participant.fullName || message.participant.email }} </span> <span flex></span> <div class=attachment-counter ng-if="message.files.length > 0"> <span>{{message.files.length}}</span> <md-icon aria-label="Attachment counter">attach_file</md-icon> </div> <time ng-if="message.isBcc === false" class=moment-date datetime="{{:: message.createdDate | date : \'yyyy-MM-dd HH:mm:ss\' }}"> {{ message.createdDate | momentAgo }} </time> <md-checkbox aria-label="select message" class=md-primary ng-click=$ctrl.toggleSelectMessage(message.id) ng-checked=$ctrl.isSelectedMessage(message.id) ng-if=$ctrl.isForwardedConversation></md-checkbox> </div> <div ng-if=$ctrl.areRecipientsVisible(message) class="fill-width header quote-information-recipients" layout=row ng-class="$ctrl.getAreRecipientsExpandable(message.id) ? \'expandable-recipients\' : \'non-expandable-recipients\'" ng-click=$ctrl.toggleRecipientsExpansion(message.id)> <div ng-class="{ \'truncate\' : $ctrl.getAreRecipientsExpanded(message.id) === false }"> <span class=to translate>.TO</span> <span id=recipients-{{message.id}} class=recipients> {{ $ctrl.getRecipients(message.participant) }} </span> </div> <md-icon ng-if=$ctrl.getAreRecipientsExpandable(message.id) class=expand-icon ng-class="{ \'hide-when-no-truncation\' : $ctrl.getAreRecipientsExpandable(message.id) === false && $ctrl.getAreRecipientsExpanded(message.id) === false }" ng-bind="$ctrl.getAreRecipientsExpanded(message.id) === false ? \'expand_more\' : \'expand_less\'"></md-icon> <md-tooltip ng-if=$ctrl.getAreRecipientsExpandable(message.id) md-delay=500 md-direction=right> <translate ng-if="$ctrl.getAreRecipientsExpanded(message.id) === false">.TRUNCATED-RECIPIENTS.SHOW-MORE</translate> <translate ng-if=$ctrl.getAreRecipientsExpanded(message.id)>.TRUNCATED-RECIPIENTS.SHOW-LESS</translate> </md-tooltip> </div> <div ng-if="message.revoked === true && message.isBcc === false" class="conversation-message-body info"> <div translate translate-value-email={{message.sender}} class="message-body conversation-quote"> .QUOTED.NO-ACCESS </div> </div> <conversation-message-body class=conversation-message-body ng-if="message.revoked === false || $ctrl.isOwnMessage(message) === true" content-type=":: message.contentType" body=":: message.body" inline-images=":: message.inlineImages" share=$ctrl.share></conversation-message-body> <conversation-attachments ng-if="message.revoked === false && message.files.length > 0" class=conversation-attachments ng-class="{ \'no-message\' : message.body === \'\' }" profile=$ctrl.profile attachments=message.files conversation-id=":: $ctrl.conversation.id" share=":: $ctrl.share" message-id=message.id download-token=$ctrl.downloadToken></conversation-attachments> </div> </ng-repeat> </div> '},function(t,e,$){var i,n;i=[$,e,$(7),$(1),$(10),$(9),$(61),$(167),$(168),$(169),$(56),$(29),$(170),$(31),$(13),$(60),$(552)],void 0===(n=function(t,e,i,n,o,r,s,a,c,l,u,p,d,h,f,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var m="conversation-reply",g=(S.$inject=["$rootScope","$scope","$log","$mdDialog","$timeout","$transitions","$translate","$mdMedia","$mdPanel","$q","$sce","$window","DeviceService","OrganizationService","MediaService","ReplyService","SanitizeService","SignatureService","SpecialsService","StorageService"],S.prototype.$onInit=function(){var s=this;if(this.isMSBrowser="IE"===this.DeviceService.getBrowser().name||"Edge"===this.DeviceService.getBrowser().name,this.showSwitchButton=!1===this.isMSBrowser,this.draft=new r.Draft,!1===this.DeviceService.isDesktop()&&(this.draft.contentType="text/plain"),this.restoreSavedDraft(),!1===this.profile.isGuest()&&(void 0===this.draft.scheduledExpiration?this.getDefaultExpirationPolicy().then(function(){s.timeLeft=s.setTimeLeft()}).catch(function(){s.getDefaultExpirationPolicy()}):(this.isExpirationEnabled=void 0!==this.draft.scheduledExpiration.expiresIn,this.timeLeft=this.setTimeLeft())),void 0!==this.conversation.flow)return this.inSpecial();this.draft.id=this.conversation.share,this.isMSBrowser&&(this.draft.contentType="text/plain"),this.$scope.$watch(function(){return s.draft.isModified},function(t){t&&(s.changesForValidation++,s.draft.isModified=!1,s.draft.validation.validationCompleted=!1,s.$timeout.cancel(s.draftModifiedTimeout),s.draftModifiedTimeout=s.$timeout(function(){s.validateDraft()},500),s.$timeout.cancel(s.saveTimeout),s.saveTimeout=s.$timeout(function(){return s.saveDraft()},150))}),this.$scope.$on(h.DraftEvents.ValidationsUpdated,function(t,e){s.draft.validation=e.validation,!1===s.showValidationBar&&e.validation.hasViolations()&&(s.showValidationBar=!0)}),this.$scope.$on(u.Events.Updated,function(t,e){s.conversation.participants=e}),this.$scope.$watch(function(){return s.conversation.participants},function(){s.showReplyButton=s.hasNotReplied()&&!1===s.isReplyActive,s.$rootScope.$broadcast("reply.btn.visibility.change",s.showReplyButton)},!0),this.$scope.$on("files-dropped",function(){s.replyFocus()}),this.$scope.$on("reply-all",function(){s.replyFocus()}),this.$transitions.onBefore({},function(e){var i=e.to(),n=e.params();if(s.draft.isUploading){s.$log.debug("preventing navigation away because we are still uploading");var o=f.WarningDialog.factory({explanation:"draft-attachments.CONFIRM-LEAVE-WHILE-UPLOADING",submitText:"MAIN.YES",cancelText:"MAIN.NO",type:f.WarningDialogTypes.error});return new Promise(function(t){s.$mdDialog.show(o).then(function(){s.draft.files.filter(function(t){return void 0!==t.upload}),s.draft.isUploading=!1,e.router.stateService.target(i,n)}).catch(function(){e.abort()}).finally(function(){t()})})}})},S.prototype.$onDestroy=function(){this.$timeout.cancel(this.draftModifiedTimeout),this.$timeout.cancel(this.validationTimeout),this.$timeout.cancel(this.saveTimeout),this.saveDraft()},S.prototype.validateDraft=function(){var e=this;this.$timeout.cancel(this.validationTimeout),0===this.changesForValidation||this.draft.isValidating||0===this.draft.body.length&&0===this.draft.files.length||(this.draft.isValidating=!0,this.changesForValidation=0,this.validationAttempts++,this.ReplyService.validate(this.conversation.id,this.draft,this.token,this.profile.isGuest()).then(function(t){(e.draft.validation=t).validationCompleted?e.validationAttempts=0:e.validationTimeout=e.$timeout(function(){e.changesForValidation++,e.validateDraft()},1e3*e.validationAttempts,!1)}).catch(function(t){e.$log.warn("Error validating reply draft",{error:t})}).finally(function(){e.draft.isValidating=!1}))},S.prototype.isDraftValid=function(){return!1===this.draft.isModified&&this.draft.validation.validationCompleted&&this.draft.validation.validDraft&&0===this.draft.validation.violationsUnresolved.length},S.prototype.send=function(){var e=this;if(this.$rootScope.$broadcast("reply.btn.visibility.change",!0),this.$timeout.cancel(this.validationTimeout),this.$timeout.cancel(this.saveTimeout),!1!==this.preSend()){this.draft.isSending=!0,void 0!==this.draft.scheduledExpiration&&(this.draft.scheduledExpiration={action:this.draft.scheduledExpiration.action,expiresAt:o().add(o.duration(this.draft.scheduledExpiration.expiresIn)).toISOString()});var i=this.draft.id;this.draft.id=null;var n=this.draft.contentType;"text/html"===n&&this.switchImgSource(),this.ReplyService.send(this.conversation.id,this.draft,this.token).then(function(t){e.removeSavedDraft(),e.StorageService.removeItem("LOCAL","ignoredViolations"+i),e.draft=new r.Draft,e.draft.id=e.conversation.share,e.draft.contentType=n,e.$rootScope.$broadcast("conversations.replied",t),e.isMSBrowser&&e.$scope.$broadcast("signature.add",!1)}).catch(function(t){e.$log.error("Could not reply in conversation",{error:t})}).finally(function(){(e.draft.isSending=!1)===e.profile.isGuest()&&e.getDefaultExpirationPolicy()})}},S.prototype.updateFlow=function(){var e=this;void 0!==this.conversation.specialId&&this.SpecialsService.getConversationFlow(this.conversation.id).then(function(t){e.conversation.flow=t})},S.prototype.preSend=function(){return!(this.draft.isValidating||(this.draft.isUploading?(this.$log.info("Trying to finalize draft while still uploading"),1):this.draft.isSending||(0<this.draft.validation.violationsUnresolved.length?(this.openViolationSidePane(),this.$log.info("Trying to finalize draft with unresolved violations"),1):!1===this.isDraftValid()&&(this.openViolationSidePane(),this.$log.info("Trying to finalize draft that is invalid"),1))))},S.prototype.hasNotReplied=function(){var e=this;return this.conversation.participants.filter(function(t){return t.email===e.profile.email})[0].removable},S.prototype.setReplyButton=function(){return this.hasNotReplied()&&!1===this.isReplyActive},S.prototype.openViolationSidePane=function(){this.showViolationsSidePane=!0},S.prototype.closeViolationsSidePane=function(){this.showViolationsSidePane=!1},S.prototype.replyFocus=function(){this.isReplyActive=!0,this.showReplyButton=this.setReplyButton(),this.$rootScope.$broadcast("reply.btn.visibility.change",this.showReplyButton)},S.prototype.editorToggle=function(){if(this.draft.contentType="text/html"===this.draft.contentType?"text/plain":"text/html","text/plain"===this.draft.contentType){var t=document.createElement("div");t.innerHTML=this.draft.body,this.draft.body=t.innerText}else this.draft.body=this.draft.body.slice(0,this.draft.body.indexOf("\n\n--\n"));this.saveDraft()},S.prototype.saveDraft=function(){0!==this.draft.body.length||0!==this.draft.files.length?this.draft.isSending||this.StorageService.setItem("LOCAL",this.getDraftSaveKey(),{body:this.draft.body,contentType:this.draft.contentType,files:this.draft.files.map(function(t){return{id:t.id,name:t.name,size:t.size,inline:t.inline}}),scheduledExpiration:this.draft.scheduledExpiration}):this.removeSavedDraft()},S.prototype.restoreSavedDraft=function(){var e=this,t=this.StorageService.getItem("LOCAL",this.getDraftSaveKey());null!==t?(this.draft.body=t.body,this.draft.contentType=t.contentType,this.draft.scheduledExpiration=t.scheduledExpiration,t.files.length&&t.files.forEach(function(t){e.draft.files.push(new r.DraftAttachment(t))}),this.replyFocus()):"text/html"===this.draft.contentType&&this.$scope.$applyAsync(function(){e.$scope.$broadcast("signature.add",!1)})},S.prototype.removeSavedDraft=function(){this.StorageService.removeItem("LOCAL",this.getDraftSaveKey())},S.prototype.getDraftSaveKey=function(){return"reply.draft."+this.conversation.share},S.prototype.inSpecial=function(){var t=this;this.draft.draftType="plain",this.draft.contentType="application/zivver-special+json";var e=this.conversation.flow.responses;0===e.length||(1===e.length?(this.formDefinition=e[0].formDefinition,this.draft.messageDefinitionId=e[0].id):this.$log.warn("More than one responses available. Not yet implemented.")),this.$scope.$on("conversations.replied",function(){t.updateFlow()})},S.prototype.getDefaultExpirationPolicy=function(){var n=this;return this.$q(function(e,i){n.OrganizationService.getMessageExpirationPolicy().then(function(t){n.isExpirationEnabled=t.automaticScheduledExpiration,t.automaticScheduledExpiration&&(n.draft.scheduledExpiration={action:t.defaults.action,expiresIn:t.defaults.duration},n.timeLeft=n.setTimeLeft()),e()}).catch(function(t){n.$log.error("Unable to retrieve organization default expiration policy",{error:t}),i()})})},S.prototype.openExpirationDialog=function(){var i=this,t={isDraft:!0,isEnabled:this.isExpirationEnabled,scheduledExpiration:this.draft.scheduledExpiration},e=v.ExpirationDialog.factory(t);this.$mdDialog.show(e).then(function(t){if(t.isEnabled){var e=f.WarningDialog.factory({title:m+"."+t.scheduledExpiration.action.toUpperCase()+"-WARN.TITLE",explanation:m+"."+t.scheduledExpiration.action.toUpperCase()+"-WARN.SCHEDULED",submitText:"MAIN.OK",type:"delete"===t.scheduledExpiration.action?f.WarningDialogTypes.error:f.WarningDialogTypes.info});i.$mdDialog.show(e).then(function(){i.setExpirationData(t)})}else i.setExpirationData(t)})},S.prototype.setExpirationData=function(t){this.isExpirationEnabled=t.isEnabled,!1===this.isExpirationEnabled?this.draft.scheduledExpiration=void 0:(this.draft.scheduledExpiration=i.__assign({},t.scheduledExpiration),this.timeLeft=this.setTimeLeft()),this.draft.isModified=!0},S.prototype.openInfoPane=function(){this.showInfoPane=!0},S.prototype.sidePaneClosed=function(){this.showInfoPane=!1},S.prototype.setTimeLeft=function(){return o().add(o.duration(this.draft.scheduledExpiration.expiresIn)).fromNow(!0)},S.prototype.showReplyAllMessage=function(){return!0===this.profile.isGuest()&&!0===this.$mdMedia("gt-xs")&&2<this.conversation.participants.length},S.prototype.switchImgSource=function(){if(!1===this.isMSBrowser){var t=document.createElement("div");t.innerHTML=this.draft.body;for(var e=0,i=[].slice.call(t.querySelectorAll("img"));e<i.length;e++){var n=i[e];n.title&&(n.src=n.title,n.removeAttribute("title"))}this.draft.body=t.innerHTML}},S);function S(t,e,i,n,o,s,r,a,c,l,u,p,d,h,f,v,m,g,S,$){this.$rootScope=t,this.$scope=e,this.$log=i,this.$mdDialog=n,this.$timeout=o,this.$transitions=s,this.$translate=r,this.$mdMedia=a,this.$mdPanel=c,this.$q=l,this.$sce=u,this.$window=p,this.DeviceService=d,this.OrganizationService=h,this.MediaService=f,this.ReplyService=v,this.SanitizeService=m,this.SignatureService=g,this.SpecialsService=S,this.StorageService=$,this.isMSBrowser=!1,this.isReplyActive=!1,this.showReplyButton=!0,this.showValidationBar=!1,this.isExpirationEnabled=!1,this.changesForValidation=0,this.validationAttempts=0,this.showViolationsSidePane=!1,this.showInfoPane=!1,this.showSwitchButton=!0}e.ConversationReply=g,e.ConversationReplyModule=n.module("components.ConversationReply",[c.AttachButtonModule.name,s.DraftAttachmentsModule.name,a.DraftSendButtonModule.name,l.DraftValidationsBarModule.name,d.DraftSpecialModule.name,p.SidepaneModule.name,f.WarningDialogModule.name]).component("conversationReply",{bindings:{profile:"<",conversation:"<",hasEvents:"<",token:"<"},controller:g,template:$(553)})}.apply(e,i))||(t.exports=n)},function(t,e,l){var i,n;i=[l,e,l(1),l(9),l(485),l(164),l(166),l(487)],void 0===(n=function(t,e,i,n,o,s,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=(c.$inject=["$scope","$element","$mdDialog","$translate"],c.prototype.$onInit=function(){var t=this;this.setIcon(),this.setTooltip(),this.setViolationsClass(),this.$scope.$watchGroup([function(){return t.validation.violationsUnresolved},function(){return t.validation.violationsIgnored},function(){return t.validation.validationCompleted}],function(){t.setIcon(),t.setTooltip(),t.setViolationsClass()}),this.$scope.$watchCollection(function(){return t.file.upload||{}},function(){t.setIcon(),t.setTooltip(),t.setViolationsClass()})},c.prototype.setIcon=function(){this.hasUploadError()||this.hasViolationLevel("error")||this.hasViolationLevel("warning")?this.icon="error":void 0!==this.file.upload?0<this.file.upload.progress&&this.file.upload.progress<100?this.icon="file_upload":this.icon="hourglass_empty":this.icon="insert_drive_file"},c.prototype.setTooltip=function(){var e=this;if(this.hasUploadError())switch(this.file.upload.error){case n.ClientViolationTypes.UploadFailed:this.tooltip=this.$translate.instant("DRAFTS.EDIT.ATTACHMENT.UPLOAD-ERROR");break;default:this.tooltip=this.validation.violationsUnresolved.filter(function(t){return-1<t.files.indexOf(e.file.id)}).shift().description}else void 0!==this.file.upload?this.tooltip=this.file.name+" ("+s.formatBytes(this.file.upload.loaded,!1)+" / "+s.formatBytes(this.file.size,!1)+")":this.tooltip=this.file.name+" ("+s.formatBytes(this.file.size,!1)+")"},c.prototype.showDialog=function(){var t=new o.AttachmentDialog;t.locals.file=this.file,t.locals.violations=this.validation.getViolationsForAttachment(this.file.id),this.$mdDialog.show(t)},c.prototype.setViolationsClass=function(){var e=this;Object.keys(n.ViolationClassNames).map(function(t){return e.mdChip.removeClass(n.ViolationClassNames[t])}),this.hasViolationLevel("error")||this.hasUploadError()?this.mdChip.addClass(n.ViolationClassNames.error):this.hasViolationLevel("warning")?this.mdChip.addClass(n.ViolationClassNames.warning):this.hasViolationLevel("suggestion")?this.mdChip.addClass(n.ViolationClassNames.suggestion):!1===this.validation.validationCompleted?this.mdChip.addClass(n.ViolationClassNames.validating):this.validation.validationCompleted&&0===this.validation.getViolationsForAttachment(this.file.id).length?this.mdChip.addClass(n.ViolationClassNames.okay):this.mdChip.addClass(n.ViolationClassNames.unkown)},c.prototype.hasViolationLevel=function(e){return 0<this.validation.getViolationsForAttachment(this.file.id).map(function(t){return t.violationLevel}).filter(function(t){return t===e}).length},c.prototype.hasUploadError=function(){return void 0!==this.file.upload&&void 0!==this.file.upload.error},c);function c(t,e,i,n){this.$scope=t,this.$element=e,this.$mdDialog=i,this.$translate=n,this.mdChip=this.$element.parent().parent().parent()}e.DraftAttachmentChipModule=i.module("components.DraftAttachmentChip",[o.AttachmentDialogModule.name,s.FormatBytesFilterModule.name,r.TruncateFilterModule.name]).component("draftAttachmentChip",{bindings:{file:"<",validation:"<"},controller:a,templateUrl:l(488)})}.apply(e,i))||(t.exports=n)},function(t,e,r){var i,n;i=[r,e,r(1),r(159)],void 0===(n=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AttachmentDialog=function(){this.templateUrl=r(486),this.locals={file:null,violations:null},this.controller=o};var o=(s.$inject=["$mdDialog","file","violations"],s.prototype.close=function(){this.$mdDialog.cancel()},s);function s(t,e,i){this.$mdDialog=t,this.file=e,this.violations=i}e.AttachmentDialogModule=i.module("app.drafts.edit.AttachmentDialog",[n.DraftViolationItemModule.name])}.apply(e,i))||(t.exports=n)},function(t,e,i){t.exports=i.p+"assets/tpl/AttachmentDialog.45bdc3.html"},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/DraftAttachmentChip.600432.html"},function(t,e,i){},function(t,e){t.exports='<div layout> <md-chips class=md-contact-chips flex readonly=true md-removable=true md-on-remove=$ctrl.removeFile($chip) ng-model=$ctrl.files ng-show="$ctrl.files.length > 0"> <md-chip-template> <draft-attachment-chip file=$chip validation=$ctrl.draft.validation></draft-attachment-chip> </md-chip-template> </md-chips> </div> '},function(t,e,i){},function(t,e){t.exports=' <md-button hide-gt-sm aria-label="{{ $ctrl.label }}" class="md-fab md-mini md-primary" ng-disabled="$ctrl.canSend() === false" ng-click=$ctrl.send()> <md-icon>send</md-icon> </md-button> <md-button hide-xs hide-sm aria-label="{{ $ctrl.label }}" class="md-raised md-primary wide" ng-disabled="$ctrl.canSend() === false" ng-click=$ctrl.send()> <translate>MAIN.SEND</translate> </md-button> '},function(t,e){t.exports="<md-button class=\"md-icon-button attachments\" ng-click=$ctrl.attachFiles($event)> <md-tooltip md-direction=top> <translate>{{ 'DRAFTS.EDIT.ATTACHMENT.ADD' }}</translate> </md-tooltip> <md-icon class=needsclick> attach_file </md-icon> </md-button> <div ngf-select ngf-multiple=true ngf-change=$ctrl.uploadFiles($files) class=hidden></div> "},function(t,e,a){var i,n;i=[a,e,a(1),a(495),a(497),a(500)],void 0===(n=function(t,e,i,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=(r.$inject=["$rootScope","$scope","$log","$mdDialog","$mdSidenav","DraftsValidationService"],r.prototype.$onInit=function(){var t=this;this.updateViolations(),this.$scope.$watchCollection(function(){return[t.draft.validation.violationsUnresolved,t.draft.validation.violationsIgnored]},function(){t.updateViolations()})},r.prototype.dismissViolation=function(t){void 0!==t.id?t.showStopper?this.$log.warn("trying to dismiss a violation that is a showstopper",{violation:t}):this.draft.validation=this.DraftsValidationService.dismissViolation(t,this.draft):this.$log.info("dismissing violation without id",{violation:t})},r.prototype.dismissAll=function(){this.draft.validation=this.DraftsValidationService.dismissAllViolations(this.draft)},r.prototype.infoViolation=function(t){var e=this,i=new n.ViolationInformationDialog;i.locals.violation=t,i.locals.violation.files=i.locals.violation.files.map(function(t){return e.draft.getFilenameById(t)}),this.$mdDialog.show(i)},r.prototype.showResolveDialog=function(i){var n=this,t=new o.ViolationResolveDialog;t.locals.violation=i,t.locals.draft=this.draft,this.$mdDialog.show(t).then(function(){switch(!0){case 0<i.recipients.length:n.draft.recipients=n.draft.recipients.filter(function(t){return-1===i.recipients.indexOf(t.email)});break;case 0<i.files.length:var t=n.draft.files.filter(function(t){return-1<i.files.indexOf(t.id)});n.$rootScope.$broadcast("attachments-removed",t);break;case/src="data:image\/([a-zA-Z]*);base64,([^"]*)"/i.test(n.draft.body):var e=document.getElementsByClassName("pell-content").item(0);e.querySelectorAll("img").forEach(function(t){/src="data:image\/([a-zA-Z]*);base64,([^"]*)"/i.test(t.outerHTML)&&(t.parentElement.removeChild(t),n.draft.body=e.innerHTML)});break;default:n.$log.warn("Got a violation with no file and no recipients. No clue how to resolve",{violation:i})}})},r.prototype.hasViolations=function(){return 0<this.unresolvedViolations.length||0<this.dismissedViolations.length},r.prototype.toggleUnresolvedViolations=function(){this.isUnresolvedCollapsed=!this.isUnresolvedCollapsed},r.prototype.toggleDismissedViolations=function(){this.isDismissedCollapsed=!this.isDismissedCollapsed},r.prototype.showResolveButton=function(t){return"files"===t.violationType||"toRecipients"===t.violationType||"filesToRecipients"===t.violationType},r.prototype.violationIcon=function(t){var e;switch(t.violationLevel){case"suggestion":case"okay":e="info";break;default:e=t.violationLevel}return e},r.prototype.openVerificationInfo=function(){void 0!==this.openVerifications?this.openVerifications():this.$log.warn("no openVerifications function bound")},r.prototype.updateViolations=function(){void 0===this.draft?(this.unresolvedViolations=[],this.dismissedViolations=[],this.hasDismissableViolations=!1,this.$log.warn("[DraftValidationsResult] draft is undefined")):(this.dismissedViolations=this.draft.validation.violationsIgnored,this.unresolvedViolations=this.draft.validation.violationsUnresolved,this.hasDismissableViolations=0<this.unresolvedViolations.filter(function(t){return!1===t.showStopper}).length)},r.prototype.isEmptyFilesViolation=function(t){return"files"===t.violationType&&0===t.files.length},r);function r(t,e,i,n,o,s){this.$rootScope=t,this.$scope=e,this.$log=i,this.$mdDialog=n,this.$mdSidenav=o,this.DraftsValidationService=s,this.hasDismissableViolations=!1,this.isUnresolvedCollapsed=!1,this.isDismissedCollapsed=!1}e.DraftValidationResultsModule=i.module("components.DraftValidationResults",[]).component("draftValidationResults",{bindings:{draft:"<",openVerifications:"&"},controller:s,templateUrl:a(501)})}.apply(e,i))||(t.exports=n)},function(t,e,o){var i;void 0===(i=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ViolationInformationDialog=function(){this.templateUrl=o(496),this.locals={violation:null},this.controller=i};var i=(n.$inject=["$mdDialog","violation"],n.prototype.cancel=function(){this.$mdDialog.cancel()},n);function n(t,e){this.$mdDialog=t,this.violation=e}}.apply(e,[o,e]))||(t.exports=i)},function(t,e,i){t.exports=i.p+"assets/tpl/violationInformationDialog.87d2b0.html"},function(t,e,o){var i,n;i=[o,e,o(498)],void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ViolationResolveDialog=function(){this.templateUrl=o(499),this.locals={violation:null,draft:null},this.controller=i};var i=(n.$inject=["$rootScope","$log","$mdDialog","draft","violation"],n.prototype.cancel=function(){this.$mdDialog.cancel()},n.prototype.resolve=function(){this.$mdDialog.hide()},n);function n(t,e,i,n,o){var s=this;this.$rootScope=t,this.$log=e,this.$mdDialog=i,this.draft=n,this.violation=o,this.filenames=[],this.filenames=this.violation.files.map(function(t){return s.draft.getFilenameById(t)}),0!==o.recipients.length?this.target="RECIPIENTS":this.target="FILES"}}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/violationResolveDialog.c7c37b.html"},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/DraftValidationResults.3ae02d.html"},function(t,e,i){},function(t,e){t.exports='<div ng-class=$ctrl.iconStatus layout=row layout-align="space-between center" translate-namespace=draft-validations-bar> <md-card-header-text> <div aria-label="Open security and protections settings"> <md-icon ng-class=$ctrl.iconStatus class=left-icon>lock</md-icon> <span ng-if="$ctrl.unresolvedViolations.length !== 1" translate translate-value-violations={{$ctrl.unresolvedViolations.length}}> {{ $ctrl.info }} </span> <div class="violation-description truncate" ng-if="$ctrl.unresolvedViolations.length === 1"> {{ $ctrl.unresolvedViolations[0].description }} </div> </div> </md-card-header-text> <span flex></span> <md-button ng-class=$ctrl.iconStatus md-no-ink ng-if="$ctrl.unresolvedViolations.length === 1 && $ctrl.unresolvedViolations[0].showStopper === false" ng-click=$ctrl.dismissViolation($event);> <translate>.DISMISS</translate> </md-button> <md-icon ng-class=$ctrl.iconStatus>info_outline</md-icon> </div> '},function(t,e,s){var i,n;i=[s,e,s(1)],void 0===(n=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.prototype.$onInit=function(){void 0!==this.component.answer&&(this.model=this.component.answer.value)},o);function o(){}e.SpecialsHiddenModule=i.module("components.SpecialsHidden",[]).component("specialsHidden",{bindings:{component:"="},controller:n,templateUrl:s(505),require:{specialsSection:"^specialsSection"}})}.apply(e,i))||(t.exports=n)},function(t,e,i){t.exports=i.p+"assets/tpl/SpecialsHidden.780fd8.html"},function(t,e,r){var i,n;i=[r,e,r(1),r(15)],void 0===(n=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(s.prototype.onChange=function(){this.component.answer=new n.FormChoice({value:this.model.toString()})},s);function s(){void 0!==this.component.answer&&(this.model=this.component.answer.value)}e.SpecialsInputCheckboxModule=i.module("components.SpecialsInputCheckbox",[]).component("specialsInputCheckbox",{bindings:{component:"="},controller:o,templateUrl:r(507)})}.apply(e,i))||(t.exports=n)},function(t,e,i){t.exports=i.p+"assets/tpl/SpecialsInputCheckbox.c343b9.html"},function(t,e,r){var i,n;i=[r,e,r(1),r(509)],void 0===(n=function(t,e,i){"use strict";s.$inject=["$log"],Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$log"],o.prototype.$onInit=function(){var i=this;if(void 0!==this.component.answerArray){var n=this.component.answerArray.map(function(t){return t.value});this.model={},this.component.choices.forEach(function(t,e){i.model[e]=-1<n.indexOf(t.value)})}else{this.model={};var t=this.component.choices.filter(function(t){return void 0!==t.default});0<t.length&&(t.forEach(function(t,e){!0===t.default&&(i.model[e]=!0)}),this.updateModel())}this.component.choices.filter(function(t){return void 0!==t.enables}).forEach(function(t){i.specialsSection.setComponentVisibility(t.enables,!1)})},o.prototype.updateModel=function(){for(var t in this.component.answerArray=[],this.model){var e=this.component.choices[t],i=this.model[t];!0===i&&this.component.answerArray.push(e),void 0!==e.enables&&(this.specialsSection.setComponentVisibility(e.enables,i),this.specialsSection.setComponentRequired(e.enables,!0))}},o.prototype.onChange=function(){this.updateModel(),this.specialsSection.validateSection()},o);function o(t){this.$log=t}function s(t){return{require:"ngModel",link:function(t,e,i,n){var s=i.checkboxesMinItems,r=i.checkboxesMaxItems,o=i.checkboxesRequired;n.$validators.checkboxesValidatorRequired=function(t){if(void 0!==o){var e=!1;for(var i in t)if(!0===t[i]){e=!0;break}return e}},n.$validators.checkboxesValidatorMinMax=function(t){var e=0,i=!0,n=!0;if(""!==s||""!==r)for(var o in t)!0===t[o]&&e++;return""!==s&&(i=parseInt(s)<=e),""!==r&&(n=e<=parseInt(r)),i&&n}}}}e.SpecialsInputCheckboxesModule=i.module("components.SpecialsInputCheckboxes",[]).directive("checkboxesValidator",s).component("specialsInputCheckboxes",{bindings:{component:"="},controller:n,templateUrl:r(510),require:{specialsSection:"^specialsSection"}})}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/SpecialsInputCheckboxes.be8f85.html"},function(t,e,s){var i,n;i=[s,e,s(1),s(512)],void 0===(n=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$window","$sce"],o.prototype.$onInit=function(){var e=this;if(void 0!==this.component.answerArray){var i=this.component.answerArray.map(function(t){return t.value});this.model=this.component.choices.map(function(t){return-1<i.indexOf(t.value)})}else this.model=this.component.choices.map(function(t){return!1});this.trustSVG(),this.component.choices.forEach(function(t){"body-contour"!==t.value&&"body-shadows"!==t.value&&"floor-shadow"!==t.value&&!0!==e.render||(t.unselectable=!0)}),!1===this.render?this.onChange():this.markForRendering()},o.prototype.trustSVG=function(){var e=this;this.component.choices.forEach(function(t){t.trustedSvg=e.$sce.trustAsHtml('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 600">'+t.svg+"</svg>")})},o.prototype.onChange=function(){for(var t in this.component.answerArray=[],!0===this.component.required&&(this.satisfiesRequired=!1),this.model)if(this.model.hasOwnProperty(t)&&!0===this.model[t]){var e=this.component.choices[t];this.$window.document.getElementById("renderable-svg-"+t),this.component.answerArray.push(e),this.satisfiesRequired=!0}this.specialsSection.validateSection()},o.prototype.markForRendering=function(){var t=this.component.getAnswer();if(void 0!==t){var e=t;void 0!==this.component.answerArray&&this.component.choices.filter(function(t){return-1<e.indexOf(t.value)}).forEach(function(t){t.selected=!0})}},o.prototype.onKeypress=function(t,e){32===e&&(this.model[t]=void 0===this.model[t]||!this.model[t])},o);function o(t,e){this.$window=t,this.$sce=e,this.satisfiesRequired=!0}e.SpecialsInputCheckboxesSvgModule=i.module("components.SpecialsInputCheckboxesSvg",[]).directive("svgValidator",function(){return{require:["ngModel","^?form"],link:function(t,e,i,n){function o(t){var e=!1;for(var i in t)if(!0===t[i]){e=!0;break}return e}var s=n.shift(),r=n.shift(),a=i.svgLinkedComponents.split(","),c=i.svgRequired;s.$validators.svgValidatorRequired=function(t){var e=!1;return void 0!==c&&!1===(e=o(t))&&0<a.length&&(e=a.some(function(t){var e=r[t];return void 0!==e&&o(e.$modelValue)})),e}}}}).component("specialsInputCheckboxesSvg",{bindings:{component:"=",render:"<"},controller:n,templateUrl:s(513),require:{specialsSection:"?^specialsSection"}})}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/SpecialsInputCheckboxesSvg.f881ac.html"},function(t,e,a){var i,n;i=[a,e,a(1),a(10),a(15),a(515)],void 0===(n=function(t,e,i,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=(r.$inject=["$log","$scope","DeviceService"],r.prototype.$onInit=function(){this.inputType="Apple"===this.DeviceService.getDevice().vendor?"date":"text","date"===this.inputType&&(this.inputFormatRegExp=""),void 0!==this.component.answer&&this.update(this.component.answer.value),this.minDate=n().subtract(120,"years"),this.maxDate=n()},r.prototype.momentify=function(t){var e;if("string"==typeof t){var i=t.replace(/\D/gi,"/");e=n(i,this.inputFormat)}else e=n(t);return e},r.prototype.$postLink=function(){var i=this;this.specialsSection.formCtrl[this.component.key].$validators.dateFormat=function(t){if(null==t)return!1;var e=i.momentify(t);return null!==n(e).format(i.serverFormat).match(i.serverFormatRegExp)},this.specialsSection.formCtrl[this.component.key].$validators.dateRange=function(t){if(null==t)return!1;var e=i.momentify(t);return(void 0===i.minDate||e.isAfter(i.minDate))&&(void 0===i.maxDate||e.isBefore(i.maxDate))},this.$scope.$watch(function(){return i.component.answer},function(t){void 0!==t&&i.updateValue(t.value)})},r.prototype.onChange=function(){var t;if("string"==typeof this.date)t=this.momentify(this.date).format(this.serverFormat);else{if(!(this.date instanceof Date))return;t=n(this.date).format(this.serverFormat)}this.component.answer=new o.FormChoice({value:t}),this.specialsSection.validateSection()},r.prototype.update=function(t){var e=n(t).format(this.serverFormat);"date"===this.inputType?this.date=new Date(t):this.date=n(t).format(this.inputFormat),this.component.answer=new o.FormChoice({value:e})},r.prototype.updateValue=function(t){void 0!==t?8===t.length&&this.update(t):this.date=""},r);function r(t,e,i){this.$log=t,this.$scope=e,this.DeviceService=i,this.serverFormat="YYYY-MM-DD",this.serverFormatRegExp="([0-9]{4}).(0[1-9]|1[012]).(0[1-9]|1[0-9]|2[0-9]|3[01])",this.inputFormat="DD-MM-YYYY",this.inputFormatRegExp="([0-9]{1,2}).([0-9]{1,2}).([0-9]{4})"}e.SpecialsInputDateModule=i.module("components.SpecialsInputDate",[]).component("specialsInputDate",{bindings:{component:"="},controller:s,templateUrl:a(516),require:{specialsSection:"^specialsSection"}})}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/SpecialsInputDate.cdc895.html"},function(t,e,r){var i,n;i=[r,e,r(1),r(15),r(518)],void 0===(n=function(t,e,i,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(s.$inject=["$window","$timeout","$scope","$log","FilesOutService"],s.prototype.$onInit=function(){var e=this;void 0!==this.component.answer&&(this.model=this.component.answer.value),this.focusInputWatch=this.$scope.$watch(function(){return e.component.focused},function(t){void 0!==t&&!0===t&&e.setFocus()}),this.watchFile()},s.prototype.$onDestroy=function(){this.focusInputWatch()},s.prototype.setFocus=function(){var t=this;this.$timeout(function(){t.getInputElement().focus()})},s.prototype.onChange=function(){this.specialsSection.validateSection()},s.prototype.watchFile=function(){var t,e=this,i=this.getInputElement();i.addEventListener("change",function(){e.$timeout.cancel(t),t=e.$timeout(function(){if(0!==i.files.length){var t=i.files[0];e.filename=t.name,e.specialsSection.closeAllSectionsBelow(),e.onChange(),e.handleFile(t)}},10)})},s.prototype.handleFile=function(t){var n=this;this.$timeout(function(){var i;!0===n.specialsSection.sectionValid?(i=n.filename.slice(0,-4).split("_"),n.uploadFile(t)):i=new Array(4),n.component.patternReferences.forEach(function(e,t){n.specialsSection.specialsForm.sections[2].components.filter(function(t){return t.key===e})[0].answer=new o.FormChoice({value:i[t]})})},150)},s.prototype.uploadFile=function(e){var i=this;this.specialsSection.specialsForm.removeAllFiles(),this.specialsSection.specialsForm.awaitUpload(),this.FilesOutService.createFileSlot(this.component.patternReplacementFileName,e.size,e.type,!0).then(function(t){return i.file=t,i.FilesOutService.uploadToFileSlot(t,e)}).then(function(){i.specialsSection.specialsForm.addFile(i.file),i.model=i.file.fileslotId,i.component.answer=new o.FormChoice({value:i.model})}).catch(function(t){i.$log.error("Error uploading file in special filename pattern component",{reason:t})}).finally(function(){i.specialsSection.specialsForm.awaitedUploadDone()})},s.prototype.getInputElement=function(){return this.$window.document.getElementById(this.component.key).querySelector('[component="component"] input')},s);function s(t,e,i,n,o){this.$window=t,this.$timeout=e,this.$scope=i,this.$log=n,this.FilesOutService=o}e.SpecialsInputFilenamePatternModule=i.module("components.SpecialsInputFilenamePattern",[]).component("specialsInputFilenamePattern",{bindings:{component:"="},controller:n,templateUrl:r(519),require:{specialsSection:"^specialsSection"}}).directive("filenamePatternValidator",function(){return{require:"ngModel",link:function(t,i,e,n){n.$validators.filenamePatternValidator=function(t,e){return!(n.$isEmpty(e)||!n.$isEmpty(t)&&null===e.toString().match(i[0].pattern))}}}})}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/SpecialsInputFilenamePattern.e34332.html"},function(t,e,a){var i,n;i=[a,e,a(1),a(15),a(521),a(524)],void 0===(n=function(t,e,i,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=(r.$inject=["FilesOutService","$timeout","$window","$translate","$scope","$log","$element"],r.prototype.$onInit=function(){var e=this;this.focusInputWatch=this.$scope.$watch(function(){return e.component.focused},function(t){void 0!==t&&!0===t&&e.setFocus()}),this.updateModel(this.specialsForm.files),this.$scope.$watch(function(){return e.selectedFile},function(){void 0!==e.selectedFile&&e.uploadImage(e.selectedFile)})},r.prototype.updateModel=function(t){var i=this;t.forEach(function(t){var e=i.component.key;t.name.substring(0,t.name.indexOf("."))===e&&i.$timeout(function(){i.imageName=t.name}).then(function(){return i.uploadImageDone(t)}).catch(function(t){return i.uploadImageCatch(t)}).finally(function(){return i.uploadImageFinally()})})},r.prototype.$onDestroy=function(){this.focusInputWatch()},r.prototype.setFocus=function(){this.$timeout(this.$element[0].focus,0,!1)},r.prototype.uploadImageFailed=function(){this.specialsForm.removeFile(this.file),this.file=void 0,this.component.answer=void 0},r.prototype.uploadImage=function(e){var i=this;if(this.$log.info("SPECIALS::CONSULT >> uploadImage called with selectedFile: ",e),this.thumbnailStatus=this.$translate.instant("specials-input-image.UPLOADING"),this.imageName=e.name,null==(this.image=e))return this.uploadImageFailed(),void this.specialsSection.validateSection();this.isUploading=!0,this.isUploaded=!1,this.specialsSection.specialsForm.awaitUpload();var t=this.component.key+"."+e.name.split(".").pop();this.FilesOutService.createFileSlot(t,e.size,e.type,!0).then(function(t){return i.file=t,i.FilesOutService.uploadToFileSlot(t,e)}).then(function(t){return i.uploadImageDone(t)}).catch(function(t){return i.uploadImageCatch(t)}).finally(function(){return i.uploadImageFinally()}),this.specialsSection.validateSection()},r.prototype.uploadImageDone=function(t){this.component.answer=new n.FormChoice({value:t.id}),this.isUploaded=!0,this.thumbnailStatus=this.$translate.instant("specials-input-image.UPLOADED"),this.specialsForm.addFile(t)},r.prototype.uploadImageCatch=function(t){this.uploadImageFailed(),this.thumbnailStatus=this.$translate.instant("specials-input-image.UPLOADFAILED"),this.$log.warn("SPECIALS::CONSULT >> image upload FAILED: ",{reason:t})},r.prototype.uploadImageFinally=function(){var t=this;this.isUploading=!1,this.$timeout(function(){t.isUploaded=!1},2e3,!1),this.specialsSection.specialsForm.awaitedUploadDone()},r);function r(t,e,i,n,o,s,r){this.FilesOutService=t,this.$timeout=e,this.$window=i,this.$translate=n,this.$scope=o,this.$log=s,this.$element=r,this.isUploaded=!1,this.uploadProgress=0,this.isUploading=!1,this.thumbnailStatus=""}e.SpecialsInputImageModule=i.module("ziv.components.SpecialsInputImage",[o.SpecialsAttachButtonModule.name]).component("specialsInputImage",{bindings:{component:"="},controller:s,templateUrl:a(525),require:{specialsSection:"^specialsSection",specialsForm:"^specialsForm"}})}.apply(e,i))||(t.exports=n)},function(t,e,s){var i,n;i=[s,e,s(1),s(522)],void 0===(n=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$log","$scope","$element"],o.prototype.triggerFileSelect=function(t){var e=this,i=this.getInputElement();i.onchange=function(){e.selectedFile=i.files[0],e.$scope.$applyAsync()},i.click()},o.prototype.getInputElement=function(){return this.$element.find("input")[0]},o);function o(t,e,i){this.$log=t,this.$scope=e,this.$element=i}e.SpecialsAttachButton=n,e.SpecialsAttachButtonModule=i.module("components.SpecialsAttachButton",[]).component("specialsAttachButton",{bindings:{selectedFile:"="},controller:n,template:s(523)})}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e){t.exports='<label> <md-button class="md-fab md-primary" aria-label="upload image" ng-click=$ctrl.triggerFileSelect($event)> <md-icon>add</md-icon> </md-button> <input type=file name=inputFile class=inputFile accept=image/* /> </label> '},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/SpecialsInputImage.9531e8.html"},function(t,e,s){var i,n;i=[s,e,s(1),s(527)],void 0===(n=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$timeout","$window","$log","$scope"],o.prototype.$onInit=function(){var e=this;if(0===this.component.choices.length&&this.$log.warn("No choices defined for component",{component:this.component}),void 0!==this.component.answer)this.model=this.component.answer.value;else{this.model="";var t=this.component.choices.filter(function(t){return void 0!==t.default});1===t.length&&(!0===t[0].default&&(this.model=t[0].value),this.onChange())}this.component.choices.filter(function(t){return void 0!==t.enables}).forEach(function(t){e.componentsToEnable.push(t),e.specialsSection.setComponentVisibility(t.enables,!1)}),this.focusInputWatch=this.$scope.$watch(function(){return e.component.focused},function(t){void 0!==t&&!0===t&&e.setFocus()}),this.$scope.$watch(function(){return e.component.answer},function(t){void 0!==t&&(e.model=t.value)})},o.prototype.$onDestroy=function(){this.focusInputWatch()},o.prototype.setFocus=function(){var t=this.$window.document.getElementById(this.component.key).querySelector('[component="component"] md-radio-group');this.$timeout(function(){t.focus()})},o.prototype.onChange=function(){var e=this;if(this.component.answer=this.component.choices.filter(function(t){return t.value===e.model}).shift(),void 0!==this.model){var t=this.component.answer;this.componentsToEnable.forEach(function(t){e.specialsSection.setComponentVisibility(t.enables,!1),e.specialsSection.setComponentRequired(t.enables,!1)}),void 0!==t.enables&&(this.specialsSection.setComponentVisibility(t.enables,!0),this.specialsSection.setComponentRequired(t.enables,!0))}this.specialsSection.validateSection()},o);function o(t,e,i,n){this.$timeout=t,this.$window=e,this.$log=i,this.$scope=n,this.componentsToEnable=[]}e.SpecialsInputRadioButtonModule=i.module("components.SpecialsInputRadioButton",[]).component("specialsInputRadioButton",{bindings:{component:"="},controller:n,templateUrl:s(528),require:{specialsSection:"^specialsSection"}})}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/SpecialsInputRadioButton.a77bbf.html"},function(t,e,s){var i,n;i=[s,e,s(1)],void 0===(n=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.prototype.$onInit=function(){this.updateQuestionChoices()},o.prototype.updateQuestionChoices=function(e){e&&(this.choices=this.component.choices.filter(function(t){return t.value!==e.value}))},o.prototype.onChange=function(){var e=this;this.component.answer=this.component.choices.filter(function(t){return t.value===e.model}).shift()},o);function o(){this.choices=[]}e.SpecialsInputSelectModule=i.module("ziv.components.SpecialsInputSelect",[]).component("specialsInputSelect",{bindings:{component:"="},controller:n,templateUrl:s(530)})}.apply(e,i))||(t.exports=n)},function(t,e,i){t.exports=i.p+"assets/tpl/SpecialsInputSelect.c7dcf2.html"},function(t,e,c){var i,n;i=[c,e,c(1),c(15)],void 0===(n=function(t,e,i,n){"use strict";a.$inject=["$log"],Object.defineProperty(e,"__esModule",{value:!0});var o=(s.$inject=["$window","$timeout","$scope","$log"],s.prototype.$onInit=function(){var e=this;void 0!==this.component.answer&&(this.model=this.component.answer.value),this.focusInputWatch=this.$scope.$watch(function(){return e.component.focused},function(t){void 0!==t&&!0===t&&e.setFocus()}),this.$scope.$watch(function(){return e.component.answer},function(t){void 0!==t&&(e.model=t.value)})},s.prototype.$onDestroy=function(){this.focusInputWatch()},s.prototype.setFocus=function(){var t=this.$window.document.getElementById(this.component.key).querySelector('[component="component"] input');this.$timeout(function(){t.focus()})},s.prototype.onChange=function(){this.component.answer=new n.FormChoice({value:this.model}),this.specialsSection.validateSection()},s);function s(t,e,i,n){this.$window=t,this.$timeout=e,this.$scope=i,this.$log=n}var r=9;function a(t){return{require:"ngModel",link:function(t,e,i,n){n.$parsers.push(function(t){return parseInt(t)}),n.$formatters.push(function(t){return parseInt(t)}),n.$validators.ssnValidator=function(t,e){if(n.$isEmpty(e))return!1;if(n.$isEmpty(t))return!0;if(e.toString().length!==r)return!1;try{return e.toString().split("").map(function(t,e){var i=r-e==1?-1:r-e;return parseInt(t)*i}).reduce(function(t,e){return t+e})%11==0}catch(t){return!1}}}}}e.SpecialsInputSsnModule=i.module("components.SpecialsInputSsn",[]).component("specialsInputSsn",{bindings:{component:"="},controller:o,templateUrl:c(532),require:{specialsSection:"^specialsSection"}}).directive("ssnValidator",a)}.apply(e,i))||(t.exports=n)},function(t,e,i){t.exports=i.p+"assets/tpl/SpecialsInputSsn.0fe20f.html"},function(t,e,r){var i,n;i=[r,e,r(1),r(15)],void 0===(n=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(s.$inject=["$window","$timeout","$scope","$log"],s.prototype.$onInit=function(){var e=this;this.component.autocomplete=this.component.autocomplete.map(function(t){return t[Object.keys(t)[0]]}),void 0!==this.component.answer?this.model=this.component.answer.value:void 0!==this.component.defaultValue&&(this.model=this.component.defaultValue.toString(),this.onChange()),this.focusInputWatch=this.$scope.$watch(function(){return e.component.focused},function(t){void 0!==t&&!0===t&&e.setFocus()}),this.$scope.$watch(function(){return e.component.answer},function(t){void 0!==t&&(e.model=t.value)})},s.prototype.$onDestroy=function(){this.focusInputWatch()},s.prototype.setFocus=function(){var t=this.$window.document.getElementById(this.component.key).querySelector('[component="component"] input');this.$timeout(function(){t.focus()},0,!1)},s.prototype.onChange=function(){this.component.answer=new n.FormChoice({value:this.model}),this.specialsSection.validateSection()},s.prototype.createNew=function(){this.model=this.search,this.onChange()},s.prototype.onBlur=function(){this.model=this.search,this.onChange()},s.prototype.searchAutocomplete=function(){var e=this;return""===this.search||void 0===this.search?this.component.autocomplete:this.component.autocomplete.filter(function(t){return 0===t.indexOf(e.search)})},s);function s(t,e,i,n){this.$window=t,this.$timeout=e,this.$scope=i,this.$log=n,this.search=""}e.SpecialsInputTextAutocompleteModule=i.module("ziv.components.SpecialsInputTextAutocomplete",[]).component("specialsInputTextAutocomplete",{bindings:{component:"="},controller:o,templateUrl:r(534),require:{specialsSection:"^specialsSection"}})}.apply(e,i))||(t.exports=n)},function(t,e,i){t.exports=i.p+"assets/tpl/SpecialsInputTextAutocomplete.fc67bc.html"},function(t,e,r){var i,n;i=[r,e,r(1),r(15)],void 0===(n=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(s.$inject=["$window","$timeout","$scope","$log"],s.prototype.$onInit=function(){var e=this;void 0!==this.component.answer&&(this.model=this.component.answer.value),this.focusInputWatch=this.$scope.$watch(function(){return e.component.focused},function(t){void 0!==t&&!0===t&&e.setFocus()}),this.$scope.$watch(function(){return e.component.answer},function(t){void 0!==t&&(e.model=t.value)})},s.prototype.$onDestroy=function(){this.focusInputWatch()},s.prototype.setFocus=function(){var t=this.$window.document.getElementById(this.component.key).querySelector('[component="component"] input');this.$timeout(function(){t.focus()},0,!1)},s.prototype.onChange=function(){this.component.answer=new n.FormChoice({value:this.model}),this.specialsSection.validateSection()},s);function s(t,e,i,n){this.$window=t,this.$timeout=e,this.$scope=i,this.$log=n}e.SpecialsInputTextModule=i.module("ziv.components.SpecialsInputText",[]).component("specialsInputText",{bindings:{component:"="},controller:o,templateUrl:r(536),require:{specialsSection:"^specialsSection"}})}.apply(e,i))||(t.exports=n)},function(t,e,i){t.exports=i.p+"assets/tpl/SpecialsInputText.7e532f.html"},function(t,e,r){var i,n;i=[r,e,r(1),r(15)],void 0===(n=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(s.$inject=["$window","$timeout","$scope","$log"],s.prototype.$onInit=function(){var e=this;void 0!==this.component.answer&&(this.model=this.component.answer.value),this.focusInputWatch=this.$scope.$watch(function(){return e.component.focused},function(t){void 0!==t&&!0===t&&e.setFocus()})},s.prototype.$onDestroy=function(){this.focusInputWatch()},s.prototype.setFocus=function(){var t=this.$window.document.getElementById(this.component.key).querySelector('[component="component"] textarea');this.$timeout(function(){t.focus()})},s.prototype.onChange=function(){this.component.answer=new n.FormChoice({value:this.model}),this.specialsSection.validateSection()},s);function s(t,e,i,n){this.$window=t,this.$timeout=e,this.$scope=i,this.$log=n}e.SpecialsInputTextareaModule=i.module("components.SpecialsInputTextarea",[]).component("specialsInputTextarea",{bindings:{component:"="},controller:o,templateUrl:r(538),require:{specialsSection:"^specialsSection"}})}.apply(e,i))||(t.exports=n)},function(t,e,i){t.exports=i.p+"assets/tpl/SpecialsInputTextarea.7c8e24.html"},function(t,e,s){var i,n;i=[s,e,s(1)],void 0===(n=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$log","$element"],o.prototype.$postLink=function(){var t=this;this.$element.find("img").on("error",function(){t.$log.warn("Error loading special static image",{component:t.component})})},o);function o(t,e){this.$log=t,this.$element=e}e.SpecialsStaticImageModule=i.module("components.SpecialsStaticImage",[]).component("specialsStaticImage",{bindings:{component:"="},controller:n,templateUrl:s(540)})}.apply(e,i))||(t.exports=n)},function(t,e,i){t.exports=i.p+"assets/tpl/SpecialsStaticImage.d8976b.html"},function(t,e,s){var i,n;i=[s,e,s(1)],void 0===(n=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$sce"],o.prototype.$onInit=function(){this.textHtml=this.$sce.trustAsHtml(this.component.textTranslated)},o);function o(t){this.$sce=t}e.SpecialsStaticText=n,e.SpecialsStaticTextModule=i.module("components.SpecialsStaticText",[]).component("specialsStaticText",{bindings:{component:"="},controller:n,templateUrl:s(542)})}.apply(e,i))||(t.exports=n)},function(t,e,i){t.exports=i.p+"assets/tpl/SpecialsStaticText.492dfa.html"},function(t,e,n){var i,o;i=[n,e,n(1),n(544)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SpecialsStaticTextHeaderModule=i.module("components.SpecialsStaticTextHeader",[]).component("specialsStaticTextHeader",{bindings:{component:"=",enabled:"<",formReference:"<"},controller:function(){},templateUrl:n(545)})}.apply(e,i))||(t.exports=o)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/SpecialsStaticTextHeader.379efa.html"},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/SpecialsSection.cd5c2b.html"},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/SpecialsForm.91749a.html"},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/DraftSpecial.a46939.html"},function(t,e,i){},function(t,e){t.exports=' <md-card ng-if="$ctrl.conversation.specialId === undefined" class=draft translate-namespace=conversation-reply> <draft-validations-bar draft=$ctrl.draft ng-if="$ctrl.showValidationBar === true" ng-click=$ctrl.openViolationSidePane()></draft-validations-bar> <form name=$ctrl.form ng-submit=$ctrl.send()> <md-card-content layout-xs=column layout-gt-xs=row class=reply-all layout-align="{{$ctrl.profile.isGuest() ? \'space-between\' : \'end\'}} center" ng-if="$ctrl.showReplyButton === true"> <div ng-switch=$ctrl.conversation.participants.length ng-if=$ctrl.profile.isGuest()> <translate ng-switch-when=1 ng-if="$ctrl.hasEvents === true">.REPLY-TEXT-YOURSELF</translate> <translate ng-switch-when=1 ng-if="$ctrl.hasEvents === false">.REPLY-CONVERSATION-STARTER</translate> <translate ng-switch-when=2>.REPLY-TEXT-ONE</translate> <translate ng-switch-default translate-compile translate-value-participants="{{ $ctrl.conversation.participants.length - 1 }}"> .REPLY-TEXT-ALL </translate> </div> <md-button aria-label="activate reply" class="md-raised md-primary" ng-click=$ctrl.replyFocus() ng-if="$ctrl.isReplyActive === false"> <translate ng-if="$ctrl.conversation.participants.length <= 2">.REPLY</translate> <translate ng-if="$ctrl.conversation.participants.length > 2">.REPLY-ALL</translate> </md-button> </md-card-content> <md-card-content ng-show="$ctrl.showReplyButton === false"> <div layout=row layout-align="space-between end" layout-wrap class=message-body> <div class=reply-all ng-if=$ctrl.showReplyAllMessage()> <translate translate-compile translate-value-participants="{{ $ctrl.conversation.participants.length - 1 }}">.REPLY-TEXT-ALL</translate> </div> <md-input-container flex-xs=75 flex-sm=75 flex-gt-sm=100 md-no-float> <draft-body body=$ctrl.draft.body content-type=$ctrl.draft.contentType is-signature-page=false profile-uuid=$ctrl.profile.uuid> </draft-body> </md-input-container> <section flex-xs=25 flex-sm=25 flex-gt-sm=100 class=actions layout=row layout-align="end center"> <div layout=row layout-align="space-between center" hide-xs hide-sm> <span ng-if=$ctrl.isExpirationEnabled class=time-left> {{$ctrl.timeLeft}} </span> <md-button class="md-icon-button expiration-button" ng-click=$ctrl.openExpirationDialog() aria-label="schedule options" ng-class="{\'md-primary\': $ctrl.isExpirationEnabled}" ng-if="$ctrl.profile.isGuest() === false"> <md-tooltip md-direction=top> <translate>.SCHEDULE</translate> </md-tooltip> <md-icon>history</md-icon> </md-button> </div> <md-button class="md-icon-button editor-button" ng-click=$ctrl.editorToggle() ng-if=$ctrl.showSwitchButton aria-label="editor toggle" md-no-ink hide-xs hide-sm> <md-tooltip md-direction=top> <translate>{{ \'.EDITOR.\' + ($ctrl.draft.contentType === \'text/plain\' ? \'PLAIN\' : \'HTML\') }}</translate> </md-tooltip> <md-icon ng-class="{\'rich-text\': $ctrl.draft.contentType === \'text/html\'}"> text_format </md-icon> </md-button> <attach-button draft=$ctrl.draft></attach-button> <draft-send-button draft=$ctrl.draft send=$ctrl.send() recipients-check=false class=draft-send> </draft-send-button> </section> <div ngf-select ngf-multiple=true ngf-change=$ctrl.uploadFiles($files) class=hidden></div> </div> <section class=attachments> <draft-attachments draft=$ctrl.draft></draft-attachments> </section> </md-card-content> </form> <sidepane ng-if="$ctrl.showViolationsSidePane === true" on-close=$ctrl.closeViolationsSidePane()> <pane-title> <translate>.VALIDATIONS-PANE</translate> </pane-title> <pane-content> <draft-validation-results draft=$ctrl.draft></draft-validation-results> </pane-content> </sidepane> <sidepane ng-if="$ctrl.showInfoPane === true" on-close=$ctrl.sidePaneClosed()> <pane-title> <translate>conversation-header.INFO-PANE-TITLE</translate> </pane-title> <pane-content> <conversation-info profile=$ctrl.profile conversation=$ctrl.conversation></conversation-info> </pane-content> </sidepane> </md-card> <draft-special ng-if="$ctrl.conversation.flow.responses.length > 0" type=response draft=$ctrl.draft conversation=":: $ctrl.conversation" download-grant-token=":: $ctrl.token" message-definition=$ctrl.messageDefinition form-definition=$ctrl.formDefinition></draft-special> '},function(t,e,s){var i,n;i=[s,e,s(1),s(555)],void 0===(n=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$translate"],o.prototype.closeSurvey=function(){this.onClose()},o.prototype.getFeedbackUrl=function(t){return"https://survey.zivver.com/798254?lang="+this.$translate.use()+"&id=guestopen&shareid="+this.shareId+"&sort="+t},o);function o(t){this.$translate=t}e.SurveyToolModule=i.module("components.SurveyTOol",[]).component("surveyTool",{bindings:{shareId:"<",onClose:"&"},controller:n,templateUrl:s(556)})}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/SurveyTool.2ec628.html"},function(t,e,i){var n,o;n=[i,e,i(1),i(19),i(8),i(5),i(59),i(166),i(18),i(94),i(172),i(560),i(13)],void 0===(o=function(t,e,n,o,s,r,i,a,c,l,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ListControllerModule=n.module("app.conversations.ListController",[c.AppSwitcherModule.name,u.ComposeButtonModule.name,i.IfEmptyFilterModule.name,l.ParticipantAvatarsModule.name,p.QuickSelectModule.name,a.TruncateFilterModule.name,d.WarningDialogModule.name]);var h=(f.$inject=["$log","$mdDialog","$q","$mdMedia","$rootScope","$scope","$state","$timeout","$transitions","$window","hotkeys","AppSwitcherService","ConversationsService","MessengerService","WebSocketService","labelCollection","profile"],f.prototype.setPlaceholder=function(t){this.placeholderItem="archive"===t?"archive":"trash"===t?"trash":"conversations"},f.prototype.openItem=function(t){if("SELECT"===this.listAction)return t.isSelected=!t.isSelected,void(!0===t.isSelected?this.selectedItems++:this.selectedItems--);if(!this.isItemActive(t)){var e={conversationId:t.id,label:this.listedLabel};"SEARCH"===this.listAction&&(e.keywords=this.search.textInput),this.$state.go("conversations.view",e,{reload:"conversations.view"})}},f.prototype.loadMoreConversations=function(){var t;0<this.items.length&&(t=this.items[this.items.length-1].lastMessageDate),this.getConversations("desc",t)},f.prototype.clearSelection=function(){this.selectedItems=0,this.items.forEach(function(t){return t.isSelected=!1}),this.listAction="DEFAULT"},f.prototype.showLabels=function(t,e){var i;return void 0===e&&(e=!1),i="SEARCH"===this.listAction&&this.search.wasPerformed?[t.systemLabel].concat(t.customLabels):t.customLabels,e?i.slice(3):i.slice(0,3)},f.prototype.getConversations=function(t,e){var i=this;this.cancelRefresh(),this.refreshing=!0;var n=this.ConversationsService.list(t,e,this.listedLabel,50,this.specialId);n.then(function(t){if("SEARCH"!==i.listAction){i.totalItems=t.pagination.total;var e=t.items.map(function(t){return t.id});i.items=i.items.filter(function(t){return-1===e.indexOf(t.id)}).concat(t.items).sort(i.sortConversations),i.initRefresh()}}),n.catch(function(t){i.$log.warn("error fetching conversations",{error:t})}),n.finally(function(){i.loading=!1,i.$timeout(function(){i.refreshing=!1},500)})},f.prototype.initSearch=function(e,i){var n=this;this.cancelRefresh(),this.listAction="SEARCH",this.$timeout(function(){var t=n.$window.document.getElementById("search-text-input");t.focus(),void 0!==e&&3<=e.length&&void 0!==i&&(t.value=e,n.searchKeyword(e))},0,!1)},f.prototype.searchTextOnChange=function(){this.search.inProgress=!0,void 0!==this.search.debounce&&this.$timeout.cancel(this.search.debounce),this.search.textInput&&3<=this.search.textInput.length?this.searchKeyword(this.search.textInput):(void 0===this.search.textInput||this.search.textInput.length<=3)&&(this.items=[],this.search.wasPerformed=!1)},f.prototype.searchKeyword=function(e){var i=this;this.search.debounce=this.$timeout(function(){if(!i.$scope.$$destroyed){i.loading=!0;var t=n.copy(i.$state.params);t.keywords=e,i.$state.go(i.$state.current.name,t,{notify:!1}),i.ConversationsService.search(e,i.specialId).then(function(t){return i.search.wasPerformed=!0,i.ConversationsService.getBatch(t.map(function(t){return t.conversationId}))}).then(function(t){i.items=t}).catch(function(){i.MessengerService.toast("CONVERSATIONS.LIST.SEARCH.ERROR")}).finally(function(){i.loading=!1})}},350,!1)},f.prototype.searchClose=function(){this.$timeout.cancel(this.search.debounce),this.search={textInput:"",debounce:void 0,inProgress:!1,wasPerformed:!1},this.listAction="DEFAULT";var t=n.copy(this.$state.params);t.keywords=void 0,this.$state.go(this.$state.current.name,t,{reload:!1}),this.doRefresh(!0)},f.prototype.isItemActive=function(t){var e=this.$state.current.name;return"conversations.open"===e&&this.$state.params.shareId===t.share||"conversations.view"===e&&this.$state.params.conversationId===t.id},f.prototype.validateLabel=function(t){return this.labelCollection.getAll().map(function(t){return t.name.toLowerCase()}).indexOf(t.toLowerCase())<0?(this.$log.debug("label '"+t+"' was not defined in this.labels"),"inbox"):t},f.prototype.initRefresh=function(){var t=this;this.WebSocketService.isOpen()||(this.refreshTimeout=this.$timeout(function(){t.doRefresh()},15e3,!1))},f.prototype.doRefresh=function(t){if(void 0===t&&(t=!1),!(this.$scope.$$destroyed||!1===t&&this.refreshing))if("SEARCH"!==this.listAction&&"SELECT"!==this.listAction)if("hidden"===this.$window.document.visibilityState&&0<this.items.length)this.initRefresh();else if(!0===t)this.loading=!0,this.items=[],this.selectedItems=0,this.getConversations("desc");else{var e=void 0;0<this.items.length&&(e=this.items[0].lastMessageDate),this.getConversations("asc",e)}else this.initRefresh()},f.prototype.cancelRefresh=function(){void 0!==this.refreshTimeout&&(this.$timeout.cancel(this.refreshTimeout),this.refreshTimeout=void 0)},f.prototype.registerEvents=function(){var i=this;function t(t){i.$timeout(function(){"visible"===i.$window.document.visibilityState&&i.$timeout(function(){i.cancelRefresh(),i.doRefresh()},350)},250)}this.$scope.$on(r.AuthEvents.logoutOtherTab,function(){i.cancelRefresh()}),this.$scope.$on("conversation-moved",function(t,e){i.items=i.items.filter(function(t){return t.id!==e}),i.totalItems--,i.$state.go("conversations.label",{label:i.listedLabel})}),this.$scope.$on("conversation:updated",function(t,e){i.items=i.items.map(function(t){return t.id===e.id?e:t}).sort(i.sortConversations)}),this.$window.document.addEventListener("visibilitychange",t),this.$scope.$on("$destroy",function(){i.$window.document.removeEventListener("visibilitychange",t)}),this.$rootScope.$on("push.conversations",function(){i.$log.debug("Updating list of conversations, from push notifications"),i.doRefresh()}),this.$scope.$on(o.WebSocketEvents.CONVERSATION_UPDATED,function(){i.$log.debug("Websocket received a updated conversation, refreshing list"),i.doRefresh()}),this.$scope.$on(s.LabelEvents.Updated,function(t,e){i.labelCollection=e,i.ConversationsService.setLabels(i.labelCollection),i.items.forEach(function(t){return t.updateLabelCollection(i.labelCollection)})}),this.$scope.$on(s.LabelEvents.Deleted,function(t,e){i.items.forEach(function(t){return t.removeLabelById(e)})})},f.prototype.enableHotkeys=function(){var e=this;this.hotkeys.bindTo(this.$scope).add({combo:"/",callback:function(t){t.preventDefault(),e.initSearch()}}).add({combo:"esc",allowIn:["INPUT"],callback:function(t){t.preventDefault(),e.searchClose()}})},f.prototype.sortConversations=function(t,e){return t.lastMessageDate>e.lastMessageDate?-1:1},f.prototype.moveConversations=function(e){var i=this;if(this.items.filter(function(t){return t.isSelected}).length<1)this.MessengerService.toast("CONVERSATIONS.LIST.MOVE.NONE");else{this.listAction="DEFAULT",this.selectedItems=0;var n=[];this.items.filter(function(t){return t.isSelected}).forEach(function(t){n.push(i.ConversationsService.moveConversation(t,e))}),this.$q.all(n).then(function(){i.MessengerService.toast("CONVERSATIONS.LIST.MOVE.SUCCESS."+e),i.totalItems=i.totalItems-n.length,i.items=i.items.filter(function(t){return!1===t.isSelected}),i.$state.go("conversations.label",{label:i.listedLabel})}).catch(function(t){i.$log.warn("Error unarchiving conversations",{error:t}),i.MessengerService.toast("CONVERSATIONS.LIST.MOVE.ERROR")})}},f.prototype.deleteItems=function(){var t,i=this,e=this.items.filter(function(t){return t.isSelected});if(e.length<1)this.MessengerService.toast("CONVERSATIONS.LIST.MOVE.NONE");else{t=1<e.length?"conversation-header.DELETE.EXPLANATION-MULTIPLE":"conversation-header.DELETE.EXPLANATION";var n=d.WarningDialog.factory({title:"conversation-header.DELETE.TITLE",explanation:t,submitText:"conversation-header.DELETE.CONFIRM",type:d.WarningDialogTypes.error}),o=[];this.$mdDialog.show(n).then(function(){e.reduce(function(t,e){return t.then(function(){return i.ConversationsService.removeConversation(e.share).then(function(t){o.push(t)}).catch(function(t){i.$log.warn("error deleting conversation",{error:t})})})},i.$q.resolve()).then(function(){o.every(function(t){return!0===t})?i.MessengerService.toast("CONVERSATIONS.LIST.DELETE-SUCCESS"):i.MessengerService.toast("CONVERSATIONS.LIST.DELETE-SOME-SUCCESS"),i.clearSelection(),i.doRefresh(!0),i.$state.go("conversations.label",{label:i.listedLabel})}).catch(function(t){i.$log.warn("error while deleting conversations",{error:t})})})}},f);function f(t,e,i,n,o,s,r,a,c,l,u,p,d,h,f,v,m){var g=this;this.$log=t,this.$mdDialog=e,this.$q=i,this.$mdMedia=n,this.$rootScope=o,this.$scope=s,this.$state=r,this.$timeout=a,this.$transitions=c,this.$window=l,this.hotkeys=u,this.AppSwitcherService=p,this.ConversationsService=d,this.MessengerService=h,this.WebSocketService=f,this.labelCollection=v,this.profile=m,this.items=[],this.listAction="DEFAULT",this.loading=!0,this.refreshing=!0,this.search={textInput:"",debounce:void 0,inProgress:!1,wasPerformed:!1},this.selectedItems=0,this.excludedComposeLabels=["trash"],this.excludedSearchLabels=["trash"],this.registerEvents(),this.enableHotkeys(),this.specialId=this.AppSwitcherService.getContext().specialId,this.listedLabel=this.validateLabel(r.params.label),void 0===r.params.keywords?this.getConversations("desc"):(this.loading=!1,this.initSearch(r.params.keywords,this.listedLabel)),this.setPlaceholder(this.listedLabel),this.$transitions.onSuccess({to:"conversations.label"},function(t){var e=t.params();"SEARCH"===g.listAction?(g.listedLabel=g.validateLabel(e.label),g.doRefresh(!0)):"DEFAULT"===g.listAction&&g.listedLabel!==e.label?(g.listedLabel=g.validateLabel(e.label),g.doRefresh(!0)):"SELECT"===g.listAction&&g.listedLabel!==e.label&&(g.listedLabel=g.validateLabel(e.label),g.clearSelection(),g.doRefresh(!0)),g.setPlaceholder(g.listedLabel)})}e.ListController=h}.apply(e,n))||(t.exports=o)},function(t,e,i){},function(t,e){t.exports='<div translate-namespace=compose-button> <md-button class="md-fab md-primary" aria-label="{{:: $ctrl.options[0].label}}" ui-sref="{{ $ctrl.options[0].state}}($ctrl.options[0].stateParams)" ng-if="$ctrl.options.length === 1"> <md-icon>{{:: $ctrl.options[0].icon }}</md-icon> <md-tooltip md-delay=500 md-direction=top>{{:: $ctrl.options[0].label}}</md-tooltip> </md-button> <md-fab-speed-dial md-open=$ctrl.speedDialOpen md-direction=up class=md-scale ng-if="$ctrl.options.length > 1"> <md-fab-trigger> <md-button aria-label=menu class="md-fab md-primary"> <md-icon>apps</md-icon> </md-button> </md-fab-trigger> <md-fab-actions> <div ng-repeat="option in $ctrl.options"> <md-button ui-sref="{{ option.state }}(option.stateParams)" aria-label="{{:: option.label }}" class="md-fab md-raised md-mini"> <md-icon>{{:: option.icon }}</md-icon> <md-tooltip md-direction=left>{{:: option.label }}</md-tooltip> </md-button> </div> </md-fab-actions> </md-fab-speed-dial> </div> '},function(t,e,r){var i,n;i=[r,e,r(1),r(8),r(561)],void 0===(n=function(t,e,i,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$log","$scope","$state","LabelService"],o.prototype.getLabels=function(){var e=this;this.LabelService.getLabels().then(function(t){return e.userLabels=t.userLabels.filter(function(t){return 0<t.counter})}).catch(function(t){e.$log.warn("Error getting labels",{error:t})})},o.prototype.goToSysItem=function(t){this.$state.go(t.state,t.stateParams)},o.prototype.sysItemActive=function(t){return"conversations.label"===t.state?this.$state.includes(t.state,t.stateParams):"drafts.index"===t.state?this.$state.includes(t.state)||this.$state.includes("drafts.edit")||this.$state.includes("draft.create"):void 0},o.prototype.labelActive=function(t){return this.$state.params.label===t.name},o.prototype.showLabelConversations=function(t){this.$state.go("conversations.label",{label:t.name})},o.prototype.goTo=function(t){this.$state.go(t)},o);function o(t,e,i,n){var o=this;this.$log=t,this.$scope=e,this.$state=i,this.LabelService=n,this.sysItems=[{state:"conversations.label",stateParams:{label:"inbox"},label:"INBOX",icon:"question_answer"},{state:"drafts.index",label:"DRAFTS",icon:"rate_review"},{state:"conversations.label",stateParams:{label:"archive"},label:"ARCHIVE",icon:"archive"},{state:"conversations.label",stateParams:{label:"trash"},label:"TRASH",icon:"delete"}],this.userLabels=[],this.$scope.$on(s.LabelEvents.Updated,function(t,e){o.userLabels=e.userLabels.filter(function(t){return 0<t.counter})}),this.$scope.$on(s.LabelEvents.Deleted,function(t,e){o.userLabels=o.userLabels.filter(function(t){return t.id!==e})}),this.getLabels()}e.QuickSelect=n,e.QuickSelectModule=i.module("components.QuickSelect",[]).component("quickSelect",{controller:n,templateUrl:r(562)})}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/QuickSelect.c45cd5.html"},function(t,e,s){var i,n;i=[s,e,s(1),s(564)],void 0===(n=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$stateParams"],o);function o(t){this.conversation=t.conversation,this.share=t.share,this.error=t.error}e.ConversationError=n,e.ConversationErrorModule=i.module("components.ConversationError",[]).component("conversationError",{bindings:{profile:"<"},controller:n,templateUrl:s(565)})}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/ConversationError.871b23.html"},function(t,e,i){},function(t,e){t.exports='<aside class=header layout=row layout-align="space-between center"> <div class=list-actions flex-gt-sm=15 ng-if="$ctrl.items.length > 0"> <md-button class=md-icon-button ng-click="$ctrl.listAction = \'SELECT\'" ng-if="$ctrl.listAction === \'DEFAULT\'" aria-label="Select conversations"> <md-tooltip md-delay=500> <translate>CONVERSATIONS.LIST.SELECT</translate> </md-tooltip> <md-icon md-svg-icon=ziv:select></md-icon> </md-button> <md-button class=md-icon-button ng-click=$ctrl.clearSelection() ng-if="$ctrl.listAction === \'SELECT\'" aria-label="Cancel selection"> <md-icon md-svg-icon=ziv:deselect></md-icon> </md-button> </div> <div ng-switch=$ctrl.listAction flex flex-gt-sm=75 layout-align="start center" class=middle-list-header ng-class="{ \'no-multiselect-margin\' : $ctrl.items.length === 0 }"> <div ng-switch-default layout=row> <h2 flex=nogrow class=md-title> <span ng-if="$ctrl.selectedItems === 0" ng-switch=$ctrl.listedLabel> <translate ng-switch-when=inbox>CONVERSATIONS.LIST.TITLE</translate> <translate ng-switch-when=archive>CONVERSATIONS.LIST.TITLE-ARCHIVE</translate> <translate ng-switch-when=trash>CONVERSATIONS.LIST.TITLE-TRASH</translate> <span ng-switch-default>{{$ctrl.listedLabel}}</span> </span> <span ng-if="$ctrl.selectedItems > 0"> {{$ctrl.selectedItems}} </span> </h2> <div ng-if="$ctrl.listAction === \'DEFAULT\'" hide-gt-sm class="label-menu noselect"> <quick-select></quick-select> </div> </div> <div ng-switch-when=SEARCH flex layout=row layout-fill class=search-container> <md-input-container flex=100 md-no-float class=md-block> <input id=search-text-input class=search-input type=text ng-model=$ctrl.search.textInput ng-change=$ctrl.searchTextOnChange() placeholder="{{ \'CONVERSATIONS.LIST.SEARCH\' | translate }}"> </md-input-container> </div> </div> <div flex-gt-sm=30 ng-switch=$ctrl.listAction> <div ng-switch-when=DEFAULT ng-if="$ctrl.excludedSearchLabels.indexOf($ctrl.listedLabel) === -1" layout=row layout-align="end center"> <md-button class=md-icon-button ng-click=$ctrl.initSearch(false)> <md-icon>search</md-icon> <md-tooltip md-delay=500> <translate>CONVERSATIONS.LIST.SEARCH</translate> </md-tooltip> </md-button> </div> <div ng-switch-when=SELECT layout=row layout-align="end center"> <md-button class=md-icon-button ng-if="$ctrl.listedLabel === \'inbox\'" ng-click="$ctrl.moveConversations(\'ARCHIVE\')"> <md-icon>archive</md-icon> <md-tooltip md-delay=500> <translate>CONVERSATIONS.LIST.MOVE.ARCHIVE</translate> </md-tooltip> </md-button> <md-button class=md-icon-button ng-click="$ctrl.moveConversations(\'INBOX\')" ng-if="$ctrl.listedLabel === \'archive\'"> <md-icon>move_to_inbox</md-icon> <md-tooltip md-delay=500> <translate>CONVERSATIONS.LIST.MOVE.INBOX</translate> </md-tooltip> </md-button> <md-button class=md-icon-button ng-click="$ctrl.moveConversations(\'TRASH\')" ng-if="$ctrl.listedLabel !== \'trash\'"> <md-icon>delete</md-icon> <md-tooltip md-delay=500> <translate>CONVERSATIONS.LIST.MOVE.TRASH</translate> </md-tooltip> </md-button> <md-button class=md-icon-button ng-click="$ctrl.moveConversations(\'INBOX\')" ng-if="$ctrl.listedLabel === \'trash\'"> <md-icon>move_to_inbox</md-icon> <md-tooltip md-delay=500> <translate>CONVERSATIONS.LIST.MOVE.INBOX</translate> </md-tooltip> </md-button> <md-button class=md-icon-button ng-click=$ctrl.deleteItems() ng-if="$ctrl.listedLabel === \'trash\'"> <md-icon>delete</md-icon> <md-tooltip md-delay=500> <translate>CONVERSATIONS.LIST.DELETE</translate> </md-tooltip> </md-button> </div> <div ng-switch-when=SEARCH layout=row layout-align="end center"> <md-button class=md-icon-button ng-click=$ctrl.searchClose();> <md-icon>close</md-icon> </md-button> </div> </div> </aside> <md-progress-linear md-mode=indeterminate ng-if="$ctrl.loading === true"></md-progress-linear> <div class="conversations-list items-list" translate-namespace=CONVERSATIONS.LIST ng-class="{\n\t\t\'md-whiteframe-1dp\' : $ctrl.$mdMedia(\'gt-md\')\n\t}"> <div ng-if="$ctrl.loading === false" class=div-list> <div class=list-item-empty ng-if="$ctrl.items.length === 0 && $ctrl.search.inProgress === false && $ctrl.$mdMedia(\'gt-sm\')"> <translate>.EMPTY</translate> </div> <placeholder ng-if="$ctrl.items.length === 0 && $ctrl.search.inProgress === false && $ctrl.$mdMedia(\'gt-sm\') === false" item=$ctrl.placeholderItem></placeholder> <div class=list-item-empty ng-if="$ctrl.search.textInput.length > 3 && $ctrl.items.length === 0 && $ctrl.search.wasPerformed === true"> <translate>.SEARCH.NOTFOUND</translate> </div> <div class=div-list-item ng-if="$ctrl.items.length > 0" ng-repeat="item in $ctrl.items track by item.id" ng-class="{\n\t\t\t\tselected : item.isSelected,\n\t\t\t\tactive : $ctrl.isItemActive(item)\n\t\t\t}" ng-click=$ctrl.openItem(item); layout=row layout-align="start center"> <md-icon ng-if="$ctrl.listAction === \'SELECT\'" class=item-select ng-class="{ \'selected\' : item.isSelected === true }"> {{ item.isSelected === true ? \'check_box\' : \'check_box_outline_blank\' }} </md-icon> <participant-avatars participants=":: item.participants" profile=":: $ctrl.profile" ng-if=":: item.participants.length > 0"> </participant-avatars> <div class="div-list-item-text extend" flex=85> <div class="first-line truncate" title="{{:: item.subject }}"> <span class=truncate>{{:: item.subject | ifEmpty:"" }}</span> </div> <div class=second-line> <span class=truncate>{{:: item.summarizeParticipants($ctrl.profile, 2); }}</span> </div> <div class=third-line layout=row> <div flex=90> <conversation-label ng-repeat="label in $ctrl.showLabels(item) track by label.id" label=::label mini=::true></conversation-label> <span ng-if="$ctrl.showLabels(item, true).length > 0"> ... +{{ $ctrl.showLabels(item, true).length }} </span> </div> </div> </div> <span flex></span> <div class=messageType> <span class=date title="{{ item.lastMessageDate | date : \'medium\'}}"> {{ item.lastMessageDate | date : \'dd MMM\'}} </span> <div class="row icons" layout-wrap> <md-icon class=new ng-if="item.counters.unread > 0">lens</md-icon> <md-icon class=attach-file ng-if=":: item.counters.files > 0">attach_file</md-icon> </div> </div> </div> <div ng-if="$ctrl.totalItems > $ctrl.items.length && $ctrl.listAction === \'DEFAULT\'" class="div-list-item load-more"> <a ng-if="$ctrl.refreshing === false" ng-click="$ctrl.loadMoreConversations(\'older\');"> <translate>.LOAD-OLDER</translate> </a> </div> </div> </div> <compose-button ng-if="$ctrl.excludedComposeLabels.indexOf($ctrl.listedLabel) === -1"></compose-button> '},function(t,e){t.exports='<div flex=100 layout=row class=zv-subheader> <aside class=header flex ng-if="$app.isGuest === false"></aside> </div> <div class="main-content messages-view conversation-view" translate-namespace=CONVERSATIONS.LIST flex=100> <md-card ng-if=$app.isGuest> <md-card-content> <p class="fill-width center"><translate>.GUEST-ACCESS</translate></p> <div layout=row layout-align=center> <md-button class="md-raised md-warn" ui-sref="signup({email : $app.profile.email })"> <translate>.GUEST-SIGNUP</translate> </md-button> </div> </md-card-content> </md-card> <placeholder ng-if="$app.isGuest === false && $ctrl.$mdMedia(\'gt-sm\')" item=":: $ctrl.placeholderItem"></placeholder> </div> '},function(t,e){t.exports='<conversation-header conversation=$ctrl.conversation profile=$ctrl.profile share=$ctrl.share> </conversation-header> <div class="main-content messages-view conversation-view" flex=100 layout=row ng-if=$ctrl.loading> <md-progress-linear md-mode=query></md-progress-linear> </div> <div class="main-content messages-view conversation-view" flex=100 layout=row layout-align="center start" ng-if="$ctrl.loading === false"> <md-card ng-if="$ctrl.loading === false && $ctrl.delegate === undefined" class=challenge> <md-card-content> <conversation-challenge conversation=$ctrl.conversation share=$ctrl.share profile=$ctrl.profile notified=$ctrl.hideTitle></conversation-challenge> </md-card-content> </md-card> <conversation-for-delegate ng-if="$ctrl.loading === false && $ctrl.delegate !== undefined" profile-email=":: $ctrl.profile.email" delegate=":: $ctrl.delegate" share-id=":: $ctrl.share.id"> </conversation-for-delegate> </div> '},function(t,e,i){t.exports='<conversation-header conversation=$ctrl.conversation messages=$ctrl.messages profile=$ctrl.profile share=$ctrl.share> </conversation-header> <div class="main-content messages-view conversation-view" translate-namespace=CONVERSATIONS.VIEW flex=100> <md-progress-linear md-mode=query ng-if=$ctrl.loading></md-progress-linear> <div layout=column layout-align-xs=space-between class=conversation-container ng-class="{\n\t\t\t\'guest\' : $ctrl.profile.isGuest() && $ctrl.loading === false,\n\t\t\t\'ordinary\' : $ctrl.conversation.specialId === undefined }"> <div class=conversation-messages> <div ng-show="$ctrl.conversation.customLabels.length > 0" class="conversation-label-container clearfix"> <conversation-label ng-repeat="label in $ctrl.conversation.customLabels" label=label conversation=":: $ctrl.conversation"> </conversation-label> </div> <ng-repeat ng-repeat="item in $ctrl.messagesAndEvents"> <md-card class=placeholder ng-if="item.contentType === undefined && item.eventType === undefined"> <md-card-header flex> <md-card-avatar> <img class=md-user-avatar src='+i(75)+' /> </md-card-avatar> <md-card-header-text> <span class="md-title block">&nbsp;</span> </md-card-header-text> </md-card-header> <md-card-content> <p class=block>&nbsp;</p> <p class=block>&nbsp;</p> </md-card-content> </md-card> <conversation-message ng-if="item.contentType !== undefined" message=item conversation=$ctrl.conversation download-token=$ctrl.downloadToken profile=$ctrl.profile share=$ctrl.share></conversation-message> <conversation-event ng-if="item.eventType !== undefined" event=item></conversation-event> <survey-tool ng-if="$first === true && $ctrl.showSurvey === true" on-close=$ctrl.closeSurvey() share-id=$ctrl.share.id></survey-tool> </ng-repeat> <conversation-event ng-repeat="item in $ctrl.suspendedEvents track by item.originator" event=::item ng-click=$ctrl.openSidePane()></conversation-event> </div> <conversation-reply id=reply ng-if="$ctrl.messagesAndEvents.length > 0" conversation=":: $ctrl.conversation" token=":: $ctrl.share.accessRightGrant.token" profile=$ctrl.profile has-events=$ctrl.hasEvents></conversation-reply> </div> <sidepane ng-if=$ctrl.showInfoPane on-close=$ctrl.sidePaneClosed()> <pane-title> <translate>.INFO-PANE-TITLE</translate> </pane-title> <pane-content> <conversation-info profile=$ctrl.profile conversation=$ctrl.conversation></conversation-info> </pane-content> </sidepane> </div> '},function(t,e,v){var i,n;i=[v,e,v(1),v(40),v(572),v(9),v(573),v(600),v(5),v(601),v(77),v(602)],void 0===(n=function(t,e,i,d,n,a,o,s,r,c,l){"use strict";function u(t,e,i,n){var o=e.messageDefinition;return null!==o?t.resolve(o):i.getMessageDefinition(n.messageDefinitionId)}function p(t,e){return e.getSpecial(t.params().specialId)}function h(e,i,t){var n=e.params().draftId;return t.get(n).catch(function(t){i.warn("Error resolving draft",{draftId:n,error:t}),e.router.stateService.go("drafts.index")})}function f(t,e,i,n,o,s,r){if(void 0===n||n.isPlain()||n.isFoward()&&void 0===n.quote)return t.resolve();var a=i.params().share;return(void 0!==a?t.resolve(a):s.getShare(n.quote.shareId)).then(function(t){if(!1!==t.isAccessGranted())return t;r.confirm("DRAFTS.DIALOG.ACCESSRIGHTGRANT-NEEDED.TITLE","DRAFTS.DIALOG.ACCESSRIGHTGRANT-NEEDED.BODY").then(function(){i.router.stateService.go("conversations.open",{shareId:t.id})},function(){i.router.stateService.go("conversations.index")})}).catch(function(t){e.warn("Error resolving share for quoted draft",{error:t}),i.router.stateService.go("drafts.index")})}u.$inject=["$q","$stateParams","SpecialsService","draft"],p.$inject=["$transition$","SpecialsService"],h.$inject=["$transition$","$log","DraftsService"],f.$inject=["$q","$log","$transition$","draft","profile","ConversationsService","MessengerService"],Object.defineProperty(e,"__esModule",{value:!0}),e.DraftsModule=i.module("app.drafts",[n.CreateControllerModule.name,o.EditControllerModule.name,s.ListControllerModule.name,c.SpecialControllerModule.name,l.SpecialsFormModule.name]),e.DraftsModule.config(["$stateProvider",function(t){t.state({abstract:!0,parent:"_app_layout",name:"drafts",url:"/drafts",data:{title:"Drafts",bodyClass:"app drafts",scopesRequired:[r.Scopes.SENDMESSAGES]},views:{"list@_app_layout":{templateUrl:v(603),controller:s.ListController,controllerAs:"$ctrl"},"main@_app_layout":{template:'<div class="drafts" layout="row" layout-wrap ui-view></div>'}}}),t.state({name:"drafts.index",url:"/index",templateUrl:v(173)}),t.state({name:"drafts.create",url:"/create",templateUrl:v(173),params:{recipients:[],to:[],quote:void 0,share:void 0,draftType:"plain",selectedMessages:void 0,conversationStarter:void 0},controller:n.CreateController,resolve:{profileProgress:["ProfileService",function(t){return t.progress()}],recipients:["$q","$stateParams","ContactsService",function(e,t,n){var o=[],i=t.recipients,s=t.to;if(void 0!==i&&0<i.length)for(var r=0,a=i;r<a.length;r++){var c=a[r];o.push(e.when(c))}if(void 0!==s&&0<s.length)for(var l=function(i){var t=n.get(i).then(function(t){var e;return void 0===t?(e=new d.Contact).email=i:e=t,e.toRecipient()});t.catch(function(){return e.resolve(i)}),o.push(t)},u=0,p=s;u<p.length;u++)l(p[u]);return e.all(o)}]}}),t.state({name:"drafts.edit",url:"/edit/{draftId:uuid}?label",templateUrl:v(604),controller:o.EditController,controllerAs:"$ctrl",data:{scopesRequired:[r.Scopes.SENDMESSAGES]},params:{draft:null,draftId:null,label:void 0,share:void 0,conversationStarter:void 0},resolve:{draft:h,share:f}}),t.state({name:"drafts.special",url:"/special/{specialId:uuid}",controller:c.SpecialController,controllerAs:"$ctrl",templateUrl:v(174),resolve:{draft:["$state","DraftsService","special",function(e,t,i){var n=new a.Draft,o=i.flowInitiations[0],s=o.messageDefinition,r=o.fixedRecipients;return n.contentType="application/zivver-special+json",n.messageDefinitionId=s.id,n.recipients=r.map(function(t){return new a.Recipient({email:t})}),n.subject="",t.save(n).then(function(t){return e.go("drafts.specialedit",{draftId:t.id,draft:t,messageDefinition:s})})}],special:p}}),t.state({name:"drafts.specialedit",url:"/special/edit/{draftId:uuid}",templateUrl:v(174),controller:c.SpecialController,controllerAs:"$ctrl",params:{draft:null,draftId:null,messageDefinition:null},resolve:{draft:h,messageDefinition:u}})}])}.apply(e,i))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(1),i(158),i(9)],void 0===(o=function(t,e,i,n,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(s.$inject=["$log","$rootScope","$state","$stateParams","AuthSessionService","DeviceService","DraftsService","profile","profileProgress","recipients","SignatureService","WizardService"],s.prototype.setSignature=function(e){var i=this,n=e,o="IE"===this.DeviceService.getBrowser().name||"Edge"===this.DeviceService.getBrowser().name;return this.SignatureService.getSignature(this.profile.uuid,"First").then(function(t){if(t&&0<t.content.length&&0==o)n.body+="<div><br><br> -- <br> "+t.content+"</div>";else if(t&&0<t.content.length&&o){var e=document.createElement("div");e.innerHTML=t.content,n.body+="\n\n--\n"+e.innerText}return n}).catch(function(t){return i.$log.error("Error getting signature",{error:t}),e})},s);function s(t,e,i,n,o,s,r,a,c,l,u,p){var d=this;if(this.$log=t,this.$rootScope=e,this.$state=i,this.$stateParams=n,this.AuthSessionService=o,this.DeviceService=s,this.DraftsService=r,this.profile=a,this.profileProgress=c,this.recipients=l,this.SignatureService=u,this.WizardService=p,!1!==c.hasSecondAuthenticationFactor||!1!==o.isDelegate()){var h=new g.Draft;h.recipients=l,h.draftType=n.draftType,h.subject=n.subject,!1===s.isDesktop()&&(h.contentType="text/plain");var f=n.conversationStarter;if(h.isPlain())this.setSignature(h).then(function(t){r.save(t).then(function(t){e.$broadcast("list:added",t),i.go("drafts.edit",{draftId:t.id,draft:t,conversationStarter:f},{location:"replace"})}).catch(function(t){d.$log.error("Error creating new draft",{error:t})})});else{var v=n.share,m=n.quote;if(void 0===v)throw Error("Cannot quote without a share");if(void 0===m)throw Error("Cannot quote without a quote");r.setAccessRightGrant(v.accessRightGrant),this.setSignature(h).then(function(t){r.save(t,m).then(function(t){return e.$broadcast("list:added",t),i.go("drafts.edit",{draftId:t.id,draft:t,share:v,conversationStarter:f},{location:"replace"})})})}}else p.openWizard(p.WIZARDS.MFA,{params:{allowClose:!0}}).then(function(){return i.reload()}).catch(function(){return i.go("drafts.index",{reload:!0},{location:"replace"})})}e.CreateController=o,e.CreateControllerModule=i.module("app.drafts.CreateController",[n.WizardMfaModule.name])}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(7),i(1),i(10),i(168),i(5),i(8),i(163),i(165),i(574),i(61),i(577),i(160),i(167),i(169),i(60),i(6),i(8),i(29),i(597),i(13),i(157),i(156),i(19)],void 0===(o=function(t,e,i,n,o,s,A,I,r,a,c,l,u,p,d,h,f,v,m,g,S,$,y,b,R){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var w="conversation-message",E=(C.$inject=["$element","$log","$mdDialog","$mdMedia","$mdPanel","$rootScope","$scope","$state","$stateParams","$timeout","$translate","$transitions","$uiRouterGlobals","ConversationsService","DeviceService","DraftsService","DraftsValidationService","LabelService","MessengerService","OrganizationService","StorageService","WizardService","draft","profile","share"],C.prototype.$onInit=function(){var e=this;this.isMSBrowser="IE"===this.DeviceService.getBrowser().name||"Edge"===this.DeviceService.getBrowser().name,this.isMSBrowser&&(this.draft.contentType="text/plain"),void 0===this.draft.scheduledExpiration?this.OrganizationService.getMessageExpirationPolicy().then(function(t){e.isExpirationEnabled=t.automaticScheduledExpiration,t.automaticScheduledExpiration&&(e.draft.scheduledExpiration={action:t.defaults.action,expiresIn:t.defaults.duration},e.timeLeft=e.setTimeLeft())}):(this.isExpirationEnabled=void 0!==this.draft.scheduledExpiration.expiresIn,this.timeLeft=this.setTimeLeft())},C.prototype.refreshDownloadToken=function(){var e=this;return this.ConversationsService.getShareDownloadToken(this.share).then(function(t){return e.downloadToken=t}).catch(function(t){e.$log.error("Something went wrong while getting the share the download token",{error:t}),e.MessengerService.toast("CONVERSATIONS.VIEW.DOWNLOAD-TOKEN-ERROR")})},C.prototype.save=function(){var e=this;0===this.changesForSaving||this.draft.isSaving||(10<=this.saveAttempts&&(this.$log.error("Cannot save draft, tried "+this.saveAttempts+" time already"),this.MessengerService.toast("DRAFTS.EDIT.ERROR.SAVE")),this.saveAttempts++,this.draft.isSaving=!0,this.changesForSaving=0,this.DraftsService.save(this.draft).then(function(t){e.saveAttempts=0,e.draft.createdDate=t.createdDate,e.draft.modifiedDate=t.modifiedDate}).catch(function(t){t.status===v.HTTP_BAD_REQUEST?e.draft.validation.validationCompleted=!0:e.$log.warn("Could not save message",{error:t})}).finally(function(){e.draft.isSaving=!1}))},C.prototype.cancel=function(){var t=this,e=$.WarningDialog.factory({title:"DRAFTS.CANCEL-DIALOG.TITLE",explanation:"DRAFTS.CANCEL-DIALOG.CONFIRMATION",submitText:"DRAFTS.CANCEL-DIALOG.SUBMIT",cancelText:"DRAFTS.CANCEL-DIALOG.CANCEL",type:$.WarningDialogTypes.warning});this.$mdDialog.show(e).then(function(){t.draft.isUploading=!1,null!==t.draft.id?(t.$rootScope.$broadcast("list:remove",t.draft.id),t.DraftsValidationService.clearDismissedViolations(t.draft.id),t.DraftsService.remove(t.draft).then(function(){t.$state.go("drafts.index")})):t.$state.go("drafts.index")})},C.prototype.validate=function(){var e=this;this.$timeout.cancel(this.validationTimeout),0===this.changesForValidation||this.draft.isValidating||(this.draft.isValidating=!0,this.changesForValidation=0,this.validationAttempts++,this.DraftsService.validate(this.draft).then(function(t){(e.draft.validation=t).validationCompleted?e.validationAttempts=0:e.validationAttempts<10?e.validationTimeout=e.$timeout(function(){e.changesForValidation++,e.validate()},1e3*e.validationAttempts,!1):(e.MessengerService.alert("DRAFTS.EDIT.ERROR.VALIDATION.TIMEOUT"),e.$log.warn("Giving up draft validation after too many attempts",{fileIds:e.draft.files.map(function(t){return t.id}),draftId:e.draft.id})),t.hasViolations()&&e.WizardService.showWizardOnce(e.WizardService.WIZARDS.BUSINESSRULES)},function(t){e.$log.warn("Error validating draft",{error:t})}).finally(function(){e.draft.isValidating=!1}))},C.prototype.isDraftValid=function(){return!1===this.draft.isModified&&0<this.draft.recipients.length&&this.draft.validation.validationCompleted&&this.draft.validation.validDraft&&0===this.draft.validation.violationsUnresolved.length},C.prototype.isDraftEmpty=function(){var t=this.draft.body.substring(0,this.draft.body.indexOf("<div><br><br> --")).replace("<div><br/></div>","");return void 0===this.draft.id||0===this.draft.recipients.length&&0===this.draft.files.length&&void 0===this.draft.subject&&(void 0===t||0===t.length)},C.prototype.send=function(){var e=this;if(this.$timeout.cancel(this.validationTimeout),!1!==this.preSend()){void 0!==this.draft.scheduledExpiration&&(this.draft.scheduledExpiration={action:this.draft.scheduledExpiration.action,expiresAt:o().add(o.duration(this.draft.scheduledExpiration.expiresIn)).toISOString()}),"text/html"===this.draft.contentType&&this.switchImgSource();var t=n.copy(this.draft);!this.draft.isReply()&&!this.draft.isFoward()||void 0!==this.draft.quote&&0!==this.selectedMessages.length?(void 0!==t.quote&&(t.quote.messages=this.draft.quote.messages.filter(function(t){return-1<e.selectedMessages.indexOf(t.id)})),this.draft.isSending=!0,this.DraftsService.send(t).then(function(t){e.MessengerService.toast("DRAFTS.EDIT.MESSAGE.SENT"),e.DraftsValidationService.clearDismissedViolations(e.draft.id),void 0!==e.mdPanelRef&&e.mdPanelRef.destroy(),void 0!==e.draftLabel&&e.createLabel(t.conversation),e.$state.go("conversations.view",{conversationId:t.conversation},{location:"replace"})}).catch(function(t){return e.draft.isSending=!1,e.$log.error("Error finalizing draft",{error:t}),e.validate(),e.MessengerService.alert("DRAFTS.EDIT.MESSAGE.CANNOT-BE-SENT")})):this.MessengerService.alert("DRAFTS.EDIT.FORWARD.NO-MESSAGE.ERROR")}},C.prototype.createLabel=function(i){var n=this;this.LabelService.getLabels().then(function(t){var e=t.userLabels.filter(function(t){return t.name===n.draftLabel})[0];void 0!==e?(n.StorageService.setItem("SESSION","draft-label",e),n.StorageService.setItem("SESSION","conversation-label",i)):n.LabelService.createLabel(n.draftLabel,Object.keys(m.LabelColors)[Math.floor(9*Math.random())]).then(function(t){n.StorageService.setItem("SESSION","draft-label",t),n.StorageService.setItem("SESSION","conversation-label",i)}).catch(function(t){n.$log.info("Could not create label when finalizing draft",{error:t})})})},C.prototype.uploadFiles=function(t){!1!==n.isArray(t)&&0!==t.length&&this.$rootScope.$broadcast("files-dropped",t)},C.prototype.preSend=function(){return!(this.draft.isValidating||(this.draft.isUploading?(this.$log.info("Trying to finalize draft while still uploading"),1):0<this.draft.validation.violationsUnresolved.length?(this.openValidationsSidePane(),this.$log.info("Trying to finalize draft with unresolved violations"),1):!1===this.isDraftValid()&&(this.openValidationsSidePane(),this.$log.info("Trying to finalize draft that is invalid"),1)))},C.prototype.useQuoteInfo=function(){void 0!==this.draft.quote&&null!==this.draft.quote&&(void 0!==this.draft.subject&&0!==this.draft.subject.length||(void 0!==this.draft.draftType&&(this.draft.isReply()?this.draft.subject="RE":this.draft.isFoward()&&(this.draft.subject="FW")),void 0!==this.draft.quote.conversationInfo&&void 0!==this.draft.quote.conversationInfo.subject&&(this.draft.subject+=": "+this.draft.quote.conversationInfo.subject)))},C.prototype.handleQuoteNotifications=function(){this.draft.isFoward()&&(void 0===this.draft.quote?this.conversationEvent.eventType="quotes-conversation-revoked":this.draft.quote.messages.some(function(t){return t.revoked})&&(this.conversationEvent.eventType="quotes-revoked"))},C.prototype.editorToggle=function(){if(this.draft.contentType="text/html"===this.draft.contentType?"text/plain":"text/html","text/plain"===this.draft.contentType){var t=document.createElement("div");t.innerHTML=this.draft.body,this.draft.body=t.innerText}else this.draft.body=this.draft.body.slice(0,this.draft.body.indexOf("\n\n--\n"))},C.prototype.setFocus=function(){0===this.draft.recipients.length?this.focusOn="recipients":void 0===this.draft.subject||""===this.draft.subject?this.focusOn="subject":this.focusOn="body"},C.prototype.openVerificationSidePane=function(){this.sidePane="VERIFICATIONS"},C.prototype.openValidationsSidePane=function(){this.sidePane="VALIDATIONRESULTS"},C.prototype.onSidePaneClosed=function(){this.sidePane=void 0},C.prototype.openExpirationPanel=function(){var i=this,t={isDraft:!0,isEnabled:this.isExpirationEnabled,scheduledExpiration:this.draft.scheduledExpiration},e=f.ExpirationDialog.factory(t);this.$mdDialog.show(e).then(function(t){if(t.isEnabled){var e=$.WarningDialog.factory({title:w+"."+t.scheduledExpiration.action.toUpperCase()+"-WARN.TITLE",explanation:w+"."+t.scheduledExpiration.action.toUpperCase()+"-WARN.SCHEDULED",submitText:"MAIN.OK",type:"delete"===t.scheduledExpiration.action?$.WarningDialogTypes.error:$.WarningDialogTypes.info});i.$mdDialog.show(e).then(function(){i.setExpirationData(t)})}else i.setExpirationData(t)})},C.prototype.setExpirationData=function(t){this.isExpirationEnabled=t.isEnabled,this.draft.scheduledExpiration=i.__assign({},t.scheduledExpiration),this.draft.isModified=!0,t.isEnabled?this.timeLeft=this.setTimeLeft():delete this.draft.scheduledExpiration},C.prototype.setTimeLeft=function(){return o().add(o.duration(this.draft.scheduledExpiration.expiresIn)).fromNow(!0)},C.prototype.selectAllQuotes=function(){this.selectedMessages=this.draft.quote.messages.filter(function(t){return!1===t.revoked}).map(function(t){return t.id})},C.prototype.deselectAllQuotes=function(){this.selectedMessages=[]},C.prototype.switchImgSource=function(){if("IE"!==this.DeviceService.getBrowser().name){var t=document.createElement("div");t.innerHTML=this.draft.body;for(var e=0,i=[].slice.call(t.querySelectorAll("img"));e<i.length;e++){var n=i[e];n.title&&(n.src=n.title,n.removeAttribute("title"))}this.draft.body=t.innerHTML}},C);function C(t,e,i,n,o,s,r,a,c,l,u,p,d,h,f,v,m,g,S,$,y,b,w,E,C){var T=this;this.$element=t,this.$log=e,this.$mdDialog=i,this.$mdMedia=n,this.$mdPanel=o,this.$rootScope=s,this.$scope=r,this.$state=a,this.$stateParams=c,this.$timeout=l,this.$translate=u,this.$transitions=p,this.$uiRouterGlobals=d,this.ConversationsService=h,this.DeviceService=f,this.DraftsService=v,this.DraftsValidationService=m,this.LabelService=g,this.MessengerService=S,this.OrganizationService=$,this.StorageService=y,this.WizardService=b,this.draft=w,this.profile=E,this.share=C,this.areAllQuotesSelected=!1,this.conversationEvent=new I.ConversationEvent,this.isExpirationEnabled=!1,this.isForwardedConversation=!1,this.changesForValidation=0,this.changesForSaving=0,this.isMSBrowser=!1,this.saveAttempts=0,void(this.validationAttempts=0)!==this.draft.quote&&(1<=this.draft.quote.messages.length&&this.selectAllQuotes(),this.isForwardedConversation=this.draft.isFoward()&&1<this.draft.quote.messages.filter(function(t){return!1===t.revoked}).length,this.$timeout(function(){T.$scope.$watch(function(){return T.selectedMessages.length},function(){T.areAllQuotesSelected=T.selectedMessages.length===T.draft.quote.messages.filter(function(t){return!1===t.revoked}).length})})),this.draftLabel=this.$uiRouterGlobals.params.label,void 0!==this.draftLabel&&this.StorageService.setItem("SESSION","draft-label",this.draftLabel),this.conversationStarter=this.$stateParams.conversationStarter,void 0!==C&&(this.DraftsService.setAccessRightGrant(C.accessRightGrant),this.refreshDownloadToken(),this.$scope.$watch(function(){return T.share.downloadToken},function(t){void 0===t&&T.refreshDownloadToken()})),r.$on("$destroy",function(){T.DraftsService.setAccessRightGrant()}),this.useQuoteInfo(),this.handleQuoteNotifications(),this.setFocus(),this.$scope.$watch(function(){return T.draft.isModified},function(t){t&&(T.changesForSaving++,T.changesForValidation++,T.draft.isModified=!1,T.draft.validation.validationCompleted=!1,T.$timeout.cancel(T.draftModifiedTimeout),T.draftModifiedTimeout=T.$timeout(function(){T.validate(),T.save()},500))}),this.$scope.$on(R.DraftEvents.ValidationsUpdated,function(t,e){T.draft.validation=e.validation}),this.$scope.$on(A.AuthEvents.logoutOtherTab,function(){T.$timeout.cancel(T.saveTimeout),T.$timeout.cancel(T.validationTimeout)}),this.$scope.$watch(function(){return T.draft.recipients.length},function(t,e){0===e&&0<t&&T.$timeout(function(){T.WizardService.showWizardOnce(T.WizardService.WIZARDS.VERIFICATION)},1e3)}),this.$transitions.onStart({},function(){T.$timeout.cancel(T.saveTimeout),T.$timeout.cancel(T.draftModifiedTimeout),T.$timeout.cancel(T.validationTimeout),!0===T.isDraftEmpty()&&(T.$rootScope.$broadcast("list:remove",w.id),T.DraftsService.remove(T.draft),T.DraftsValidationService.clearDismissedViolations(T.draft.id))})}e.EditController=E,e.EditControllerModule=n.module("app.drafts.EditController",[s.AttachButtonModule.name,c.CalloutCardModule.name,r.ConversationEventModule.name,a.ConversationQuoteModule.name,l.DraftAttachmentsModule.name,u.DraftBodyModule.name,p.DraftRecipientsModule.name,d.DraftSendButtonModule.name,h.DraftValidationsBarModule.name,g.SidepaneModule.name,S.VerificationSettingsModule.name,$.WarningDialogModule.name,b.WizardVerificationModule.name,y.WizardBusinessRulesModule.name])}.apply(e,n))||(t.exports=o)},function(t,e,a){var i,n;i=[a,e,a(1),a(575)],void 0===(n=function(t,e,i){"use strict";var n,o;Object.defineProperty(e,"__esModule",{value:!0}),(o=n=e.CalloutCardTypes||(e.CalloutCardTypes={})).info="info",o.warning="warning",o.error="error";var s=(r.prototype.$onInit=function(){this.type=this.type||n.info},r);function r(){}e.CalloutCard=s,e.CalloutCardModule=i.module("components.CalloutCard",[]).component("calloutCard",{controller:s,bindings:{explanation:"<",icon:"<",type:"<",params:"<"},templateUrl:a(576)})}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/CalloutCard.ca4265.html"},function(t,e,d){var i,n;i=[d,e,d(1),d(578),d(579),d(581),d(583),d(586),d(589),d(6),d(591)],void 0===(n=function(t,e,i,c,o,n,l,s,r,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=(p.$inject=["$log","$mdDialog","$mdMedia","$mdPanel","$q","$scope","$timeout","DeviceService","MediaService","MessengerService","SanitizeService","SignatureService"],p.prototype.$onInit=function(){var i=this;this.isMSBrowser="IE"===this.DeviceService.getBrowser().name||"Edge"===this.DeviceService.getBrowser().name,this.isDesktop=this.$mdMedia("gt-sm"),!0===this.isDesktop&&!1===this.isMSBrowser?this.$scope.$applyAsync(function(){i.initPellEditor().then(function(){var t;i.isSignatureSet()&&(t=i.body.substring(0,i.body.indexOf("<div><br><br> --")).replace("<div><br></div>","")),i.focusableDiv=i.editor.childNodes[1],i.attachListeners(),!0===i.isRichText&&void 0!==i.body&&(!1===i.isSignatureSet()||i.isSignatureSet()&&0<t.length||void 0!==i.autoFocus||i.isSignaturePage)&&i.setHtmlContent().then(function(t){i.body=t,i.setEditorInnerHTML(t)})})}):this.removeSignature(),this.$scope.$on("signature.add",function(t,e){return i.setSignature(e)})},p.prototype.$onDestroy=function(){this.editor=void 0,this.$scope.$broadcast("link.tooltip:close")},p.prototype.$onChanges=function(t){void 0!==t.contentType&&(this.isRichText="text/html"===t.contentType.currentValue,!1===this.isRichText&&void 0!==this.editor?(this.removeSignature(),this.body=this.focusableDiv.innerText,this.setEditorInnerHTML(this.focusableDiv.innerText)):!0===this.isRichText&&void 0!==this.editor&&this.setSignature(!0))},p.prototype.attachListeners=function(){var n=this;this.focusableDiv.addEventListener("keydown",function(t){return n.keyboardListener(t)}),this.focusableDiv.addEventListener("mousedown",function(t){return n.checkIfAnchor(t)}),this.focusableDiv.addEventListener("paste",function(t){var e=n.getDataFormat(t),i=(t.clipboardData||window.clipboardData).getData(e);if(n.isRichText&&!0===/<[a-z][\s\S]*>/i.test(i))if(t.preventDefault(),t.stopPropagation(),!0===n.isSignaturePage||!1===n.isSignaturePage&&!1===/<img.*?s[^>]+>/i.test(i)){if(!1===/data:image\/[^;]+;base64/i.test(i))return n.$q(function(t){"IE"===n.DeviceService.getBrowser().name?n.pasteHtmlAtCaret(i):c.default.exec("insertHTML",i),t()}).then(function(){n.isSignaturePage?n.setHtmlContent().then(function(t){n.body=t,n.setEditorInnerHTML(n.body)}):n.setHtmlContent()});n.MessengerService.toast("draft-body.ERRORS.BASE64-IMG")}else n.MessengerService.toast("draft-body.ERRORS.IMG-NOT-YET-SUPPORTED")}),this.focusableDiv.addEventListener("focus",function(){void 0===n.autoFocus&&n.isFirstFocus?(n.setHtmlContent().then(function(t){n.body=t,n.setEditorInnerHTML(t)}),n.$scope.$applyAsync(function(){n.setSelectionToStart()}),n.isFirstFocus=!1):n.isFirstFocus&&(n.$scope.$applyAsync(function(){n.setSelectionToStart()}),n.isFirstFocus=!1)}),this.$scope.$on("conversations.replied",function(){!1===n.isMSBrowser&&(n.setEditorInnerHTML(""),n.setSignature(!1),n.isFirstFocus=!0)}),this.$scope.$on("signature.remove",function(){return n.removeSignature()}),this.$scope.$watch(function(){return n.autoFocus},function(){!0===n.autoFocus&&!0===n.isDesktop&&n.setSelection()})},p.prototype.keyboardListener=function(t){if(!1===this.isRichText){if(t.ctrlKey||t.metaKey)switch(t.keyCode){case 66:case 98:case 73:case 105:case 85:case 117:t.preventDefault()}}else this.checkIfAnchor(t)},p.prototype.getDataFormat=function(t){return(t.clipboardData||window.clipboardData).types?"IE"===this.DeviceService.getBrowser().name?!0===window.clipboardData.types.contains("text/html")?"text/html":"Text":"Edge"===this.DeviceService.getBrowser().name&&parseInt(this.DeviceService.getBrowser().version.slice(0,2))<=16?"Text":"Edge"===this.DeviceService.getBrowser().name&&16<parseInt(this.DeviceService.getBrowser().version.slice(0,2))?!0===t.clipboardData.types.contains("text/html")?"text/html":"Text":"Firefox"===this.DeviceService.getBrowser().name&&parseInt(this.DeviceService.getBrowser().version.slice(0,2))<=51?!0===t.clipboardData.types.contains("text/html")?"text/html":"Text":-1<t.clipboardData.types.indexOf("text/html")?"text/html":"Text":"Text"},p.prototype.checkIfAnchor=function(t){var e;"mousedown"===t.type?(e=t.target,this.$scope.$broadcast("link.tooltip:close")):e=this.getSelectionContainer(),void 0!==e&&("a"===e.tagName.toLocaleLowerCase()&&!1===this.isLinkTooltipOpen?(this.isLinkTooltipOpen=!0,this.openLinkTooltip(e)):"a"!==e.tagName.toLocaleLowerCase()&&!0===this.isLinkTooltipOpen&&this.$scope.$broadcast("link.tooltip:close"))},p.prototype.initPellEditor=function(){var n=this;return new Promise(function(t){"IE"===n.DeviceService.getBrowser().name?(n.editor=c.default.init({element:document.getElementById("pell"),defaultParagraphSeparator:"div",styleWithCSS:!0,actions:n.setEditorActions(),classes:{actionbar:"pell-actionbar",button:"pell-button",content:"pell-content",selected:"pell-button-selected"}}),n.pellObserver=new MutationObserver(function(){var t=document.querySelector(".pell-content").innerHTML;"<br>"===t&&(t=""),n.$scope.$applyAsync(function(){return n.body=t})}),n.pellObserver.observe(document.querySelector(".pell-content"),{characterData:!0,attributes:!1,childList:!0,subtree:!0})):n.editor=c.default.init({element:document.getElementById("pell"),onChange:function(t){return n.$scope.$applyAsync(function(){return n.body=t})},defaultParagraphSeparator:"div",styleWithCSS:!0,actions:n.setEditorActions(),classes:{actionbar:"pell-actionbar",button:"pell-button",content:"pell-content",selected:"pell-button-selected"}});for(var e=0,i=[].slice.call(document.querySelectorAll(".pell-button"));e<i.length;e++)i[e].setAttribute("tabIndex","-1");t()})},p.prototype.setEditorActions=function(){var n=this;return"IE"===this.DeviceService.getBrowser().name||"Edge"===this.DeviceService.getBrowser().name?[{icon:'<div class="button-container"></div><md-icon class="material-icons">format_bold</md-icon>',name:"bold",result:function(){return c.default.exec("bold")}},{icon:'<div class="button-container"></div><md-icon class="material-icons">format_italic</md-icon>',name:"italic",result:function(){return c.default.exec("italic")}},{icon:'<div class="button-container"></div><md-icon class="material-icons">format_underlined</md-icon>',name:"underline",result:function(){return c.default.exec("underline")}},{icon:'<div class="button-container"></div><md-icon class="material-icons">format_strikethrough</md-icon>',name:"strikethrough",result:function(){return c.default.exec("strikethrough")}},{icon:'<div class="button-container"></div><md-icon class="material-icons format-size-button">format_size</md-icon>',name:"fontsize",title:"Font Size",result:function(){if(n.getSelection(),void 0!==n.selection)return n.openFormatSizePanel()}},{icon:'<div class="button-container"></div><md-icon class="material-icons format-color-button">format_color_text</md-icon>',name:"color",title:"Text Color",result:function(){if(n.getSelection(),void 0!==n.selection)return n.openFormatColorPanel()}},{icon:'<div class="button-container"></div><md-icon class="material-icons format-alignment-button">format_align_center</md-icon>',name:"align",title:"Align Content",result:function(){if(n.getSelection(),n.TrailingDivMsBrowsers(),void 0!==n.selection)return n.openFormatAlignmentPanel()}},{icon:'<div class="button-container"></div><md-icon class="material-icons">format_list_numbered</md-icon>',name:"olist",result:function(){n.TrailingDivMsBrowsers(),c.default.exec("insertOrderedList"),n.removeTrailingDiv()}},{icon:'<div class="button-container"></div><md-icon class="material-icons">format_list_bulleted</md-icon>',name:"ulist",result:function(){n.TrailingDivMsBrowsers(),c.default.exec("insertUnorderedList"),n.removeTrailingDiv()}},{icon:'<div class="button-container"></div><md-icon class="material-icons">insert_link</md-icon>',name:"link",title:"Link",result:function(){var t=n.getSelectionContainer(),e=void 0!==t?t.href:void 0,i=window.getSelection().toString();e&&(i=t.innerHTML),n.getSelection(),void 0!==n.selection&&n.openFormatLinkDialog(t,i,e).catch(function(){return n.setSelection()})}},{icon:'<div class="button-container"></div><md-icon class="material-icons">format_clear</md-icon>',name:"clearformatting",title:"Clear Formatting",result:function(){return c.default.exec("removeFormat")}}]:[{icon:'<div class="button-container"></div><md-icon class="material-icons">format_bold</md-icon>',name:"bold",result:function(){return c.default.exec("bold")}},{icon:'<div class="button-container"></div><md-icon class="material-icons">format_italic</md-icon>',name:"italic",result:function(){return c.default.exec("italic")}},{icon:'<div class="button-container"></div><md-icon class="material-icons">format_underlined</md-icon>',name:"underline",result:function(){return c.default.exec("underline")}},{icon:'<div class="button-container"></div><md-icon class="material-icons">format_strikethrough</md-icon>',name:"strikethrough",result:function(){return c.default.exec("strikethrough")}},{icon:'<div class="button-container"></div><md-icon class="material-icons format-size-button">format_size</md-icon>',name:"fontsize",title:"Font Size",result:function(){if(n.getSelection(),void 0!==n.selection)return n.openFormatSizePanel()}},{icon:'<div class="button-container"></div><md-icon class="material-icons format-color-button">format_color_text</md-icon>',name:"color",title:"Text Color",result:function(){if(n.getSelection(),void 0!==n.selection)return n.openFormatColorPanel()}},{icon:'<div class="button-container"></div><md-icon class="material-icons format-alignment-button">format_align_center</md-icon>',name:"align",title:"Align Content",result:function(){if(n.getSelection(),n.TrailingDivMsBrowsers(),void 0!==n.selection)return n.openFormatAlignmentPanel()}},{icon:'<div class="button-container"></div><md-icon class="material-icons">format_list_numbered</md-icon>',name:"olist",result:function(){n.TrailingDivMsBrowsers(),c.default.exec("insertOrderedList"),n.removeTrailingDiv()}},{icon:'<div class="button-container"></div><md-icon class="material-icons">format_list_bulleted</md-icon>',name:"ulist",result:function(){n.TrailingDivMsBrowsers(),c.default.exec("insertUnorderedList"),n.removeTrailingDiv()}},{icon:'<div class="button-container"></div><md-icon class="material-icons">insert_link</md-icon>',name:"link",title:"Link",result:function(){var t=n.getSelectionContainer(),e=void 0!==t?t.href:void 0,i=window.getSelection().toString();e&&(i=t.innerHTML),n.getSelection(),void 0!==n.selection&&n.openFormatLinkDialog(t,i,e).catch(function(){return n.setSelection()})}},{icon:'<div class="button-container"></div><md-icon class="material-icons">remove</md-icon>',name:"line",result:function(){return n.pasteHtmlAtCaret('<hr contenteditable="false">')}},{icon:'<div class="button-container"></div><md-icon class="material-icons">format_clear</md-icon>',name:"clearformatting",title:"Clear Formatting",result:function(){return c.default.exec("removeFormat")}}]},p.prototype.rgbToHex=function(t,e,i){return"#"+[t,e,i].map(function(t){var e=Number(t).toString(16);return 1===e.length?"0"+e:e}).join("")},p.prototype.pasteHtmlAtCaret=function(t){this.getSelection(),void 0!==this.selection&&(this.selection.deleteContents(),this.selection.insertNode(this.selection.createContextualFragment(t)),this.setSelection())},p.prototype.TrailingDivMsBrowsers=function(){this.isMSBrowser&&"text/html"===this.contentType&&(this.trailingDiv=document.createElement("div"),this.focusableDiv.appendChild(this.trailingDiv))},p.prototype.removeTrailingDiv=function(){this.trailingDiv&&(this.focusableDiv.removeChild(this.trailingDiv),this.trailingDiv=null)},p.prototype.setHtmlContent=function(){for(var i=[],t=Array.from(this.editor.querySelectorAll("img")),e=this.SanitizeService.sanitizeHtml(this.body,t),n=function(e){if(e.classList.contains("external")){var t=o.MediaService.proxy(e.getAttribute("title")).then(function(t){e.setAttribute("src",t),e.classList.remove("external")});i.push(t)}},o=this,s=0,r=[].slice.call(e.querySelectorAll("img"));s<r.length;s++)n(r[s]);return this.$q.all(i).then(function(){return e.innerHTML})},p.prototype.setEditorInnerHTML=function(t){var e=this;this.$scope.$applyAsync(function(){e.editor.content.innerHTML=t})},p.prototype.openFormatLinkDialog=function(e,t,i){var n=this,o=s.FormatLinkDialog.factory(t,i);return this.$mdDialog.show(o).then(function(t){return i&&e.parentElement.removeChild(e),n.setSelection(),"IE"!==n.DeviceService.getBrowser().name?c.default.exec("insertHTML",t.linkElement):n.pasteHtmlAtCaret(t.linkElement)})},p.prototype.openFormatSizePanel=function(){var i=this,t=parseInt(document.queryCommandValue("FontSize")),e=this.$mdPanel.newPanelPosition().relativeTo(".format-size-button").addPanelPosition(this.$mdPanel.xPosition.CENTER,this.$mdPanel.yPosition.ABOVE).withOffsetY("10px"),n={attachTo:document.body,controller:o.FormatSizePanel,controllerAs:"$ctrl",templateUrl:d(592),position:e,locals:{size:t},escapeToClose:!0,clickOutsideToClose:!0,onCloseSuccess:function(t){var e=t.config.scope.$ctrl.size;return i.setSelection(),c.default.exec("fontSize",e)}};this.$mdPanel.open(n).then(function(t){window.addEventListener("resize",function(){t.updatePosition(e)})}).catch(function(t){return i.$log.error("Error opening the format size panel",{error:t})})},p.prototype.openFormatColorPanel=function(){var n=this,t=new RegExp("((\\d{1,3}), (\\d{1,3}), (\\d{1,3}))"),e=document.queryCommandValue("foreColor"),i=document.queryCommandValue("backColor"),o="#000000",s="#f5f5f5";null!==t.exec(e)&&(o=this.rgbToHex(t.exec(e)[2],t.exec(e)[3],t.exec(e)[4])),null!==t.exec(i)&&(s=this.rgbToHex(t.exec(i)[2],t.exec(i)[3],t.exec(i)[4]));var r=this.$mdPanel.newPanelPosition().relativeTo(".format-color-button").addPanelPosition(this.$mdPanel.xPosition.CENTER,this.$mdPanel.yPosition.ABOVE).withOffsetY("10px"),a={attachTo:document.body,controller:l.FormatColorsPanel,controllerAs:"$ctrl",templateUrl:d(593),position:r,locals:{foreColor:o,backColor:s},escapeToClose:!0,clickOutsideToClose:!0,onCloseSuccess:function(t){var e=t.config.scope.$ctrl.foreColor,i=t.config.scope.$ctrl.backColor;return n.setSelection(),s!==i?c.default.exec("backColor",i):o!==e?c.default.exec("foreColor",e):void 0}};this.$mdPanel.open(a).then(function(t){window.addEventListener("resize",function(){t.updatePosition(r)})}).catch(function(t){return n.$log.error("Error opening the format color panel",{error:t})})},p.prototype.openFormatAlignmentPanel=function(){var i=this,e=this.$mdPanel.newPanelPosition().relativeTo(".format-alignment-button").addPanelPosition(this.$mdPanel.xPosition.CENTER,this.$mdPanel.yPosition.ABOVE).withOffsetY("10px"),t={attachTo:document.body,controller:n.FormatAlignmentPanel,controllerAs:"$ctrl",templateUrl:d(594),position:e,locals:{},escapeToClose:!0,clickOutsideToClose:!0,onCloseSuccess:function(t){var e=t.config.scope.$ctrl.alignment;e&&(i.TrailingDivMsBrowsers(),c.default.exec("justify"+e),i.removeTrailingDiv()),i.setSelection()}};this.$mdPanel.open(t).then(function(t){window.addEventListener("resize",function(){t.updatePosition(e)})}).catch(function(t){return i.$log.error("Error opening the format alignment panel",{error:t})})},p.prototype.openLinkTooltip=function(o){var s=this;if("a"===o.tagName.toLowerCase()){var e=this.$mdPanel.newPanelPosition().relativeTo(o).addPanelPosition(this.$mdPanel.xPosition.CENTER,this.$mdPanel.yPosition.BELOW).withOffsetY("4px"),t={attachTo:document.body,controller:r.LinkTooltip,controllerAs:"$ctrl",templateUrl:d(595),position:e,locals:{action:void 0,url:o.href},escapeToClose:!1,clickOutsideToClose:!1,focusOnOpen:!1,zIndex:100,propagateContainerEvents:!0,onCloseSuccess:function(t,e){if("fromEvent"!==e){var i=t.config.scope.$ctrl.action;switch(s.getSelection(),s.isLinkTooltipOpen=!1,i){case"edit":return s.openFormatLinkDialog(o,o.innerHTML,o.href).catch(function(){return s.setSelection()});case"remove":var n=o.innerHTML;return o.parentNode.removeChild(o),s.setSelection(),c.default.exec("insertText",n);default:return}}}};this.$mdPanel.open(t).then(function(t){window.addEventListener("resize",function(){t.updatePosition(e)}),s.$scope.$on("link.tooltip:close",function(){t.close("fromEvent"),s.isLinkTooltipOpen=!1})}).catch(function(t){return s.$log.error("Error opening the link tooltip panel",{error:t})})}},p.prototype.getSelectionContainer=function(){if(window.getSelection){var t=window.getSelection();if(t.getRangeAt&&t.rangeCount){var e=t.getRangeAt(0).commonAncestorContainer;return 1===e.nodeType?e:e.parentNode}}},p.prototype.getSelection=function(){if(window.getSelection){var t=window.getSelection();"IE"!==this.DeviceService.getBrowser().name&&!1===this.editor.contains(t.focusNode)?this.selection=void 0:t.getRangeAt&&t.rangeCount&&(this.selection=t.getRangeAt(0))}else this.selection=void 0},p.prototype.setSelection=function(){if(this.selection){if(window.getSelection){var t=window.getSelection();t.removeAllRanges(),t.addRange(this.selection)}}else this.focusableDiv.focus()},p.prototype.setSelectionToStart=function(){var t=document.createRange(),e=window.getSelection();this.focusableDiv.firstChild&&(t.setStart(this.focusableDiv.firstChild,0),t.collapse(!0),e.removeAllRanges(),e.addRange(t),this.focusableDiv.focus())},p.prototype.isSignatureSet=function(){return 0<=this.body.indexOf("<div><br><br> --")||0<=this.body.indexOf("\n\n--\n")},p.prototype.removeSignature=function(){!1===this.isDesktop&&(this.body=this.body.substring(0,this.body.indexOf("<div><br><br> --"))),this.isSignatureSet()&&(this.body=this.body.substring(0,this.body.indexOf("<div><br><br> --")),this.setEditorInnerHTML(this.body))},p.prototype.setSignature=function(i){var n=this;this.SignatureService.getSignature(this.profileUuid,!0===i?"First":"All").then(function(t){if(t&&0<t.content.length&&!1===n.isMSBrowser)n.isRichText?n.body+="<div><br></div><div><br><br> -- <br> "+t.content+"</div>":((e=document.createElement("div")).innerHTML=t.content,n.body+="\n\n--\n"+e.innerText),!0===i&&void 0!==n.editor&&n.setEditorInnerHTML(n.body);else if(t&&0<t.content.length&&n.isMSBrowser){var e;(e=document.createElement("div")).innerHTML=t.content,n.body+="\n\n--\n"+e.innerText}}).catch(function(t){t.status!==a.HTTP_NOT_FOUND?n.$log.error("Unable to get profile signature",{error:t}):n.$log.error("No signature found",{error:t})})},p);function p(t,e,i,n,o,s,r,a,c,l,u,p){this.$log=t,this.$mdDialog=e,this.$mdMedia=i,this.$mdPanel=n,this.$q=o,this.$scope=s,this.$timeout=r,this.DeviceService=a,this.MediaService=c,this.MessengerService=l,this.SanitizeService=u,this.SignatureService=p,this.body="",this.isDesktop=!0,this.isFirstFocus=!0,this.isMSBrowser=!1,this.isLinkTooltipOpen=!1}e.DraftBodyModule=i.module("components.DraftBody",[]).component("draftBody",{bindings:{autoFocus:"<",body:"=",contentType:"<",isSignaturePage:"<",profileUuid:"<"},controller:u,template:d(596)})}.apply(e,i))||(t.exports=n)},,function(t,e,i){var n,o;n=[i,e,i(1),i(580)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$scope","mdPanelRef","size"],o.prototype.$onInit=function(){},o.prototype.close=function(){this.mdPanelRef.close()},o.prototype.setSize=function(t){this.size=t,this.close()},o);function o(t,e,i){this.$scope=t,this.mdPanelRef=e,this.size=i}e.FormatSizePanel=n,e.FormatSizePanelModule=i.module("drafts.FormatSizePanel",[])}.apply(e,n))||(t.exports=o)},function(t,e,i){},function(t,e,i){var n,o;n=[i,e,i(1),i(582)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(o.$inject=["$scope","mdPanelRef"],o.prototype.$onInit=function(){},o.prototype.close=function(){this.mdPanelRef.close()},o.prototype.setAlignment=function(t){this.alignment=t,this.close()},o);function o(t,e){this.$scope=t,this.mdPanelRef=e,this.alignment="left"}e.FormatAlignmentPanel=n,e.FormatAlignmentPanelModule=i.module("drafts.FormatAlignmentPanel",[])}.apply(e,n))||(t.exports=o)},function(t,e,i){},function(t,e,i){var n,o;n=[i,e,i(1),i(584),i(585)],void 0===(o=function(t,e,i,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(s.$inject=["$scope","mdPanelRef","backColor","foreColor"],s.prototype.$onInit=function(){},s.prototype.close=function(){this.mdPanelRef.close()},s.prototype.selectForeColor=function(t){this.foreColor=t,this.close()},s.prototype.selectBackColor=function(t){this.backColor=t,this.close()},s);function s(t,e,i,n){this.$scope=t,this.mdPanelRef=e,this.backColor=i,this.foreColor=n,this.primaryColors=o.editorPrimaryColors,this.secondaryColors=o.editorSecondaryColors}e.FormatColorsPanel=n,e.FormatColorsPanelModule=i.module("drafts.FormatColorsPanel",[])}.apply(e,n))||(t.exports=o)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.editorPrimaryColors=[["#000000","#424242","#616161","#757575","#9e9e9e","#bdbdbd","#eeeeee","#ffffff"],["#ff0000","#ff9900","#ffff00","#00ff00","#00ffff","#0000ff","#9900ff","#ff00ff"]],e.editorSecondaryColors=[["#ffebee","#fff3e0","#fffde7","#f9fbe7","#e0f7fa","#e3f2fd","#ede7f6","#f3e5f5"],["#ffcdd2","#ffe0b2","#fff9c4","#f0f4c3","#b2ebf2","#bbdefb","#d1c4e9","#e1bee7"],["#e57373","#ffb74d","#fff176","#dce775","#26c6da","#64b5f6","#7e57c2","#ba68c8"],["#e53935","#fb8c00","#fdd835","#c0ca33","#00acc1","#1e88e5","#5e35b1","#8e24aa"],["#c62828","#ef6c00","#f9a825","#9e9d24","#00838f","#283593","#4527a0","#6a1b9a"],["#b71c1c","#e65100","#f57f17","#827717","#006064","#1a237e","#311b92","#4a148c"]]}.apply(e,[i,e]))||(t.exports=n)},function(t,e,i){},function(t,e,o){var i,n;i=[o,e,o(587)],void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.$inject=["$scope","$mdDialog","link","linkLabel"],n.prototype.$onInit=function(){this.currentLinkLabel=this.linkLabel,this.currentLink=this.link},n.prototype.close=function(){this.$mdDialog.cancel()},n.prototype.setLink=function(){var t=new RegExp("^http[s]?|mailto:");this.link=this.currentLink,this.linkLabel=this.currentLinkLabel;var e=document.createElement("a");e.setAttribute("href",t.test(this.link)?this.link:"https://"+this.link),e.innerHTML=this.linkLabel,this.$mdDialog.hide({linkElement:e.outerHTML})},n.factory=function(t,e){return{controller:n,template:o(588),locals:{link:e,linkLabel:t}}},n);function n(t,e,i,n){this.$scope=t,this.$mdDialog=e,this.link=i,this.linkLabel=n}e.FormatLinkDialog=i}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e){t.exports='<md-dialog class=format-link-container layout-align="space-between center" translate-namespace=format-link-panel> <div flex=100 layout=row layout-align="space-between center" class=toolbar> <span translate>.TITLE</span> <md-button type=button class=md-icon-button ng-click=$ctrl.close();> <md-icon aria-label="Close dialog">close</md-icon> </md-button> </div> <md-dialog-content layout-padding> <div flex=100 layout=row layout-align="space-between center"> <md-input-container flex=100> <label for=linkLabel translate>.LABEL</label> <input id=linkLabel name=linkLabel md-no-asterisk ng-model=$ctrl.currentLinkLabel> </md-input-container> </div> <div flex=100 layout=row layout-align="space-between center"> <md-input-container flex=100> <label for=linkValue translate>.LINK</label> <input id=linkValue name=linkValue md-no-asterisk ng-model=$ctrl.currentLink> </md-input-container> </div> </md-dialog-content> <md-dialog-actions layout=row layout-align="space-between center" class=actions> <md-button ng-click=$ctrl.close()> <translate>MAIN.CANCEL</translate> </md-button> <md-button ng-click=$ctrl.setLink() class="md-primary md-raised" ng-disabled="$ctrl.link.length === 0"> <translate>MAIN.OK</translate> </md-button> </md-dialog-actions> </md-dialog> '},function(t,e,i){var n,o;n=[i,e,i(590)],void 0===(o=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.$inject=["$scope","mdPanelRef","action","url"],n.prototype.$onInit=function(){},n.prototype.editLink=function(){this.action="edit",this.close()},n.prototype.removeLink=function(){this.action="remove",this.close()},n.prototype.close=function(){this.mdPanelRef.close()},n);function n(t,e,i,n){this.$scope=t,this.mdPanelRef=e,this.action=i,this.url=n}e.LinkTooltip=i}.apply(e,n))||(t.exports=o)},function(t,e,i){},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/FormatSizePanel.0129f3.html"},function(t,e,i){t.exports=i.p+"assets/tpl/FormatColorsPanel.58e1b9.html"},function(t,e,i){t.exports=i.p+"assets/tpl/FormatAlignmentPanel.832015.html"},function(t,e,i){t.exports=i.p+"assets/tpl/LinkTooltip.6bcca9.html"},function(t,e){t.exports='<div id=pell ng-class="{\'rich-text\': $ctrl.isRichText}" ng-if="$ctrl.isDesktop === true && $ctrl.isMSBrowser === false" ng-show="$ctrl.isRichText && $ctrl.isMSBrowser === false"></div> <div class=deprecation-warning ng-if=$ctrl.isMSBrowser> <span translate>.DEPRECATED</span> </div> <textarea class=editor-textarea ng-model=$ctrl.body aria-label="message body" ng-if="$ctrl.isDesktop === true || $ctrl.isMSBrowser === true" ng-show="$ctrl.isRichText === false || $ctrl.isMSBrowser === true" placeholder="{{ \'draft-body.PLACEHOLDER\' | translate }}"></textarea> <div ng-if="$ctrl.isDesktop === false" class=editor-container> <textarea ng-model=$ctrl.body aria-label="message body" autocomplete=off></textarea> </div> '},function(t,e,o){var i,n;i=[o,e,o(1),o(9),o(58),o(14),o(598)],void 0===(n=function(t,e,s,r,a,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=[{type:"zivver",svg:"ziv:zivver-shield",label:".SETUP.VERIFICATION.OPTIONS.ZIVVER",available:!1},{type:"sms",icon:"smartphone",label:".SETUP.VERIFICATION.OPTIONS.SMS-CODE",available:!1},{type:"password",icon:"keyboard",label:".SETUP.VERIFICATION.OPTIONS.ACCESS-CODE",available:!1},{type:"email",icon:"email",label:".SETUP.VERIFICATION.OPTIONS.EMAIL",available:!1},{type:"generatedCode",icon:"lock_open",label:".SETUP.VERIFICATION.OPTIONS.NONE",available:!1}],i=(n.$inject=["$scope","$log","$q","$timeout","$mdDialog","MessengerService","ContactsService"],n.prototype.$onInit=function(){var t=this;this.setSelectedRecipients(),this.verificationMethod=this.verifications.filter(function(t){return t.available}).map(function(t){return t.type}).shift(),this.$scope.$watch(function(){return t.recipients},function(){t.updateAvailableVerificationTypes()}),this.$scope.$watch(function(){return t.verificationMethod},function(){t.failed=!1})},n.prototype.$onChanges=function(t){t.validation&&this.setViolationDescription()},n.prototype.applyVerificationMethod=function(){var s=this;this.failed=!1,this.form.$invalid?this.$log.debug("form is invalid"):0!==this.selectedRecipients.length?(this.recipients.filter(function(t){return-1<s.selectedRecipients.indexOf(t.email)}).forEach(function(t){var e=t.verifications.filter(function(t){return"generatedCode"===s.verificationMethod?"NoVerification"===t.id:"email"===s.verificationMethod?"Email"===t.id:t.verificationType.toString()===s.verificationMethod.toString()})[0],i=void 0!==e;if(i){var n=r.AccessRightSetup.fromVerification(e),o=t.accessRightSetup;switch(s.verificationMethod){case"sms":n.requiresUserInput&&(void 0!==o.phonenumber?n.phonenumber=o.phonenumber:void 0!==t.phonenumber?n.phonenumber=t.phonenumber:i=!1);break;case"password":n.requiresUserInput&&(void 0!==o.password?n.password=o.password:i=!1);break;case"zivver":!1===s.recipientHasZivver(t)&&(i=!1)}n.isValid=i,t.accessRightSetup=n}!1===i&&(s.failed=!0)}),!1===this.failed&&this.MessengerService.toast("verification-settings.SUCCESS")):this.MessengerService.toast("verification-settings.NONE-SELECTED")},n.prototype.hasAccessRightViolation=function(t){return 0<this.validation.getViolationsForRecipient(t).filter(function(t){return"accessRights"===t.violationType}).length},n.prototype.showDialog=function(t,e){var i=this,n=new a.RecipientDialog,o=this.recipients.filter(function(t){return t.email===e})[0];n.resolve.recipient=function(){return void 0!==o.verifications?i.$q.resolve(s.copy(o)):i.ContactsService.get(o.email).then(function(t){return t.toRecipient()})},n.locals.violations=this.validation.getViolationsForRecipient(o),this.$mdDialog.show(n).then(function(t){o=s.extend(o,t)})},n.prototype.isSelected=function(t){return-1<this.selectedRecipients.indexOf(t.email)},n.prototype.setSelectedRecipients=function(){var e=this;switch(this.target){case"all":this.selectedRecipients=this.recipients.map(function(t){return t.email});break;case"selected":this.selectedRecipients=[];break;case"non-zivver":this.selectedRecipients=this.recipients.filter(function(t){return!1===e.recipientHasZivver(t)}).map(function(t){return t.email});break;default:throw Error("Invalid value for this.target: "+this.target)}this.updateAvailableVerificationTypes()},n.prototype.toggleRecipient=function(e){"non-zivver"===this.target&&this.recipientHasZivver(e)||(0<this.selectedRecipients.filter(function(t){return t===e.email}).length?this.selectedRecipients=this.selectedRecipients.filter(function(t){return t!==e.email}):this.selectedRecipients.push(e.email),this.updateAvailableVerificationTypes())},n.prototype.setViolationDescription=function(){var t=this.validation.violationsUnresolved.filter(function(t){return"accessRights"===t.violationType});this.validation.hasViolations()&&0<t.length?this.violationDescription=t[0].description:this.violationDescription=void 0},n.prototype.recipientHasZivver=function(t){return void 0!==t.verifications&&0<t.verifications.filter(function(t){return"zivver"===t.verificationType}).length},n.prototype.updateAvailableVerificationTypes=function(){var e=this,i=!1,n=!1,o=!1,s=!1,r=!1;[].concat.apply([],this.recipients.filter(function(t){return-1<e.selectedRecipients.indexOf(t.email)}).map(function(t){return t.verifications})).filter(function(t){return void 0!==t}).forEach(function(t){"none"===t.verificationType?"Email"===t.id?s=!0:r=!0:"password"===t.verificationType?o=!0:"sms"===t.verificationType?n=!0:"zivver"===t.verificationType&&(i=!0)}),this.verifications=l.filter(function(t){switch(t.type){case"zivver":return i;case"sms":return n;case"password":return o;case"email":return s;case"generatedCode":return r}})},n);function n(t,e,i,n,o,s,r){this.$scope=t,this.$log=e,this.$q=i,this.$timeout=n,this.$mdDialog=o,this.MessengerService=s,this.ContactsService=r,this.failed=!1,this.target="non-zivver",this.unknownPerson=c.UNKNOWN_PERSON,this.verificationMethod="generatedCode",this.verifications=l,this.selectedRecipients=[]}e.VerificationSettingsModule=s.module("components.VerificationSettings",[a.RecipientDialogModule.name]).component("verificationSettings",{bindings:{recipients:"=",validation:"<"},controller:i,templateUrl:o(599)})}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/VerificationSettings.2206ba.html"},function(t,e,i){var n,o;n=[i,e,i(1),i(59),i(172),i(13)],void 0===(o=function(t,e,i,n,o,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=(a.$inject=["$rootScope","$scope","$state","$log","$q","$mdMedia","DraftsService","AppSwitcherService","MessengerService","$mdDialog","DraftsValidationService","profile"],a.prototype.getDrafts=function(){var e=this;this.loading=!0,this.DraftsService.list(this.paginator.offset,this.paginator.limit).then(function(t){e.paginator.total=t.pagination.total,t.items=t.items.sort(function(t,e){return t.modifiedDate<e.modifiedDate?-1:1}),void 0!==e.context.specialId?t.items.filter(function(t){return void 0!==t.messageDefinitionId}).forEach(function(t){return e.addDraft(t)}):t.items.filter(function(t){return void 0===t.messageDefinitionId}).forEach(function(t){return e.addDraft(t)})}).catch(function(t){e.$log.error("Error getting drafts list",{error:t})}).finally(function(){e.loading=!1})},a.prototype.addDraft=function(e){var i=!1;this.items.filter(function(t){return t.id===e.id}).map(function(t){i=!0}),!1===i&&this.items.unshift(e)},a.prototype.openItem=function(t){if("SELECT"===this.listAction)return t.isSelected=!t.isSelected,void(!0===t.isSelected?this.selectedItems++:this.selectedItems--);var e={draftId:t.id,draft:t,conversationStarter:void 0};"DEFAULT"===this.listAction&&this.$state.go(this.getItemStateName(t),e)},a.prototype.isItemActive=function(t){var e=this.$state.current.name,i=this.$state.params.draftId;return e===this.getItemStateName(t)&&i===t.id},a.prototype.getItemStateName=function(t){return"drafts."+(void 0!==t.messageDefinitionId?"specialedit":"edit")},a.prototype.clearSelection=function(){this.selectedItems=0,this.items.forEach(function(t){return t.isSelected=!1}),this.listAction="DEFAULT"},a.prototype.deleteItems=function(){var i=this,t=this.items.filter(function(t){return t.isSelected}),e=s.WarningDialog.factory({title:"DRAFTS.CANCEL-DIALOG.TITLE",explanation:"DRAFTS.CANCEL-DIALOG.MULTI-DELETION",submitText:"DRAFTS.CANCEL-DIALOG.SUBMIT",cancelText:"DRAFTS.CANCEL-DIALOG.CANCEL",type:s.WarningDialogTypes.warning}),n=[];this.$mdDialog.show(e).then(function(){t.reduce(function(t,e){return t.then(function(){e.isUploading=!1,null!==e.id?(i.$rootScope.$broadcast("list:remove",e.id),i.DraftsValidationService.clearDismissedViolations(e.id),i.DraftsService.remove(e).then(function(t){n.push(t)})):i.$state.go("drafts.index")})},i.$q.resolve()).then(function(){n.every(function(t){return!0===t})?i.MessengerService.toast("DRAFTS.DELETE.SUCCESS"):i.MessengerService.toast("DRAFTS.DELETE.SOME-SUCCESS"),i.clearSelection(),i.$state.go("drafts.index")}).catch(function(t){i.$log.warn("error while deleting drafts",{error:t})})})},a);function a(t,e,i,n,o,s,r,a,c,l,u,p){var d=this;this.$rootScope=t,this.$scope=e,this.$state=i,this.$log=n,this.$q=o,this.$mdMedia=s,this.DraftsService=r,this.AppSwitcherService=a,this.MessengerService=c,this.$mdDialog=l,this.DraftsValidationService=u,this.profile=p,this.items=[],this.loading=!0,this.listAction="DEFAULT",this.selectedItems=0,this.paginator={total:0,limit:500,offset:0},this.getDrafts(),this.context=this.AppSwitcherService.getContext(),this.$scope.$on("list:added",function(t,e){d.addDraft(e)}),this.$scope.$on("list:remove",function(t,e){d.items=d.items.filter(function(t){return t.id!==e})})}e.ListController=r,e.ListControllerModule=i.module("app.drafts.ListController",[o.ComposeButtonModule.name,n.IfEmptyFilterModule.name])}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(1),i(170),i(18),i(13)],void 0===(o=function(t,e,i,n,o,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=(a.$inject=["$rootScope","$log","$state","$stateParams","$translate","$mdDialog","DraftsService","AppSwitcherService","SpecialsService","draft","messageDefinition"],a.prototype.deleteSpecialDraft=function(t){var e=this,i=s.WarningDialog.factory({title:"DRAFTS.CANCEL-DIALOG.TITLE",explanation:"DRAFTS.CANCEL-DIALOG.CONFIRMATION",explanationParams:{type:this.messageDefinition.name.toLowerCase()},type:s.WarningDialogTypes.warning,submitText:"MAIN.DELETE"});this.$mdDialog.show(i).then(function(){e.draft.isUploading=!1,null!==e.draft.id?(e.$rootScope.$broadcast("list:remove",e.draft.id),e.DraftsService.remove(e.draft).then(function(){e.$state.go("drafts.index")})):e.$state.go("drafts.index")})},a);function a(t,e,i,n,o,s,r,a,c,l,u){if(this.$rootScope=t,this.$log=e,this.$state=i,this.$stateParams=n,this.$translate=o,this.$mdDialog=s,this.DraftsService=r,this.AppSwitcherService=a,this.SpecialsService=c,this.draft=l,this.messageDefinition=u,!(this.loading=!0)!=(void 0!==this.AppSwitcherService.getContext().specialId)){if(this.formDefinition=u.formDefinition,null!==l.body&&""!==l.body)try{var p=JSON.parse(l.body);this.formDefinition=this.SpecialsService.getResumedFormDefinition(this.formDefinition,p),this.SpecialsService.preOpenSections(this.formDefinition,p)}catch(t){this.$log.error("Could not parse special resumed form data",{error:t})}this.loading=!1}else i.go("drafts.index")}e.SpecialController=r,e.SpecialControllerModule=i.module("app.drafts.SpecialController",[o.AppSwitcherModule.name,n.DraftSpecialModule.name])}.apply(e,n))||(t.exports=o)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/list.17a87c.html"},function(t,e,i){t.exports=i.p+"assets/tpl/edit.446f30.html"},function(t,e,r){var i,n;i=[r,e,r(1),r(18),r(606)],void 0===(n=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(s.$inject=["$window","$state","$stateParams","AppSwitcherService"],s.prototype.goBack=function(){if(this.$state.includes("conversations"))this.$state.go("conversations.label",{label:this.$stateParams.label});else if(this.$state.includes("drafts"))!0===this.inSpecial?this.$state.go("conversations.label",{label:"inbox"}):this.$state.go("drafts.index");else if(this.$state.includes("contacts"))switch(this.$state.current.name){case"contacts.view":this.$state.go("contacts."+this.$state.params.listType);break;case"contacts.shared-view":this.$state.go("contacts."+this.$state.params.listType,{addressBook:this.$state.params.addressBook});break;default:this.$state.go("contacts.personal")}else this.$state.includes("settings")?"settings.shared-addressbook-details"===this.$state.current.name?this.$state.go("settings.shared-addressbooks"):this.$state.go("settings"):this.$window.history.back()},s);function s(t,e,i,n){this.$window=t,this.$state=e,this.$stateParams=i,this.AppSwitcherService=n,this.inSpecial=void 0!==this.AppSwitcherService.getContext().specialId}e.BackButton=o,e.BackButtonModule=i.module("components.BackButton",[n.AppSwitcherModule.name]).component("backButton",{controller:o,template:r(607)})}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e){t.exports="<md-button class=md-icon-button ng-click=$ctrl.goBack() translate-namespace=back-button> <md-tooltip md-delay=500> <translate>.TOOLTIP</translate> </md-tooltip> <md-icon class=back-arrow>keyboard_arrow_left</md-icon> </md-button> "},function(t,e,u){var i,n;i=[u,e,u(1),u(19),u(6),u(39),u(14),u(609)],void 0===(n=function(t,e,i,n,o,s,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=(a.$inject=["$scope","$window","$log","$timeout","$translate","$state","$mdDialog","AccessRightGrantService","AuthSessionService","DelegateAccountService","LoginService","MessengerService","ProfileService","WebSocketService","StorageService"],a.prototype.$onInit=function(){var i=this;this.imgPresence=v.PRESENCE[this.presence],this.isDelegate=this.AuthSessionService.isDelegate(),this.listPrincipalAccounts(),this.$scope.$on("profile-updated",function(t,e){i.profile=e.profile,null===i.profile.picture&&(i.profile.picture=v.UNKNOWN_PERSON),i.entrustedAccounts=i.entrustedAccounts.slice(1),i.entrustedAccounts.unshift(i.profile)}),this.$scope.$on(n.WebSocketEvents.PRESENCE_CHANGED,function(t,e){e.accountUuid===i.profile.uuid&&(i.imgPresence=v.PRESENCE[e.presence],i.presence=e.presence)}),this.$scope.$on("$destroy",function(){i.ProfileService.clearCachedProfile()})},a.prototype.listPrincipalAccounts=function(){var e=this;return this.DelegateAccountService.getDelegations().then(function(t){e.entrustedAccounts=[e.profile].concat(t.filter(function(t){return t.email!==e.profile.email}))}).catch(function(t){e.$log.error("Could not get list of principal accounts",{error:t})})},a.prototype.changePresence=function(){var e=this,t=c.factory(this.profile.presence);this.$mdDialog.show(t).then(function(t){return e.WebSocketService.setPresence(t),e.ProfileService.patchProfile({presence:t},e.profile.uuid).catch(function(t){return e.$log.warn("Error changing presence",{error:t})})})},a.prototype.openState=function(t,e){void 0===e&&(e={}),this.$state.go(t,e)},a.prototype.selectAccount=function(e){var i=this;if(void 0===e&&(e=null),this.profile.uuid!==e){var t=this.entrustedAccounts.filter(function(t){return t.uuid===e})[0];this.LoginService.switchAccount(t.email).then(function(){i.AccessRightGrantService.clear(),i.StorageService.removeItem("LOCAL","application.context"),i.StorageService.removeItem("SESSION","application.theme"),i.reload()}).catch(function(t){i.entrustedAccounts=i.entrustedAccounts.filter(function(t){return t.uuid!==e}),t.status===o.HTTP_UNAUTHORIZED&&void 0!==t.data&&void 0!==t.data.reason?i.MessengerService.toast("profile-menu."+t.data.reason,{},!0):t.status===o.HTTP_PRECONDITION_FAILED?i.MessengerService.confirm("AUTH.LOGIN-412.EXPLANATION","AUTH.LOGIN-412.TITLE",{},i.$translate.instant("AUTH.LOGIN-412.ACTION"),i.$translate.instant("MAIN.CANCEL")).then(function(){return i.$state.go("settings.security")}):i.$log.error("Unexpected error switching accounts",{error:t})})}},a.prototype.reload=function(){s.locationReload("conversations.index",{},this.$window,this.$state)},a);function a(t,e,i,n,o,s,r,a,c,l,u,p,d,h,f){this.$scope=t,this.$window=e,this.$log=i,this.$timeout=n,this.$translate=o,this.$state=s,this.$mdDialog=r,this.AccessRightGrantService=a,this.AuthSessionService=c,this.DelegateAccountService=l,this.LoginService=u,this.MessengerService=p,this.ProfileService=d,this.WebSocketService=h,this.StorageService=f,this.entrustedAccounts=[],this.isDelegate=!1,this.imgUnknownPerson=v.UNKNOWN_PERSON}var c=(l.$inject=["$mdDialog","presence"],l.prototype.submit=function(){this.$mdDialog.hide(this.presence)},l.prototype.cancel=function(){this.$mdDialog.cancel()},l.factory=function(t){return{controller:l,templateUrl:u(610),locals:{presence:t}}},l);function l(t,e){this.$mdDialog=t,this.presence=e,this.icons=v.PRESENCE}e.ProfileMenuModule=i.module("components.ProfileMenu",[]).component("profileMenu",{bindings:{profile:"<"},controller:r,template:u(611)})}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e,i){t.exports=i.p+"assets/tpl/ChangePresence.a2399c.html"},function(t,e){t.exports='<div class=profile translate-namespace=profile-menu> <md-menu md-offset="10 60" md-position-mode="target-right target" md-no-ink> <div> <img ng-src="{{ $ctrl.profile.picture || $ctrl.imgUnknownPerson }}" alt="{{:: $ctrl.profile.email }}" ng-click=$mdMenu.open($event) /> <span ng-if="$ctrl.isDelegate === false" class=presence ng-class="\'presence-\' + $ctrl.presence"></span> </div> <md-menu-content width=6 class=profile-menu> <div class=account-list> <md-menu-item class="menu-header account-option" ng-repeat="account in $ctrl.entrustedAccounts track by account.uuid" ng-click=$ctrl.selectAccount(account.uuid)> <img ng-src="{{ account.picture || $ctrl.imgUnknownPerson }}"/> <div layout=row layout-align="start center" layout-wrap flex> <span class="md-subhead fullname" flex=100>{{ account.fullName }}</span> <span class="md-subhead email" flex=100>{{ account.email }}</span> </div> <md-icon aria-label="Selected account" ng-if="$ctrl.profile.email === account.email && $ctrl.entrustedAccounts.length > 1">check</md-icon> </md-menu-item> </div> <md-menu-divider></md-menu-divider> <md-menu-item> <md-button class=md-primary aria-label="Change presence" ng-click=$ctrl.changePresence() ng-disabled=$ctrl.isDelegate> <md-icon md-svg-src="{{ $ctrl.imgPresence }}" md-menu-align-target></md-icon> <span translate>.CHANGE-PRESENCE</span> </md-button> </md-menu-item> <md-menu-item> <md-button class="md-primary edit-profile" aria-label="Edit profile" ng-click="$ctrl.openState(\'settings.profile\')" ng-disabled=$ctrl.isDelegate> <md-icon md-menu-align-target>account_circle</md-icon> <span translate>.EDIT-PROFILE</span> </md-button> </md-menu-item> <md-menu-item> <md-button class="md-primary log-out" aria-label=Logout ng-click="$ctrl.openState(\'logout\')"> <md-icon md-menu-align-target>exit_to_app</md-icon> <span translate>.LOGOUT</span> </md-button> </md-menu-item> </md-menu-content> </md-menu> </div> '},function(t,e,p){var i,n;i=[p,e,p(1),p(19),p(5),p(8),p(101),p(18),p(53),p(87),p(613)],void 0===(n=function(t,i,e,o,f,s,r,n,a,c){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.STORAGE_PREFIX="sidenav.";var l=(u.$inject=["$scope","$rootScope","$log","$timeout","$window","$state","$mdDialog","$mdMedia","AddressBookService","AuthSessionService","DeviceService","LabelService","StorageService","AppSwitcherService"],u.prototype.$onInit=function(){var t=this;this.state=this.getStorageItem("state")||"CLOSED",this.updateBodyClass(),this.registerEvents(),this.$rootScope.$on("$locationChangeStart",function(){"OPEN"===t.state&&t.toggleState()}),this.labelsCollapsed=!1!==this.getStorageItem("labelsCollapsed"),this.addressBooksCollapsed=!1!==this.getStorageItem("addressBooksCollapsed");var e=void 0!==this.AppSwitcherService.getContext().specialId,i=this.AuthSessionService.isDelegate();this.AuthSessionService.hasScope(f.Scopes.RECEIVEMESSAGES)&&this.messageItems.push({state:"conversations.label",stateParams:{label:"inbox"},additionalActiveStates:[["conversations.view",{label:"inbox"}],["conversations.open",{label:"inbox"}]],label:"INBOX",icon:"question_answer"}),this.AuthSessionService.hasScope(f.Scopes.SENDMESSAGES)&&this.messageItems.push({state:"drafts.index",additionalActiveStates:[["drafts",{}]],label:"DRAFTS",icon:"rate_review"}),this.AuthSessionService.hasScope(f.Scopes.RECEIVEMESSAGES)&&this.messageItems.push({state:"conversations.label",stateParams:{label:"archive"},additionalActiveStates:[["conversations.view",{label:"archive"}],["conversations.open",{label:"archive"}]],label:"ARCHIVE",icon:"archive"}),this.AuthSessionService.hasScope(f.Scopes.SENDMESSAGES)&&(this.messageItems.push({state:"conversations.label",stateParams:{label:"trash"},additionalActiveStates:[["conversations.view",{label:"trash"}],["conversations.open",{label:"trash"}]],label:"TRASH",icon:"delete"}),this.addLabelsOption()),1!=e?(this.AuthSessionService.hasScope(f.Scopes.SENDMESSAGES)&&(this.profile.isBusiness()&&this.contactItems.push({state:"contacts.all",stateParams:{listType:"all"},additionalActiveStates:[["contacts.view",{listType:"all"}]],label:"CONTACTS-ALL",icon:"supervisor_account"}),this.contactItems.push({state:"contacts.personal",stateParams:{listType:"personal"},additionalActiveStates:[["contacts.view",{listType:"personal"}]],label:"CONTACTS-PERSONAL",icon:"account_circle"}),this.profile.isBusiness()&&this.contactItems.push({state:"contacts.organization",stateParams:{listType:"organization"},additionalActiveStates:[["contacts.view",{listType:"organization"}]],label:"CONTACTS-SHARED",icon:"folder_shared"}),this.addAddressBooksOption()),!1===this.AuthSessionService.hasScopes([f.Scopes.ORGANIZATIONADMIN,f.Scopes.USERADMIN])&&!1===i&&(this.restItems.push({state:"settings.support",label:"SUPPORT",icon:"help"}),this.exceptionStates.push("settings.support")),this.AuthSessionService.hasScope(f.Scopes.ORGANIZATIONADMIN)&&!1===i&&this.restItems.push({state:"organization.overview",label:"ORG-SETTINGS",additionalActiveStates:[["organization",{}]],icon:"tune"}),!1===i&&this.restItems.push({state:this.$mdMedia("gt-sm")?"settings.profile":"settings",label:"SETTINGS",additionalActiveStates:[["settings",{}]],icon:"settings"})):this.restItems.push({state:"specials-about",stateParams:{theme:this.AppSwitcherService.getContext().theme},label:"SPECIALINFO",icon:"help"})},u.prototype.showOverlay=function(){return"OPEN"===this.state&&(!1===this.$mdMedia("gt-sm")||!1===this.DeviceService.isDesktop())},u.prototype.showPin=function(){return"OPEN"===this.state&&this.DeviceService.isDesktop()},u.prototype.getStorageItem=function(t){return this.StorageService.getItem("SESSION",""+i.STORAGE_PREFIX+t)},u.prototype.setStorageItem=function(t,e){this.StorageService.setItem("SESSION",""+i.STORAGE_PREFIX+t,e)},u.prototype.go=function(t,e){var i=this;void 0===e&&(e={}),"OPEN"===this.state?(this.toggleState(),this.$timeout(function(){i.$state.transitionTo(t,e,{reload:i.$state.$current.parent})},200)):this.$state.transitionTo(t,e,{reload:this.$state.$current.parent})},u.prototype.toggleLabels=function(){"CLOSED"!==this.state?(this.labelsCollapsed=!this.labelsCollapsed,this.setStorageItem("labelsCollapsed",this.labelsCollapsed)):this.toggleState()},u.prototype.toggleAddressBooks=function(){"CLOSED"!==this.state?(this.addressBooksCollapsed=!this.addressBooksCollapsed,this.setStorageItem("addressBooksCollapsed",this.addressBooksCollapsed)):this.toggleState()},u.prototype.isStateActive=function(t){if(this.$state.includes(t.state,t.stateParams))return!0;if(void 0===t.additionalActiveStates)return!1;for(var e=0,i=t.additionalActiveStates;e<i.length;e++){var n=i[e],o=n[0],s=n[1];if(this.$state.includes(o,s)&&this.exceptionStates.indexOf(this.$state.current.name)<0)return!0}return!1},u.prototype.isLabelActive=function(t){var e={label:t.name};return this.$state.includes("conversations.label",e)||this.$state.includes("conversations.view",e)||this.$state.includes("conversations.open",e)},u.prototype.isAddressBookActive=function(t){return this.$state.includes("contacts.shared",{addressBook:t})||this.$state.includes("contacts.shared-view",{addressBook:t})},u.prototype.setState=function(t){var e=this;t!==this.state&&this.$timeout(function(){e.setRotate(t),e.state=t,e.updateBodyClass(),"OPEN"!==e.state&&e.setStorageItem("state",e.state)},16,!0)},u.prototype.setRotate=function(t){this.rotate="OPEN"===this.state&&"PINNED"===t||"PINNED"===this.state&&"OPEN"===t},u.prototype.updateBodyClass=function(){var t=this.$window.document.body;"PINNED"===this.state?t.classList.add("sidenav-pinned"):t.classList.remove("sidenav-pinned")},u.prototype.addLabelsOption=function(){var e=this,t=this.LabelService.getLabels();t.then(function(t){e.labels=t.userLabels.filter(function(t){return 0<t.counter})}),t.catch(function(t){e.$log.error("Error getting labels",{error:t})})},u.prototype.addAddressBooksOption=function(){var e=this;this.AddressBookService.list().then(function(t){return e.addressBooks=t.items}).catch(function(t){e.$log.error("Error getting address books",{error:t})})},u.prototype.addNewLabel=function(t){var e=c.LabelsDialog.factory("EDIT");e.targetEvent=t,e.openFrom=t.currentTarget,e.closeTo=t.currentTarget,this.$mdDialog.show(e)},u.prototype.toggleState=function(){"CLOSED"===this.state||"PINNED"===this.state?this.setState("OPEN"):this.setState("CLOSED")},u.prototype.onMouseLeave=function(){var t=this;"OPEN"===this.state&&this.$mdMedia("gt-sm")&&(this.mouseCloseTimeout=this.$timeout(function(){t.setState("CLOSED"),t.mouseCloseTimeout=void 0},1500,!1))},u.prototype.onMouseEnter=function(){void 0!==this.mouseCloseTimeout&&this.$timeout.cancel(this.mouseCloseTimeout)},u.prototype.registerEvents=function(){var n=this;this.$scope.$on(s.LabelEvents.Updated,function(t,e){n.labels=e.userLabels.filter(function(t){return 0<t.counter})}),this.$scope.$on(s.LabelEvents.Deleted,function(t,e){n.labels=n.labels.filter(function(t){return t.id!==e})}),this.$scope.$on(r.Events.Created,function(t,e){n.addressBooks.push(e)}),this.$scope.$on(r.Events.Updated,function(t,e){var i=n.addressBooks.filter(function(t){return t.uuid===e.uuid})[0];i.name=e.name,i.color=e.color}),this.$scope.$on(r.Events.Deleted,function(t,e){n.addressBooks=n.addressBooks.filter(function(t){return t.uuid!==e})}),this.$scope.$on("sidenav:toggle",function(){n.toggleState()}),this.$scope.$on(o.DeviceService.Events.WindowResized,function(){"PINNED"===n.state&&!1===n.$mdMedia("gt-sm")&&n.setState("CLOSED")})},u);function u(t,e,i,n,o,s,r,a,c,l,u,p,d,h){this.$scope=t,this.$rootScope=e,this.$log=i,this.$timeout=n,this.$window=o,this.$state=s,this.$mdDialog=r,this.$mdMedia=a,this.AddressBookService=c,this.AuthSessionService=l,this.DeviceService=u,this.LabelService=p,this.StorageService=d,this.AppSwitcherService=h,this.messageItems=[],this.contactItems=[],this.restItems=[],this.labelsCollapsed=!0,this.addressBooksCollapsed=!0,this.rotate=!1,this.exceptionStates=[],this.hasSpecials=this.AuthSessionService.hasScope(f.Scopes.SPECIALSUSER)}i.Sidenav=l,i.SidenavModule=e.module("components.sidenav",[n.AppSwitcherModule.name,a.VersionModule.name,c.LabelsDialogModule.name]).component("sidenav",{bindings:{profile:"<"},controller:l,template:p(614)})}.apply(e,i))||(t.exports=n)},function(t,e,i){},function(t,e){t.exports='<div id=overlay ng-if=$ctrl.showOverlay() ng-click="$ctrl.setState(\'CLOSED\');"> </div> <div class=wrapper translate-namespace=SIDENAV ng-class="\'state-\' + $ctrl.state.toLowerCase()" ng-mouseleave=$ctrl.onMouseLeave() ng-mouseenter=$ctrl.onMouseEnter()> <header> <app-switcher ng-if=$ctrl.hasSpecials></app-switcher> <md-button class="md-icon-button close-button" ng-click="$ctrl.setState(\'CLOSED\');" ng-if="$ctrl.hasSpecials === false"> <md-icon>close</md-icon> </md-button> <div class=icons> <md-button class="md-icon-button set-state-open" aria-label="open sidenav" ng-if="$ctrl.state === \'CLOSED\'" ng-click="$ctrl.setState(\'OPEN\');"> <md-icon>menu</md-icon> </md-button> <md-button class="md-icon-button set-state-pinned" aria-label="pinned sidenav" ng-if=$ctrl.showPin() ng-click="$ctrl.setState(\'PINNED\');" hide show-gt-sm> <md-icon md-svg-src=ziv:pin ng-class="{ \'rotatable\' : $ctrl.rotate === true }"></md-icon> </md-button> <md-button class="md-icon-button set-state-unpin" aria-label="unpin sidenav" ng-if="$ctrl.state === \'PINNED\'" ng-click="$ctrl.setState(\'CLOSED\');" hide show-gt-sm> <md-icon md-svg-src=ziv:pin class="rotatable rotated"></md-icon> </md-button> </div> </header> <div class=sections-wrapper> <section class=conversations> <h2 translate ng-if="::$ctrl.messageItems.length > 0">.CONVERSATIONS-TITLE</h2> <ul> <li ng-repeat="$item in ::$ctrl.messageItems track by $index" ng-click="$ctrl.go($item.state, $item.stateParams);" ng-class="{\'active\' : $ctrl.isStateActive($item)}"> <md-icon>{{:: $item.icon }}</md-icon> <span translate>{{:: \'.ITEMS.\' + $item.label }}</span> </li> <li ng-click=$ctrl.toggleLabels(); ng-if="$ctrl.messageItems.length > 0"> <md-icon>local_offer</md-icon> <span translate>.ITEMS.LABELS</span> <md-icon class="toggle hide-when-mini" ng-bind="$ctrl.labelsCollapsed ? \'expand_more\' : \'expand_less\'"></md-icon> </li> <ul ng-if="$ctrl.labelsCollapsed === false"> <li ng-repeat="$item in $ctrl.labels track by $item.id" ng-click="$ctrl.go(\'conversations.label\', { label : $item.name });" class="child hide-when-mini" ng-class="{ \'active\' : $ctrl.isLabelActive($item) }"> <md-icon ng-style="{ \'color\': $item.labelColor }">lens</md-icon> <span class=name>{{ $item.name }}</span> <span class=counter>{{ $item.counter }}</span> </li> </ul> <ul ng-if="$ctrl.labelsCollapsed === false"> <li ng-click=$ctrl.addNewLabel($event); ng-if="$ctrl.messageItems.length > 0" class="child hide-when-mini"> <md-icon>add</md-icon> <span class=name translate>.LABELS-ADD</span> </li> </ul> </ul> </section> <section class=contacts> <h2 translate ng-if="::$ctrl.contactItems.length > 0">.CONTACTS-TITLE</h2> <ul> <li ng-repeat="$item in ::$ctrl.contactItems track by $index" ng-click="$ctrl.go($item.state, $item.stateParams);" ng-class="{\'active\' : $ctrl.isStateActive($item)}"> <md-icon>{{:: $item.icon }}</md-icon> <span translate>{{:: \'.ITEMS.\' + $item.label }}</span> </li> <li ng-click=$ctrl.toggleAddressBooks(); ng-if="$ctrl.addressBooks.length > 0"> <md-icon>import_contacts</md-icon> <span translate>.ITEMS.ADDRESS-BOOKS</span> <md-icon class="toggle hide-when-mini" ng-bind="$ctrl.labelsCollapsed ? \'expand_more\' : \'expand_less\'"></md-icon> </li> <ul ng-if="$ctrl.addressBooksCollapsed === false"> <li ng-repeat="$book in $ctrl.addressBooks track by $book.uuid" ng-click="$ctrl.go(\'contacts.shared\', { addressBook : $book.uuid, listType : \'shared\' });" class="child hide-when-mini address-book" ng-class="{ \'active\' : $ctrl.isAddressBookActive($book.uuid) }"> <md-icon ng-style="{ \'color\': $book.color }">panorama_fish_eye</md-icon> <span class=name>{{ $book.name }}</span> </li> </ul> </ul> </section> <section class="rest settings"> <ul> <li ng-repeat="$item in ::$ctrl.restItems track by $index" ng-click="$ctrl.go($item.state, $item.stateParams);" ng-class="[\n\t\t\t\t\t\t{\'hidden\' : $item.label === \'ORG-SETTINGS\'},\n\t\t\t\t\t\t{\'active\' : $ctrl.isStateActive($item)}\n\t\t\t\t\t]"> <md-icon>{{:: $item.icon }}</md-icon> <span translate>{{:: \'.ITEMS.\' + $item.label }}</span> </li> </ul> </section> <version with-api="$ctrl.state !== \'CLOSED\'"></version> </div> </div> '},function(t,e,o){var i,n;i=[o,e,o(5)],void 0===(n=function(t,e,i){"use strict";function n(e,i,t,n,o){var s=t.contactEmail;return n.get(s).catch(function(t){return e.warn("error resolving contact",{error:t,contactEmail:s}),o.toast("CONTACTS.ERRORS.UNKNOWN"),i.go("contacts.index")})}n.$inject=["$log","$state","$stateParams","ContactsService","MessengerService"],Object.defineProperty(e,"__esModule",{value:!0}),e.ContactsRoutes=[{parent:"_app_layout",abstract:!0,name:"contacts",url:"/contacts",lazyLoad:function(t){var e=t.injector().get("$ocLazyLoad");return new Promise(function(e,t){o.e(8).then(function(){var t=[o(692)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}).then(function(t){return e.load(t.ContactsModule)})},data:{title:"Contacts",scopesRequired:[i.Scopes.SENDMESSAGES]},views:{"list@_app_layout":{component:"contactList"},"main@_app_layout":{template:'<div class="contacts" layout="row" layout-wrap ui-view></div>'}}},{name:"contacts.personal",url:"/personal",component:"contactsIndex",params:{listType:"personal"}},{name:"contacts.organization",url:"/organization",component:"contactsIndex",onEnter:["$state","profile",function(t,e){!1===e.isBusiness()&&t.go("contacts.personal")}],params:{listType:"organization"}},{name:"contacts.all",url:"/all",component:"contactsIndex",onEnter:["$state","profile",function(t,e){!1===e.isBusiness()&&t.go("contacts.personal")}],params:{listType:"all"}},{name:"contacts.view",url:"/{listType:all|personal|organization}/{contactEmail}",component:"contactView",onEnter:["$state","$stateParams","profile",function(t,e,i){!1===i.isBusiness()&&"personal"!==e.listType&&t.go("contacts.view",{contactEmail:e.contactEmail,contact:e.contact,listType:"personal"})}],params:{listType:"personal"},resolve:{contact:n}},{name:"contacts.shared",url:"/shared/{addressBook:uuid}",component:"contactsIndex",params:{listType:"shared"}},{name:"contacts.shared-view",url:"/shared/{addressBook:uuid}/{contactEmail}",component:"contactView",params:{addressBook:void 0,listType:"shared"},resolve:{contact:n}}]}.apply(e,i))||(t.exports=n)},function(t,e,o){var i,n;i=[o,e,o(5)],void 0===(n=function(t,e,i){"use strict";function n(t){return t.get()}n.$inject=["OrganizationService"],Object.defineProperty(e,"__esModule",{value:!0}),e.OrganizationRoutes=[{abstract:!0,parent:"_app_layout",name:"organization",url:"/organization",data:{title:"Organization Settings",scopesRequired:[i.Scopes.USERADMIN]},lazyLoad:function(t){var e=t.injector().get("$ocLazyLoad");return new Promise(function(e,t){o.e(5).then(function(){var t=[o(693)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}).then(function(t){return e.load(t.OrganizationModule)})},views:{"list@_app_layout":{component:"organizationList"},"main@_app_layout":{template:'<div class="settings" ui-view></div>'}},resolve:{organization:n}},{name:"organization.account",url:"/account/{accountId:uuid}",component:"organizationAccount",data:{title:"Organization account"},resolve:{organization:n}},{name:"organization.accounts",url:"/accounts",component:"organizationAccounts",data:{title:"Organization accounts"},resolve:{organization:n}},{name:"organization.api-keys",url:"/api-keys",component:"organizationApiKeys",data:{title:"Organization API keys"}},{name:"organization.audit-log",url:"/audit-log",component:"organizationAuditLog",data:{title:"Organization Audit Log"}},{name:"organization.business-rules",url:"/business-rules",component:"organizationBusinessRules",data:{title:"Organization business rules"},resolve:{organization:n}},{name:"organization.communication-log",url:"/communication-log/{accountId:uuid}",component:"organizationCommunicationLog",data:{title:"Organization Communication Log"},params:{from:void 0,category:void 0},resolve:{accountId:["$stateParams",function(t){return t.accountId}]}},{name:"organization.data-export",url:"/data-export",component:"organizationDataExport",data:{title:"Organization data export"},resolve:{organization:n}},{name:"organization.dns-settings",url:"/dns-settings",component:"organizationDnsSettings"},{name:"organization.domains",url:"/domains",component:"organizationOwnedDomains"},{name:"organization.external-conversations",url:"/external-conversations",component:"organizationExternalConversations"},{name:"organization.messages-expiration-date",url:"/messages-expiration-date",component:"organizationMessagesExpirationDate"},{name:"organization.mail-submission",url:"/mail-submission",component:"organizationMailSubmission",data:{title:"Organization mail submission"}},{name:"organization.network-restrictions",url:"/network-restrictions",component:"organizationNetworkRestrictions",data:{title:"Organization Network Range Restrictions"}},{name:"organization.notifications",url:"/notifications",component:"organizationNotifications",data:{title:"Organization notifications"},resolve:{organization:n}},{name:"organization.overview",url:"/overview",component:"organizationOverview",data:{title:"Organization Overview"},resolve:{organization:n}},{name:"organization.profile",url:"/profile",component:"organizationProfile",data:{title:"Organization profile"},resolve:{organization:n}},{name:"organization.plugin-settings",url:"/plugin-settings",component:"organizationPluginSettings",data:{title:"Organization Plugin Settings"}},{name:"organization.recipients-verifications",url:"/recipients-verifications",component:"organizationRecipientsVerifications",data:{title:"Organization Recipients Verifications"},resolve:{organization:n}},{name:"organization.secure-direct-delivery",url:"/secure-direct-delivery",component:"organizationSecureDirectDelivery",data:{title:"Organization Secure Direct Delivery"}},{name:"organization.services",url:"/services",component:"organizationServices",data:{title:"Organization Services"}},{name:"organization.service-details",url:"/services/{serviceId:uuid}",component:"organizationServiceDetails",data:{title:"Organization Services"}},{name:"organization.specials",url:"/specials",component:"organizationSpecials",data:{title:"Organization specials"}},{name:"organization.sso",url:"/sso",component:"organizationSso",data:{title:"Organization SSO SAML"},resolve:{organization:n}},{name:"organization.support",url:"/support",component:"support"},{name:"organization.usage-statistics",url:"/usage-statistics",component:"organizationUsageStatistics",data:{title:"Organization Usage Statistics"}}]}.apply(e,i))||(t.exports=n)},function(t,e,s){var i,n;i=[s,e,s(5)],void 0===(n=function(t,e,i){"use strict";function n(t){return t.get()}function o(t,e){t.get().then(function(t){return e.getSignature(t.uuid)})}n.$inject=["ProfileService"],o.$inject=["ProfileService","SignatureService"],Object.defineProperty(e,"__esModule",{value:!0}),e.SettingsRoutes=[{parent:"_app_layout",name:"settings",url:"/settings",data:{title:"Settings",scopesRequired:[i.Scopes.USERREGISTRATION]},lazyLoad:function(t){var e=t.injector().get("$ocLazyLoad");return new Promise(function(e,t){s.e(7).then(function(){var t=[s(694)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}).then(function(t){return e.load(t.SettingsModule)})},onEnter:["$state","AuthSessionService",function(t,e){e.isDelegate()&&t.go("conversations.label")}],params:{mode:"default"},views:{"list@_app_layout":{component:"settingsList"},"main@_app_layout":{template:'<div class="settings" ui-view></div>'}},resolve:{profile:n}},{name:"settings.audit-log",url:"/auditlog",component:"settingsAuditLog",data:{title:"Account Audit Log"}},{name:"settings.business-rules",url:"/business-rules",component:"settingsAccountBusinessRules",data:{title:"Account business rules"},onEnter:["$state","profile",function(t,e){if(!1===e.isBusiness())return t.go("_errors.not_found")}]},{name:"settings.delegation",url:"/delegation",component:"settingsDelegation",data:{title:"Delegation settings"},onEnter:["$state","profile",function(t,e){if(!1===e.isPersonal())return t.go("_errors.not_found")}]},{name:"settings.data-export",url:"/data-export",component:"settingsDataExport",data:{title:"Data export settings"}},{name:"settings.notifications",url:"/notifications",component:"settingsNotifications",data:{title:"Notification settings"},resolve:{profile:n}},{name:"settings.profile",url:"/profile",component:"settingsProfile",data:{title:"Profile settings"},resolve:{profile:n}},{name:"settings.recovery",url:"/recovery",component:"settingsRecovery",data:{scopesRequired:[i.Scopes.USERECOVERYCODE],title:"Message recovery"}},{name:"settings.security",url:"/security?highlight",component:"settingsSecurity",data:{title:"Security settings"},params:{highlight:void 0},resolve:{cardHighlight:["$q","$stateParams",function(t,e){return t.resolve(e.highlight)}],profile:n}},{name:"settings.signature",url:"/signature",component:"settingsSignature",data:{title:"Signature"},resolve:{profile:n,signature:o}},{name:"settings.shared-addressbooks",url:"/shared-addressbooks",component:"settingsSharedAddressbooks",data:{title:"Shared Addressbooks"}},{name:"settings.shared-addressbook-details",url:"/shared-addressbooks/{addressBook:uuid}",component:"settingsSharedAddressbookDetails",resolve:{addressbook:["$state","$stateParams","$log","AddressBookService",function(e,t,i,n){return n.getAsAdmin(t.addressBook).catch(function(t){return i.warn("Error getting addressbook as admin",{error:t}),e.go("_errors.not_found")})}]},data:{title:"Shared Addressbook details"}},{name:"settings.specials",url:"/specials",component:"settingsSpecials",data:{title:"Specials settings"}},{name:"settings.support",url:"/support",component:"support"}]}.apply(e,i))||(t.exports=n)},function(t,e,n){var i,o;i=[n,e,n(5)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SpecialsRoutes=[{abstract:!0,parent:"_app_layout",name:"specials",url:"/specials/{theme:string}",lazyLoad:function(t){var e=t.injector().get("$ocLazyLoad");return new Promise(function(e,t){n.e(11).then(function(){var t=[n(695)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}).then(function(t){return e.load(t.SpecialsModule)})}},{parent:"specials",name:"specials-about",url:"/about",data:{scopesRequired:[i.Scopes.USERREGISTRATION,i.Scopes.SPECIALSUSER],title:"Specials information"},resolve:{special:["$stateParams","SpecialsService",function(e,t){return t.listSpecials().then(function(t){return t.filter(function(t){return t.theme===e.theme}).shift()})}]},views:{"@":{component:"specialsInfo"}}}]}.apply(e,i))||(t.exports=o)},function(t,e,i){},function(t,e){t.exports='<div id=zivver-main class=zivver-main translate-cloak ngf-drop ngf-drag-over-class=dragover ngf-change=$app.filesDropped($files); ngf-multiple=true ngf-model-options="{\n\t\tupdateOn: \'drop\',\n\t\tallowInvalid: false,\n\t\tdebounce: 0\n\t}"> <sidenav ng-if="::$app.isGuest === false" profile=::$app.profile></sidenav> <div class="app-container no-guest" ng-if="::$app.isGuest === false"> <header class=app layout=row layout-align="space-between center"> <div class=burger hide show-xs show-sm> <md-button class="md-icon-button burger-menu" ng-click=$app.toggleSidenav()> <md-icon>menu</md-icon> </md-button> </div> <span flex-xs flex-sm></span> <h1><a ui-sref="conversations.label({ label : \'inbox\' })">ZIVVER</a></h1> <span flex></span> <profile-menu profile=::$app.profile></profile-menu> </header> <div class=body layout=row layout-align="start start"> <div ui-view=list class=column-list></div> <div class=column-content flex> <div class=main ui-view=main></div> </div> <right-pane profile=::$app.profile></right-pane> </div> </div> <div class="app-container guest" ng-if=::$app.isGuest> <header class=app layout=row layout-align="space-between center"> <h1><a>ZIVVER</a></h1> <span flex></span> <language-select hide show-gt-xs></language-select> <div class=profile layout=row layout-align="end center"> <md-button class="" ui-sref="logout({message : \'HASQUIT\'})"> <span translate>MAIN.CLOSE</span> <md-icon>close</md-icon> </md-button> </div> </header> <div class="body guest" layout=row layout-align="start start"> <div class=column-content flex> <div class=main ui-view=main></div> </div> <right-pane profile=::$app.profile></right-pane> </div> </div> </div> <div id=noprinting> <span class=no-print-message translate>PRINT.NOPRINT</span> </div> '},function(t,e,i){t.exports='<div id=zivver-main class=zivver-main translate-namespace=APP.REFRESH> <div class="app-container refresh"> <div class=zivver-loader ng-if="$ctrl.connectionError === false && $ctrl.authenticationError === false"> <img src='+i(175)+' alt="ZIVVER is loading"> </div> <md-card class=no-connection ng-if=$ctrl.connectionError translate-namespace=.CONNECTION-ERROR> <md-card-title> <md-card-title-text> <span class=md-headline translate>.TITLE</span> </md-card-title-text> </md-card-title> <md-card-content> <p translate> .MESSAGE </p> </md-card-content> <md-card-actions layout=row layout-align="end center" class=actions> <md-button ng-click=$ctrl.tryAgain() class="md-primary md-raised"> <translate>.TRY-AGAIN</translate> </md-button> </md-card-actions> </md-card> <md-card class=no-connection ng-if=$ctrl.authenticationError translate-namespace=.AUTH-401> <md-card-title> <md-card-title-text> <span class=md-headline translate>.TITLE</span> </md-card-title-text> </md-card-title> <md-card-content> <p translate> .MESSAGE </p> </md-card-content> <md-card-actions layout=row layout-align="end center" class=actions> <md-button ng-click=$ctrl.loginAgain() class="md-primary md-raised"> <translate>.LOGIN-AGAIN</translate> </md-button> </md-card-actions> </md-card> </div> </div> '},function(t,e,f){var i,n;i=[f,e,f(1),f(623),f(624),f(625),f(626),f(627),f(628),f(53),f(80),f(629)],void 0===(n=function(t,e,i,n,o,s,r,a,c,l,u){"use strict";function p(t){var e={authorizationRequired:!1,permissionsRequired:[],bodyClass:"landing auth"};t.state({name:"landing-open",url:"/l/{openOrShare:open|share}/{uuid:uuid}/{token:token}",template:f(630),controller:n.OpenController,controllerAs:"$ctrl",data:e,resolve:{accessToken:d,profile:h}}),t.state({name:"landing-support",url:"/l/support?{return}",data:{authorizationRequired:!0},resolve:{supportToken:["$http","$log","$state",function(t,e,i){var n=t.get("/api/authentication/login/support");return n.catch(function(t){return e.error("Could not obtain support token",{error:t}),i.go("_error_not_found")}),n.then(function(t){return t.data.jwt})}]},controller:["$window","$log","$state","$stateParams","supportToken",function(t,e,i,n,o){var s=n.return,r=-1<s.indexOf("?");if(0!==s.toLowerCase().indexOf("https://support.zivver.com/"))return e.warn("Support redirect url does not contain support.zivver.com",{returnUrl:s}),void i.go("_errors.not_found");t.location.href=s+(r?"&":"?")+"jwt="+o}]}),t.state({name:"conversation-starter",url:"/l/start/{conversationStarterId:uuid}?email&name",templateUrl:f(631),controller:a.ConversationStarterController,controllerAs:"$ctrl",data:e,resolve:{accessToken:d}}),t.state({name:"conversation-starter-email",url:"/l/start/{token:token}",controller:r.ConversationStarterEmailController,controllerAs:"$ctrl",data:e}),t.state({name:"address-book",url:"/l/addressbook/{addressBookSignupId:uuid}",templateUrl:f(632),controller:s.AddressBookController,controllerAs:"$ctrl",data:e,resolve:{accessToken:d,profile:h}}),t.state({name:"address-book-email",url:"/l/addressbook/{token:token}?unsubscribe",templateUrl:f(633),controller:o.AddressBookEmailController,controllerAs:"$ctrl",data:e}),t.state({name:"landing-theme",url:"/l/special/{theme}?{next}",controller:c.SpecialController,data:e}),t.state({name:"landing-mobapp-sso-start",url:"/l/mobapp-sso-start?url&scheme",controller:["$stateParams","$window","LoginService",function(t,e,i){var n=t.url,o=t.scheme;i.setLoginDestination("landing-mobapp-sso-success",{scheme:o}),e.location.href=n}],data:e}),t.state({name:"landing-mobapp-sso-success",url:"/l/mobapp-sso-success",params:{refreshToken:void 0,scheme:void 0},controller:["$stateParams","$window","AuthSessionService",function(t,e,i){var n=i.getRefreshToken(),o=t.scheme;e.location.href=o+"://?token="+n}],data:e})}function d(t,e,i){return e.isAuthenticated()?t.resolve(e.getAccessToken()):e.hasRefreshToken()?i.refresh().then(function(t){return t.accessToken}):t.resolve(void 0)}function h(t,e,i){return void 0!==i?e.get():t.resolve(!1)}p.$inject=["$stateProvider"],d.$inject=["$q","AuthSessionService","LoginService"],h.$inject=["$q","ProfileService","accessToken"],Object.defineProperty(e,"__esModule",{value:!0}),e.LandingModule=i.module("zivver.landing",[n.OpenControllerModule.name,s.AddressBookControllerModule.name,r.ConversationStarterEmailControllerModule.name,a.ConversationStarterControllerModule.name,l.VersionModule.name,u.LanguageSelectModule.name]),e.LandingModule.config(p)}.apply(e,i))||(t.exports=n)},function(t,e,c){var i,n;i=[c,e,c(1),c(6),c(161),c(39)],void 0===(n=function(t,e,i,o,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var y=c(21);e.OpenControllerModule=i.module("landing.OpenController",[n.ConversationChallengeModule.name]);var r=(a.$inject=["$log","$q","$window","$state","$stateParams","$translate","AuthSessionService","LoginService","KeysService","ShareTokenService","ConversationsService","ProfileService","DelegateAccountService","AccessRightGrantService","ThemeService","profile"],a.prototype.resolveConflict=function(){"stay-logged-in"===this.userConflictResolution?this.$state.go("conversations.label",{location:"replace"}):(this.AuthSessionService.forgetMe(),this.$window.location.reload(!0))},a.prototype.changeToDelegate=function(){var t=this;this.LoginService.switchAccount(this.intendedRecipient).then(function(){s.locationReload("conversations.open",{shareId:t.shareId},t.$window,t.$state)})},a.prototype.loginGuest=function(){var n=this;this.LoginService.authCodeLogin(this.token,!1).then(function(){var t=n.ConversationsService.getShare(n.shareId).then(function(e){return n.ConversationsService.getBrandingForShare(e).then(function(t){return"zivver"!==t.name&&(n.ThemeService.loadTheme(t,!0),n.logo=t.logoUrl),e}).catch(function(){return e})});n.$q.all([t,n.ProfileService.get()]).then(function(t){var e=t[0],i=t[1];n.share=e,n.isEmailChallenge=n.share.isEmailAccessRight(),n.profile=i,!1===e.isAccessGranted()?n.getConversation(e).then(function(t){n.conversation=t,n.screen="challenge"}).catch(function(t){return n.$log.error("Error: ",{err:t})}):n.goToConversation()}).catch(function(t){n.screen="error",n.error=n.$translate.instant("LANDING.OPEN.ERROR.CHALLENGE-RESOLVE")+" (code: 2751)",n.$log.error("Error resolving data for guest conversation-challenge",{error:t})})}).catch(function(t){t.status===o.HTTP_CONFLICT?n.$state.go("login",{nextState:"conversations.open",nextParams:{shareId:n.shareId}},{location:"replace"}):(n.$translate("LANDING.OPEN.ERROR.AUTHENTICATION").then(function(t){n.screen="error",n.error=t+" (code: 2749)"}),n.$log.error("Could not log in guest (code: 2749)",{error:t}))})},a.prototype.goToConversation=function(){return this.$state.transitionTo("conversations.open",{shareId:this.shareId},{location:"replace"})},a.prototype.checkShareToken=function(){var i=this;if(this.profile.isGuest())return this.goToConversation();this.KeysService.verifyAdoptShareToken(this.token).then(function(e){!1===e.isAdoptable&&void 0!==e.canBeAdoptedBy?(i.intendedRecipient=e.canBeAdoptedBy,i.DelegateAccountService.getDelegations().then(function(t){return t.map(function(t){return t.email})}).then(function(t){-1<t.indexOf(e.canBeAdoptedBy)?i.screen="for-delegate":i.screen="user-conflict"})):i.goToConversation()},function(t){i.screen="error",i.error="Unexpected error occurred (code: 2767)",i.$log.error("Could not verify share token adoption (code: 2776)",{error:t})})},a.prototype.getShareIdFromToken=function(t){var e=t.split(".")[1],i=JSON.parse(atob(e));return this.$log.info("Getting share id from legacy JWT"),i.shareUuid},a.prototype.getConversation=function(t){var e=this;return this.ConversationsService.get(t.conversationId).then(function(t){return t}).catch(function(t){return e.screen="error",e.error=e.$translate.instant("LANDING.OPEN.ERROR.CHALLENGE-RESOLVE")+" (code: 2750)",e.$log.error("Error resolving data for guest conversation-challenge",{error:t}),e.$q.reject(t)})},a);function a(t,e,i,n,o,s,r,a,c,l,u,p,d,h,f,v){this.$log=t,this.$q=e,this.$window=i,this.$state=n,this.$stateParams=o,this.$translate=s,this.AuthSessionService=r,this.LoginService=a,this.KeysService=c,this.ShareTokenService=l,this.ConversationsService=u,this.ProfileService=p,this.DelegateAccountService=d,this.AccessRightGrantService=h,this.ThemeService=f,this.profile=v,this.hideTitle=!1,this.intendedRecipient="stay-logged-in",this.logo=y,this.screen="loading";var m=this.$stateParams,g=m.uuid,S=m.token,$=m.openOrShare;this.expired=!1,this.shareId="share"===$?g:this.getShareIdFromToken(S),this.token=S,this.ShareTokenService.storeToken(this.shareId,S),this.AuthSessionService.isAuthenticated()&&!1===v.isGuest()?this.checkShareToken():this.loginGuest()}e.OpenController=r}.apply(e,i))||(t.exports=n)},function(t,e,i){var n,o;n=[i,e,i(1),i(6)],void 0===(o=function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=(s.$inject=["$log","$translate","$state","$stateParams","AddressBookService"],s.prototype.authenticateChallenge=function(){var i=this,t=this.AddressBookService.authenticateChallenge(this.$stateParams.token);return t.catch(function(t){i.screen="AUTHENTICATE-ERROR";var e="";switch(t.status){case n.HTTP_NOT_FOUND:e="Link does not exist",i.error="NOT-FOUND";break;case n.HTTP_NOT_ACCEPTABLE:e="Already a member",i.screen="ALREADY-MEMBER",i.token=t.data.token;break;case n.HTTP_CONFLICT:e="Already pending request",i.screen="MEMBERSHIP-PENDING";break;case n.HTTP_GONE:e="Token no longer available",i.error="GONE";break;default:e="Authenticate challenge error",i.error="DEFAULT"}i.$log.warn(e,{error:t})}),t.then(function(){i.screen="MEMBERSHIP-PENDING"})},s.prototype.unsubscribe=function(){var i=this;this.token=void 0!==this.token?this.token:this.$stateParams.token;var t=this.AddressBookService.unsubscribe(this.token);return t.catch(function(t){i.screen="UNSUBSCRIBE-ERROR";var e="";switch(t.status){case n.HTTP_BAD_REQUEST:e="Invalid unsubscribe token",i.error="BAD-REQUEST";break;case n.HTTP_FORBIDDEN:e="Unsubscribe address book owner",i.error="FORBIDDEN";break;case n.HTTP_GONE:e="Expired unsubscribe token",i.error="GONE";break;default:e="Unsubscribe address book error",i.error="DEFAULT"}i.$log.warn("Address books unsubscribe: "+e,{error:t})}),t.then(function(){i.screen="UNSUBSCRIBED",i.token=void 0})},s);function s(t,e,i,n,o){this.$log=t,this.$translate=e,this.$state=i,this.$stateParams=n,this.AddressBookService=o,this.error="",this.screen="LOADING",void 0!==this.$stateParams.token?"true"===this.$stateParams.unsubscribe?this.unsubscribe():this.authenticateChallenge():(this.error="ERROR",this.screen="ERROR")}e.AddressBookEmailController=o,e.AddressBookEmailControllerModule=i.module("landing.AddressBookEmailController",[])}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(1),i(5),i(6),i(13)],void 0===(o=function(t,e,i,n,o,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r="LANDING.ADDRESS-BOOK",a=(c.$inject=["$log","$rootScope","$mdDialog","$timeout","$translate","$state","$stateParams","AddressBookService","AuthSessionService","accessToken","profile"],c.prototype.prefillForm=function(){void 0!==this.accessToken&&(this.formValues.email=this.profile.email,this.formValues.name=this.profile.fullName,this.formValues.organization=this.profile.organizationName,this.loggedIn=!0)},c.prototype.getAddressBookInfo=function(){var e=this,t=this.AddressBookService.getSignup(this.addressBookSignupId);return t.catch(function(t){if(e.screen="ERROR",t.status===o.HTTP_NOT_FOUND)return e.$log.warn("This address book does not exist",{error:t}),e.$state.go("_errors.not_found")}),t.then(function(t){e.addressBook=t,e.screen="REQUEST-FORM"})},c.prototype.submitForm=function(){this.requestSignup()},c.prototype.requestSignup=function(){var e=this;this.submittingForm=!0;var t,i={email:this.formValues.email,profile:{fullName:this.formValues.name,organizationName:this.formValues.organization}};return(t=this.loggedIn?this.AddressBookService.join(this.addressBook.uuid):this.AddressBookService.requestSignup(this.addressBookSignupId,i)).catch(function(t){switch(t.status){case o.HTTP_CONFLICT:e.screen="MEMBERSHIP-PENDING";break;case o.HTTP_NOT_ACCEPTABLE:e.screen="ALREADY-MEMBER";break;case o.HTTP_LOCKED:e.showAlert(r+".ERRORS.LOCKED");break;case o.HTTP_GONE:case o.HTTP_NOT_FOUND:default:e.showAlert(r+".ERRORS.DESC")}e.$log.warn("Signup post request to address book failed",{error:t})}),t.finally(function(){e.submittingForm=!1}),t.then(function(t){e.loggedIn?e.screen="MEMBERSHIP-PENDING":e.screen="REQUEST-SENT"})},c.prototype.useOtherEmail=function(){var t=this,e=s.WarningDialog.factory({title:r+".DIALOG.TITLE",explanation:r+".DIALOG.CONFIRMATION",submitText:r+".DIALOG.CONFIRM",cancelText:r+".DIALOG.CANCEL",type:s.WarningDialogTypes.error});return this.$mdDialog.show(e).then(function(){t.logout()})},c.prototype.unsubscribe=function(){var e=this;this.AddressBookService.leave(this.addressBook.uuid).then(function(){return e.screen="UNSUBSCRIBED"}).catch(function(t){switch(t.status){case o.HTTP_NOT_FOUND:e.showAlert(r+".ERRORS.NOT-MEMBER");break;case o.HTTP_CONFLICT:e.showAlert(r+".ERRORS.CONFLICT");break;default:e.showAlert(r+".ERRORS.DEFAULT")}})},c.prototype.reload=function(){this.$state.reload()},c.prototype.logout=function(){this.AuthSessionService.forgetMe(),this.$rootScope.$broadcast(n.AuthEvents.logoutSuccess),this.$state.go("address-book",{addressBookSignupId:this.addressBookSignupId},{location:"replace",reload:!0})},c.prototype.showAlert=function(t){var e=this.$mdDialog.alert();e.title(this.$translate.instant(r+".ERRORS.TITLE")),e.htmlContent(this.$translate.instant(t)),e.ok(this.$translate.instant("MAIN.OK")),this.$mdDialog.show(e)},c);function c(t,e,i,n,o,s,r,a,c,l,u){var p=this;this.$log=t,this.$rootScope=e,this.$mdDialog=i,this.$timeout=n,this.$translate=o,this.$state=s,this.$stateParams=r,this.AddressBookService=a,this.AuthSessionService=c,this.accessToken=l,this.profile=u,this.error=null,this.formValues={},this.screen="LOADING",this.submittingForm=!1,this.loggedIn=!1,this.$timeout(function(){var t=p.$translate.use().toLowerCase();p.supportUrl="https://support.zivver.com/"+t+"/kb/articles/301"},500),this.addressBookSignupId=this.$stateParams.addressBookSignupId,this.prefillForm(),this.getAddressBookInfo()}e.AddressBookController=a,e.AddressBookControllerModule=i.module("landing.AddressBookController",[])}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(1)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ConversationStarterEmailControllerModule=i.module("landing.ConversationStarterEmailController",[]);var n=(o.$inject=["$log","$state","$stateParams","ConversationStartersService"],o.prototype.putConversationStarterToken=function(t){var e=this;this.ConversationStartersService.validateConversationStarterToken(t).then(function(t){e.$state.go("landing-open",{token:t.shareToken,uuid:t.shareId,openOrShare:"share"},{reload:!0})}).catch(function(t){return e.$log.warn("Error while putting token to this conversation starter",{error:t}),e.$state.go("_errors.not_found")})},o);function o(t,e,i,n){this.$log=t,this.$state=e,this.$stateParams=i,this.ConversationStartersService=n;var o=this.$stateParams.token;void 0===o||this.putConversationStarterToken(o)}e.ConversationStarterEmailController=n}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(1),i(25),i(6),i(5)],void 0===(o=function(t,e,i,n,v,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o="LANDING.CONVERSATION-STARTER";e.ConversationStarterControllerModule=i.module("landing.ConversationStarterController",[]);var s=(r.$inject=["$log","$mdDialog","$q","$translate","$state","$stateParams","AuthSessionService","ConversationStartersService","LoginService","MessengerService","ThemeService","accessToken"],r.prototype.getConversationStarterInfo=function(){var e=this;return this.ConversationStartersService.getInfo(this.conversationStarterId).then(function(t){e.conversationStarter=t}).catch(function(t){if(t.status===v.HTTP_NOT_FOUND)return e.$log.warn("This conversation starter does not exist",{error:t}),e.$state.go("_errors.not_found")})},r.prototype.initiateConversationRegistered=function(){var i=this;this.ConversationStartersService.initiateConversationRegistered(this.conversationStarterId).then(function(t){i.$state.go("conversations.open",{shareId:t.shareId},{reload:!0})}).catch(function(e){switch(e.status){case v.HTTP_NOT_ACCEPTABLE:i.getConversationStarterInfo().then(function(t){t?i.screen="error":(i.$state.go("drafts.create",{conversationStarter:i.conversationStarter}),i.$log.warn("Tried to start conversation with no default recipient",{error:e}))});break;case v.HTTP_NOT_FOUND:i.screen="error",i.error=".ERRORS.NOT-FOUND",i.$log.warn("Error posting to this conversation starter",{error:e})}})},r.prototype.setLoginDestination=function(){this.LoginService.setLoginDestination(this.$state.current.name,this.$state.params),n.unloadTheme()},r.prototype.submitOpenForm=function(){var e=this,i=!1===this.useDefaultRecipient?this.formValues.recipient:this.conversationStarter.recipientFullName;this.ConversationStartersService.initiateConversationGuest(this.conversationStarterId,this.formValues).then(function(){e.screen="code-sent"}).catch(function(t){e.MessengerService.alert(o+".ERRORS.DESC","",{recipient:i}),e.$log.warn("Could not post to this conversation starter",{error:t})})},r.prototype.submitPersonalForm=function(){var e=this;this.ConversationStartersService.initiateConversationGuest(this.conversationStarterId,this.formValues).then(function(){e.screen="code-sent"}).catch(function(t){e.MessengerService.alert(o+".ERRORS.DESC","",{recipient:e.conversationStarter.recipientFullName}),e.$log.warn("Could not post to this conversation starter",{error:t})})},r.prototype.switchState=function(t){this.subState=t},r.prototype.toggleOverwriteRecipient=function(){!1===this.useDefaultRecipient&&(this.formValues.recipient="",this.formRecipient.recipient.$setPristine())},r);function r(t,e,i,n,o,s,r,a,c,l,u,p){var d=this;if(this.$log=t,this.$mdDialog=e,this.$q=i,this.$translate=n,this.$state=o,this.$stateParams=s,this.AuthSessionService=r,this.ConversationStartersService=a,this.LoginService=c,this.MessengerService=l,this.ThemeService=u,this.accessToken=p,this.error=null,this.formValues={},this.screen="loading",this.subState="SET-SENDER",this.useDefaultRecipient=!1,this.logo="",this.conversationStarterId=this.$stateParams.conversationStarterId,void 0!==this.accessToken&&this.AuthSessionService.hasScope(m.Scopes.SENDMESSAGES))this.initiateConversationRegistered();else{this.formValues.email="true"!==this.$stateParams.email?this.$stateParams.email:void 0,this.formValues.fullName="true"!==this.$stateParams.name?this.$stateParams.name:void 0;var h=this.ConversationStartersService.getBranding(this.conversationStarterId),f=this.getConversationStarterInfo();this.$q.all([h,f]).then(function(t){var e=t[0];d.ThemeService.loadTheme(e,!0),""!==e.logoUrl?d.logo=e.logoUrl:""!==d.conversationStarter.organizationLogo&&(d.logo=d.conversationStarter.organizationLogo),d.screen="email-form"}).catch(function(t){if(t.status===v.HTTP_NOT_FOUND)return d.$log.warn("This conversation starter does not exist",{error:t}),d.$state.go("_errors.not_found");d.screen="error"})}}e.ConversationStarterController=s}.apply(e,n))||(t.exports=o)},function(t,e,i){var n,o;n=[i,e,i(25)],void 0===(o=function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(n.$inject=["$log","$state","$stateParams"],n);function n(t,e,i){var n=i.theme;void 0!==n&&s.loadTheme(n);var o=i.next;switch(o){case"/login":e.go("login");break;default:t.warn("SpecialController got an unexpected url to go next: ",{next:o}),e.go("login")}}e.SpecialController=i}.apply(e,n))||(t.exports=o)},function(t,e,i){},function(t,e){t.exports='<div class="auth landing open" translate-cloak translate-namespace=LANDING.OPEN> <main> <div class=loader ng-if="$ctrl.screen === \'loading\'"> <md-progress-linear md-mode=query></md-progress-linear> </div> <div ng-if="$ctrl.screen === \'challenge\'"> <img ng-src="{{ $ctrl.logo }}" alt=logo class=logo /> <h2 class=md-title ng-if="$ctrl.hideTitle === false && $ctrl.isEmailChallenge === false" translate>.TITLE</h2> <conversation-challenge conversation=$ctrl.conversation share=$ctrl.share sender=$ctrl.sender profile=$ctrl.profile expired=$ctrl.expired notified=$ctrl.hideTitle></conversation-challenge> </div> <div ng-if="$ctrl.screen === \'user-conflict\'" translate-namespace=.USER-CONFLICT> <img ng-src="{{ $ctrl.logo }}" alt=logo class=logo /> <p class=intro translate translate-values="{\n\t\t\t\t\tuser : $ctrl.profile.email,\n\t\t\t\t\trecipient : $ctrl.intendedRecipient\n\t\t\t\t}"> .INTRO </p> <div> <md-radio-group ng-model=$ctrl.userConflictResolution> <md-radio-button value=stay-logged-in> <translate translate-values="{ user : $ctrl.profile.email }">.STAY-LOGGED-IN</translate> </md-radio-button> <md-radio-button value=logout-current-user> <translate translate-values="{\n\t\t\t\t\t\t\t\tuser : $ctrl.profile.email,\n\t\t\t\t\t\t\t\trecipient : $ctrl.intendedRecipient\n\t\t\t\t\t\t\t}">.LOGOUT-CURRENT-USER</translate> </md-radio-button> </md-radio-group> <div class=actions> <md-button class="md-raised md-primary" ng-click=$ctrl.resolveConflict();> <translate>.SUBMIT</translate> </md-button> </div> </div> </div> <div ng-if="$ctrl.screen === \'for-delegate\'" translate-namespace=.FOR-DELEGATE> <img ng-src="{{ $ctrl.logo }}" alt=logo class=logo /> <p class=intro translate translate-values="{\n\t\t\t\t\tuser : $ctrl.profile.email,\n\t\t\t\t\trecipient : $ctrl.intendedRecipient\n\t\t\t\t}"> .INTRO </p> <div> <div class=actions> <md-button class="md-raised md-primary" ng-click=$ctrl.changeToDelegate();> <translate>.SUBMIT</translate> </md-button> </div> </div> </div> <div class=error ng-if="$ctrl.screen === \'error\'" ng-bind-html=$ctrl.error></div> </main> </div> <footer> <version with-api=false></version> <div class=secured-by ng-if="$ctrl.hasDefaultLogo() === false" layout=row> <span class=text translate>LANDING.OPEN.SECURED-BY</span> <span class=logo>ZIVER</span> </div> </footer> <language-select class=open-guest></language-select> '},function(t,e,i){t.exports=i.p+"assets/tpl/conversationStarter.49bf9a.html"},function(t,e,i){t.exports=i.p+"assets/tpl/addressBook.d31ac5.html"},function(t,e,i){t.exports=i.p+"assets/tpl/addressBookEmail.157364.html"},function(t,e,i){var n,o;n=[i,e,i(1)],void 0===(o=function(t,e,n){"use strict";function i(t){var e="ZIVVER",i=t[0];return{setTitle:function(t){null!==t?"  "===t.substr(-2)?i.title=t:i.title=t+" - "+e:i.title=e},getTitle:function(){return i.title.replace(e,"")}}}i.$inject=["$document"],Object.defineProperty(e,"__esModule",{value:!0}),e.DocumentTitleServiceModule=n.module("services.DocumentTitleService",[]).factory("DocumentTitleService",i).run(["$transitions",function(t){t.onSuccess({},function(t){var e=t.to(),i=t.injector().get("DocumentTitleService");n.isDefined(e.data)&&n.isDefined(e.data.title)?i.setTitle(e.data.title):i.setTitle(null)})}])}.apply(e,n))||(t.exports=o)},function(t,e,i){var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ErrorRoutes=[{name:"_errors",abstract:!0,template:i(636),lazyLoad:function(t){var e=t.injector().get("$ocLazyLoad");return new Promise(function(e,t){i.e(10).then(function(){var t=[i(696)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}).then(function(t){return e.load(t.ErrorsModule)})},data:{authorizationRequired:!1,permissionsRequired:[],bodyClass:"error auth"}},{name:"_errors.not_found",component:"errorsNotFound"},{name:"_errors.permissions",component:"errorsPermissions",resolve:{prevState:["$q","$stateParams",function(t,e){return t.resolve(e.prevState)}],scopes:["$q","$stateParams",function(t,e){return t.resolve(e.scopes)}]}},{name:"_errors.state_change",component:"errorsStateChange"}]}.apply(e,[i,e]))||(t.exports=n)},function(t,e){t.exports='<div class="auth errors" translate-cloak ui-view></div> <language-select></language-select> '},,,,,,,,,,,,function(t,e,i){var n,o;n=[i,e,i(649)],void 0===(o=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}.apply(e,n))||(t.exports=o)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){}],[[203,0,1,6]]]);